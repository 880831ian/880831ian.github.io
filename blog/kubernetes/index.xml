<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>PIN-YI â€“ Kubernetes</title><link>https://pin-yi.me/blog/kubernetes/</link><description>Recent content in Kubernetes on PIN-YI</description><generator>Hugo -- gohugo.io</generator><language>zh-tw</language><atom:link href="https://pin-yi.me/blog/kubernetes/index.xml" rel="self" type="application/rss+xml"/><item><title>kube-dns vs CoreDNS æ¯”è¼ƒï¼ŒDNS çš„æœ€ä½³å¯¦è¸</title><link>https://pin-yi.me/blog/kubernetes/kube-dns-vs-core-dns/</link><pubDate>Tue, 23 Jul 2024 00:00:00 +0000</pubDate><guid>https://pin-yi.me/blog/kubernetes/kube-dns-vs-core-dns/</guid><description>
&lt;p>å‰æƒ…æè¦ï¼šç”±æ–¼ä¸Šä¸€ç¯‡ç­†è¨˜ &lt;a href="../pod-curl-error-6-could-not-resolve-host" >Pod å‡ºç¾ cURL error 6: Could not resolve host&lt;/a> çš„å¾ŒçºŒè¦åŠƒä¸­ï¼Œæœ‰æå‡ºæˆ‘å€‘æƒ³ç ”ç©¶çœ‹çœ‹ Core DNS ä¾†å–ä»£ Kube DNSï¼Œå› æ­¤ï¼Œé€™ç¯‡ç­†è¨˜è¦ä¾†æ¯”è¼ƒä¸€ä¸‹ Kube DNS ä»¥åŠ Core DNS çš„å·®ç•°ä»¥åŠå…©è€…çš„å„ªç¼ºé»ï¼Œå¦å¤–é‚„æœƒèªªæ˜ä¸€ä¸‹ DNS çš„æœ€ä½³å¯¦è¸åšæ³•ã€‚&lt;/p>
&lt;br>
&lt;p>å‰é¢æ¦‚è«–ä»‹ç´¹ K8s å…§çš„ DNS ä»¥åŠ CoreDNS ä¸»è¦éƒ½æ˜¯åƒè€ƒ &lt;a href="https://weng-albert.medium.com/%E6%8E%A2%E7%A7%98k8s-dns-%E8%A7%A3%E5%AF%86ip%E6%9F%A5%E8%A9%A2%E8%88%87%E6%9C%8D%E5%8B%99%E7%99%BC%E7%8F%BE-034de2e72abe" target="_blank" rel="noopener">æ¢ç§˜K8S DNSï¼šè§£å¯†IPæŸ¥è©¢èˆ‡æœå‹™ç™¼ç¾&lt;/a>ã€&lt;a href="https://weng-albert.medium.com/coredns%E7%B0%A1%E5%96%AE%E9%99%A4%E9%8C%AF-%E8%A7%A3%E6%B1%BA%E4%BD%A0%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E8%88%AC%E5%95%8F%E9%A1%8C-71d255e39548" target="_blank" rel="noopener">CoreDNSç°¡å–®é™¤éŒ¯ï¼šè§£æ±ºä½ é‡åˆ°çš„ä¸€èˆ¬å•é¡Œ&lt;/a>ï¼Œè©³ç´°å¯ä»¥æŸ¥çœ‹åŸæ–‡ã€‚&lt;/p>
&lt;br>
&lt;h2>æ¦‚è«– (K8s DNS)&lt;span class="hx-absolute -hx-mt-20" id="æ¦‚è«–-k8s-dns">&lt;/span>
&lt;a href="#%e6%a6%82%e8%ab%96-k8s-dns" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>K8s æœƒæœ‰ DNS æœå‹™ï¼Œä¸»è¦æ˜¯å› ç‚º K8s é€£ç·šæ˜¯é€é Pod IP ä¾†é€£ç·šï¼Œä½†æ¯ç•¶ Pod é‡å•Ÿå¾Œ IP æœƒè®Šå‹•ï¼Œæ‰€ä»¥å°±éœ€è¦é€é Service é€™å€‹ Type å…ˆå»ºç«‹æŒä¹…æ€§çš„åç¨±ä¾†è®“å…¶ä»– Pod é€£ç·šåˆ°å¾Œç«¯æœå‹™ä¸Šã€‚&lt;/p>
&lt;p>ç•¶æˆ‘å€‘å»ºç«‹ Service æ™‚ï¼ŒK8s DNS å°±æœƒè‡ªå‹•ç”¢ç”Ÿä¸€å€‹å°æ‡‰çš„ A record å°‡ service dns name èˆ‡ IP ä½å€é…å°ã€‚ä¹‹å¾Œï¼ŒPod å°±å¯ä»¥é€é DNS åç¨±ä¾†é€²è¡Œé€£ç·šã€‚&lt;/p>
&lt;p>è€Œ DNS è² è²¬å‹•æ…‹æ›´æ–° A record èˆ‡ Service IP çš„ç•°å‹•ã€‚&lt;/p>
&lt;p>å°±å¦‚ä¸Šé¢æœ‰æåˆ°ï¼Œç›®å‰ K8s çš„ DNS å·²ç¶“å¾ kube-dns æ”¹æˆ CoreDNSï¼Œé‚£å…©è€…éƒ½æœ‰äº›ç›¸åŒçš„åŠŸèƒ½ï¼Œå¦‚ä¸‹ï¼š&lt;/p>
&lt;ol>
&lt;li>kube-dns svc å¯ä»¥å»ºç«‹ä¸€å€‹æˆ–å¤šå€‹ Pod&lt;/li>
&lt;li>kube-dns svc ç›£æ§ Kubernetes API çš„ service å’Œ endpoint äº‹ä»¶ï¼Œä¸¦æ ¹æ“šéœ€è¦è®Šæ›´å…¶ DNS é …ç›®ã€‚ç•¶é€éå»ºç«‹ã€ç·¨è¼¯æˆ–åˆªé™¤æ“ä½œä¿®æ”¹é€™äº› Kubernetes æœå‹™åŠå…¶ç›¸é—œ pod æ™‚ï¼Œé€™äº›äº‹ä»¶æœƒè‡ªå‹•è§¸ç™¼ã€‚&lt;/li>
&lt;li>Kubelet æœƒå°‡ kube-dns svc çš„å¢é›† IP æŒ‡æ´¾çµ¦æ¯å€‹æ–° Pod çš„ &lt;code>/etc/resolv.conf&lt;/code> åç¨±ä¼ºæœå™¨æª”æ¡ˆå…§ï¼Œä»¥åŠé©ç•¶çš„æœå°‹è¨­å®šä»¥å…è¨±æ›´çŸ­çš„ä¸»æ©Ÿåç¨±ï¼Œå¦‚ä¸‹ï¼šã€‚&lt;/li>
&lt;/ol>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/kube-dns-vs-core-dns/1.png"
alt="å¯ä»¥çœ‹åˆ° /etc/resolv.conf èˆ‡ kube-dns çš„ cluster IP ã„§è‡´" width="900">&lt;figcaption>
&lt;p>å¯ä»¥çœ‹åˆ° /etc/resolv.conf èˆ‡ kube-dns çš„ cluster IP ã„§è‡´&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>K8s æœå‹™çš„æ•´å€‹ DNS A record å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>Service DNS nameï¼š&lt;/li>
&lt;/ul>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;pre>&lt;code>[service].[namespace].svc.cluster.local&lt;/code>&lt;/pre>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>serviceã€namespace å¯ä»¥è‡ªè¡Œæ›¿æ›ï¼Œé€™ä¹Ÿæ˜¯æˆ‘å€‘æœ€å¸¸ä½¿ç”¨çš„æ–¹å¼ã€‚&lt;/p>
&lt;br>
&lt;p>ç•¶ç„¶ Pod ä¹Ÿæœ‰è‡ªå·±çš„ DNS nameï¼Œåªæ˜¯å› çˆ² Pod æ¯æ¬¡é‡å•Ÿ IP æœƒè®Šå‹•ï¼Œæ‰€ä»¥æˆ‘å€‘é€šå¸¸ä¸æœƒä½¿ç”¨ Pod DNS nameï¼š&lt;/p>
&lt;ul>
&lt;li>Pod DNS nameï¼š&lt;/li>
&lt;/ul>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;pre>&lt;code>[pod cluster IP].[namespace].pod.cluster.local&lt;/code>&lt;/pre>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>pod cluster IP é€™é‚Šè¦å°‡ IP å¾ . çš„åˆ†éš”ç¬¦è™Ÿæ›æˆ -ï¼Œä¾‹å¦‚ï¼š&lt;code>10-166-65-136.default.pod.cluster.local&lt;/code>&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/kube-dns-vs-core-dns/2.png"
alt="å¯ä»¥çœ‹åˆ° curl çš„ pod cluster IP èˆ‡ svc çš„ endpoint ã„§è‡´" width="750">&lt;figcaption>
&lt;p>å¯ä»¥çœ‹åˆ° curl çš„ pod cluster IP èˆ‡ svc çš„ endpoint ã„§è‡´&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>æ‰€ä»¥ï¼Œç¨‹å¼å¯ä»¥é€éç°¡å–®ä¸”ä¸€è‡´çš„ä¸»æ©Ÿåç¨±ä¾†å­˜å– cluster å…¶ä»–æœå‹™æˆ–æ˜¯ Podã€‚&lt;/p>
&lt;p>ä¹Ÿä¸éœ€è¦ä½¿ç”¨å®Œæ•´çš„ hostname ä¾†å­˜å–æœå‹™ï¼Œå› ç‚ºåœ¨ &lt;code>resolv.conf&lt;/code> æœƒè¨­å®šå¥½ domain çš„ suffixesï¼Œå¦‚æœåŒä¸€å€‹ namespace åº•ä¸‹æœå‹™æºé€šï¼Œåªè¦è¨­å®šä»¥ä¸‹å³å¯ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;pre>&lt;code>[service]&lt;/code>&lt;/pre>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>è·¨åˆ°å…¶ä»– nampesace å°±è¦æ”¹æˆï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;pre>&lt;code>[service].[namespace]&lt;/code>&lt;/pre>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;h2>æ‡‰ç”¨ç¨‹å¼ DNS æŸ¥è©¢æµç¨‹&lt;span class="hx-absolute -hx-mt-20" id="æ‡‰ç”¨ç¨‹å¼-dns-æŸ¥è©¢æµç¨‹">&lt;/span>
&lt;a href="#%e6%87%89%e7%94%a8%e7%a8%8b%e5%bc%8f-dns-%e6%9f%a5%e8%a9%a2%e6%b5%81%e7%a8%8b" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/kube-dns-vs-core-dns/3.jpg"
alt="æ‡‰ç”¨ç¨‹å¼ DNS æŸ¥è©¢æµç¨‹ åœ–ç‰‡ï¼šConnecting the Dots: Understanding How Pods Talk in Kubernetes Networks" width="700">&lt;figcaption>
&lt;p>æ‡‰ç”¨ç¨‹å¼ DNS æŸ¥è©¢æµç¨‹ åœ–ç‰‡ï¼š&lt;a href="https://medium.com/@seifeddinerajhi/connecting-the-dots-understanding-how-pods-talk-in-kubernetes-networks-992fa69fbbeb" target="_blank" rel="noopener">Connecting the Dots: Understanding How Pods Talk in Kubernetes Networks&lt;/a>&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>ä¸‹é¢åˆ—å‡ºä¸€ä¸‹æ‡‰ç”¨ç¨‹å¼åœ¨ K8s å…§çš„ DNS æŸ¥è©¢æµç¨‹ï¼š&lt;/p>
&lt;ol>
&lt;li>ç•¶ Pod åŸ·è¡Œ DNS æŸ¥è©¢æ™‚ï¼Œæœƒå…ˆæŸ¥è©¢ Pod è£¡é¢çš„ &lt;code>resolv.conf&lt;/code> æª”æ¡ˆï¼Œå†ä¾†æŸ¥è©¢ Pod æ‰€åœ¨çš„ node ä¸Šçš„ &lt;code>resolv.conf&lt;/code> æª”æ¡ˆï¼Œé€™å€‹æª”æ¡ˆæœ‰è¨­å®š nodelocaldns ä¼ºæœå™¨è¢«è¨­å®šç‚ºé è¨­éè¿´ DNS è§£æå™¨ï¼Œå……ç•¶å¿«å– (åœ¨ GKE éœ€è¦å¦å¤–é–‹å•Ÿ)ã€‚&lt;/li>
&lt;li>å¦‚æœæ­¤å¿«å–ä¸åŒ…å«æ‰€è«‹æ±‚ä¸»æ©Ÿåç¨±çš„ IP ä½å€ï¼Œå‰‡æŸ¥è©¢å°‡è½‰é€è‡³å¢é›† DNS ä¼ºæœå™¨ (CoreDNS)ï¼Œç›®å‰ GKE æ˜¯ kube-dnsã€‚&lt;/li>
&lt;li>æ­¤ DNS ä¼ºæœå™¨é€éæŸ¥è©¢ Kubernetes æœå‹™è¨»å†Šè¡¨ä¾†æ±ºå®š IP ä½å€ã€‚æ­¤è¨»å†Šè¡¨åŒ…å«æœå‹™åç¨±åˆ°å°æ‡‰ IP ä½å€çš„å°æ‡‰ã€‚é€™å…è¨±å¢é›† DNS ä¼ºæœå™¨å°‡æ­£ç¢ºçš„ IP ä½å€å‚³å›çµ¦è«‹æ±‚çš„ podã€‚&lt;/li>
&lt;li>ä»»ä½•è¢«æŸ¥è©¢ä½†ä¸åœ¨ Kubernetes æœå‹™è¨»å†Šè¡¨ä¸­çš„ç¶²åŸŸéƒ½æœƒè½‰é€åˆ°ä¸Šæ¸¸ DNS ä¼ºæœå™¨ã€‚&lt;/li>
&lt;/ol>
&lt;br>
&lt;h2>æ¦‚è«– (kube-dns)&lt;span class="hx-absolute -hx-mt-20" id="æ¦‚è«–-kube-dns">&lt;/span>
&lt;a href="#%e6%a6%82%e8%ab%96-kube-dns" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>é€™é‚Šå°±ä¾†èªªä¸€ä¸‹ç›®å‰ GKE åœ¨ä½¿ç”¨çš„ kube-dns æ¶æ§‹ï¼Œä¸»è¦ç”±é€™ä¸‰å€‹ container çµ„æˆï¼š&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/kube-dns-vs-core-dns/4.jpg"
alt="kube-dns æ¶æ§‹ åœ–ç‰‡ï¼šDNS" width="600">&lt;figcaption>
&lt;p>kube-dns æ¶æ§‹ åœ–ç‰‡ï¼š&lt;a href="https://feisky.gitbooks.io/kubernetes/content/components/kube-dns.html" target="_blank" rel="noopener">DNS&lt;/a>&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/kube-dns-vs-core-dns/5.png"
alt="ç›®å‰ GKE 1.29 kube-dns" width="750">&lt;figcaption>
&lt;p>ç›®å‰ GKE 1.29 kube-dns&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;ul>
&lt;li>kubednsï¼šDNS æœå‹™æ ¸å¿ƒå…ƒä»¶ï¼Œä¸»è¦ç”± KubeDNS ä»¥åŠ SkyDNS å…©å€‹å…ƒä»¶çµ„æˆï¼š
&lt;ul>
&lt;li>KubeDNS è² è²¬ç›£è½ Kubernetes API çš„ service å’Œ endpoint äº‹ä»¶ï¼Œä¸¦å°‡ç›¸é—œè¨Šæ¯æ›´æ–°åˆ° SkyDNS ä¸­ã€‚&lt;/li>
&lt;li>SkyDNS è² è²¬ DNS è§£æï¼Œç›£è½åœ¨ 10053 Port (tcp/udp)ï¼Œä¹ŸåŒæ™‚ç›£è½åœ¨ 10055 Port æä¾› metricsã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/kube-dns-vs-core-dns/6.png"
alt="SkyDNS Metrics Port ä»¥åŠç›£è½ 10053 Port" width="750">&lt;figcaption>
&lt;p>SkyDNS Metrics Port ä»¥åŠç›£è½ 10053 Port&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;ul>
&lt;li>
&lt;p>dnsmasq (æœ‰æ›åç¨±)ï¼šè² è²¬å•Ÿå‹• dnsmasqï¼Œä¸¦åœ¨è®ŠåŒ–æ™‚é‡å•Ÿ dnsmasqï¼š&lt;/p>
&lt;ul>
&lt;li>dnsmasq çš„ Upstream DNS Server æ˜¯ SkyDNSï¼Œcluster å…§éƒ¨çš„ DNS æŸ¥è©¢éƒ½æœƒç”± SkyDNS è² è²¬ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>sidecarï¼šè² è²¬å¥åº·æª¢æŸ¥å’Œæä¾› DNS metrics ç›£è½åœ¨ 10054 Portã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/kube-dns-vs-core-dns/7.png"
alt="sidecar å¥åº·æª¢æŸ¥ä»¥åŠç›£è½ 10054 Port" width="750">&lt;figcaption>
&lt;p>sidecar å¥åº·æª¢æŸ¥ä»¥åŠç›£è½ 10054 Port&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;h2>æ¦‚è«– (CoreDNS)&lt;span class="hx-absolute -hx-mt-20" id="æ¦‚è«–-coredns">&lt;/span>
&lt;a href="#%e6%a6%82%e8%ab%96-coredns" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>é€™é‚Šå°±èªªæ˜ä¸€ä¸‹æˆ‘å€‘æƒ³è¦ç ”ç©¶çš„ CoreDNS å§ï¼Œå…¶å¯¦æ—©å°±æ‡‰è©²ç”¨ CoreDNS ä¾†å–ä»£ kube-dnsï¼Œ&lt;del>&lt;del>åªæ˜¯ GKE ä¸çŸ¥é“ç‚ºä»€éº¼é‚„ä¸æ”¯æ´&lt;/del>&lt;/del>&lt;/p>
&lt;p>CoreDNS æ˜¯ä¸€å€‹ç”¨ Go èªè¨€å¯«çš„ DNS ä¼ºæœå™¨ï¼Œå®ƒæ˜¯ä¸€å€‹ CNCF çš„å°ˆæ¡ˆï¼Œç›®å‰å·²ç¶“æˆç‚º K8s çš„é è¨­ DNS ä¼ºæœå™¨ã€‚&lt;/p>
&lt;p>è·Ÿå…¶ä»– DNS æ¯”è¼ƒä¸ä¸€æ¨£çš„æ˜¯ä»–éå¸¸éˆæ´»å½ˆæ€§ï¼Œä¸¦ä¸”æ‰€æœ‰åŠŸèƒ½éƒ½æ˜¯é€é Plugins ä¾†å¯¦ç¾ï¼Œé€™æ¨£å°±å¯ä»¥æ ¹æ“šéœ€æ±‚ä¾†è‡ªè¨‚è‡ªå·±çš„ DNS ä¼ºæœå™¨ã€‚&lt;/p>
&lt;p>å®ƒçš„ç‰¹é»æ˜¯ï¼š&lt;/p>
&lt;ol>
&lt;li>Plugins (æ’ä»¶åŒ–)&lt;/li>
&lt;li>Service Discovery (æœå‹™ç™¼ç¾)&lt;/li>
&lt;li>Fast and Flexible (å¿«é€Ÿä¸”éˆæ´»)&lt;/li>
&lt;li>Simplicity (ç°¡å–®)&lt;/li>
&lt;/ol>
&lt;p>é€™é‚Šä¾†èªªä¸€ä¸‹ å¸¸è¦‹çš„ Plugins å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>loadbalanceï¼šæä¾›åŸºæ–¼ DNS çš„è² è¼‰å‡è¡¡åŠŸèƒ½&lt;/li>
&lt;li>loopï¼šæª¢æ¸¬åœ¨ DNS è§£æéç¨‹ä¸­å‡ºç¾çš„ç°¡å–®å¾ªç’°å•é¡Œ&lt;/li>
&lt;li>cacheï¼šæä¾›å‰ç«¯å¿«å–åŠŸèƒ½&lt;/li>
&lt;li>healthï¼šå° Endpoint é€²è¡Œå¥åº·æª¢æŸ¥&lt;/li>
&lt;li>kubernetesï¼šæä¾›å° Kubernetes API çš„è¨ªå•ï¼Œä¸¦å°‡å…¶è½‰æ›ç‚º DNS è¨˜éŒ„&lt;/li>
&lt;li>etcdï¼šæä¾›å° etcd çš„è¨ªå•ï¼Œä¸¦å°‡å…¶è½‰æ›ç‚º DNS è¨˜éŒ„&lt;/li>
&lt;li>reloadï¼šå®šæ™‚è‡ªå‹•é‡æ–°åŠ è¼‰ Corefile é…ç½®çš„å…§å®¹&lt;/li>
&lt;li>forwardï¼šè½‰ç™¼åŸŸåæŸ¥è©¢åˆ°ä¸Šæ¸¸ DNS ä¼ºæœå™¨&lt;/li>
&lt;li>proxyï¼šè½‰ç™¼ç‰¹å®šçš„åŸŸåæŸ¥è©¢åˆ°å¤šå€‹å…¶ä»– DNS ä¼ºæœå™¨ï¼ŒåŒæ™‚æä¾›åˆ°å¤šå€‹ DNS æœå‹™å™¨çš„è² è¼‰å‡è¡¡åŠŸèƒ½&lt;/li>
&lt;li>prometheusï¼šçˆ² Prometheus ç³»çµ±æä¾›æ¡é›†æ€§èƒ½æŒ‡æ‘½æ•¸æ“šçš„ URL&lt;/li>
&lt;li>logï¼šå° DNS æŸ¥è©¢é€²è¡Œæ—¥èªŒè¨˜éŒ„&lt;/li>
&lt;li>errorsï¼šå° DNS æŸ¥è©¢éŒ¯èª¤é€²è¡Œæ—¥èªŒè¨˜éŒ„&lt;/li>
&lt;/ul>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/kube-dns-vs-core-dns/8.png"
alt="CoreDNS ä½¿ç”¨çš„ Plugins/æ¶æ§‹ åœ–ç‰‡ï¼šA Brief Look at CoreDNS" width="750">&lt;figcaption>
&lt;p>CoreDNS ä½¿ç”¨çš„ Plugins/æ¶æ§‹ åœ–ç‰‡ï¼š&lt;a href="https://livewyer.io/blog/2018/05/31/a-brief-look-at-coredns/" target="_blank" rel="noopener">A Brief Look at CoreDNS&lt;/a>&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>CoreDNS çš„ helmï¼š&lt;a href="https://github.com/coredns/helm/tree/master/charts/coredns" target="_blank" rel="noopener">https://github.com/coredns/helm/tree/master/charts/coredns&lt;/a>&lt;/p>
&lt;br>
&lt;h2>kube-dns vs CoreDNS å„ªç¼ºé»&lt;span class="hx-absolute -hx-mt-20" id="kube-dns-vs-coredns-å„ªç¼ºé»">&lt;/span>
&lt;a href="#kube-dns-vs-coredns-%e5%84%aa%e7%bc%ba%e9%bb%9e" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;h3>kube-dns&lt;span class="hx-absolute -hx-mt-20" id="kube-dns">&lt;/span>
&lt;a href="#kube-dns" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;ul>
&lt;li>å„ªé»ï¼šæœ‰ dnsmesqï¼Œåœ¨æ€§èƒ½ä¸Šæœ‰ä¸€å®šçš„ä¿éšœã€‚&lt;/li>
&lt;li>ç¼ºé»ï¼š dnsmesq å¦‚æœé‡å•Ÿï¼Œæœƒå…ˆåˆªæ‰ process æ‰æœƒé‡æ–°èµ·æœå‹™ï¼Œä¸­é–“å¯èƒ½æœƒå‡ºç¾æŸ¥è©¢å¤±æ•—ã€‚åœ¨ç¢ºèªå…§éƒ¨æª”æ¡ˆæ™‚ï¼Œå¦‚æœæ•¸é‡éå¤šæˆ–æ˜¯å¤ªé »ç¹æ›´æ–° DNS æœ‰å¯èƒ½åè€Œå°è‡´ dnsmasq ä¸ç©©ï¼Œé€™æ™‚å€™å°±éœ€è¦é‡å•Ÿ dnsmasq æœå‹™ã€‚&lt;/li>
&lt;/ul>
&lt;br>
&lt;h3>CoreDNS&lt;span class="hx-absolute -hx-mt-20" id="coredns">&lt;/span>
&lt;a href="#coredns" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;ul>
&lt;li>å„ªé»ï¼šå¯ä»¥è‡ªè¡Œæ ¹æ“šéœ€æ±‚ä½¿ç”¨è‡ªè¨‚çš„ Pluginsï¼Œè¨˜æ†¶é«”çš„ä½”ç”¨æƒ…æ³ä¹Ÿæ¯” kube-dns å¥½ã€‚&lt;/li>
&lt;li>ç¼ºé»ï¼šCache åŠŸèƒ½ä¸å¦‚ dnsmasqï¼Œå…§éƒ¨è§£æé€Ÿåº¦å¯èƒ½æœƒæ¯” kube-dns æ…¢ã€‚&lt;/li>
&lt;/ul>
&lt;br>
&lt;h2>GKE ä¸Šçš„ DNSï¼Œå¯ä»¥æ”¹ç”¨ CoreDNS å—ï¼Ÿ&lt;span class="hx-absolute -hx-mt-20" id="gke-ä¸Šçš„-dnså¯ä»¥æ”¹ç”¨-coredns-å—">&lt;/span>
&lt;a href="#gke-%e4%b8%8a%e7%9a%84-dns%e5%8f%af%e4%bb%a5%e6%94%b9%e7%94%a8-coredns-%e5%97%8e" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>ç›®å‰ GKE ä¸Šçš„ DNS é è¨­æ˜¯ kube-dnsï¼Œæˆ–æ˜¯ä½¿ç”¨ GCP æä¾›çš„å¦ä¸€å€‹ Cloud DNS æœå‹™ï¼Œä½†æ˜¯ä¸Šæ¬¡æˆ‘å€‘æœ‰æåˆ°ï¼Œå› ç‚ºå…¬å¸ä¹‹å¾Œæƒ³èµ°å¤šé›²æ¶æ§‹ï¼Œæœƒé–‹å§‹ä½¿ç”¨ AWSï¼Œè€Œ AWS çš„ EKS é è¨­çš„ DNS æœå‹™æ˜¯ CoreDNS (K8s ç¾åœ¨é è¨­ä¹Ÿæ˜¯ CoreDNS ğŸ˜¿)&lt;/p>
&lt;p>æ‰€ä»¥æˆ‘å€‘æƒ³èªªï¼Œæ˜¯ä¸æ˜¯å¯ä»¥åœ¨ GKE ä¸Šä¹Ÿæ”¹ä½¿ç”¨ CoreDNSï¼Œé€™æ¨£ä¹‹å¾Œç¶­è­·å¯ä»¥æ›´ä¸€è‡´ã€‚&lt;/p>
&lt;br>
&lt;p>åœ¨çˆ¬æ–‡çš„éç¨‹ä¸­æœ‰ç™¼ç¾ï¼ŒGoogle æœ‰ä¸€ç¯‡ knowledge æ–‡ç«  &lt;a href="https://cloud.google.com/knowledge/kb/how-to-run-coredns-on-kubernetes-engine-000004698" target="_blank" rel="noopener">How to run CoreDNS on Kubernetes Engine?&lt;/a> æœ‰æåˆ° Google é è¨­å°±æ˜¯ä½¿ç”¨ kube-dnsï¼Œæ²’è¾¦æ³•æŠŠ kube-dns ç¸®å°åˆ° 0 ä¸¦å®Œå…¨æ›¿æ›ï¼Œå¦‚æœåªæ˜¯å–®ç´”æƒ³è¦ä½¿ç”¨ CoreDNS çš„å¿«å–åŠŸèƒ½ï¼Œå¯ä»¥å•Ÿç”¨ GKE ä¸Šçš„ NodeLocal DNSCache&lt;/p>
&lt;p>å¦‚æœæƒ³è¦æŠŠ CronDNS è§£æåŠŸèƒ½åŠ åˆ° GKE ä¸Šï¼Œè¦å…ˆéƒ¨ç½²ä¸€å€‹ core-dns Podï¼Œä¸¦é€é service å…¬é–‹å®ƒï¼Œä¸¦ç‚º kube-dns é…ç½®ä¸€å€‹ stub domainï¼Œå°‡å…¶æŒ‡å‘ core-dns æœå‹™ IPã€‚&lt;/p>
&lt;p>æ‰€æœ‰èˆ‡ stub domain å¾Œç¶´ç›¸ç¬¦çš„æµé‡éƒ½æœƒè·¯ç”±åˆ° core-dns Podã€‚ä¸ç¬¦åˆçš„æµé‡å°‡ç¹¼çºŒç”± kube-dns è§£æã€‚&lt;/p>
&lt;br>
&lt;h2>DNS çš„æœ€ä½³å¯¦è¸&lt;span class="hx-absolute -hx-mt-20" id="dns-çš„æœ€ä½³å¯¦è¸">&lt;/span>
&lt;a href="#dns-%e7%9a%84%e6%9c%80%e4%bd%b3%e5%af%a6%e8%b8%90" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>(ä»£è£œ&amp;hellip;.)&lt;/p>
&lt;br>
&lt;h2>åƒè€ƒè³‡æ–™&lt;span class="hx-absolute -hx-mt-20" id="åƒè€ƒè³‡æ–™">&lt;/span>
&lt;a href="#%e5%8f%83%e8%80%83%e8%b3%87%e6%96%99" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>æ¢ç§˜K8S DNSï¼šè§£å¯†IPæŸ¥è©¢èˆ‡æœå‹™ç™¼ç¾ï¼š&lt;a href="https://weng-albert.medium.com/%E6%8E%A2%E7%A7%98k8s-dns-%E8%A7%A3%E5%AF%86ip%E6%9F%A5%E8%A9%A2%E8%88%87%E6%9C%8D%E5%8B%99%E7%99%BC%E7%8F%BE-034de2e72abe" target="_blank" rel="noopener">https://weng-albert.medium.com/%E6%8E%A2%E7%A7%98k8s-dns-%E8%A7%A3%E5%AF%86ip%E6%9F%A5%E8%A9%A2%E8%88%87%E6%9C%8D%E5%8B%99%E7%99%BC%E7%8F%BE-034de2e72abe&lt;/a>&lt;/p>
&lt;p>CoreDNSç°¡å–®é™¤éŒ¯ï¼šè§£æ±ºä½ é‡åˆ°çš„ä¸€èˆ¬å•é¡Œï¼š&lt;a href="https://weng-albert.medium.com/coredns%E7%B0%A1%E5%96%AE%E9%99%A4%E9%8C%AF-%E8%A7%A3%E6%B1%BA%E4%BD%A0%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E8%88%AC%E5%95%8F%E9%A1%8C-71d255e39548" target="_blank" rel="noopener">https://weng-albert.medium.com/coredns%E7%B0%A1%E5%96%AE%E9%99%A4%E9%8C%AF-%E8%A7%A3%E6%B1%BA%E4%BD%A0%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E8%88%AC%E5%95%8F%E9%A1%8C-71d255e39548&lt;/a>&lt;/p>
&lt;p>Connecting the Dots: Understanding How Pods Talk in Kubernetes Networksï¼š&lt;a href="https://medium.com/@seifeddinerajhi/connecting-the-dots-understanding-how-pods-talk-in-kubernetes-networks-992fa69fbbeb" target="_blank" rel="noopener">https://medium.com/@seifeddinerajhi/connecting-the-dots-understanding-how-pods-talk-in-kubernetes-networks-992fa69fbbeb&lt;/a>&lt;/p>
&lt;p>How to run CoreDNS on Kubernetes Engine?ï¼š&lt;a href="https://cloud.google.com/knowledge/kb/how-to-run-coredns-on-kubernetes-engine-000004698" target="_blank" rel="noopener">https://cloud.google.com/knowledge/kb/how-to-run-coredns-on-kubernetes-engine-000004698&lt;/a>&lt;/p></description></item><item><title>Pod å‡ºç¾ cURL error 6: Could not resolve host</title><link>https://pin-yi.me/blog/kubernetes/pod-curl-error-6-could-not-resolve-host/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pin-yi.me/blog/kubernetes/pod-curl-error-6-could-not-resolve-host/</guid><description>
&lt;p>æ­¤ç¯‡ä¸»è¦æ˜¯ä¾†è¨˜éŒ„ä¸€ä¸‹åœ¨æ­£å¼ç’°å¢ƒæœå‹™å‡ºç¾ &lt;code>cURL error 6: Could not resolve host&lt;/code> çš„å•é¡Œï¼Œä»¥åŠå¦‚ä½•è§£æ±ºã€‚&lt;/p>
&lt;br>
&lt;h2>å•é¡Œç™¼ç”Ÿ&lt;span class="hx-absolute -hx-mt-20" id="å•é¡Œç™¼ç”Ÿ">&lt;/span>
&lt;a href="#%e5%95%8f%e9%a1%8c%e7%99%bc%e7%94%9f" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>ç•¶å¤© RD åœ¨å…¬çª—åæ‡‰èªªï¼ŒAPI ç¨‹å¼å»æ‰“å…¶ä»–å–®ä½æˆ–æ˜¯ Google BigQuery çš„ API æ™‚ï¼Œæœƒå‡ºç¾ &lt;code>cURL error 6: Could not resolve host&lt;/code> çš„éŒ¯èª¤ï¼Œä½†é€™å€‹éŒ¯èª¤æ˜¯å¶ç™¼æ€§éŒ¯èª¤ï¼Œä¸”å‡ºç¾éŒ¯èª¤çš„ Pod ä¹Ÿä¸æ˜¯å›ºå®šï¼Œä¹Ÿæœƒå‡ºç¾åœ¨ä¸åŒçš„ node ä¸Šã€‚&lt;/p>
&lt;p>ç•¶ä¸‹æª¢æŸ¥æœå‹™æ˜¯æ­£å¸¸çš„ï¼Œä¹Ÿæ²’æœ‰ä»»ä½•ç•°å¸¸ï¼Œå› æ­¤æˆ‘å€‘é¦¬ä¸Šé–‹äº† Google Support Ticket ä¾†è©¢å•ã€‚&lt;/p>
&lt;br>
&lt;h2>è§£æ±ºè¾¦æ³• &amp;amp; å¾ŒçºŒè¦åŠƒ&lt;span class="hx-absolute -hx-mt-20" id="è§£æ±ºè¾¦æ³•--å¾ŒçºŒè¦åŠƒ">&lt;/span>
&lt;a href="#%e8%a7%a3%e6%b1%ba%e8%be%a6%e6%b3%95--%e5%be%8c%e7%ba%8c%e8%a6%8f%e5%8a%83" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;h3>è‡ªè¡Œæ¸¬è©¦&lt;span class="hx-absolute -hx-mt-20" id="è‡ªè¡Œæ¸¬è©¦">&lt;/span>
&lt;a href="#%e8%87%aa%e8%a1%8c%e6%b8%ac%e8%a9%a6" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>åœ¨ç­‰å¾… Google Support å›è¦†åŒæ™‚ï¼Œä¹Ÿå…ˆåœ¨ç¶²è·¯ä¸Šæœå°‹å‡ºç¾ &lt;code>cURL error 6: Could not resolve host&lt;/code> çš„ç›¸é—œéŒ¯èª¤ï¼Œä¸»è¦éƒ½æ˜¯å› ç‚º DNS å°è‡´ï¼Œå› æ­¤æˆ‘å€‘ä¹Ÿå…ˆæª¢æŸ¥äº†ä¸€ä¸‹ç›®å‰ DNS çš„è¨­å®šã€‚&lt;/p>
&lt;p>åƒè€ƒäº† Google çš„ kube-dns æ–‡ä»¶å¾Œ &lt;a href="https://cloud.google.com/kubernetes-engine/docs/how-to/nodelocal-dns-cache#scaling_up_kube-dns" target="_blank" rel="noopener">Setting up NodeLocal DNSCache/Scaling up kube-dns&lt;/a>ï¼Œæˆ‘å€‘å˜—è©¦èª¿æ•´ kube-dns-autoscaler configmap çš„è¨­å®šï¼š&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/pod-curl-error-6-could-not-resolve-host/1.png"
alt="kube-dns-autoscaler configmap" width="800">&lt;figcaption>
&lt;p>kube-dns-autoscaler configmap&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>ä¸¦è§€å¯Ÿä¸€é™£å­å¾Œç™¼ç¾ï¼Œå‡ºç¾ &lt;code>cURL error 6: Could not resolve host&lt;/code> çš„éŒ¯èª¤ Log å·²ç¶“æ²’æœ‰å†å‡ºç¾ï¼Œå› æ­¤æˆ‘å€‘èªç‚ºæ˜¯ DNS çš„å•é¡Œï¼Œä¸¦å›å ±çµ¦ Google Supportã€‚&lt;/p>
&lt;br>
&lt;p>Kube-dns çš„ Pod æ˜¯ç”± kube-dns-autoscaler çš„ configmap ä¾†æ§åˆ¶ Pod æ•¸é‡ï¼Œå¦‚åœ–ï¼š&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/pod-curl-error-6-could-not-resolve-host/2.png"
alt="kube-dns-autoscaler configmap" width="700">&lt;figcaption>
&lt;p>kube-dns-autoscaler configmap&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;h4>kube-dns-autoscaler configmap è¨­å®š&lt;span class="hx-absolute -hx-mt-20" id="kube-dns-autoscaler-configmap-è¨­å®š">&lt;/span>
&lt;a href="#kube-dns-autoscaler-configmap-%e8%a8%ad%e5%ae%9a" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h4>&lt;p>æˆ‘å€‘ä¾†èªªæ˜ä¸€ä¸‹é€™å€‹è¨­å®šå…§å®¹æ˜¯ä»€éº¼ (ä¸‹é¢æœƒå…ˆä»¥ GCP çš„ kube-dns å®˜ç¶²æ–‡ä»¶ä¾†è£œå……èªªæ˜ï¼Œè€Œä¸æ˜¯ä¸Šé¢åœ–ç‰‡)ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div class="filename not-prose" dir="auto">configmap kube-dns-autoscaler&lt;/div>&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>linear: &lt;span style="color:#e6db74">&amp;#39;{
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> &amp;#34;coresPerReplica&amp;#34;: 256,
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> &amp;#34;includeUnschedulableNodes&amp;#34;: true,
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> &amp;#34;nodesPerReplica&amp;#34;: 16,
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> &amp;#34;min&amp;#34;: 1,
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> &amp;#34;max&amp;#34;: 5,
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> &amp;#34;preventSinglePointFailure&amp;#34;: true
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">}&amp;#39;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-8">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;ul>
&lt;li>coresPerReplicaï¼šå¤šå°‘å€‹ cores å•Ÿå‹•ä¸€å€‹ kube-dns pod (é è¨­ 256ï¼Œä¹Ÿå°±æ˜¯æ¯ 256 core æ‰æœƒå•Ÿå‹•ä¸€å€‹ kube-dns pod)&lt;/li>
&lt;li>nodesPerReplicaï¼šå¤šå°‘å€‹ node å•Ÿå‹•ä¸€å€‹ kube-dns pod (é è¨­ 16ï¼Œä¹Ÿå°±æ˜¯æ¯ 16 node æ‰æœƒå•Ÿå‹•ä¸€å€‹ kube-dns pod)&lt;/li>
&lt;li>minï¼šæœ€å° kube-dns pod æ•¸é‡&lt;/li>
&lt;li>maxï¼šæœ€å¤§ kube-dns pod æ•¸é‡&lt;/li>
&lt;/ul>
&lt;br>
&lt;p>GCP kube-dns å®˜ç¶²æ–‡ä»¶å»ºè­°ï¼š&lt;/p>
&lt;ol>
&lt;li>è¦å° &lt;code>nodesPerReplica&lt;/code> è¨­å®šæ¯”è¼ƒä½çš„å€¼ï¼Œç¢ºä¿åœ¨å¢é›†ç¯€é»æ“´å……æ™‚ï¼Œkube-dns pod æ•¸é‡ä¹Ÿæœƒè·Ÿè‘—å¢åŠ ã€‚&lt;/li>
&lt;li>ä¹Ÿå¼·çƒˆå»ºè­°è¨­å®šä¸€å€‹æ˜ç¢ºçš„ max å€¼ï¼Œä»¥ç¢ºä¿ GKE control plane ä¸æœƒå› å¤§é‡çš„ kube-dns pod å»ä½¿ç”¨ Kubernetes API è€Œéè¼‰ã€‚&lt;/li>
&lt;/ol>
&lt;br>
&lt;h4>kube-dns è¨ˆç®—æ–¹å¼&lt;span class="hx-absolute -hx-mt-20" id="kube-dns-è¨ˆç®—æ–¹å¼">&lt;/span>
&lt;a href="#kube-dns-%e8%a8%88%e7%ae%97%e6%96%b9%e5%bc%8f" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h4>&lt;p>kube-dns çš„ pod æ•¸é‡è¨ˆç®—æ–¹å¼å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>replicas &lt;span style="color:#f92672">=&lt;/span> max&lt;span style="color:#f92672">(&lt;/span> ceil&lt;span style="color:#f92672">(&lt;/span> cores Ã— 1/coresPerReplica &lt;span style="color:#f92672">)&lt;/span> , ceil&lt;span style="color:#f92672">(&lt;/span> nodes Ã— 1/nodesPerReplica &lt;span style="color:#f92672">)&lt;/span>, maxValue &lt;span style="color:#f92672">)&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;p>æƒ…å¢ƒä¸€ï¼šå‡è¨­æˆ‘ç¾åœ¨æœ‰ 16 å€‹ nodeï¼Œcore æ•¸é‡æœƒæ˜¯ 50ï¼Œé‚£éº¼ kube-dns pod æ•¸é‡å°±æœƒæ˜¯ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>replicas &lt;span style="color:#f92672">=&lt;/span> max&lt;span style="color:#f92672">(&lt;/span> ceil&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#ae81ff">50&lt;/span> Ã— 1/256&lt;span style="color:#f92672">)&lt;/span> , ceil&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#ae81ff">16&lt;/span> Ã— 1/16&lt;span style="color:#f92672">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; replicas &lt;span style="color:#f92672">=&lt;/span> max&lt;span style="color:#f92672">(&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> , 1&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; replicas &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;p>æƒ…å¢ƒäºŒï¼šå‡è¨­æˆ‘ç¾åœ¨æœ‰ 32 å€‹ nodeï¼Œcore æ•¸é‡æœƒæ˜¯ 100ï¼Œé‚£éº¼ kube-dns pod æ•¸é‡å°±æœƒæ˜¯ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>replicas &lt;span style="color:#f92672">=&lt;/span> max&lt;span style="color:#f92672">(&lt;/span> ceil&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#ae81ff">100&lt;/span> Ã— 1/256&lt;span style="color:#f92672">)&lt;/span> , ceil&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#ae81ff">32&lt;/span> Ã— 1/16&lt;span style="color:#f92672">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; replicas &lt;span style="color:#f92672">=&lt;/span> max&lt;span style="color:#f92672">(&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> , 2&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; replicas &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;p>æƒ…å¢ƒä¸‰ï¼šå‡è¨­æˆ‘ç¾åœ¨æœ‰ 96 å€‹ nodeï¼Œcore æ•¸é‡æœƒæ˜¯ 300ï¼Œæœ‰å¤šè¨­å®š max æ˜¯ 5ï¼Œé‚£éº¼ kube-dns pod æ•¸é‡å°±æœƒæ˜¯ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>replicas &lt;span style="color:#f92672">=&lt;/span> max&lt;span style="color:#f92672">(&lt;/span> ceil&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#ae81ff">300&lt;/span> Ã— 1/256&lt;span style="color:#f92672">)&lt;/span> , ceil&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#ae81ff">96&lt;/span> Ã— 1/16&lt;span style="color:#f92672">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; replicas &lt;span style="color:#f92672">=&lt;/span> max&lt;span style="color:#f92672">(&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> , 6&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; replicas &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">6&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>ä½†æ˜¯æˆ‘å€‘æœ‰è¨­å®š max æ˜¯ 5ï¼Œæ‰€ä»¥æœ€å¾Œ kube-dns pod æ•¸é‡å°±æœƒæ˜¯ 5ï¼Œä¸æœƒè¶…é 5ã€‚&lt;/p>
&lt;br>
&lt;p>ç‚ºäº†ç¢ºä¿å¢é›† DNS å¯ç”¨æ€§çš„æ°´å¹³ï¼Œä¹Ÿå»ºè­°å¹« kube-dns è¨­å®š mix å€¼ã€‚&lt;/p>
&lt;p>å¾ä¸Šé¢è¨ˆç®—æ–¹æ³•ä¹Ÿå¯ä»¥çŸ¥é“ï¼Œç•¶å¢é›†å…·æœ‰å¤šå€‹æ ¸å¿ƒçš„ç¯€é»æ™‚ï¼ŒcoresPerReplica æœƒä½”ä¸»å°åœ°ä½ã€‚ç•¶å¢é›†ä½¿ç”¨æ ¸å¿ƒæ•¸è¼ƒå°‘çš„ç¯€é»æ•¸ï¼ŒnodesPerReplica ä½”ä¸»å°åœ°ä½ã€‚é€šå¸¸æ‡‰è©²æœƒä»¥ nodesPerReplica ä¾†è¨­å®šã€‚&lt;/p>
&lt;p>èª¿æ•´å®Œ kube-dns-autoscaler çš„ configmap è¨­å®šï¼Œä¸éœ€è¦é‡å•Ÿæœå‹™ï¼Œkube-dns å°±æœƒè‡ªå‹• scale up or scale down pod æ•¸&lt;/p>
&lt;br>
&lt;p>æœ€å¾Œç­‰å¾… Google Support å›è¦†ï¼Œä¸¦å‘ŠçŸ¥å·²ç¶“èª¿æ•´ kube-dns-autoscaler configmap çš„è¨­å®šï¼Œä¸¦è§€å¯Ÿä¸€é™£å­å¾Œï¼Œå•é¡Œå·²ç¶“è§£æ±ºã€‚&lt;/p>
&lt;h3>Google Support å›è¦†&lt;span class="hx-absolute -hx-mt-20" id="google-support-å›è¦†">&lt;/span>
&lt;a href="#google-support-%e5%9b%9e%e8%a6%86" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>Google Support å›è¦†ï¼š&lt;/p>
&lt;p>ç°¡å–®è§£é‡‹ä¸€ä¸‹ç‚ºä»€éº¼ scale up kube-dns pods æ•¸é‡æœƒæœ‰å¹«åŠ©ï¼š&lt;/p>
&lt;p>ç•¶ Pod åš DNS æŸ¥è©¢æ™‚ï¼Œå› ç‚ºä½ å€‘æœ‰å•Ÿç”¨ NodeLocal DNSCacheï¼Œæ‰€ä»¥ä»–æœƒå…ˆæ‰¾ cacheï¼Œå¦‚æœæ²’æœ‰ cache å°±æœƒå› kube-dns æŸ¥è©¢ã€‚&lt;/p>
&lt;p>æˆ‘å€‘åœ¨è¡¨è±¡ä¸Šå…ˆè§€å¯Ÿåˆ° NodeLocal DNSCache latency å¾ˆé«˜ï¼Œè€Œé€™æœ‰å…©å€‹å¯èƒ½ï¼Œä¸€å€‹ç•¶ç„¶å¯èƒ½æ˜¯è‡ªèº«å•é¡Œï¼Œä½†æ›´å¤§çš„å¯èƒ½æ€§æ˜¯ç•¶ cache è¦å›æºè·Ÿ kube-dns æŸ¥æ‰¾æ™‚ï¼Œkube-dns å·²ç¶“æ²’è¾¦æ³•å†æ‰¿æ¥æ›´å¤š requestï¼Œæ‰€ä»¥ NodeLocal DNSCache æœƒä¸€ç›´å˜—è©¦ retryï¼Œæˆ‘å€‘åœ¨æŒ‡æ¨™ä¸Šä¹Ÿçœ‹åˆ° latency æ‹‰é«˜ä¸¦æŒå¹³åœ¨ä¸€å€‹æ°´ä½é¡¯ç¤ºå‡ºæŸå€‹ç“¶é ¸ã€‚&lt;/p>
&lt;p>åœ¨ç¶“é kube-dns å¢åŠ  pod æ“ä½œä¹‹å¾Œï¼Œçœ‹èµ·ä¾†å¾ŒçºŒ DNS æŸ¥è©¢å¯ä»¥é †åˆ©è¢«è™•ç†è·Ÿ cacheï¼Œæ‰€ä»¥å•é¡Œå°±å¤§å¹…ç·©è§£ã€‚&lt;/p>
&lt;br>
&lt;h3>Google Support å»ºè­°&lt;span class="hx-absolute -hx-mt-20" id="google-support-å»ºè­°">&lt;/span>
&lt;a href="#google-support-%e5%bb%ba%e8%ad%b0" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;ul>
&lt;li>æ¶æ§‹å„ªåŒ–ï¼šæœªä¾†å¯ä»¥è©•ä¼°ç”¨ CloudDNS å–ä»£ kube-dnsï¼ŒCloudDNS ç‚ºè¨—ç®¡æœå‹™ï¼Œå¯ä»¥è‡ªå‹• scale up ä¾†è™•ç†æ•ˆèƒ½å•é¡Œã€‚&lt;a href="https://medium.com/google-cloud/dns-on-gke-everything-you-need-to-know-b961303f9153" target="_blank" rel="noopener">åƒè€ƒæ–‡ä»¶&lt;/a>&lt;/li>
&lt;li>ç›£æ§ï¼šå¦‚æœçŸ­æœŸæš«æ™‚ç„¡æ³•æ›¿æ› CloudDNSï¼Œå»ºè­°å¯åœ¨ kube-dns å®‰è£ agent åšç›£æ§ï¼Œç•¶æ¥è¿‘æ•ˆèƒ½ç“¶é ¸æ™‚ï¼Œå¯ä»¥æå‰ scale up kube-dns podã€‚&lt;a href="https://medium.com/@prageeshag/monitoring-kube-dns-pods-in-gke-83b76a0ef3d9" target="_blank" rel="noopener">éå®˜æ–¹åƒè€ƒæ–‡ä»¶&lt;/a>&lt;/li>
&lt;/ul>
&lt;br>
&lt;h3>å¾ŒçºŒè¦åŠƒ&lt;span class="hx-absolute -hx-mt-20" id="å¾ŒçºŒè¦åŠƒ">&lt;/span>
&lt;a href="#%e5%be%8c%e7%ba%8c%e8%a6%8f%e5%8a%83" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>ä½†ç”±æ–¼æˆ‘å€‘å…¬å¸æœ€è¿‘ä¹Ÿåœ¨è€ƒæ…® multi-cloud çš„æ–¹æ¡ˆï¼Œæ‰€ä»¥æš«æ™‚ä¸è€ƒæ…®ç”¨ GCP é›²ä¾›æ‡‰å•†çš„ CloudDNS å–ä»£ kube-dnsï¼Œæˆ‘å€‘æƒ³ç ”ç©¶çœ‹çœ‹å¦ä¸€å¥— coreDNS æ˜¯å¦èƒ½å¤ è§£æ±ºé€™å€‹å•é¡Œã€‚&lt;/p>
&lt;p>æœ‰èˆˆè¶£å¯ä»¥åƒè€ƒä¸‹ä¸€ç¯‡æ–‡ç« ï¼š&lt;a href="../kube-dns-vs-core-dns" >Kube DNS vs Core DNS&lt;/a>ã€‚&lt;/p>
&lt;br>
&lt;h2>åƒè€ƒè³‡æ–™&lt;span class="hx-absolute -hx-mt-20" id="åƒè€ƒè³‡æ–™">&lt;/span>
&lt;a href="#%e5%8f%83%e8%80%83%e8%b3%87%e6%96%99" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>k8s dns æ•…éšœ Pod æ— æ³•è§£æä¸»æœºå Couldnâ€˜t resolve hostï¼š&lt;a href="https://blog.csdn.net/hknaruto/article/details/109361342" target="_blank" rel="noopener">https://blog.csdn.net/hknaruto/article/details/109361342&lt;/a>&lt;/p>
&lt;p>Setting up NodeLocal DNSCache/Scaling up kube-dnsï¼š&lt;a href="https://cloud.google.com/kubernetes-engine/docs/how-to/nodelocal-dns-cache#scaling_up_kube-dns" target="_blank" rel="noopener">https://cloud.google.com/kubernetes-engine/docs/how-to/nodelocal-dns-cache#scaling_up_kube-dns&lt;/a>&lt;/p>
&lt;p>DNS on GKE: Everything you need to knowï¼š&lt;a href="https://medium.com/google-cloud/dns-on-gke-everything-you-need-to-know-b961303f9153" target="_blank" rel="noopener">https://medium.com/google-cloud/dns-on-gke-everything-you-need-to-know-b961303f9153&lt;/a>&lt;/p>
&lt;p>Monitoring kube-dns pods in GKEï¼š&lt;a href="https://medium.com/@prageeshag/monitoring-kube-dns-pods-in-gke-83b76a0ef3d9" target="_blank" rel="noopener">https://medium.com/@prageeshag/monitoring-kube-dns-pods-in-gke-83b76a0ef3d9&lt;/a>&lt;/p></description></item><item><title>æ­£å¼ç’°å¢ƒä¸Šè¸©åˆ° StatefulSet çš„é›·ï¼Œæ‹¿åˆ° P1 çš„æ•™è¨“</title><link>https://pin-yi.me/blog/kubernetes/k8s-statefulset-podmanagementpolicy/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pin-yi.me/blog/kubernetes/k8s-statefulset-podmanagementpolicy/</guid><description>
&lt;p>æ­¤æ–‡ç« è¦ä¾†è¨˜éŒ„ä¸€ä¸‹å‰é™£å­åœ¨å…¬å¸çš„æ­£å¼ç’°å¢ƒè¸©åˆ° StatefulSet çš„é›·ï¼Œäº‹æƒ…æ˜¯é€™æ¨£çš„ï¼Œæˆ‘å€‘æœ‰äº›æœå‹™ï¼Œæ˜¯ä½¿ç”¨ StatefulSet ä¾†å»ºç½®ï¼Œè‡³æ–¼ç‚ºä»€éº¼ä¸ç”¨ Deploymentï¼Œé€™å€‹èªªä¾†è©±é•· (ä¹Ÿä¸æ˜¯å› ç‚ºéœ€è¦ç‰¹å®šçš„ Pod åç¨±ã€æˆ–æ˜¯ç¶²è·¯æ¨™è¨˜ç­‰ç­‰)ï¼Œæˆ‘å€‘é€™é‚Šå…ˆä¸è¨è«–ï¼Œé€™å€‹ StatefulSet æœå‹™æ˜¯ Nginx + PHP-FPMï¼Œç‚ºäº†é¿å…æµé‡é€²å…¥åˆ° processes å·²ç¶“è¢«ç”¨å…‰çš„ Pod ä¸­ï¼Œæˆ‘å€‘åœ¨ StatefulSet çš„ PHP Container ä¸Šæœ‰è¨­å®š readinessï¼Œreadiness çš„è¨­å®šé•·å¾—åƒä»¥ä¸‹ï¼š&lt;/p>
&lt;br>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">readinessProbe&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">exec&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">command&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e6db74">&amp;#34;/bin/bash&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e6db74">&amp;#34;-c&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - |&lt;span style="color:#e6db74">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> CHECK_INFO=$(curl -s -w &amp;#39;http code:\t%{http_code}\n&amp;#39; 127.0.0.1/status)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> HTTP_CODE=$(echo -e &amp;#34;${CHECK_INFO}&amp;#34; | awk &amp;#39;/http code:/ {print $3}&amp;#39;)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> IDLE_PROCESSES=$(echo -e &amp;#34;${CHECK_INFO}&amp;#34; | awk &amp;#39;/idle processes:/ {print $3}&amp;#39;)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> [[ $HTTP_CODE -eq 200 &amp;amp;&amp;amp; $IDLE_PROCESSES -ge 10 ]] || exit 1&lt;/span> &lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;p>æˆ‘å€‘æœƒç”¨ curl ä¾†æ‰“ &lt;code>/status&lt;/code>ï¼Œæª¢æŸ¥å›å‚³çš„ http code æ˜¯å¦ç‚º 200ï¼Œä»¥åŠ idle processes æ˜¯å¦å¤§æ–¼ç­‰æ–¼ 10ï¼Œå¦‚æœä¸ç¬¦åˆï¼Œå°±æœƒå›å‚³ 1ï¼Œè®“ä»–è¢«æ¨™è¨˜ä¸å¥åº·ï¼Œè®“ Kubernetes åœæ­¢æµé‡åˆ°ä¸å¥åº·çš„å®¹å™¨ï¼Œä»¥ç¢ºä¿æµé‡è¢«è·¯ç”±åˆ°å…¶ä»–å¥åº·çš„å‰¯æœ¬ã€‚&lt;/p>
&lt;br>
&lt;h2>å•é¡Œ&lt;span class="hx-absolute -hx-mt-20" id="å•é¡Œ">&lt;/span>
&lt;a href="#%e5%95%8f%e9%a1%8c" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>ç•¶å¤©é‡åˆ°çš„æƒ…æ³æ˜¯ï¼Œæˆ‘å€‘ä¸Šç¨‹å¼å¾Œï¼ŒPod éƒ½ä¸€åˆ‡æ­£å¸¸ï¼Œç•¶æµé‡é–‹å§‹é€²ä¾†å¾Œï¼Œç™¼ç¾ 10 å€‹ Pod æœƒé–‹å§‹å¶ç™¼çš„å™´ &lt;code>Readiness probe failed&lt;/code>ï¼ŒæŸ¥çœ‹ç›£æ§ç™¼ç¾ processes è¶Šä¾†è¶Šä½ï¼Œæœ€å¾Œè¢«åæ‡‰æœå‹™æœ‰å•é¡Œï¼Œæˆ‘å€‘æŸ¥çœ‹ Hpa çš„ç´€éŒ„çš„ç¢ºæœ‰è§¸ç™¼åˆ° 40 å€‹ Podï¼Œåªæ˜¯æŸ¥çœ‹ Pod æ•¸é‚„æ˜¯ä¾æ¨£å¡åœ¨ 10 å€‹ï¼Œç•¶ä¸‹æˆ‘å€‘æœ‰å˜—è©¦ä½¿ç”¨èª¿æ•´ yaml åœ¨ applyï¼Œç™¼ç¾ StatefulSet çš„ yaml ä¹Ÿå·²ç¶“æ›´æ–°äº†ï¼Œä½† Pod é‚„æ˜¯ä¸€æ¨£å¡åœ¨ 10 å€‹ï¼Œä¹Ÿæœ‰ä½¿ç”¨ kubectl ä¸‹ &lt;code>kubectl scale sts [æœå‹™åç¨±] --replicas=0&lt;/code>ï¼Œæƒ³è¦åˆ‡æ› Pod æ•¸ä¹Ÿæ²’æœ‰è¾¦æ³•ã€‚&lt;/p>
&lt;br>
&lt;p>ç•¶ä¸‹æˆ‘å€‘æœ‰å…ˆ Call Google çš„ Support ä¸€èµ·æ‰¾åŸå› ï¼ŒGoogle æ˜¯å»ºè­°æˆ‘å€‘ readiness çš„æ¢ä»¶ä¸è¦è¨­çš„å¤ªåš´æ ¼ï¼Œå¯ä»¥åŠ ä¸Š &lt;code>timeoutSeconds: ç§’æ•¸&lt;/code>ï¼Œä½†å°æ–¼ Pod å¡ä½ï¼Œé‚„æ˜¯æ²’æœ‰æ‰¾åˆ°åŸå› ï¼Œå¾Œä¾†æˆ‘å€‘æŸ¥äº†ä¸€ä¸‹ StatefulSet çš„æ–‡ä»¶ç™¼ç¾ï¼ŒStatefulSet æœ‰ä¸€å€‹è¨­å®š &lt;code>podManagementPolicy&lt;/code>ï¼Œé è¨­æ˜¯ &lt;code>OrderedReady&lt;/code>ï¼Œä»–å¿…é ˆç­‰å¾…å‰é¢çš„ Pod æ˜¯ Ready ç‹€æ…‹ï¼Œæ‰æœƒå†ç¹¼çºŒå»ºç«‹æ–°çš„ï¼Œä¹Ÿå°±æ˜¯èªªæˆ‘å€‘çš„ StatefulSet å·²ç¶“å¡ä½ï¼Œå°è‡´å°±ç®— Hpa è§¸ç™¼è¦é•·åˆ° 40 å€‹ Pod ä¹Ÿæ²’æœ‰ç”¨ã€‚&lt;/p>
&lt;br>
&lt;h2>è§£æ±ºè¾¦æ³•&lt;span class="hx-absolute -hx-mt-20" id="è§£æ±ºè¾¦æ³•">&lt;/span>
&lt;a href="#%e8%a7%a3%e6%b1%ba%e8%be%a6%e6%b3%95" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>ç•¶ä¸‹æƒ³è¶•å¿«è§£æ±º readiness é€™å€‹å•é¡Œï¼Œèª¿æ•´ &lt;code>timeoutSeconds&lt;/code> å¾Œï¼Œå–®ç´” apply æ˜¯æ²’æœ‰ç”¨çš„ï¼Œè¦è¨˜å¾—åˆªæ‰å¡ä½çš„ Podï¼Œè®“ä»–é‡æ–°å»ºç«‹ï¼Œæ‰æœƒå¥—ç”¨æ–°çš„è¨­å®š (ä½†æˆ‘å€‘ç•¶ä¸‹å¤ªåœ¨æ„ç‚ºç”šéº¼ Pod æœƒå¡ä½ï¼Œæ²’æœ‰æƒ³åˆ°è¦å…ˆæŠŠ readiness å•é¡Œä¿®æ‰ xDï¼Œæˆ‘å€‘ç•¶ä¸‹çš„è§£æ³•æ˜¯å…ˆå°‡æµé‡å°åˆ°åœ°ç«¯æ­£å¸¸çš„æœå‹™ä¸Š)ã€‚&lt;/p>
&lt;p>å¦å¤– Google ä¹Ÿèªªï¼Œå‡å¦‚æˆ‘å€‘é‚„æ˜¯å¿…é ˆä½¿ç”¨ StatefulSet ä¾†å»ºç«‹æœå‹™ï¼Œå»ºè­°æˆ‘å€‘æŠŠ podManagementPolicy æ”¹æˆ &lt;code>Parallel&lt;/code>ï¼Œå®ƒæœƒæœ‰é»åƒæ˜¯ Deployment çš„æ„Ÿè¦ºï¼Œä¸æœƒç­‰å¾…å…¶ä»– Pod è®Šæˆ Ready ç‹€æ…‹ï¼Œæ‰€ä»¥å¯ä»¥è®“æˆ‘å€‘å°±ç®—åœ¨ readiness å¡ä½çš„æƒ…æ³ä¸‹ï¼Œä¹Ÿå¯ä»¥è‡ªå‹•æ“´ç¸®æœå‹™ã€‚&lt;/p>
&lt;br>
&lt;div class="hx-overflow-x-auto hx-mt-6 hx-flex hx-rounded-lg hx-border hx-py-2 ltr:hx-pr-4 rtl:hx-pl-4 contrast-more:hx-border-current contrast-more:dark:hx-border-current hx-border-blue-200 hx-bg-blue-100 hx-text-blue-900 dark:hx-border-blue-200/30 dark:hx-bg-blue-900/30 dark:hx-text-blue-200">
&lt;div class="ltr:hx-pl-3 ltr:hx-pr-2 rtl:hx-pr-3 rtl:hx-pl-2">&lt;div class="hx-select-none hx-text-xl" style="font-family: 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">â„¹ï¸&lt;/div>&lt;/div>
&lt;div class="hx-w-full hx-min-w-0 hx-leading-7">
&lt;div class="hx-mt-6 hx-leading-7 first:hx-mt-0">&lt;p>StatefulSet podManagementPolicy åƒæ•¸èªªæ˜&lt;/p>
&lt;ul>
&lt;li>OrderedReady (é è¨­)&lt;/li>
&lt;/ul>
&lt;p>Pods æœƒæŒ‰ç…§é †åºä¸€å€‹æ¥ä¸€å€‹åœ°è¢«å‰µå»ºã€‚å³ï¼Œn+1 è™Ÿ Pod ä¸æœƒåœ¨ n è™Ÿ Pod æˆåŠŸå‰µå»ºä¸” Ready ä¹‹å‰é–‹å§‹å‰µå»ºã€‚
åœ¨ç¸®å° StatefulSet çš„å¤§å°æ™‚ï¼ŒPods æœƒæŒ‰ç…§åå‘é †åºä¸€å€‹æ¥ä¸€å€‹åœ°è¢«çµ‚æ­¢ã€‚å³ï¼Œn è™Ÿ Pod ä¸æœƒåœ¨ n+1 è™Ÿ Pod å®Œå…¨çµ‚æ­¢ä¹‹å‰é–‹å§‹çµ‚æ­¢ã€‚
é€™ç¢ºä¿äº† Pods çš„å•Ÿå‹•å’Œçµ‚æ­¢çš„é †åºæ€§ã€‚&lt;/p>
&lt;br>
&lt;ul>
&lt;li>Parallel&lt;/li>
&lt;/ul>
&lt;p>æ‰€æœ‰ Pods æœƒåŒæ™‚åœ°è¢«å‰µå»ºæˆ–çµ‚æ­¢ã€‚
ç•¶ StatefulSet æ“´å±•æ™‚ï¼Œæ–°çš„ Pods æœƒç«‹å³é–‹å§‹å‰µå»ºï¼Œä¸ç”¨ç­‰å¾…å…¶ä»– Pods æˆç‚º Ready ç‹€æ…‹ã€‚
ç•¶ç¸®å° StatefulSet çš„å¤§å°æ™‚ï¼Œè¦çµ‚æ­¢çš„ Pods æœƒç«‹å³é–‹å§‹çµ‚æ­¢ï¼Œä¸ç”¨ç­‰å¾…å…¶ä»– Pods å…ˆçµ‚æ­¢ã€‚
é€™ç¨®ç­–ç•¥æä¾›äº†å¿«é€Ÿçš„æ“´å±•å’Œç¸®å°æ“ä½œï¼Œä½†ç¼ºä¹é †åºæ€§ä¿è­‰ã€‚&lt;/p>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;br>
&lt;h2>æ¸¬è©¦çµæœ&lt;span class="hx-absolute -hx-mt-20" id="æ¸¬è©¦çµæœ">&lt;/span>
&lt;a href="#%e6%b8%ac%e8%a9%a6%e7%b5%90%e6%9e%9c" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>æœ€å¾Œæˆ‘å€‘å°±ä½¿ç”¨å…©ç¨®æ¨¡å¼ä¾†æ¸¬è©¦çœ‹çœ‹ï¼Œå·²ä¸‹æ˜¯æ¸¬è©¦çµæœ(é€é P1 æ‰çŸ¥é“çš„è¨­å®šï¼±ï¼±)ï¼š&lt;/p>
&lt;p>æœ‰å°‡æ¸¬è©¦çš„ StatefulSet æ”¾åœ¨ Githubï¼Œ&lt;a href="https://github.com/880831ian/k8s-statefulset-podmanagementpolicy" target="_blank" rel="noopener">å¯ä»¥é»æˆ‘æŸ¥çœ‹&lt;/a> (å¯ä»¥èª¿æ•´ readinessProbe çš„ httpGet.Path æ•…æ„æŠŠä»–ç”¨å£)&lt;/p>
&lt;br>
&lt;h3>ä½¿ç”¨ OrderedReady æ¨¡å¼&lt;span class="hx-absolute -hx-mt-20" id="ä½¿ç”¨-orderedready-æ¨¡å¼">&lt;/span>
&lt;a href="#%e4%bd%bf%e7%94%a8-orderedready-%e6%a8%a1%e5%bc%8f" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>StatefulSet åœ¨ podManagementPolicy é è¨­ OrderedReady çš„æ¨¡å¼ï¼Œæ•…æ„è®“ readiness å¡ä½æ™‚ (Pod å¡ä½æ™‚)ï¼š&lt;/p>
&lt;ul>
&lt;li>ç•¶ä¸‹çš„ StatefulSet è¨­å®šï¼š&lt;/li>
&lt;/ul>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-statefulset-podmanagementpolicy/1.png"
alt="StatefulSet è¨­å®š" width="800">&lt;figcaption>
&lt;p>StatefulSet è¨­å®š&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;ul>
&lt;li>Pod ç‹€æ…‹ï¼š&lt;/li>
&lt;/ul>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-statefulset-podmanagementpolicy/2.png"
alt="Pod ç‹€æ…‹" width="800">&lt;figcaption>
&lt;p>Pod ç‹€æ…‹&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;h4>ä½¿ç”¨æŒ‡ä»¤èª¿æ•´ Pod æ•¸é‡&lt;span class="hx-absolute -hx-mt-20" id="ä½¿ç”¨æŒ‡ä»¤èª¿æ•´-pod-æ•¸é‡">&lt;/span>
&lt;a href="#%e4%bd%bf%e7%94%a8%e6%8c%87%e4%bb%a4%e8%aa%bf%e6%95%b4-pod-%e6%95%b8%e9%87%8f" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h4>&lt;p>æˆ‘å€‘é€™æ™‚å€™ä¸‹æŒ‡ä»¤èª¿æ•´ Pod æ•¸é‡ï¼Œçœ‹çœ‹æœƒç™¼ç”Ÿä»€éº¼äº‹ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>kubectl scale sts my-statefulset --replicas&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">5&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;p>æˆ‘å€‘å…ˆçœ‹ StatefulSet çš„ yaml å¯ä»¥çœ‹åˆ° Pod replicas å·²ç¶“æ”¹è®Šï¼Œä¹Ÿå¯ä»¥çœ‹ generation æœ‰æ›´æ–°ï¼Œä»£è¡¨ StatefulSet æœ¬èº«æœ‰æ¥æ”¶åˆ°èª¿æ•´è¨­å®šçš„è«‹æ±‚ã€‚&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-statefulset-podmanagementpolicy/3.png"
alt="ä¸‹æŒ‡ä»¤èª¿æ•´å¾Œçš„ StatefulSet è¨­å®š" width="800">&lt;figcaption>
&lt;p>ä¸‹æŒ‡ä»¤èª¿æ•´å¾Œçš„ StatefulSet è¨­å®š&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>çœ‹äº†ä¸€ä¸‹ Pod æ•¸é‡ï¼Œä¹Ÿæ˜¯ä¸€æ¨£å¡ä½ï¼Œä¸” Pod æ•¸é‡ä¹Ÿæ²’æœ‰è®ŠåŒ–ã€‚&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-statefulset-podmanagementpolicy/4.png"
alt="ä¸‹æŒ‡ä»¤èª¿æ•´å¾Œçš„ Pod ç‹€æ…‹" width="800">&lt;figcaption>
&lt;p>ä¸‹æŒ‡ä»¤èª¿æ•´å¾Œçš„ Pod ç‹€æ…‹&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;h4>ä½¿ç”¨ yaml èª¿æ•´ Pod æ•¸é‡&lt;span class="hx-absolute -hx-mt-20" id="ä½¿ç”¨-yaml-èª¿æ•´-pod-æ•¸é‡">&lt;/span>
&lt;a href="#%e4%bd%bf%e7%94%a8-yaml-%e8%aa%bf%e6%95%b4-pod-%e6%95%b8%e9%87%8f" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h4>&lt;p>æˆ‘å€‘ç›´æ¥èª¿æ•´ StatefulSet yaml çš„ Pod æ•¸é‡ï¼Œçœ‹çœ‹æœƒç™¼ç”Ÿä»€éº¼äº‹ï¼š&lt;/p>
&lt;p>ä¸€æ¨£æˆ‘å€‘å…ˆçœ‹ StatefulSet çš„ yaml å¯ä»¥çœ‹åˆ° Pod replicas å·²ç¶“æ”¹è®Š(é€™è£¡æ‡‰è©²åˆ‡åˆ¥çš„ Pod æ•¸é‡ï¼Œåˆ‡å› 3 å€‹å¥½åƒæ²’æœ‰æ„ç¾© xD)ï¼Œä¹Ÿå¯ä»¥çœ‹ generation æœ‰æ›´æ–°ã€‚&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-statefulset-podmanagementpolicy/5.png"
alt="ä½¿ç”¨ yaml èª¿æ•´å¾Œçš„ StatefulSet è¨­å®š" width="800">&lt;figcaption>
&lt;p>ä½¿ç”¨ yaml èª¿æ•´å¾Œçš„ StatefulSet è¨­å®š&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>çœ‹äº†ä¸€ä¸‹ Pod æ•¸é‡ï¼Œä¹Ÿæ˜¯ä¸€æ¨£å¡ä½ï¼Œä¸” Pod æ•¸é‡ä¹Ÿæ²’æœ‰è®ŠåŒ–ã€‚&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-statefulset-podmanagementpolicy/6.png"
alt="ä½¿ç”¨ yaml èª¿æ•´å¾Œçš„ Pod ç‹€æ…‹" width="800">&lt;figcaption>
&lt;p>ä½¿ç”¨ yaml èª¿æ•´å¾Œçš„ Pod ç‹€æ…‹&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>æ‰€ä»¥ä»£è¡¨åœ¨ OrderedReady çš„æ¨¡å¼ä¸‹ï¼ŒPod å¡ä½æ™‚ï¼Œç„¡æ³•å° Pod é€²è¡Œä»»ä½•æ“ä½œï¼Œå¿…é ˆè¦æ‰‹å‹•åˆªé™¤å¡ä½çš„ Pod æ‰åƒå¾—åˆ°æœ€æ–°çš„è¨­å®šã€‚&lt;/p>
&lt;br>
&lt;h3>ä½¿ç”¨ Parallel æ¨¡å¼&lt;span class="hx-absolute -hx-mt-20" id="ä½¿ç”¨-parallel-æ¨¡å¼">&lt;/span>
&lt;a href="#%e4%bd%bf%e7%94%a8-parallel-%e6%a8%a1%e5%bc%8f" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>StatefulSet åœ¨ podManagementPolicy Parallel çš„æ¨¡å¼ï¼Œæ•…æ„è®“ readiness å¡ä½æ™‚ (Pod å¡ä½æ™‚)ï¼š&lt;/p>
&lt;ul>
&lt;li>ç•¶ä¸‹çš„ StatefulSet è¨­å®šï¼š&lt;/li>
&lt;/ul>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-statefulset-podmanagementpolicy/7.png"
alt="StatefulSet è¨­å®š" width="800">&lt;figcaption>
&lt;p>StatefulSet è¨­å®š&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;ul>
&lt;li>Pod ç‹€æ…‹ï¼š&lt;/li>
&lt;/ul>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-statefulset-podmanagementpolicy/8.png"
alt="Pod ç‹€æ…‹" width="800">&lt;figcaption>
&lt;p>Pod ç‹€æ…‹&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;h4>ä½¿ç”¨æŒ‡ä»¤èª¿æ•´ Pod æ•¸é‡&lt;span class="hx-absolute -hx-mt-20" id="ä½¿ç”¨æŒ‡ä»¤èª¿æ•´-pod-æ•¸é‡-1">&lt;/span>
&lt;a href="#%e4%bd%bf%e7%94%a8%e6%8c%87%e4%bb%a4%e8%aa%bf%e6%95%b4-pod-%e6%95%b8%e9%87%8f-1" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h4>&lt;p>æˆ‘å€‘é€™æ™‚å€™ä¸‹æŒ‡ä»¤èª¿æ•´ Pod æ•¸é‡ï¼Œçœ‹çœ‹æœƒç™¼ç”Ÿä»€éº¼äº‹ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>kubectl scale sts my-statefulset --replicas&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">5&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;p>æˆ‘å€‘å…ˆçœ‹ StatefulSet çš„ yaml å¯ä»¥çœ‹åˆ° Pod replicas å·²ç¶“æ”¹è®Šï¼Œä¹Ÿå¯ä»¥çœ‹ generation æœ‰æ›´æ–°ï¼Œä»£è¡¨ StatefulSet æœ¬èº«æœ‰æ¥æ”¶åˆ°èª¿æ•´è¨­å®šçš„è«‹æ±‚ã€‚&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-statefulset-podmanagementpolicy/9.png"
alt="ä¸‹æŒ‡ä»¤èª¿æ•´å¾Œçš„ StatefulSet è¨­å®š" width="800">&lt;figcaption>
&lt;p>ä¸‹æŒ‡ä»¤èª¿æ•´å¾Œçš„ StatefulSet è¨­å®š&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>çœ‹äº†ä¸€ä¸‹ Pod æ•¸é‡ï¼Œå°±ç®— my-statefulset-2 å¡ä½ï¼Œé‚„æ˜¯å¯ä»¥æ“´åˆ° 5 å€‹ Podã€‚&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-statefulset-podmanagementpolicy/10.png"
alt="ä¸‹æŒ‡ä»¤èª¿æ•´å¾Œçš„ Pod ç‹€æ…‹" width="800">&lt;figcaption>
&lt;p>ä¸‹æŒ‡ä»¤èª¿æ•´å¾Œçš„ Pod ç‹€æ…‹&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;h4>ä½¿ç”¨ yaml èª¿æ•´ Pod æ•¸é‡&lt;span class="hx-absolute -hx-mt-20" id="ä½¿ç”¨-yaml-èª¿æ•´-pod-æ•¸é‡-1">&lt;/span>
&lt;a href="#%e4%bd%bf%e7%94%a8-yaml-%e8%aa%bf%e6%95%b4-pod-%e6%95%b8%e9%87%8f-1" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h4>&lt;p>æˆ‘å€‘ç›´æ¥èª¿æ•´ StatefulSet yaml çš„ Pod æ•¸é‡ï¼Œçœ‹çœ‹æœƒç™¼ç”Ÿä»€éº¼äº‹ï¼š&lt;/p>
&lt;p>ä¸€æ¨£æˆ‘å€‘å…ˆçœ‹ StatefulSet çš„ yaml å¯ä»¥çœ‹åˆ° Pod replicas å·²ç¶“æ”¹è®Šï¼Œä¹Ÿå¯ä»¥çœ‹ generation æœ‰æ›´æ–°ã€‚&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-statefulset-podmanagementpolicy/11.png"
alt="ä½¿ç”¨ yaml èª¿æ•´å¾Œçš„ StatefulSet è¨­å®š" width="800">&lt;figcaption>
&lt;p>ä½¿ç”¨ yaml èª¿æ•´å¾Œçš„ StatefulSet è¨­å®š&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>çœ‹äº†ä¸€ä¸‹ Pod æ•¸é‡ï¼Œä¹Ÿä¸æœƒç®¡å…¶ä»– Pod æ˜¯å¦ Readyï¼Œä¸€æ¨£å¯ä»¥ç¸®å°æˆ 2 å€‹ Podã€‚&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-statefulset-podmanagementpolicy/12.png"
alt="ä½¿ç”¨ yaml èª¿æ•´å¾Œçš„ Pod ç‹€æ…‹" width="800">&lt;figcaption>
&lt;p>ä½¿ç”¨ yaml èª¿æ•´å¾Œçš„ Pod ç‹€æ…‹&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;h2>çµè«–&lt;span class="hx-absolute -hx-mt-20" id="çµè«–">&lt;/span>
&lt;a href="#%e7%b5%90%e8%ab%96" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>å¾Œä¾†æˆ‘å€‘é‡æ–°æª¢æŸ¥äº†ä¸€ä¸‹ç‚ºä»€éº¼ processes æœƒç”¨å®Œï¼Œçµæœç™¼ç¾æ˜¯ RD çš„ç¨‹å¼é‚è¼¯ï¼Œå°è‡´æ¯ç­† Request å¿…é ˆç­‰å¾…å‰ä¸€ç­† Request åšå®Œï¼Œæ‰æœƒé–‹å§‹å‹•ä½œï¼Œè®“ processes ä¸€ç›´è¢«å ç”¨ï¼Œæ²’è¾¦æ³•å³æ™‚æ¶ˆåŒ–ï¼Œå°è‡´ processes ç”¨å®Œï¼ŒåˆåŠ ä¸Šæœå‹™æ˜¯ä½¿ç”¨ StatefulSetï¼Œé è¨­æ¨¡å¼çš„ OrderedReadyï¼Œå¿…é ˆç­‰å¾…å‰ä¸€å€‹ Pod æ˜¯ Ready æ‰å¯ä»¥è‡ªå‹•æ“´ç¸®ï¼Œæ‰€ä»¥ç•¶æˆ‘å€‘ Hpa æƒ³è¦æ“´ç¸®ï¼Œä¾†å¢åŠ å¯ç”¨çš„ processes æ•¸é‡ï¼Œä¹Ÿå› ç‚ºæ²’è¾¦æ³•æ“´ç¸®ï¼Œæœ€å¾Œå°è‡´é€™ä¸€é€£ä¸²çš„å•é¡Œ ğŸ˜•ã€‚&lt;/p>
&lt;br>
&lt;p>å¦å¤–ï¼Œå¦‚æœæƒ³è¦å¾ OrderedReady æ¨¡å¼åˆ‡æˆ Parallel æ¨¡å¼ (åæ­£éä¾†ä¹Ÿæ˜¯)ï¼Œå¿…é ˆå…ˆå°‡åŸæœ¬çš„ StatefulSet çµ¦åˆªé™¤ï¼Œæ‰å¯ä»¥èª¿æ•´ï¼š&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-statefulset-podmanagementpolicy/13.png"
alt="OrderedReady æ¨¡å¼åˆ‡æˆ Parallel æ¨¡å¼" width="800">&lt;figcaption>
&lt;p>OrderedReady æ¨¡å¼åˆ‡æˆ Parallel æ¨¡å¼&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;h2>åƒè€ƒè³‡æ–™&lt;span class="hx-absolute -hx-mt-20" id="åƒè€ƒè³‡æ–™">&lt;/span>
&lt;a href="#%e5%8f%83%e8%80%83%e8%b3%87%e6%96%99" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>Kubernetes â€” å¥åº·æª¢æŸ¥ï¼š&lt;a href="https://medium.com/learn-or-die/kubernetes-%E5%81%A5%E5%BA%B7%E6%AA%A2%E6%9F%A5-59ee2a798115" target="_blank" rel="noopener">https://medium.com/learn-or-die/kubernetes-%E5%81%A5%E5%BA%B7%E6%AA%A2%E6%9F%A5-59ee2a798115&lt;/a>&lt;/p>
&lt;p>Pod Management Policiesï¼š&lt;a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/#pod-management-policies" target="_blank" rel="noopener">https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/#pod-management-policies&lt;/a>&lt;/p></description></item><item><title>éƒ¨ç½² Pod é‡åˆ° container veth name provided (eth0) already exists éŒ¯èª¤</title><link>https://pin-yi.me/blog/kubernetes/pod-veth-name-provided-eth0-already-exists/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pin-yi.me/blog/kubernetes/pod-veth-name-provided-eth0-already-exists/</guid><description>
&lt;p>æ­¤æ–‡ç« è¦ä¾†è¨˜éŒ„ä¸€ä¸‹å…¬å¸åŒäº‹åœ¨æ­£å¼æœå‹™ä¸Šé‡åˆ°çš„å•é¡Œï¼Œæœƒè©³ç´°èªªæ˜é‡åˆ°äº‹æƒ…çš„ç¶“éï¼Œä»¥åŠé–‹å–®è©¢å• google support æœ€å¾Œè¨è«–å‡ºçš„æš«æ™‚è§£æ±ºçš„è¾¦æ³•ï¼š&lt;/p>
&lt;br>
&lt;p>ç°¡å–®åˆ—å‡ºæ­£å¼ç«™ç•¶ä¸‹æœå‹™ç’°å¢ƒï¼š&lt;/p>
&lt;ul>
&lt;li>gke master versionï¼š1.25.10-gke.2700&lt;/li>
&lt;li>gke node versionï¼š1.25.8-gke.1000&lt;/li>
&lt;li>è©²å•é¡Œç™¼ç”Ÿçš„ node pool æœ‰è¨­å®š taint&lt;/li>
&lt;li>ç™¼ç”Ÿå•é¡Œçš„ Pod æ˜¯ç”¨ Statefulset å»ºç«‹çš„æœå‹™&lt;/li>
&lt;/ul>
&lt;br>
&lt;h2>äº‹æƒ…ç™¼ç”Ÿçš„ç¶“é&lt;span class="hx-absolute -hx-mt-20" id="äº‹æƒ…ç™¼ç”Ÿçš„ç¶“é">&lt;/span>
&lt;a href="#%e4%ba%8b%e6%83%85%e7%99%bc%e7%94%9f%e7%9a%84%e7%b6%93%e9%81%8e" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;ol>
&lt;li>RD åŒä»åæ‡‰ï¼Œç™¼ç¾ä½¿ç”¨ Statefulset å»ºç«‹çš„æ’ç¨‹æœå‹™æœ‰å•é¡Œï¼Œä¸‹ &lt;code>kubectl delete&lt;/code> æŒ‡ä»¤æƒ³è¦åˆªé™¤ Podï¼Œè®“ Pod é‡æ–°é•·ï¼Œå»å¡åœ¨ Terminatingï¼Œç­‰å¾…ä¸€æ®µæ™‚é–“å¾Œï¼Œæ±ºå®šä¸‹ &lt;code>kubectl delete --force --grace-period=0&lt;/code> ä¾†å¼·åˆ¶åˆªé™¤ Podï¼Œé€™æ™‚å€™ç‹€æ…‹æœƒå¡åœ¨ ContainerCreatingï¼Œä½¿ç”¨ Describe æŸ¥çœ‹ï¼Œæœƒå‡ºç¾ä»¥ä¸‹éŒ¯èª¤ï¼š&lt;/li>
&lt;/ol>
&lt;br>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;pre>&lt;code>Warning
(combined from similar events): Failed to create pod sandbox: rpo error: code = Unknown desc = failed to setup network for sandbox
&amp;#34;14fe0cd3d688aed4ffed4c36ffab1a145230449881bcbe4cac6478a63412b0c*: plugin type=*gke&amp;#34; failed (add): container veth name provided (etho) already exists&lt;/code>&lt;/pre>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;ol start="2">
&lt;li>æˆ‘å€‘ SRE å”åŠ©æŸ¥çœ‹å¾Œï¼Œä¹Ÿæœ‰å˜—è©¦å»ä¸‹ &lt;code>kubectl delete --force --grace-period=0&lt;/code> ä¾†åˆªé™¤ Podï¼Œä½†é‚„æ˜¯ä¸€æ¨£å¡åœ¨ ContainerCreatingï¼Œæœ€å¾Œæ˜¯å…ˆé–‹ä¸€å€‹æ–°çš„ Node ä¸¦è®“è©² Pod å»ºç«‹åˆ°æ–°çš„ Node ä¸Šï¼Œæ‰è§£æ±ºå•é¡Œã€‚ç‚ºäº†æ–¹ä¾¿ google support å”åŠ©æª¢æŸ¥å‡ºå•é¡Œçš„ Nodeï¼Œå…ˆå°‡ Node è¨­å®šæˆ cordonï¼Œé¿å…å…¶ä»– Pod è¢«èª¿åº¦åˆ°è©²å•é¡Œ node ä¸Šã€‚&lt;/li>
&lt;/ol>
&lt;br>
&lt;div class="hx-overflow-x-auto hx-mt-6 hx-flex hx-rounded-lg hx-border hx-py-2 ltr:hx-pr-4 rtl:hx-pl-4 contrast-more:hx-border-current contrast-more:dark:hx-border-current hx-border-orange-100 hx-bg-orange-50 hx-text-orange-800 dark:hx-border-orange-400/30 dark:hx-bg-orange-400/20 dark:hx-text-orange-300">
&lt;div class="ltr:hx-pl-3 ltr:hx-pr-2 rtl:hx-pr-3 rtl:hx-pl-2">&lt;/div>
&lt;div class="hx-w-full hx-min-w-0 hx-leading-7">
&lt;div class="hx-mt-6 hx-leading-7 first:hx-mt-0">&lt;p>Node è¨­å®šæˆ cordon&lt;/p>
&lt;p>Node å¯ä»¥è¨­å®š cordonã€drain å’Œ delete ä¸‰å€‹æŒ‡å®šéƒ½æœƒä½¿ Node åœæ­¢è¢«èª¿åº¦ï¼Œåªæ˜¯æ¯å€‹çš„æ“ä½œæš´åŠ›ç¨‹åº¦ä¸åŒï¼š&lt;/p>
&lt;p>cordonï¼šå½±éŸ¿æœ€å°ï¼Œåªæœƒå°‡ Node æ¨™ç¤ºç‚º SchedulingDisabled ä¸å¯èª¿åº¦ç‹€æ…‹ï¼Œä½†ä¸æœƒå½±éŸ¿åˆ°å·²ç¶“åœ¨è©² Node ä¸Šçš„ Podï¼Œä½¿ç”¨ &lt;code>kubectl cordon [node name]&lt;/code> ä¾†åœæ­¢èª¿åº¦ï¼Œä½¿ç”¨ &lt;code>kubectl uncordon [node name]&lt;/code> ä¾†æ¢å¾©èª¿åº¦ã€‚&lt;/p>
&lt;p>drainï¼šæœƒå…ˆé©…é€åœ¨ Node ä¸Šçš„ Podï¼Œå†å°‡ Node æ¨™ç¤ºç‚º SchedulingDisabled ä¸å¯èª¿åº¦ç‹€æ…‹ï¼Œä½¿ç”¨ &lt;code>kubectl drain [node name] --ignore-daemonsets --delete-local-data&lt;/code> ä¾†åœæ­¢èª¿åº¦ï¼Œä½¿ç”¨ &lt;code>kubectl uncordon [node name]&lt;/code> ä¾†æ¢å¾©èª¿åº¦ã€‚&lt;/p>
&lt;p>deleteï¼šæœƒå…ˆé©…é€ Node ä¸Šçš„ Podï¼Œå†åˆªé™¤ Node ç¯€é»ï¼Œå®ƒæ˜¯ä¸€ç¨®æš´åŠ›åˆªé™¤ Node çš„ä½œæ³•ï¼Œåœ¨é©…é€ Pod æ™‚ï¼Œæœƒå¼·åˆ¶ Kill å®¹å™¨é€²ç¨‹ï¼Œæ²’è¾¦æ³•å„ªé›…çš„çµ‚æ­¢ Podã€‚&lt;/p>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;br>
&lt;ol start="3">
&lt;li>æˆ‘å€‘éš¨å¾Œé–‹å–®è©¢å• goolge supportã€‚&lt;/li>
&lt;/ol>
&lt;br>
&lt;h2>èˆ‡ Google Support è¨è«–å…§å®¹&lt;span class="hx-absolute -hx-mt-20" id="èˆ‡-google-support-è¨è«–å…§å®¹">&lt;/span>
&lt;a href="#%e8%88%87-google-support-%e8%a8%8e%e8%ab%96%e5%85%a7%e5%ae%b9" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>Google Support ç¶“éæŸ¥è©¢å¾Œï¼Œå›è¦†èªªï¼šé€™å€‹å•é¡Œæ˜¯å› ç‚º Pod è¢«å¼·åˆ¶åˆªé™¤å°è‡´ï¼Œå¼·åˆ¶åˆªé™¤æ˜¯ä¸€ç¨®å±éšªçš„æ“ä½œï¼Œä¸å»ºè­°é€™æ¨£è™•ç†ï¼Œä¸‹é¢æœ‰è©³ç´°è¨è«–ã€‚&lt;/p>
&lt;br>
&lt;ol>
&lt;li>
&lt;p>ä¸€é–‹å§‹å¡åœ¨ Terminating ç‹€æ…‹ï¼Œæˆ‘å€‘ä¹Ÿæœ‰è«‹ RD èªªæ˜ä¸€ä¸‹ç•¶ä¸‹é‡åˆ°çš„å•é¡Œä»¥åŠè™•ç†å‹•ä½œï¼šRD ç•¶æ™‚æƒ³è¦åˆªé™¤ Pod æ˜¯å› ç‚ºè©²ç¨‹å¼ç•¶ä¸‹æœ‰ Bugï¼Œå°‡ redis èˆ‡ db é€£ç·šçµ¦é—œé–‰ï¼Œç¨‹å¼æ‰¾ä¸åˆ°å°±æœƒä¸€ç›´ retryï¼Œå°è‡´ç›¸é—œé€²ç¨‹ç„¡æ³•çµæŸï¼Œå†åŠ ä¸Š terminationGracePeriodSeconds æˆ‘å€‘è¨­å®š 14400ï¼Œä¹Ÿå°±æ˜¯ 4 å°æ™‚ï¼Œæ‰æœƒå¡åœ¨ Terminating ç‹€æ…‹ã€‚
(terminationGracePeriodSeconds è¨­å®šé€™éº¼ä¹…æ˜¯å¸Œæœ›å¦‚æœæœ‰è¢« on callï¼Œå·¥ç¨‹å¸«ä¸Šä¾†æ™‚ï¼Œå¯ä»¥æŸ¥çœ‹è©² Pod çš„éŒ¯èª¤åŸå› )&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å› ç‚ºå¡åœ¨ Terminating å¤ªä¹…ï¼ŒRD æœ‰åŸ·è¡Œ &lt;code>kubectl delete --force&lt;/code>ï¼Œå°±æ˜¯å› ç‚ºä¸‹äº† &lt;code>--force&lt;/code> æ‰é€ æˆç›¸é—œè³‡æºå•é¡Œ (ä¾‹å¦‚ container proccess, sandbox, ä»¥åŠç¶²è·¯è³‡æº)æ²’æœ‰åˆªä¹¾æ·¨ã€‚æ‰€ä»¥å¼•èµ·äº†æ­¤æ¬¡çš„å ±éŒ¯ &amp;ldquo;container veth name provided (eth0) already exists&amp;rdquo;ã€‚
(å› ç‚ºæˆ‘å€‘æœå‹™ä½¿ç”¨ Statefulsetï¼ŒPod åç¨±ç›¸åŒï¼Œå°è‡´ eth0 é€™å€‹ç¶²è·¯è³‡æºåç¨±é‡è¤‡ï¼Œæ‰€ä»¥é€ æˆéŒ¯èª¤ï¼Œå¯ä»¥ç”¨ deployment ä¾†æ”¹å–„é€™å€‹å•é¡Œï¼Œåªæ˜¯è³‡æºå¦‚æœæ²’æœ‰æ¸…ç†ä¹¾æ·¨æœƒä½”ç”¨ IPï¼Œæ‰€ä»¥å–®ç´”èª¿æ•´æˆ deployment ä¹Ÿä¸æ˜¯æœ€ä½³è§£)&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Google ç”¢å“åœ˜éšŠå»ºè­°ï¼Œå¦‚æœ Pod è™•æ–¼ Running ç‹€æ…‹æ™‚ï¼Œæƒ³è¦å¿«é€Ÿåˆªé™¤ Pod æ™‚ï¼Œä¸€é–‹å§‹å°±å…ˆä½¿ç”¨ &lt;code>kubectl delete pod --grace-period=number[ç§’æ•¸]&lt;/code> ä¾†åˆªé™¤ï¼Œå¦‚æœå·²ç¶“æ˜¯ Terminating ç‹€æ…‹å‰‡ç„¡æ•ˆã€‚(SRE åŒä»å·²æ¸¬è©¦éï¼Œèˆ‡ Google Support èªªæ˜ç›¸åŒ)&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é‚£å¦‚æœå·²ç¶“è™•æ–¼ Terminating ç‹€æ…‹ï¼Œè¦æ€éº½è®“ Pod è¢«é †åˆ©åˆªé™¤ï¼Œé€™éƒ¨åˆ† Google Support å¾ŒçºŒæœƒåœ¨æ¸¬è©¦ä¸¦çµ¦å‡ºå»ºè­°ï¼Œç›®å‰æ¸¬è©¦æ˜¯ï¼šé€²å»å¡ä½çš„ Pod Containerï¼Œæ‰‹å‹•åˆªé™¤ä¸»é€²ç¨‹ (pkill) å°±å¯ä»¥äº†ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/pod-veth-name-provided-eth0-already-exists/1.png"
alt="Google Support å›è¦†" width="800">&lt;figcaption>
&lt;p>Google Support å›è¦†&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;h2>åƒè€ƒè³‡æ–™&lt;span class="hx-absolute -hx-mt-20" id="åƒè€ƒè³‡æ–™">&lt;/span>
&lt;a href="#%e5%8f%83%e8%80%83%e8%b3%87%e6%96%99" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>Node ç¯€é»ç¦æ­¢èª¿åº¦ï¼ˆå¹³æ»‘ç¶­è­·ï¼‰æ–¹å¼- cordonï¼Œdrainï¼Œdeleteï¼š&lt;a href="https://www.cnblogs.com/kevingrace/p/14412254.html" target="_blank" rel="noopener">https://www.cnblogs.com/kevingrace/p/14412254.html&lt;/a>&lt;/p></description></item><item><title>Kubernetes (K8s) è‡ªå®šç¾© PHP HorizontalPodAutoscaler (HPA) æŒ‡æ¨™</title><link>https://pin-yi.me/blog/kubernetes/gcp-k8s-hpa-php-custom-metrics/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pin-yi.me/blog/kubernetes/gcp-k8s-hpa-php-custom-metrics/</guid><description>
&lt;p>æ­¤ç¯‡è¦ä»‹ç´¹ HorizontalPodAutoscaler çš„è‡ªå®šç¾©æŒ‡æ¨™ï¼ŒK8s å…§å»ºçš„æŒ‡æ¨™ (metrics) åªæ”¯æ´ CPU ä»¥åŠ Memoryï¼Œå¦‚æœæˆ‘å€‘ä»Šå¤©æƒ³è¦ä½¿ç”¨å…¶ä»–çš„æŒ‡æ¨™ä¾†è®“ HPA æ“´ç¸®å‘¢ï¼ï¼Ÿ
ä¸çŸ¥é“ä»€éº¼æ˜¯ HorizontalPodAutoscaler å—ï¼Ÿå¯ä»¥å…ˆæŸ¥çœ‹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://blog.pin-yi.me/k8s-hpa/" target="_blank" rel="noopener">Kubernetes (K8s) HorizontalPodAutoscaler (HPA) åŸç†èˆ‡å¯¦ä½œ&lt;/a>&lt;/li>
&lt;/ul>
&lt;br>
&lt;p>é€™æ™‚å€™æˆ‘å€‘å°±å¿…é ˆä½¿ç”¨è‡ªå®šç¾©æŒ‡æ¨™ï¼Œæˆ‘å€‘ä¸€æ¨£ä¾†èªªèªªä»–çš„å·¥ä½œåŸç†å§ï¼šHorizontalPodAutoscaler æ˜¯æ€éº¼å–å¾—è‡ªå®šç¾©æŒ‡æ¨™ï¼Œä»¥åŠæ˜¯è·Ÿèª°æ‹¿åˆ°æŒ‡æ¨™çš„å‘¢ï¼Ÿæˆ‘å€‘å¾ä¸‹åœ–å¾—çŸ¥ï¼š&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/gcp-k8s-hpa-php-custom-metrics/1.png"
alt="Kubernetes HPA : ExternalMetrics&amp;#43;Prometheus" width="400">&lt;figcaption>
&lt;p>&lt;a href="https://blog.kloia.com/kubernetes-hpa-externalmetrics-prometheus-acb1d8a4ed50" target="_blank" rel="noopener">Kubernetes HPA : ExternalMetrics+Prometheus&lt;/a>&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>HorizontalPodAutoscaler æœƒå…ˆè¨ªå• K8s çš„ APIï¼Œä¸¦å‘ API å–å¾—æŒ‡æ¨™è³‡æ–™ã€‚é€™é‚Šçš„ API å°±æ˜¯ &lt;code>custom.k8s.io/v1beta1&lt;/code>ã€‚&lt;/p>
&lt;br>
&lt;p>å¤§è‡´äº†è§£å¾Œï¼Œæˆ‘å€‘å°±ä¾†é€²å…¥ä»Šå¤©çš„é‡é»ï¼Œä¹Ÿå°±æ˜¯é€éè‡ªå®šç¾©åŒ– PHP çš„æŒ‡æ¨™ä¾†è®“ HorizontalPodAutoscaler é€²è¡Œæ“´ç¸®ï¼Œé€™æ¬¡ä½¿ç”¨çš„å¹³å°æ˜¯ Google Cloud Platformï¼Œå‰é¢ä»‹ç´¹ GCP æœå‹™çš„å¤§å®¶å¯ä»¥åƒè€ƒ &lt;a href="https://blog.pin-yi.me/gcp-introduce/" target="_blank" rel="noopener">Google Cloud Platform (GCP) ç™¾ç§‘å…¨æ›¸ - ä»‹ç´¹èˆ‡é–‹é ­ [ EP.0 ]&lt;/a>ï¼Œæˆ‘å€‘é€™é‚Šå°±ç›´æ¥è·³åˆ°ç¨‹å¼ç¢¼èˆ‡æ“ä½œéƒ¨åˆ†ã€‚&lt;/p>
&lt;br>
&lt;p>æ­¤æ–‡ç« ç¨‹å¼ç¢¼ä¹ŸæœƒåŒæ­¥åˆ° Github ï¼Œéœ€è¦çš„ä¹Ÿå¯ä»¥å» clone ä½¿ç”¨æ­ï¼ &lt;a href="https://github.com/880831ian/gcp-k8s-hpa-php-custom-metrics" target="_blank" rel="noopener">Github ç¨‹å¼ç¢¼é€£çµ&lt;/a> ğŸ˜†&lt;/p>
&lt;br>
&lt;h2>å¯¦ä½œ&lt;span class="hx-absolute -hx-mt-20" id="å¯¦ä½œ">&lt;/span>
&lt;a href="#%e5%af%a6%e4%bd%9c" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;h3>å®‰è£è‡ªå®šç¾©çš„ Adapter&lt;span class="hx-absolute -hx-mt-20" id="å®‰è£è‡ªå®šç¾©çš„-adapter">&lt;/span>
&lt;a href="#%e5%ae%89%e8%a3%9d%e8%87%aa%e5%ae%9a%e7%be%a9%e7%9a%84-adapter" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>æˆ‘å€‘è¦å…ˆ Apply è‡ªå®šç¾©çš„ Adapterï¼Œé€™é‚Šæˆ‘å€‘ä½¿ç”¨ Google æä¾›çš„ Stackdriver Adapter ä¾†ä½¿ç”¨ (ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ Github ç¨‹å¼ç¢¼ä¸­çš„ adapter_new_resource_model.yaml æª”æ¡ˆæ­)ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>kubectl apply -f https://raw.githubusercontent.com/GoogleCloudPlatform/k8s-stackdriver/master/custom-metrics-stackdriver-adapter/deploy/production/adapter_new_resource_model.yaml&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;h3>Deployment&lt;span class="hx-absolute -hx-mt-20" id="deployment">&lt;/span>
&lt;a href="#deployment" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">apiVersion&lt;/span>: &lt;span style="color:#ae81ff">apps/v1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">kind&lt;/span>: &lt;span style="color:#ae81ff">Deployment&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">metadata&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">demo&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">labels&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">app&lt;/span>: &lt;span style="color:#ae81ff">demo&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">spec&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">replicas&lt;/span>: &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">selector&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">matchLabels&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">app&lt;/span>: &lt;span style="color:#ae81ff">demo&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">template&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">metadata&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">labels&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">app&lt;/span>: &lt;span style="color:#ae81ff">demo&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">spec&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">containers&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">php-fpm&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">image&lt;/span>: &lt;span style="color:#ae81ff">php:fpm&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">workingDir&lt;/span>: &lt;span style="color:#ae81ff">/var/www/service&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ports&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">containerPort&lt;/span>: &lt;span style="color:#ae81ff">9000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">resources&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">requests&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">cpu&lt;/span>: &lt;span style="color:#ae81ff">100m&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">memory&lt;/span>: &lt;span style="color:#ae81ff">1G&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">limits&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">cpu&lt;/span>: &lt;span style="color:#ae81ff">100m&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">memory&lt;/span>: &lt;span style="color:#ae81ff">1G&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">volumeMounts&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">application&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">mountPath&lt;/span>: &lt;span style="color:#ae81ff">/var/www/service/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">php-fpm-config&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">mountPath&lt;/span>: &lt;span style="color:#ae81ff">/usr/local/etc/php-fpm.d/www.conf&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">subPath&lt;/span>: &lt;span style="color:#ae81ff">www.conf&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">nginx&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">image&lt;/span>: &lt;span style="color:#ae81ff">nginx:alpine&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">workingDir&lt;/span>: &lt;span style="color:#ae81ff">/var/www/service&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ports&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">containerPort&lt;/span>: &lt;span style="color:#ae81ff">80&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">volumeMounts&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">application&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">mountPath&lt;/span>: &lt;span style="color:#ae81ff">/var/www/service/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">nginx-config&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">mountPath&lt;/span>: &lt;span style="color:#ae81ff">/etc/nginx/conf.d/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">phpfpm-exporter&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">image&lt;/span>: &lt;span style="color:#ae81ff">hipages/php-fpm_exporter:latest&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">env&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">PHP_FPM_SCRAPE_URI&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">value&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;tcp://localhost:9000/status&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">PHP_FPM_FIX_PROCESS_COUNT&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">value&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;true&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">resources&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">requests&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">cpu&lt;/span>: &lt;span style="color:#ae81ff">10m&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">limits&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">cpu&lt;/span>: &lt;span style="color:#ae81ff">10m&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">prometheus-to-sd&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">image&lt;/span>: &lt;span style="color:#ae81ff">gcr.io/google-containers/prometheus-to-sd:v0.9.0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ports&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">containerPort&lt;/span>: &lt;span style="color:#ae81ff">6060&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">protocol&lt;/span>: &lt;span style="color:#ae81ff">TCP&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">command&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">/monitor&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - --&lt;span style="color:#ae81ff">stackdriver-prefix=custom.googleapis.com&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - --&lt;span style="color:#ae81ff">monitored-resource-type-prefix=k8s_&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - --&lt;span style="color:#ae81ff">source=:http://localhost:9253&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - --&lt;span style="color:#ae81ff">pod-id=$(POD_NAME)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - --&lt;span style="color:#ae81ff">namespace-id=$(POD_NAMESPACE)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">resources&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">requests&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">cpu&lt;/span>: &lt;span style="color:#ae81ff">10m&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">limits&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">cpu&lt;/span>: &lt;span style="color:#ae81ff">10m&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">env&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">POD_NAME&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">valueFrom&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">fieldRef&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">fieldPath&lt;/span>: &lt;span style="color:#ae81ff">metadata.name&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">POD_NAMESPACE&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">valueFrom&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">fieldRef&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">fieldPath&lt;/span>: &lt;span style="color:#ae81ff">metadata.namespace&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">volumes&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">application&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">emptyDir&lt;/span>: {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">php-fpm-config&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">configMap&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">php-fpm-conf&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">nginx-config&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">configMap&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">nginx-conf&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;p>æˆ‘ä¾†ç°¡å–®èªªæ˜ä¸€ä¸‹ï¼Œé€™æ˜¯ä¸€å€‹ Deploymentï¼Œæˆ‘å€‘åœ¨æ¯ä¸€å€‹ Pod è£¡é¢éƒ½æ”¾ 4 å€‹ Containerï¼Œåˆ†åˆ¥æ˜¯ &lt;code>php-fpm&lt;/code>ã€&lt;code>nginx&lt;/code>ã€&lt;code>phpfpm-exporter&lt;/code>ã€&lt;code>prometheus-to-sd&lt;/code>&lt;/p>
&lt;p>php-fpm å°±æ˜¯æˆ‘å€‘è¦ä½¿ç”¨çš„ phpï¼Œnginx æœƒæä¾› 9000 Port è®“ phpfpm-exporter å»æŠ“åˆ°ç›®å‰çš„ Process æ•¸å€¼ï¼Œæœ€å¾Œä¸Ÿçµ¦ prometheus-to-sdï¼Œè®“ä»–å»é€šçŸ¥æˆ‘å€‘å‰›å‰›æ‰€å®‰è£çš„ Adapterï¼Œå°±å¯ä»¥é€é API è®“ HPA çŸ¥é“ï¼è½ä¸å¤ªæ‡‚å—ï¼Ÿæ²’é—œä¿‚ï¼Œå¹«å¤§å®¶ç•«äº†ä¸€å¼µåœ–ï¼Œè«‹åƒè€ƒä¸‹æ–¹åœ–ç‰‡ï¼š&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/gcp-k8s-hpa-php-custom-metrics/2.png"
alt="æ¶æ§‹åœ–" width="1200">&lt;figcaption>
&lt;p>æ¶æ§‹åœ–&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>å¯ä»¥çœ‹åˆ° Deployment è£¡é¢ï¼Œæˆ‘å€‘ä½¿ç”¨ ConfigMap ä¾†æ›è¼‰ php çš„ www.conf ä»¥åŠ nginx çš„è¨­å®šæª”ï¼Œé‚£æˆ‘å€‘æ¥ä¸‹ä¾†å°±å¯«ä¸€ä»½ ConfigMap å§ï¼&lt;/p>
&lt;br>
&lt;h3>ConfigMap&lt;span class="hx-absolute -hx-mt-20" id="configmap">&lt;/span>
&lt;a href="#configmap" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">apiVersion&lt;/span>: &lt;span style="color:#ae81ff">v1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">kind&lt;/span>: &lt;span style="color:#ae81ff">ConfigMap&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">metadata&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">php-fpm-conf&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">data&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">www.conf&lt;/span>: |&lt;span style="color:#e6db74">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> [www]
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> user = 900
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> group = 900
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> listen = 9000
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> listen.owner = 900
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> listen.group = 900
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> listen.mode = 0660
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> pm = dynamic
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> pm.max_children = 150
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> pm.max_requests = 300
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> pm.start_servers = 24
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> pm.min_spare_servers = 24
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> pm.max_spare_servers = 126
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> pm.status_path = /status
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> ping.path = /ping
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> ping.response = OK
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> catch_workers_output = yes
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> request_terminate_timeout = 300
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> clear_env = no&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>---
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">apiVersion&lt;/span>: &lt;span style="color:#ae81ff">v1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">kind&lt;/span>: &lt;span style="color:#ae81ff">ConfigMap&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">metadata&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">nginx-conf&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">namespace&lt;/span>: &lt;span style="color:#ae81ff">ian&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">data&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">nginx.conf&lt;/span>: |&lt;span style="color:#e6db74">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> server {
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> listen 80;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> listen [::]:80;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> server_name _;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> root /var/www/service/;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> index index.php;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> location / {
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> try_files $uri $uri/ /index.php$is_args$args;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> }
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> location ~ ^/(status|ping)$ {
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> fastcgi_pass 127.0.0.1:9000;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> fastcgi_index index.php;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> include fastcgi_params;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> }
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> }&lt;/span> &lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>é€™ä»½ ConfigMap.yaml æª”æ¡ˆè£¡é¢åˆ†æˆ php-fpm-conf ä¾†æ”¾ www.confï¼Œä»¥åŠ nginx-conf ä¾†æ”¾ nginx.conf æª”æ¡ˆï¼Œé€™é‚Šè¦æ³¨æ„çš„æ˜¯ www.conf è¨˜å¾—è¦åŠ ä¸Š &lt;code>pm.status_path = /status&lt;/code>ï¼Œphpfpm-exporter æ˜¯é€éé€™å€‹é é¢ä¾†ç²å¾— Process æ•¸é‡ã€‚&lt;/p>
&lt;br>
&lt;h3>HorizontalPodAutoscaler&lt;span class="hx-absolute -hx-mt-20" id="horizontalpodautoscaler">&lt;/span>
&lt;a href="#horizontalpodautoscaler" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">apiVersion&lt;/span>: &lt;span style="color:#ae81ff">autoscaling/v2beta2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">kind&lt;/span>: &lt;span style="color:#ae81ff">HorizontalPodAutoscaler&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">metadata&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">demo-hpa&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">spec&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">scaleTargetRef&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">apiVersion&lt;/span>: &lt;span style="color:#ae81ff">apps/v1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">kind&lt;/span>: &lt;span style="color:#ae81ff">Deployment&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">demo&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">minReplicas&lt;/span>: &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">maxReplicas&lt;/span>: &lt;span style="color:#ae81ff">10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">metrics&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">type&lt;/span>: &lt;span style="color:#ae81ff">Pods&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">pods&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">metric&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">phpfpm_active_processes&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">target&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">averageValue&lt;/span>: &lt;span style="color:#ae81ff">50&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">type&lt;/span>: &lt;span style="color:#ae81ff">AverageValue&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">type&lt;/span>: &lt;span style="color:#ae81ff">Pods&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">pods&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">metric&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">phpfpm_idle_processes&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">target&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">averageValue&lt;/span>: &lt;span style="color:#ae81ff">50&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">type&lt;/span>: &lt;span style="color:#ae81ff">AverageValue&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">type&lt;/span>: &lt;span style="color:#ae81ff">Pods&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">pods&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">metric&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">phpfpm_total_processes&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">target&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">averageValue&lt;/span>: &lt;span style="color:#ae81ff">50&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">type&lt;/span>: &lt;span style="color:#ae81ff">AverageValue&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">type&lt;/span>: &lt;span style="color:#ae81ff">Pods&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">pods&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">metric&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">phpfpm_accepted_connections&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">target&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">averageValue&lt;/span>: &lt;span style="color:#ae81ff">50&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">type&lt;/span>: &lt;span style="color:#ae81ff">AverageValue&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>é€™ä»½ HorizontalPodAutoscaler æˆ‘å€‘ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯ &lt;code>autoscaling/v2beta2&lt;/code>ï¼Œ v2beta1 è·Ÿ v2beta2 çš„è¨­å®šæª”èªæ³•æœ‰äº›ä¸åŒï¼&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°æˆ‘å€‘ &lt;code>metrics.pods.metric.name&lt;/code> åˆ†åˆ¥æ˜¯ &lt;code>phpfpm_active_processes (æ´»å‹•çš„é€²ç¨‹å€‹æ•¸)&lt;/code>ã€&lt;code>phpfpm_idle_processes (ç©ºé–’çš„é€²ç¨‹å€‹æ•¸)&lt;/code>ã€&lt;code>phpfpm_total_processes (ç¸½å…±çš„é€²ç¨‹å€‹æ•¸)&lt;/code>ã€&lt;code>phpfpm_accepted_connections (ç•¶å‰çš„é€£æ¥æ•¸é‡)&lt;/code>ï¼Œå¦‚æœè¶…éæˆ‘å€‘æ‰€è¨­å®šçš„ target å€¼ï¼ŒHPA å°±æœƒä½œå‹•ã€‚&lt;/p>
&lt;br>
&lt;p>æˆ‘å€‘ä¾åºæŠŠ Deployment &amp;gt; ConfigMap &amp;gt; HorizontalPodAutoscaler çš„ yaml æª”æ¡ˆçµ¦ Applyï¼Œå¯ä»¥è§€å¯Ÿä¸€ä¸‹ Pod æ˜¯å¦éƒ½æœ‰æ­£å¸¸å•Ÿå‹•ï¼š&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/gcp-k8s-hpa-php-custom-metrics/3.png"
alt="Pod æ˜¯å¦æ­£å¸¸å•Ÿå‹•" width="1200">&lt;figcaption>
&lt;p>Pod æ˜¯å¦æ­£å¸¸å•Ÿå‹•&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>æˆ‘å€‘åˆ° HorizontalPodAutoscaler æŸ¥çœ‹æˆ‘å€‘æ‰€è¨­å®šçš„ metrics æ˜¯å¦éƒ½æœ‰æŠ“åˆ°ç›®å‰çš„å€¼ï¼š&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/gcp-k8s-hpa-php-custom-metrics/4.png"
alt="metrics æ˜¯å¦éƒ½æœ‰æŠ“åˆ°ç›®å‰çš„å€¼" width="550">&lt;figcaption>
&lt;p>metrics æ˜¯å¦éƒ½æœ‰æŠ“åˆ°ç›®å‰çš„å€¼&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>æˆ‘å€‘ä¹Ÿå¯ä»¥ç”¨ Google Cloud Platform çš„ç›£æ§ä¾†æŸ¥çœ‹ï¼š&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/gcp-k8s-hpa-php-custom-metrics/5.png"
alt="Google Cloud Platform çš„ç›£æ§" width="1200">&lt;figcaption>
&lt;p>Google Cloud Platform çš„ç›£æ§&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>ä»¥ä¸Šå°±å®Œæˆ è‡ªå®šç¾© HorizontalPodAutoscaler æŒ‡æ¨™å›‰ï½ ğŸ˜&lt;/p>
&lt;br>
&lt;h2>åƒè€ƒè³‡æ–™&lt;span class="hx-absolute -hx-mt-20" id="åƒè€ƒè³‡æ–™">&lt;/span>
&lt;a href="#%e5%8f%83%e8%80%83%e8%b3%87%e6%96%99" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>Autoscaling Deployments with Cloud Monitoring metricï¼š&lt;a href="https://cloud.google.com/kubernetes-engine/docs/tutorials/autoscaling-metrics#custom-prometheus_1" target="_blank" rel="noopener">https://cloud.google.com/kubernetes-engine/docs/tutorials/autoscaling-metrics#custom-prometheus_1&lt;/a>&lt;/p>
&lt;p>GoogleCloudPlatform/k8s-stackdriverï¼š&lt;a href="https://github.com/GoogleCloudPlatform/k8s-stackdriver/tree/master/custom-metrics-stackdriver-adapter" target="_blank" rel="noopener">https://github.com/GoogleCloudPlatform/k8s-stackdriver/tree/master/custom-metrics-stackdriver-adapter&lt;/a>&lt;/p>
&lt;p>hipages/php-fpm_exporterï¼š&lt;a href="https://github.com/hipages/php-fpm_exporter" target="_blank" rel="noopener">https://github.com/hipages/php-fpm_exporter&lt;/a>&lt;/p>
&lt;p>Scaling PHP-FPM with custom metrics on GKE/kubernetesï¼š&lt;a href="https://www.ashsmith.io/scaling-phpfpm-with-custom-metrics-gke" target="_blank" rel="noopener">https://www.ashsmith.io/scaling-phpfpm-with-custom-metrics-gke&lt;/a>&lt;/p></description></item><item><title>Kubernetes (K8s) HorizontalPodAutoscaler (HPA) åŸç†èˆ‡å¯¦ä½œ</title><link>https://pin-yi.me/blog/kubernetes/k8s-hpa/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pin-yi.me/blog/kubernetes/k8s-hpa/</guid><description>
&lt;p>æ­¤ç¯‡æ˜¯è¦ä»‹ç´¹ HorizontalPodAutoscaler (HPA) çš„åŸç†ä»¥åŠå¯¦ä½œå…§å®¹ï¼Œé‚£æˆ‘å€‘å…ˆä¾†èªªæ˜ä¸€ä¸‹ HorizontalPodAutoscaler æ˜¯ä»€éº¼å§ï¼&lt;/p>
&lt;br>
&lt;h2>HorizontalPodAutoscaler åŸç†&lt;span class="hx-absolute -hx-mt-20" id="horizontalpodautoscaler-åŸç†">&lt;/span>
&lt;a href="#horizontalpodautoscaler-%e5%8e%9f%e7%90%86" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>HorizontalPodAutoscaler (HPA) ä¸­æ–‡å¯ä»¥å«æ°´å¹³ Pod è‡ªå‹•æ“´ç¸®ï¼Œä»–æœƒè‡ªå‹•æ›´æ–°å·¥ä½œè² è¼‰è³‡æº (Deployment æˆ– StatefulSet)ï¼Œå…¶ç›®çš„æ˜¯é€éè‡ªå‹•æ“´ç¸®å·¥ä½œè² è¼‰ä¾†æ»¿è¶³ä½¿ç”¨éœ€æ±‚ã€‚&lt;/p>
&lt;p>ç°¡å–®ä¾†èªªä»–æœƒæ ¹æ“šä½ ç¾åœ¨çš„è² è¼‰å»èª¿æ•´ä½ çš„ Pod æ•¸é‡ï¼Œç•¶ç›®å‰çš„è² è¼‰è¶…éé…ç½®çš„è¨­å®šæ™‚ï¼ŒHPA æœƒæŒ‡ç¤ºå·¥ä½œè² è¼‰è³‡æº (Deployment æˆ– StatefulSet) æ“´å¢ï¼Œä¾†é¿å…å¡çˆ†åŒä¸€å€‹è² è¼‰è³‡æºã€‚&lt;/p>
&lt;p>å¦‚æœè² è¼‰æ¸›å°‘ï¼Œä¸” Pod æ•¸é‡é«˜æ–¼é…ç½®çš„æœ€å°å€¼ï¼ŒHPA ä¹ŸæœƒæŒ‡ç¤ºå·¥ä½œè² è¼‰è³‡æº (Deployment æˆ– StatefulSet) æ…¢æ…¢ç¸®æ¸›ã€‚å…¶ä¸­æ°´å¹³ Pod è‡ªå‹•æ“´ç¸®ä¸é©ç”¨ DaemonSet å·¥ä½œè² è¼‰è³‡æºã€‚&lt;/p>
&lt;br>
&lt;h3>HPA æ˜¯å¦‚ä½•å·¥ä½œå‘¢ï¼Ÿ&lt;span class="hx-absolute -hx-mt-20" id="hpa-æ˜¯å¦‚ä½•å·¥ä½œå‘¢">&lt;/span>
&lt;a href="#hpa-%e6%98%af%e5%a6%82%e4%bd%95%e5%b7%a5%e4%bd%9c%e5%91%a2" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-hpa/1.png"
alt="HorizontalPodAutoscaler å·¥ä½œæµç¨‹åœ–" width="650">&lt;figcaption>
&lt;p>HorizontalPodAutoscaler å·¥ä½œæµç¨‹åœ–&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>Kubernetes å°‡æ°´å¹³ Pod è‡ªå‹•æ“´ç¸®å®šç¾©ç‚ºä¸€å€‹é–“æ­‡é‹è¡Œçš„æ§åˆ¶è¿´è·¯ï¼Œä»–ä¸æ˜¯é€£çºŒçš„ï¼Œå…¶é–“éš”æ˜¯ç”± &lt;code>kube-controller-manager&lt;/code> çš„ &lt;code>--horizontal-pod-autoscaler-sync-period&lt;/code> åƒæ•¸ä¾†é…ç½®ï¼Œé è¨­æ˜¯ 15 ç§’ï¼Œcontroller-manager æœƒä¾æ“šæ¯ä¸€å€‹ HPA å®šç¾©çš„ &lt;code>scaleTargetRef&lt;/code> ä¾†æ‰¾åˆ°æ˜¯å“ªä¸€å€‹å·¥ä½œè² è¼‰è³‡æºéœ€è¦é€²è¡Œæ°´å¹³ Pod è‡ªå‹•æ“´ç¸®ï¼Œç„¶å¾Œæ ¹æ“šç›®æ¨™è³‡æºçš„ &lt;code>.spec.selector&lt;/code> æ¨™ç±¤é¸æ“‡å°æ‡‰çš„ Podï¼Œä¸¦å¾è³‡æºæŒ‡æ¨™ API æˆ–è‡ªå®šç¾©æŒ‡æ¨™ç²å– APIï¼Œç›®å‰ç¸½å…±æœ‰ä¸‰ç¨®çš„è³‡æºæŒ‡æ¨™ï¼Œåˆ†åˆ¥æ˜¯ CPUã€Memoryã€è‡ªå®šç¾©æŒ‡æ¨™ã€‚&lt;/p>
&lt;br>
&lt;br>
&lt;p>æœ‰é—œæ–¼å…¶ä»– Kubernetes è§€å¿µéƒ¨åˆ†ï¼Œå¯ä»¥å…ˆæŸ¥çœ‹ï¼š&lt;/p>
&lt;ul>
&lt;li>Kubernetes : &lt;a href="https://pin-yi.me/k8s/" target="_blank" rel="noopener">Kubernetes (K8s) ä»‹ç´¹ - åŸºæœ¬&lt;/a>&lt;/li>
&lt;li>kubernetes : &lt;a href="https://pin-yi.me/k8s-advanced/" target="_blank" rel="noopener">Kubernetes (K8s) ä»‹ç´¹ - é€²éš (Serviceã€Ingressã€StatefulSetã€Deploymentã€ReplicaSetã€ConfigMap)&lt;/a>&lt;/li>
&lt;/ul>
&lt;br>
&lt;p>æ­¤æ–‡ç« ç¨‹å¼ç¢¼ä¹ŸæœƒåŒæ­¥åˆ° Github ï¼Œéœ€è¦çš„ä¹Ÿå¯ä»¥å» clone ä½¿ç”¨æ­ï¼è¦è¨˜å¾—å…ˆç¢ºå®šä¸€ä¸‹è‡ªå·±çš„ç‰ˆæœ¬ &lt;a href="https://github.com/880831ian/Kubernetes-HPA" target="_blank" rel="noopener">Github ç¨‹å¼ç¢¼é€£çµ&lt;/a> ğŸ˜†&lt;/p>
&lt;br>
&lt;h2>ç‰ˆæœ¬è³‡è¨Š&lt;span class="hx-absolute -hx-mt-20" id="ç‰ˆæœ¬è³‡è¨Š">&lt;/span>
&lt;a href="#%e7%89%88%e6%9c%ac%e8%b3%87%e8%a8%8a" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;ul>
&lt;li>macOSï¼š11.6&lt;/li>
&lt;li>Minikubeï¼šv1.25.2&lt;/li>
&lt;li>Kubectlï¼šClient Versionï¼šv1.24.1ã€Server Versionï¼šv1.23.3&lt;/li>
&lt;li>Metrics Server &lt;a href="https://github.com/kubernetes-sigs/metrics-server/releases/tag/metrics-server-helm-chart-3.8.2" target="_blank" rel="noopener">3.8.2&lt;/a>&lt;/li>
&lt;/ul>
&lt;br>
&lt;h2>å¯¦ä½œ&lt;span class="hx-absolute -hx-mt-20" id="å¯¦ä½œ">&lt;/span>
&lt;a href="#%e5%af%a6%e4%bd%9c" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>é€™æ¬¡å¯¦ä½œè¦ä½¿ç”¨çš„å¢é›†æ˜¯ Minikubeï¼Œæ‰€ä»¥ç…§ä»¥å‰æ–‡ç« ä¸€æ¨£ï¼Œæˆ‘å€‘å…ˆå•Ÿå‹• Minikubeã€‚æœ¬æ¬¡æœƒä½¿ç”¨ K8s çš„ç®¡ç†å·¥å…·ï¼š&lt;a href="https://k8slens.dev/" target="_blank" rel="noopener">k8slens&lt;/a> ä¾†åšç‚ºè¼”åŠ©ï¼Œå¤§å®¶æœ‰èˆˆè¶£ä¹Ÿå¯ä»¥å…ˆå»ä¸‹è¼‰ä¾†ä½¿ç”¨æ­ ğŸ˜˜&lt;/p>
&lt;h3>å•Ÿå‹• Minikube å¢é›†&lt;span class="hx-absolute -hx-mt-20" id="å•Ÿå‹•-minikube-å¢é›†">&lt;/span>
&lt;a href="#%e5%95%9f%e5%8b%95-minikube-%e5%8f%a2%e9%9b%86" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;ol>
&lt;li>å•Ÿå‹• Minikube å¢é›†&lt;/li>
&lt;/ol>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>minikube start --vm-driver&lt;span style="color:#f92672">=&lt;/span>docker&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-hpa/2.png"
alt="å•Ÿå‹• Minikube" width="800">&lt;figcaption>
&lt;p>å•Ÿå‹• Minikube&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;h3>è¨­å®š Metrics Server&lt;span class="hx-absolute -hx-mt-20" id="è¨­å®š-metrics-server">&lt;/span>
&lt;a href="#%e8%a8%ad%e5%ae%9a-metrics-server" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>ç”±æ–¼æˆ‘å€‘ HorizontalPodAutoscaler æœƒæ ¹æ“šç¾åœ¨çš„è² è¼‰ä¾†åˆ¤æ–·æ˜¯å¦è¦æ–°å¢æ–°çš„ Pod ä¾†è§£æ±ºè² è¼‰è³‡æºç”¨å®Œçš„å•é¡Œï¼Œæ‰€ä»¥ç¬¬ä¸€å€‹æ¢ä»¶å°±æ˜¯è¦å…ˆç²çš„ç›®å‰çš„è² è¼‰è³‡æºä½¿ç”¨é‡ï¼Œé€™æ™‚å€™æˆ‘å€‘å¿…é ˆå…ˆåœ¨ K8s å¢é›†ä¸Šå®‰è£ &lt;code>Metrics Server&lt;/code>ï¼Œé€éä»–è®“æˆ‘å€‘å¯ä»¥çŸ¥é“ç›®å‰çš„è² è¼‰ä½¿ç”¨é‡ï¼&lt;/p>
&lt;ol start="2">
&lt;li>
&lt;p>å…ˆåˆ° &lt;a href="https://github.com/kubernetes-sigs/metrics-server" target="_blank" rel="noopener">kubernetes-sigs/metrics-server&lt;/a> ä¸‹è¼‰æœ€æ–°çš„ components.yaml æª”æ¡ˆä¸‹ä¾†ï¼Œä»¥æˆ‘é€™æ¬¡ç¤ºç¯„çš„ç‰ˆæœ¬ç‚ºä¾‹ï¼Œ&lt;a href="https://github.com/kubernetes-sigs/metrics-server/releases/tag/metrics-server-helm-chart-3.8.2" target="_blank" rel="noopener">å¤§å®¶å¯ä»¥é»æˆ‘ä¸‹è¼‰ ğŸ‘‡&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸‹è¼‰å®Œï¼Œéœ€è¦å…ˆä¿®æ”¹å…©å€‹åœ°æ–¹ï¼Œæ‰èƒ½ apply åˆ° Minikube å¢é›†ï¼Œç¬¬ä¸€å€‹æ˜¯ä¿®æ”¹ &lt;code>kubelet-preferred-address-types=InternalIP&lt;/code>ï¼Œä»¥åŠæ–°å¢ &lt;code>kubelet-insecure-tls=ture&lt;/code> è®“ Metrics Server ç¦ç”¨ TLS è­‰æ›¸é©—è­‰ï¼Œè©³ç´°å¯ä»¥åƒè€ƒä»¥ä¸‹ç…§ç‰‡ï¼š&lt;/p>
&lt;/li>
&lt;/ol>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-hpa/3.png"
alt="ä¿®æ”¹ components.yaml" width="1200">&lt;figcaption>
&lt;p>ä¿®æ”¹ components.yaml&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;ol start="4">
&lt;li>æ¥è‘— apply é€™å€‹ yaml æª”æ¡ˆï¼š&lt;/li>
&lt;/ol>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-hpa/4.png"
alt="apply components.yaml" width="800">&lt;figcaption>
&lt;p>apply components.yaml&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>å¯ä»¥æª¢æŸ¥ä¸€ä¸‹ deployment.apps/metrics-server æ˜¯å¦æœ‰æˆåŠŸå»ºç«‹æˆ–æ˜¯ Pod æ˜¯å¦æœ‰å•é¡Œï¼š&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-hpa/5.png"
alt="æª¢æŸ¥ metrics-server æ˜¯å¦æœ‰å•é¡Œ" width="1200">&lt;figcaption>
&lt;p>æª¢æŸ¥ metrics-server æ˜¯å¦æœ‰å•é¡Œ&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;h3>é–‹å§‹æ’°å¯«å¯¦ä½œæª”æ¡ˆ&lt;span class="hx-absolute -hx-mt-20" id="é–‹å§‹æ’°å¯«å¯¦ä½œæª”æ¡ˆ">&lt;/span>
&lt;a href="#%e9%96%8b%e5%a7%8b%e6%92%b0%e5%af%ab%e5%af%a6%e4%bd%9c%e6%aa%94%e6%a1%88" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;ol start="5">
&lt;li>æ¥è‘—æˆ‘å€‘å°±ä¾ç…§å®˜æ–¹çš„ &lt;a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/" target="_blank" rel="noopener">HorizontalPodAutoscaler Walkthrough&lt;/a> çš„æ–‡ç« é–‹å§‹å›‰ï¼é¦–å…ˆå…ˆå¯«ä¸€å€‹ index.phpï¼Œé€™å€‹æª”æ¡ˆæ˜¯ç”¨æ–¼å¾ŒçºŒæ¸¬è©¦ HPA è² è¼‰ä½¿ç”¨é‡çš„ç¨‹å¼ï¼š&lt;/li>
&lt;/ol>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-hpa/6.png"
alt="index.php" width="500">&lt;figcaption>
&lt;p>index.php&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;ol start="6">
&lt;li>æ–°å¢ Dockerfileï¼Œæˆ‘å€‘ä½¿ç”¨ php:5-apache çš„ imageï¼Œä¸¦è¤‡è£½å‰›å‰›å¯«çš„ index.php åˆ°å®¹å™¨å…§ï¼š&lt;/li>
&lt;/ol>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-hpa/7.png"
alt="Dockerfile" width="500">&lt;figcaption>
&lt;p>Dockerfile&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;ol start="7">
&lt;li>å°‡è©² Dockerfile Build èµ·ä¾†ï¼Œæ¨åˆ° DockerHub ä¸Šï¼Œé€™éƒ¨åˆ†å°±ä¸å¤šèªªæ˜ï¼Œæœ‰èˆˆè¶£å¯ä»¥åƒè€ƒä»¥å‰æ–‡ç« ï¼Œå¤§å®¶å¯ä»¥ç›´æ¥ä½¿ç”¨ &lt;a href="https://hub.docker.com/repository/docker/880831ian/php-apache" target="_blank" rel="noopener">880831ian/php-apache&lt;/a> æˆ‘æ¨å¥½çš„ image ä¾†ä½¿ç”¨ã€‚&lt;/li>
&lt;li>æ–°å¢ Deployment.yamlï¼Œè£¡é¢æœƒä½¿ç”¨æˆ‘å€‘å‰›å‰›æ‰“åŒ…æ¨åˆ° DockerHub ä¸Šçš„ imageï¼š&lt;/li>
&lt;/ol>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">apiVersion&lt;/span>: &lt;span style="color:#ae81ff">apps/v1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">kind&lt;/span>: &lt;span style="color:#ae81ff">Deployment&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">metadata&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">php-apache&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">spec&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">selector&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">matchLabels&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">run&lt;/span>: &lt;span style="color:#ae81ff">php-apache&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">replicas&lt;/span>: &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">template&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">metadata&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">labels&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">run&lt;/span>: &lt;span style="color:#ae81ff">php-apache&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">spec&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">containers&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">php-apache&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">image&lt;/span>: &lt;span style="color:#ae81ff">880831ian/php-apache&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ports&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">containerPort&lt;/span>: &lt;span style="color:#ae81ff">80&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">resources&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">limits&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">cpu&lt;/span>: &lt;span style="color:#ae81ff">500m&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">requests&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">cpu&lt;/span>: &lt;span style="color:#ae81ff">200m&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>---
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">apiVersion&lt;/span>: &lt;span style="color:#ae81ff">v1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">kind&lt;/span>: &lt;span style="color:#ae81ff">Service&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">metadata&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">php-apache&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">labels&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">run&lt;/span>: &lt;span style="color:#ae81ff">php-apache&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">spec&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ports&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">port&lt;/span>: &lt;span style="color:#ae81ff">80&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">selector&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">run&lt;/span>: &lt;span style="color:#ae81ff">php-apache&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>é€™é‚Šå¤§å®¶å¯ä»¥å…ˆè¨˜å¾—æˆ‘å€‘åœ¨ containers.resources æœ‰è¨­å®š cpu çš„ requests ç‚º 200mã€‚å¾ŒçºŒåœ¨è¨ˆç®—å‰¯æœ¬æ•¸æ™‚æœƒå†æåˆ° ğŸ˜¬&lt;/p>
&lt;br>
&lt;ol start="9">
&lt;li>æœ€å¾Œå°‡ Deployment.yaml çµ¦ applyï¼Œæª¢æŸ¥ä¸€ä¸‹æ˜¯å¦æœ‰æ­£å¸¸å•Ÿå‹•ï¼š&lt;/li>
&lt;/ol>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-hpa/8.png"
alt="k8slens æª¢æŸ¥æ˜¯å¦æ­£å¸¸" width="1200">&lt;figcaption>
&lt;p>k8slens æª¢æŸ¥æ˜¯å¦æ­£å¸¸&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;ol start="10">
&lt;li>ä½¿ç”¨ &lt;code>kubectl autoscale&lt;/code> ä¾†å¹«åŠ©æˆ‘å€‘å‰µå»º HorizontalPodAutoscalerï¼š&lt;/li>
&lt;/ol>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>kubectl autoscale deployment php-apache --cpu-percent&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">50&lt;/span> --min&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span> --max&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">10&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;div class="hx-overflow-x-auto hx-mt-6 hx-flex hx-rounded-lg hx-border hx-py-2 ltr:hx-pr-4 rtl:hx-pl-4 contrast-more:hx-border-current contrast-more:dark:hx-border-current hx-border-orange-100 hx-bg-orange-50 hx-text-orange-800 dark:hx-border-orange-400/30 dark:hx-bg-orange-400/20 dark:hx-text-orange-300">
&lt;div class="ltr:hx-pl-3 ltr:hx-pr-2 rtl:hx-pr-3 rtl:hx-pl-2">&lt;/div>
&lt;div class="hx-w-full hx-min-w-0 hx-leading-7">
&lt;div class="hx-mt-6 hx-leading-7 first:hx-mt-0">æˆ‘å€‘åœ¨ Deployment.yaml è£¡é¢ &lt;code>containers.resources&lt;/code> æœ‰è¨­å®š cpu çš„ requests æ˜¯ 200mï¼Œä¹Ÿå°±æ˜¯ 200 milli-coresï¼Œç•¶æˆ‘å€‘ç¾åœ¨è¨­å®š HPA çš„å¹³å‡ CPU ä½¿ç”¨ç‡ç‚º 50%ï¼Œæ‰€ä»¥æˆ‘å€‘åªè¦è¶…é 200m / 2 = 100mï¼Œä¹Ÿå°±æ˜¯ requests è¶…é 100 milli-cores å°±æœƒç”¢ç”Ÿæ–°çš„ Podã€‚é€™é‚Šæœ€å°‘ Pod ç‚º 1ï¼Œæœ€å¤šç‚º 10ã€‚å¾ŒçºŒç­‰æ¸¬è©¦æ™‚ï¼Œæœƒå¸¶å¤§å®¶è¨ˆç®—ä»–æ˜¯å¦‚ä½•ç”¢ç”Ÿ Pod çš„ ğŸ˜&lt;/div>
&lt;/div>
&lt;/div>
&lt;br>
&lt;ol start="11">
&lt;li>æŸ¥çœ‹ç›®å‰ HPA ä½¿ç”¨é‡ï¼Œå› ç‚ºæˆ‘å€‘é€™å€‹ php-apache é‚„æ²’æœ‰ä»»ä½•çš„è¨ªå•ï¼Œæ‰€ä»¥æ˜¯ 0% / 50% (æ‰¿ä¸Šé¢æ‰€èªªï¼Œæ‰€ä»¥é€™é‚Šçš„å€¼æ˜¯ 0 / 100 milli-cores)ï¼Œå¾Œé¢ä¹Ÿå¯ä»¥çœ‹åˆ°æˆ‘å€‘æ‰€è¨­å®šæœ€é«˜è·Ÿæœ€ä½çš„ Podï¼Œä»¥åŠç›®å‰çš„å‰¯æœ¬æ•¸ã€‚&lt;/li>
&lt;/ol>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-hpa/9.png"
alt="æŸ¥çœ‹ç›®å‰ HPA ä½¿ç”¨é‡" width="700">&lt;figcaption>
&lt;p>æŸ¥çœ‹ç›®å‰ HPA ä½¿ç”¨é‡&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;ol start="12">
&lt;li>ç•¶ç„¶æˆ‘å€‘é™¤äº†ç”¨å‰›å‰›çš„æŒ‡ä»¤ä»¥å¤–ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥è‡ªå·±å¯« HPA çš„ yaml æª”æ¡ˆã€‚æˆ‘é€™é‚Šå…ˆä½¿ç”¨ &lt;code>kubectl get hpa php-apache -o yaml &amp;gt; hpa.yaml&lt;/code> ä¾†å°‡å‰›å‰›ç”¨æŒ‡ä»¤ run èµ·ä¾†çš„ HPA è®Šæˆ yaml æª”ï¼Œæˆ‘å€‘ä¾†çœ‹çœ‹è£¡é¢æœ‰å“ªäº›å…§å®¹å§ï¼š&lt;/li>
&lt;/ol>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">apiVersion&lt;/span>: &lt;span style="color:#ae81ff">autoscaling/v2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">kind&lt;/span>: &lt;span style="color:#ae81ff">HorizontalPodAutoscaler&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">metadata&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">creationTimestamp&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;2022-07-12T03:16:11Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">php-apache&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">namespace&lt;/span>: &lt;span style="color:#ae81ff">default&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">resourceVersion&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;19454&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">uid&lt;/span>: &lt;span style="color:#ae81ff">dde68e68-9b6e-46a8-b50f-5525b8ec3bdf&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">spec&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">maxReplicas&lt;/span>: &lt;span style="color:#ae81ff">10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">metrics&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">resource&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">cpu&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">target&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">averageUtilization&lt;/span>: &lt;span style="color:#ae81ff">50&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">type&lt;/span>: &lt;span style="color:#ae81ff">Utilization&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">type&lt;/span>: &lt;span style="color:#ae81ff">Resource&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">minReplicas&lt;/span>: &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">scaleTargetRef&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">apiVersion&lt;/span>: &lt;span style="color:#ae81ff">apps/v1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">kind&lt;/span>: &lt;span style="color:#ae81ff">Deployment&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">php-apache&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">å¾Œé¢ç‹€æ…‹çœç•¥....&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;ul>
&lt;li>apiVersionï¼šè¦è¨˜å¾—ä½¿ç”¨ &lt;code>autoscaling/v2&lt;/code>&lt;/li>
&lt;li>kindï¼šHorizontalPodAutoscaler&lt;/li>
&lt;li>maxReplicasï¼šæ˜¯æˆ‘å€‘å‰›å‰›ç”¨æŒ‡ä»¤çš„æœ€å¤§ Pod å‰¯æœ¬æ•¸&lt;/li>
&lt;li>metricsï¼šæˆ‘å€‘æŒ‡æ¨™è¨­å®š cpu resourceï¼Œå…¶è¨­å®šå¹³å‡ä½¿ç”¨ç‡ç‚º 50 % (ç™¾åˆ†æ¯”)&lt;/li>
&lt;li>minReplicasï¼šå‰›å‰›ç”¨æŒ‡ä»¤çš„æœ€å° Pod å‰¯æœ¬æ•¸&lt;/li>
&lt;li>scaleTargetRefï¼šè¨­å®šæˆ‘å€‘é€™å€‹ HPA æ˜¯ä¾ç…§ php-apache é€™å€‹ Deploymentã€‚&lt;/li>
&lt;/ul>
&lt;br>
&lt;h2>æ¸¬è©¦ HPA&lt;span class="hx-absolute -hx-mt-20" id="æ¸¬è©¦-hpa">&lt;/span>
&lt;a href="#%e6%b8%ac%e8%a9%a6-hpa" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;ol>
&lt;li>æ¥ä¸‹ä¾†æˆ‘å€‘éƒ½è¨­å®šå¥½å¾Œï¼Œæˆ‘å€‘è¦ä¾†æ¨¡æ“¬å¢åŠ è² è¼‰ï¼Œçœ‹çœ‹ HPA çš„å¾ŒçºŒå‹•ä½œï¼Œé¦–å…ˆæˆ‘å€‘å…ˆä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤ä¾†æŒçºŒè§€å¯Ÿ HPAï¼š&lt;/li>
&lt;/ol>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>kubectl get hpa php-apache --watch
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>NAME REFERENCE TARGETS MINPODS MAXPODS REPLICAS AGE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>php-apache Deployment/php-apache 0%/50% &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#ae81ff">10&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> 4h40m&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;ol start="2">
&lt;li>ä»¥åŠåŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼Œè©²æŒ‡ä»¤æ˜¯å»ºä¸€å€‹æ–°çš„ Podï¼Œç”±æ–°çš„ Pod ç„¡é™å¾ªç’°çš„å»å‘ php-apahe æœå‹™ç™¼å‡ºè«‹æ±‚&lt;/li>
&lt;/ol>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>kubectl run -i --tty load-generator --rm --image&lt;span style="color:#f92672">=&lt;/span>busybox:1.28 --restart&lt;span style="color:#f92672">=&lt;/span>Never -- /bin/sh -c &lt;span style="color:#e6db74">&amp;#34;while sleep 0.01; do wget -q -O- http://php-apache; done&amp;#34;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-hpa/10.png"
alt="æ¨¡æ“¬å¢åŠ è² è¼‰" width="800">&lt;figcaption>
&lt;p>æ¨¡æ“¬å¢åŠ è² è¼‰&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;ol start="3">
&lt;li>æˆ‘å€‘ä½¿ç”¨ k8slens è§€å¯Ÿï¼Œæœƒç™¼ç¾ç•¶è² è¼‰ä½¿ç”¨é‡è¶…éæˆ‘å€‘å‰é¢æ‰€è¨­å®šçš„ 50%ï¼Œä¹Ÿå°±æ˜¯ 100 milli-cores æ™‚ï¼Œä»–å°±æœƒè‡ªå‹•é•·æ–°çš„ Pod å‡ºä¾†ï¼š&lt;/li>
&lt;/ol>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-hpa/11.png"
alt="HPA è‡ªå‹•é•· Pod" width="1100">&lt;figcaption>
&lt;p>HPA è‡ªå‹•é•· Pod&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;ol start="4">
&lt;li>æˆ‘å€‘åˆ‡å›å»çœ‹è§€å¯Ÿ HPA æŒ‡ä»¤ &lt;code>kubectl get hpa php-apache --watch&lt;/code>ï¼š&lt;/li>
&lt;/ol>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-hpa/12.png"
alt="è§€å¯Ÿ HPA" width="800">&lt;figcaption>
&lt;p>è§€å¯Ÿ HPA&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;div class="hx-overflow-x-auto hx-mt-6 hx-flex hx-rounded-lg hx-border hx-py-2 ltr:hx-pr-4 rtl:hx-pl-4 contrast-more:hx-border-current contrast-more:dark:hx-border-current hx-border-orange-100 hx-bg-orange-50 hx-text-orange-800 dark:hx-border-orange-400/30 dark:hx-bg-orange-400/20 dark:hx-text-orange-300">
&lt;div class="ltr:hx-pl-3 ltr:hx-pr-2 rtl:hx-pr-3 rtl:hx-pl-2">&lt;/div>
&lt;div class="hx-w-full hx-min-w-0 hx-leading-7">
&lt;div class="hx-mt-6 hx-leading-7 first:hx-mt-0">&lt;p>æˆ‘å€‘å‰›å‰›æœ‰èªªè¶…é 50%ï¼Œä¹Ÿå°±æ˜¯ 100 milli-cores æ™‚ï¼Œæœƒé•·æ–°çš„ Podã€‚æˆ‘å€‘ä»¥ä¸Šé¢åœ–ç‰‡çš„ä¾†èªªæ˜ï¼Œä¾†è¨ˆç®—æœŸæœ›éœ€è¦å¹¾å€‹å‰¯æœ¬?&lt;/p>
&lt;p>å®˜æ–¹æœ‰æä¾›ä¸€å€‹å…¬å¼ï¼š &lt;code>æœŸæœ›å‰¯æœ¬æ•° = ceil[ç›®å‰å‰¯æœ¬æ•° * (ç›®å‰æŒ‡æ¨™ / æœŸæœ›æŒ‡æ¨™)]&lt;/code> ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘å€‘è² è¼‰å¾ 0% å¾åˆ° 250%ï¼Œä¹Ÿå°±æ˜¯æˆ‘å€‘å¯¦éš›ä¸Šæ˜¯å¾ 0 è®Šæˆ 500 milli-cores (250 / 50 _ 100 )ã€‚æˆ‘å€‘å°‡å€¼å¸¶å…¥å…¬å¼å…§ï¼Œ&lt;code>ç›®å‰çš„å‰¯æœ¬ï¼š1 _ (ç›®å‰æŒ‡æ¨™ï¼š500 / æœŸæœ›æŒ‡æ¨™æ˜¯ï¼š100)&lt;/code>å¾—å‡ºä¾†çš„å€¼æ˜¯ 5ï¼Œå¦‚æœæœ‰å°æ•¸ï¼Œå› ç‚ºå‰é¢æœ‰&lt;code>ceil&lt;/code>ï¼Œæ‰€ä»¥æœƒå–æ•´æ•¸(ä¸å¯èƒ½é–‹åŠå€‹ Pod å°å§ ğŸ™„)ï¼Œæœ€å¾Œä»¥é€™å€‹ä¾‹å­ä¾†èªªï¼Œæœ€çµ‚å¾—åˆ°çš„ &lt;code>æœŸæœ›å‰¯æœ¬æ•° = 5&lt;/code>&lt;/p>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;br>
&lt;ol start="5">
&lt;li>æ ¹æ“šæˆ‘å€‘è¨ˆç®—å‡ºä¾†çš„å‰¯æœ¬æ•¸ï¼Œä»–å°±æœƒä¾ç…§è¨ˆç®—çµæœï¼Œå¹«æˆ‘å€‘è‡ªå‹•ç”Ÿæˆè©²æ•¸é‡çš„ Podï¼Œä¾†æ¸›ç·©åŒä¸€å€‹ Pod çš„è² è¼‰é‡ï¼Œæ¥è‘—æˆ‘å€‘å…ˆä¸­æ–·æ¸¬è©¦æŒ‡ä»¤ï¼Œå†ç¹¼çºŒè§€å¯Ÿ HPA ï¼š&lt;/li>
&lt;/ol>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-hpa/13.png"
alt="è§€å¯Ÿ HPA" width="700">&lt;figcaption>
&lt;p>è§€å¯Ÿ HPA&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>å¯ä»¥ç™¼ç¾å› ç‚ºæˆ‘å€‘å°‡æ¸¬è©¦æŒ‡ä»¤ä¸­æ–·å¾Œï¼Œè² è¼‰ä½¿ç”¨é‡æœƒæ…¢æ…¢é™ä½ï¼Œä½†è² è¼‰é™ä½å¾Œï¼Œå‰¯æœ¬æ•¸ä¸æœƒé¦¬ä¸Šè®Šå›å»ï¼Œå› ç‚ºæ€•å¦‚æœåˆæœ‰å¤§é‡çš„ä½¿ç”¨é‡æœƒå°è‡´ Pod ä¾†ä¸åŠé•·å‡ºä¾†ï¼Œæ‰€ä»¥é è¨­æ˜¯ &lt;code>5 åˆ†é˜ (--horizontal-pod-autoscaler-downscale-stabilization)&lt;/code> æ‰æœƒæ¸›è‡³åŸä¾†çš„ Pod æ•¸é‡&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-hpa/14.png"
alt="Pod è‡ªå‹•æ¸›å°‘" width="1100">&lt;figcaption>
&lt;p>Pod è‡ªå‹•æ¸›å°‘&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;h2>å¸¸è¦‹å•é¡ŒåŠè§£æ±ºè¾¦æ³•&lt;span class="hx-absolute -hx-mt-20" id="å¸¸è¦‹å•é¡ŒåŠè§£æ±ºè¾¦æ³•">&lt;/span>
&lt;a href="#%e5%b8%b8%e8%a6%8b%e5%95%8f%e9%a1%8c%e5%8f%8a%e8%a7%a3%e6%b1%ba%e8%be%a6%e6%b3%95" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;div class="hx-overflow-x-auto hx-mt-6 hx-flex hx-rounded-lg hx-border hx-py-2 ltr:hx-pr-4 rtl:hx-pl-4 contrast-more:hx-border-current contrast-more:dark:hx-border-current hx-border-blue-200 hx-bg-blue-100 hx-text-blue-900 dark:hx-border-blue-200/30 dark:hx-bg-blue-900/30 dark:hx-text-blue-200">
&lt;div class="ltr:hx-pl-3 ltr:hx-pr-2 rtl:hx-pr-3 rtl:hx-pl-2">&lt;div class="hx-select-none hx-text-xl" style="font-family: 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">â„¹ï¸&lt;/div>&lt;/div>
&lt;div class="hx-w-full hx-min-w-0 hx-leading-7">
&lt;div class="hx-mt-6 hx-leading-7 first:hx-mt-0">&lt;p>Q1 . å‡ºç¾ x509: cannot validate certificate for 192.168.XXX.XXX because it doesnâ€™t contain any IP SANs éŒ¯èª¤&lt;/p>
&lt;p>Ans 1ï¼šæ˜¯å› çˆ²æ²’æœ‰åŠ å…¥ &lt;code>kubelet-insecure-tls=ture&lt;/code> è®“ Metrics Server ç¦ç”¨ TLS è­‰æ›¸é©—è­‰ï¼Œæ‰å°è‡´éŒ¯èª¤ç™¼ç”Ÿã€‚&lt;/p>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;br>
&lt;h2>åƒè€ƒè³‡æ–™&lt;span class="hx-absolute -hx-mt-20" id="åƒè€ƒè³‡æ–™">&lt;/span>
&lt;a href="#%e5%8f%83%e8%80%83%e8%b3%87%e6%96%99" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>Horizontal Pod Autoscalingï¼š&lt;a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/" target="_blank" rel="noopener">https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/&lt;/a>&lt;/p>
&lt;p>HorizontalPodAutoscaler Walkthroughï¼š&lt;a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/" target="_blank" rel="noopener">https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/&lt;/a>&lt;/p></description></item><item><title>ç”¨å¤§å‹ç¤¾å€ä¾†ä»‹ç´¹ Kubernetes å…ƒä»¶</title><link>https://pin-yi.me/blog/kubernetes/k8s-plain/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pin-yi.me/blog/kubernetes/k8s-plain/</guid><description>
&lt;p>å‰é™£å­å°æ–¼ Kubernetes éƒ¨åˆ†å…§å®¹é‚„ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œåœ¨ç¶²è·¯ä¸Šé–’é€›çš„æ™‚å€™ç™¼ç¾ä¸€ç¯‡å¾ˆæœ‰è¶£çš„æ–‡ç« ï¼Œæ¨™é¡Œæ˜¯ ã€ &lt;a href="https://blog.pichuang.com.tw/20210111-Kubernetes-for-sales-and-marketing/#%E4%B8%AD%E7%BF%BB%E4%B8%AD%E7%9A%84-Kubernetes-%E7%B5%84%E4%BB%B6%E4%BB%8B%E7%B4%B9" target="_blank" rel="noopener">çµ¦è¡ŒéŠ·è·Ÿæ¥­å‹™çš„ Kubernetes 101 ä¸­ç¿»ä¸­ä»‹ç´¹&lt;/a> ã€ï¼Œé»é€²å»å¾Œæ‰ç™¼ç¾ï¼Œä½œè€… &lt;a href="https://blog.pichuang.com.tw/about/" target="_blank" rel="noopener">Phil Huang&lt;/a> å°‡ Kubernetes å…ƒä»¶çš„å…§å®¹ç”¨å¤§å‹ä½æˆ¶ç¤¾å€ä¾†ä»‹ç´¹ï¼Œè®“æˆ‘æ›´æ¸…æ¥šæ¯ä¸€å€‹å…ƒä»¶çš„æ„æ€ï¼Œä»¥ä¸‹æˆ‘æœƒç”¨æˆ‘ç†è§£çš„ä»¥åŠä½œè€…çš„æ€è€ƒé‚è¼¯ä¾†å»å¯«é€™ç¯‡ç­†è¨˜ï¼Œå†æ¬¡æ„Ÿè¬ä½œè€…æ–‡ç«  ğŸ˜&lt;/p>
&lt;br>
&lt;h2>Kubernetes å…ƒä»¶ç™½è©±æ–‡&lt;span class="hx-absolute -hx-mt-20" id="kubernetes-å…ƒä»¶ç™½è©±æ–‡">&lt;/span>
&lt;a href="#kubernetes-%e5%85%83%e4%bb%b6%e7%99%bd%e8%a9%b1%e6%96%87" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-plain/1.jpg"
alt="å¤§å‹ç¤¾å€ç¤ºæ„åœ– (åœ–ç‰‡ä¾†æºï¼šè˜‹æœåœ°ç”¢)" width="550">&lt;figcaption>
&lt;p>å¤§å‹ç¤¾å€ç¤ºæ„åœ– (åœ–ç‰‡ä¾†æºï¼š&lt;a href="https://tw.feature.appledaily.com/house/news/article/205878" target="_blank" rel="noopener">è˜‹æœåœ°ç”¢&lt;/a>)&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;p>å¯ä»¥çœ‹åˆ°ä¸Šé¢é€™å¼µåœ–ç‰‡ï¼Œä»–æ˜¯ä¸€å€‹å¾ˆå…¸å‹çš„å¤§å‹ç¤¾å€ï¼Œæˆ‘å€‘é€™æ¬¡çš„ Kubernetes å…ƒä»¶ç™½è©±æ–‡ï¼Œæœƒä»¥å¤§å‹ç¤¾å€ä¾†ç•¶ä½œç¾å¯¦ä¸­çš„å…ƒä»¶ï¼Œä»¥ç¤¾å€çš„ä¾‹å­ä¾†èªªæ˜ Kubernetes ã€‚&lt;/p>
&lt;br>
&lt;p>ç•¶ç„¶ï¼Œæˆ‘å€‘ä¹‹å‰çš„æ–‡ç« ä¹Ÿæœ‰ä»‹ç´¹é Kubernetesï¼Œæœ‰èˆˆè¶£å¯ä»¥å…ˆé£›å›å»çœ‹çœ‹ï¼&lt;/p>
&lt;p>&lt;a href="https://pin-yi.me/blog/kubernetes/k8s/" >Kubernetes (K8s) ä»‹ç´¹ - åŸºæœ¬&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://pin-yi.me/blog/kubernetes/k8s-advanced/" >Kubernetes (K8s) ä»‹ç´¹ - é€²éš (Serviceã€Ingressã€StatefulSetã€Deploymentã€ReplicaSetã€ConfigMap)&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://pin-yi.me/blog/kubernetes/k8s-efk/" >Kubernetes (K8s) æ­é… EFK å¯¦ä½œ (Deploymentã€StatefulSetã€DaemonSet)&lt;/a>&lt;/p>
&lt;p>æˆ‘å€‘å…ˆæƒ³åƒä¸€ä¸‹æˆ‘å€‘å»ºç«‹ Kubernetes å®Œæ•´çš„å¢é›†æœå‹™ï¼Œå°±å¥½æ¯”æ˜¯å»ºç«‹ä¸€å€‹å¤§å‹çš„ç¤¾å€ï¼Œæ‰€ä»¥ä»¥ä¸‹æœƒå°‡åè©èˆ‡ç¤¾å€ä¾†åšé€£çµï¼Œé‚£ï¼ï¼ï¼é–‹å§‹å›‰ï¼&lt;/p>
&lt;br>
&lt;h3>Kubernetes å…ƒä»¶&lt;span class="hx-absolute -hx-mt-20" id="kubernetes-å…ƒä»¶">&lt;/span>
&lt;a href="#kubernetes-%e5%85%83%e4%bb%b6" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;ul>
&lt;li>Kubernetesï¼šå»ºç«‹é€™å€‹å¤§å‹ç¤¾å€çš„è—åœ–ï¼Œè¦åŠƒçš„ç¤¾å€å…§çš„å¤§å¤§å°å°çš„è¨­è¨ˆã€‚&lt;/li>
&lt;li>è™›æ“¬åŒ–å¹³å°ã€å…¬æœ‰é›²å¹³å°ã€å¯¦é«”æ©Ÿå™¨ï¼šå°±æ˜¯æˆ‘å€‘è¦è“‹ç¤¾å€çš„åœ°çš®ã€‚(è™›æ“¬åŒ–å¹³å°ï¼švSphere/Proxmox/VMwareã€å…¬æœ‰é›²å¹³å°ï¼šAWS/GCP/Azuerã€å¯¦é«”æ©Ÿå™¨ï¼šå°±æ˜¯å¯¦é«”æ©Ÿå™¨ ğŸ˜‚)&lt;/li>
&lt;li>OS ä½œæ¥­ç³»çµ±ï¼šæ¯æ£Ÿå¤§æ¨“çš„éª¨æ¶å’Œåœ°åŸºã€‚&lt;/li>
&lt;li>Master Nodeï¼šä½æˆ¶ç®¡å§”æœƒæ‰€å±…ä½å¤§æ¨“ (çœŸå¥½è‡ªå·±æœ‰æ‰€å±¬çš„å¤§æ¨“ï¼¸ï¼¤)ï¼Œç‚ºäº†ä¿è­‰ä»–å€‘ä¸æœƒåµæ¶ï¼Œæ‰€ä»¥å»ºè­°æœ€å°‘éœ€è¦ä¸‰æ£Ÿã€‚&lt;/li>
&lt;li>Etcd Clusterï¼šç®¡å§”æœƒçš„äººï¼Œä¸€æ¨£ç‚ºäº†æ€•ä¸€é»¨ç¨å¤§(?ï¼Œæ‰€ä»¥å»ºè­°æœ€å°‘éœ€è¦æœ‰ä¸‰ä½ç®¡å§”ï¼Œä¸”äº’ç›¸æŠ•ç¥¨é¸å‡ºä¸€å€‹é ­é ­ã€‚&lt;/li>
&lt;li>Worker Nodeï¼šå°±æ˜¯å¶å€‘ä½æˆ¶æ‰€å±…ä½çš„å¤§æ¨“ã€‚&lt;/li>
&lt;li>Podï¼šä½æˆ¶ï¼Œæ‰€ä»¥æˆ‘å€‘ä¸€æ£Ÿ Worker Node å¤§æ¨“ï¼Œå¯ä»¥æœ‰å¾ˆå¤š Pod ä½æˆ¶ã€‚&lt;/li>
&lt;li>Pod IPï¼šæ¯å€‹ä½æˆ¶çš„é–€ç‰Œï¼Œæ—¢ç„¶æ˜¯é–€ç‰Œï¼Œä»£è¡¨ä»–ä¹Ÿä¸æœƒé‡è¤‡ã€‚&lt;/li>
&lt;li>Container Registryï¼šåŒ…è£¹é›†ä¸­çš„å­˜æ”¾ä¸­å¿ƒã€‚&lt;/li>
&lt;li>Container Imagesï¼šé‚„æ²’æœ‰è¢«æ‰“é–‹çš„åŒ…è£¹ã€‚&lt;/li>
&lt;li>Containersï¼šå·²ç¶“è¢«æ‰“é–‹ä¸”æ­£åœ¨ä½¿ç”¨çš„åŒ…è£¹ï¼Œé‚£æ¯å€‹ Pod ä½æˆ¶è£¡é¢ï¼Œå¯ä»¥æœ‰ä¸€å€‹æˆ–å¾ˆå¤šå€‹ä»¥ä¸Šçš„ Containers åŒ…è£¹ã€‚&lt;/li>
&lt;li>Serviceï¼šç¤¾å€è£¡é¢çš„ç¤¾åœ˜ï¼Œä¾‹å¦‚ï¼šç¾½çƒç¤¾ã€éº»å°‡ç¤¾ç­‰ç­‰ï¼Œå¯ä»¥é›†åˆå¤§å®¶çš„åœ°æ–¹ã€‚&lt;/li>
&lt;li>Service Meshï¼šç¤¾åœ˜çš„è¯çµ¡åå†Šï¼Œæœƒè¨˜ä½èª°æ˜¯å“ªä¸€å€‹ç¤¾åœ˜çš„æˆå“¡ã€‚&lt;/li>
&lt;li>Ingress Controllerï¼šç¤¾å€çš„å¤§é–€ï¼Œå¯ä»¥æŒ‡å®šè®“ç¤¾å€æˆå“¡éƒ½å›ºå®šèµ°åŒä¸€å€‹æˆ–æ˜¯å¤šå€‹é–€çš„å…¥å£ç®¡æ§ã€‚&lt;/li>
&lt;li>Egress Controllerï¼šç¤¾å€çš„å¾Œé–€ï¼Œå¯ä»¥æŒ‡å®šè®“ç¤¾å€æˆå“¡éƒ½å›ºå®šèµ°åŒä¸€å€‹æˆ–æ˜¯å¤šå€‹é–€çš„å‡ºå£ç®¡æ§ã€‚&lt;/li>
&lt;li>Internal DNS / Service Discoveryï¼šå¤§æ¨“ä½æˆ¶çš„é›»è©±ç°¿ã€‚&lt;/li>
&lt;li>External DNSï¼šæŒ‡å‘å„å¤§æ¨“çš„è·¯æ¨™ã€‚&lt;/li>
&lt;li>OCI (Open Container Initiative)ï¼šåˆ¶å®šå¤§æ¨“é‹¼ç­‹æ°´æ³¥æˆ–æ˜¯è¡Œæç®±æ¨™æº–çš„çµ„ç¹”ã€‚&lt;/li>
&lt;li>CRI (Container Runtime Interface)ï¼šå¤§æ¨“é‹¼ç­‹æ°´æ³¥çš„å» å•†ã€‚&lt;/li>
&lt;li>CNI (Container Network Interface)ï¼šå¤§æ¨“æ°´é›»ç³»çµ±çš„å» å•†ã€‚&lt;/li>
&lt;li>CSI (Container Storage Interface)ï¼šå¤§æ¨“ç©ºé–“è¦åŠƒçš„å» å•†ã€‚&lt;/li>
&lt;li>Bastionï¼šå°ˆé–€ç¶­è­·ç¤¾å€çš„å·¥ç¨‹è»Šã€‚&lt;/li>
&lt;/ul>
&lt;br>
&lt;h3>å¸¸ç”¨å¥—ä»¶&lt;span class="hx-absolute -hx-mt-20" id="å¸¸ç”¨å¥—ä»¶">&lt;/span>
&lt;a href="#%e5%b8%b8%e7%94%a8%e5%a5%97%e4%bb%b6" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;ul>
&lt;li>Promethusï¼šç¤¾å€æ•´é«”çš„ç›£æ§ä¸­å¿ƒ (Meterics)ï¼Œä¸€å †æ”å½±æ©Ÿçš„ç®¡ç†å®¤ XD&lt;/li>
&lt;li>Grafanaï¼šç›£æ§ä¸­å¿ƒè£¡é¢å¤§å‹çš„ LED å„€è¡¨æ¿ã€‚&lt;/li>
&lt;li>Elaticsearchï¼šç¤¾å€æ•´é«”çš„æƒ…è³‡ä¸­å¿ƒ (Logging)ï¼Œé€™æ‡‰è©²æ˜¯ä¸€ç¾¤æ„›å…«å¦çš„å¤§åª½å§ ğŸ˜&lt;/li>
&lt;li>Kibanaï¼šæƒ…è³‡ä¸­å¿ƒè£¡é¢å¤§å‹çš„ LED è¨Šæ¯ç‰ˆã€‚&lt;/li>
&lt;/ul>
&lt;br>
&lt;h2>å¸¸è¦‹å•é¡Œ&lt;span class="hx-absolute -hx-mt-20" id="å¸¸è¦‹å•é¡Œ">&lt;/span>
&lt;a href="#%e5%b8%b8%e8%a6%8b%e5%95%8f%e9%a1%8c" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>ä½œè€…ä¹Ÿæœ‰æ•´ç†äº†ä¸€äº›å¸¸è¦‹çš„å•é¡Œï¼Œæˆ‘æŠŠå®ƒæ•´ç†ä¸€ä¸‹æŒ‘é¸å‡ºå¹¾å€‹æˆ‘è‡ªå·±ä¸€é–‹å§‹ä¹Ÿæœƒæœ‰ç–‘å•çš„å•é¡Œï¼Œæˆ‘å€‘ä¸€èµ·ä¾†çœ‹çœ‹å§ï¼ä¸€æ¨£æˆ‘æœƒç”¨æˆ‘æ‰€ç†è§£çš„æ„æ€ä¾†ä»‹ç´¹ ~&lt;/p>
&lt;h3>Q1ï¼šç‚ºä»€éº¼ Kubernetes çš„æœ€å°å–®ä½æ˜¯ Pod é€™å€‹è¦æ€éº¼ç†è§£ï¼Ÿ&lt;span class="hx-absolute -hx-mt-20" id="q1ç‚ºä»€éº¼-kubernetes-çš„æœ€å°å–®ä½æ˜¯-pod-é€™å€‹è¦æ€éº¼ç†è§£">&lt;/span>
&lt;a href="#q1%e7%82%ba%e4%bb%80%e9%ba%bc-kubernetes-%e7%9a%84%e6%9c%80%e5%b0%8f%e5%96%ae%e4%bd%8d%e6%98%af-pod-%e9%80%99%e5%80%8b%e8%a6%81%e6%80%8e%e9%ba%bc%e7%90%86%e8%a7%a3" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>Ans ï¼š è©¦æƒ³ä¸€ä¸‹ï¼Œé›£é“ç®¡å§”æœƒæœƒç®¡ä½ çš„åŒ…è£¹è£¡é¢å…§å®¹ç‰©æ”¾ä»€éº¼å— XD&lt;/p>
&lt;br>
&lt;h3>Q2ï¼šDocker åœ¨ Kubernetes çš„è§’è‰²æ˜¯ä»€éº¼ï¼Ÿ&lt;span class="hx-absolute -hx-mt-20" id="q2docker-åœ¨-kubernetes-çš„è§’è‰²æ˜¯ä»€éº¼">&lt;/span>
&lt;a href="#q2docker-%e5%9c%a8-kubernetes-%e7%9a%84%e8%a7%92%e8%89%b2%e6%98%af%e4%bb%80%e9%ba%bc" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>Ans ï¼š æ˜¯çœ¾å¤šçš„ CRI (Container Runtime Interface) é¸æ“‡ä¹‹ä¸€ï¼Œä¹Ÿå°±æ˜¯å¤§æ¨“çš„é‹¼ç­‹æ°´æ³¥å» å•†æœ‰å¾ˆå¤šé–“ï¼Œæœ‰ä¸€é–“å«åš Docker çš„å» å•†ç‰¹åˆ¥æœ‰åã€‚&lt;/p>
&lt;br>
&lt;h3>Q3ï¼šå‘ˆä¸Šï¼Œé‚£ CRI/CNI/CSI æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥æ›¿æ›æˆå…¶ä»–çš„å» å•†ï¼Ÿ&lt;span class="hx-absolute -hx-mt-20" id="q3å‘ˆä¸Šé‚£-cricnicsi-æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥æ›¿æ›æˆå…¶ä»–çš„å» å•†">&lt;/span>
&lt;a href="#q3%e5%91%88%e4%b8%8a%e9%82%a3-cricnicsi-%e6%98%af%e4%b8%8d%e6%98%af%e4%b9%9f%e5%8f%af%e4%bb%a5%e6%9b%bf%e6%8f%9b%e6%88%90%e5%85%b6%e4%bb%96%e7%9a%84%e5%bb%a0%e5%95%86" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>Ans ï¼š ç•¶ç„¶å¯ä»¥ï¼Œç¾åœ¨å¯ä»¥çœ‹åˆ°è¶Šä¾†è¶Šå¤šå» å•†éƒ½é–‹å§‹æ”¯æ´ Kubernetes å°±æ˜¯å› ç‚ºé€™å€‹åŸå› ï¼Œå› ç‚ºä¸€èˆ¬æƒ…æ³ä¸‹ï¼ŒKubernetes ä¸¦ä¸æœƒç‰¹åˆ¥é™å®š &lt;code>å¤§æ¨“é‹¼ç­‹æ°´æ³¥å» å•†&lt;/code>ã€&lt;code>å¤§æ¨“æ°´é›»ç³»çµ±å» å•†&lt;/code>ã€&lt;code>å¤§æ¨“ç©ºé–“è¦åŠƒå» å•†&lt;/code>ï¼Œåªè¦æœ‰ç¬¦åˆç‰¹å®šçš„æ¨™æº–å³å¯ï¼Œä½†è¦ç•™æ„ Kubernetes çš„ç‰ˆè™Ÿä¹Ÿæœƒå—åˆ°é€™ä¸‰å€‹ä»‹é¢æ”¯æ´ç™¼è¡Œçš„ç‰ˆè™Ÿæ‰€å½±éŸ¿ï¼Œè¦ç•™æ„ç›¸å®¹æ€§çš„å•é¡Œï¼&lt;/p>
&lt;br>
&lt;h3>Q4ï¼šæ•´å€‹ä½æˆ¶ç¤¾å€æœ€é‡è¦çš„è§’è‰²æ˜¯ä»€éº¼ï¼Ÿ&lt;span class="hx-absolute -hx-mt-20" id="q4æ•´å€‹ä½æˆ¶ç¤¾å€æœ€é‡è¦çš„è§’è‰²æ˜¯ä»€éº¼">&lt;/span>
&lt;a href="#q4%e6%95%b4%e5%80%8b%e4%bd%8f%e6%88%b6%e7%a4%be%e5%8d%80%e6%9c%80%e9%87%8d%e8%a6%81%e7%9a%84%e8%a7%92%e8%89%b2%e6%98%af%e4%bb%80%e9%ba%bc" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>Ans ï¼š é‚£ä¸‰æ£Ÿç®¡å§”æœƒå¤§æ¨“ï¼Œå’Œè£¡é¢çš„çš„ä¸‰ä½å§”å“¡ï¼Œä¸‰ä½æ›æ‰ä¸€ä½é‚„å¯ä»¥ç¶­æŒæ­£å¸¸é‹ä½œï¼Œæ›æ‰å…©ä½æœƒç¶­æŒå”¯ç¨é‹ä½œã€‚&lt;/p>
&lt;br>
&lt;h3>Q5ï¼šKubernetesã€VMã€Container çš„å·®ç•°æ€§&lt;span class="hx-absolute -hx-mt-20" id="q5kubernetesvmcontainer-çš„å·®ç•°æ€§">&lt;/span>
&lt;a href="#q5kubernetesvmcontainer-%e7%9a%84%e5%b7%ae%e7%95%b0%e6%80%a7" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>Ans ï¼š æˆ‘å€‘å¯ä»¥å»ºç«‹å¥½ä¸€å€‹å¤§æ¨“(VM)ï¼Œéš¨æ„æ”¾ç½®ä¸€å€‹æˆ–æ˜¯å¤šå€‹åŒ…è£¹(Containers)ï¼Œå¿…é ˆæ‰‹å‹•ç®¡ç†é€™äº›åŒ…è£¹ï¼Œå¦‚æœè³‡æºä¸è¶³æˆ–æ˜¯é€™æ£Ÿå¤§æ¨“å€’äº†ï¼Œå°±æ²’æœ‰è¾¦æ³•è‡ªå‹•è½‰ç§»é€™äº›åŒ…è£¹çš„å…§å®¹äº†ã€‚&lt;/p>
&lt;p>ä½†å¦‚æœæ˜¯ Kubernetesï¼Œæˆ‘å€‘å°±å¯ä»¥å»ºç«‹å¤šå€‹å¤§æ¨“(VM)ï¼Œé€é Kubernetes æ‰€è¦å®šçš„æ”¾ç½®è¨ˆç•« (ä¾‹å¦‚ï¼šDeploymentã€DaemonSet)ï¼Œæˆ‘å€‘å°‡å¯ä»¥çµ±ä¸€èª¿åº¦é€™äº› Podï¼Œç•¶æŸæ£Ÿå¤§æ¨“è³‡æºä¸å¤ æˆ–æ˜¯é€™æ£Ÿå¤§æ¨“å€’æ™‚ï¼Œå¯ä»¥æ ¹æ“š Kubernetes è¦å‰‡ä¾†é€²è¡Œæ¬é·æˆ–æ˜¯æ“´å……å¤§æ¨“ã€‚&lt;/p>
&lt;br>
&lt;h3>Q6ï¼šç‚ºä»€éº¼æœ‰äººæœƒæŠŠ Container è·Ÿ Pod æ··åœ¨ä¸€èµ·è¬›&lt;span class="hx-absolute -hx-mt-20" id="q6ç‚ºä»€éº¼æœ‰äººæœƒæŠŠ-container-è·Ÿ-pod-æ··åœ¨ä¸€èµ·è¬›">&lt;/span>
&lt;a href="#q6%e7%82%ba%e4%bb%80%e9%ba%bc%e6%9c%89%e4%ba%ba%e6%9c%83%e6%8a%8a-container-%e8%b7%9f-pod-%e6%b7%b7%e5%9c%a8%e4%b8%80%e8%b5%b7%e8%ac%9b" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>Ans ï¼š å› ç‚ºå¤§éƒ¨åˆ†çš„æƒ…æ³ä¸‹ï¼Œéƒ½æ˜¯ä¸€å€‹ä½æˆ¶(Pod)æ”¾ä¸€å€‹åŒ…è£¹(Container)ï¼Œï¼Œæ‰æœƒå°è‡´é€™æ¨£çš„èª¤æœƒã€‚ä½†å¯¦éš›ä¸Šï¼Œä¸€å€‹ä½æˆ¶(Pod)æ˜¯å¯ä»¥æ”¾ä¸€å€‹æˆ–å¤šå€‹åŒ…è£¹åœ¨è£¡é¢çš„ï¼&lt;/p>
&lt;br>
&lt;h3>Q7ï¼šä»€éº¼æ˜¯ Node Scaling ?&lt;span class="hx-absolute -hx-mt-20" id="q7ä»€éº¼æ˜¯-node-scaling-">&lt;/span>
&lt;a href="#q7%e4%bb%80%e9%ba%bc%e6%98%af-node-scaling-" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>Ans ï¼š å¯ä»¥æŠŠå®ƒç†è§£æˆï¼Œç•¶ä½æˆ¶å¤ªå¤šæ™‚ï¼ŒKubernetes æœƒè‡ªå‹•æˆ–æ‰‹å‹•èˆˆå»ºå¤§æ¨“ï¼Œä¾†æŠŠå¤šå‡ºä¾†çš„ç”¨æˆ¶çµ¦å¡é€²å»ã€‚&lt;/p>
&lt;br>
&lt;h3>Q8ï¼šåœ¨ Q5 æœ‰æåˆ°æ”¾ç½®è¨ˆç•«æ˜¯ä»€éº¼æ„æ€ï¼Ÿ&lt;span class="hx-absolute -hx-mt-20" id="q8åœ¨-q5-æœ‰æåˆ°æ”¾ç½®è¨ˆç•«æ˜¯ä»€éº¼æ„æ€">&lt;/span>
&lt;a href="#q8%e5%9c%a8-q5-%e6%9c%89%e6%8f%90%e5%88%b0%e6%94%be%e7%bd%ae%e8%a8%88%e7%95%ab%e6%98%af%e4%bb%80%e9%ba%bc%e6%84%8f%e6%80%9d" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>Ans ï¼š åªè¦ä½ æœ‰éœ€è¦å°‡åŒ…è£¹æ”¾åœ¨ç¤¾å€å…§ï¼Œéƒ½å¿…é ˆæå‡ºéƒ¨ç½²è¨ˆç•«(Deployment) çµ¦ç®¡å§”æœƒå¯©æ ¸ï¼Œåªè¦é€šéå¯©æ ¸ï¼Œä»–å€‘ä¾ç…§ä½ äº‹å…ˆè²æ˜çš„è¨ˆç•«ï¼Œç›¡æœ€å¤§å¯èƒ½æ€§ä¾†æ”¾ç½®åŒ…è£¹ã€‚&lt;/p>
&lt;p>æ‰€ä»¥ç•¶æˆ‘å€‘æœ‰ä»»ä½•è®Šæ›´è¨ˆç•«æ™‚ï¼Œéƒ½éœ€è¦é‡æ–°æäº¤ä¸€ä»½æ–°çš„éƒ¨ç½²è¨ˆç•«çµ¦ç®¡å§”æœƒé‡æ–°å¯©æ ¸å’Œæ¥å—ã€‚&lt;/p>
&lt;br>
&lt;h2>åƒè€ƒè³‡æ–™&lt;span class="hx-absolute -hx-mt-20" id="åƒè€ƒè³‡æ–™">&lt;/span>
&lt;a href="#%e5%8f%83%e8%80%83%e8%b3%87%e6%96%99" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>&lt;a href="https://blog.pichuang.com.tw/20210111-Kubernetes-for-sales-and-marketing/#%E4%B8%AD%E7%BF%BB%E4%B8%AD%E7%9A%84-Kubernetes-%E7%B5%84%E4%BB%B6%E4%BB%8B%E7%B4%B9" target="_blank" rel="noopener">çµ¦è¡ŒéŠ·è·Ÿæ¥­å‹™çš„ Kubernetes 101 ä¸­ç¿»ä¸­ä»‹ç´¹&lt;/a>&lt;/p></description></item><item><title>Kubernetes (K8s) ä»‹ç´¹ - é€²éš (Serviceã€Ingressã€StatefulSetã€Deploymentã€ReplicaSetã€ConfigMap)</title><link>https://pin-yi.me/blog/kubernetes/k8s-advanced/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pin-yi.me/blog/kubernetes/k8s-advanced/</guid><description>
&lt;p>å‰é¢æˆ‘å€‘åœ¨&lt;a href="../k8s" >åŸºæœ¬ç¯‡&lt;/a>ä¸­ï¼Œç‚ºäº†ä½¿ Pod èƒ½å¤ èˆ‡æœ¬æ©Ÿé€£ç·šï¼Œä½¿ç”¨äº† &lt;code>port-forward&lt;/code>ï¼Œé‚„æœ‰å¦ä¸€ç¨®æ–¹æ³•å°±æ˜¯ä»Šå¤©è¦ä»‹ç´¹çš„ç¬¬ä¸€å€‹ä¸»é¡Œï¼šService&lt;/p>
&lt;p>é‚£æˆ‘å€‘æœƒå…ˆè¤‡ç¿’ä¸€ä¸‹ &lt;code>port-forward&lt;/code>ï¼Œå†ä¾†ä»‹ç´¹ &lt;code>Service&lt;/code>ï¼Œç•¶ç„¶å¾Œé¢ä¹Ÿæœƒæœ‰å¯¦éš›æ“ä½œï¼Œè«‹å¤§å®¶è·Ÿæˆ‘ç¹¼çºŒä¸€èµ·å­¸ä¸‹å»å§ ï¼&lt;/p>
&lt;br>
&lt;h2>port-forward&lt;span class="hx-absolute -hx-mt-20" id="port-forward">&lt;/span>
&lt;a href="#port-forward" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>&lt;code>port-forward&lt;/code> ç°¡å–®ä¾†èªªå°±æ˜¯æŠŠæœ¬æ©Ÿçš„æŸä¸€å€‹ Port èˆ‡ Pod æ‰€é–‹æ”¾å°å¤–çš„ Port åšæ˜ å°„ï¼Œå°±åƒæ˜¯æˆ‘å€‘åœ¨ Docker è·‘ container æ™‚æœƒä½¿ç”¨ -p ä¾†é€£çµæ©Ÿå™¨èˆ‡ container çš„ port ä¸€æ¨£ï½&lt;/p>
&lt;p>ä½¿ç”¨çš„æ–¹æ³•ä¹Ÿå¾ˆç°¡å–®ä¸”æ–¹ä¾¿ï¼Œä½¿ç”¨ &lt;code>kubectl port-forward &amp;lt;pod&amp;gt; &amp;lt;external-port&amp;gt;:&amp;lt;pod-port&amp;gt;&lt;/code>ï¼Œæˆ‘å€‘æ‹¿ &lt;a href="../k8s" >Kubernetes åŸºæœ¬ç¯‡&lt;/a>æœ€å¾Œçš„ç¯„ä¾‹ï¼Œä¾†åšèªªæ˜ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>$ kubectl port-forward kubernetes-demo-pod 3000:3000
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Forwarding from 127.0.0.1:3000 -&amp;gt; &lt;span style="color:#ae81ff">3000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Forwarding from &lt;span style="color:#f92672">[&lt;/span>::1&lt;span style="color:#f92672">]&lt;/span>:3000 -&amp;gt; &lt;span style="color:#ae81ff">3000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Handling connection &lt;span style="color:#66d9ef">for&lt;/span> &lt;span style="color:#ae81ff">3000&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>æˆ‘å€‘æŠŠ kubernetes-demo-pod é€™å€‹ podï¼Œç”¨ port-forward è¨­å®šæœ¬æ©Ÿ 3000 port èˆ‡ pod 3000 port åšæ˜ å°„ï¼Œç•¶æˆ‘å€‘ç€è¦½ &lt;code>http://localhost:3000&lt;/code> å°±å¯ä»¥çœ‹åˆ° pod è£¡é¢çš„å…§å®¹äº†ï¼&lt;/p>
&lt;p>é›–ç„¶å¾ˆæ–¹ä¾¿ï¼Œå¯ä»¥é¦¬ä¸Šå°±é–‹å¥½è¦æ˜ å°„çš„ portï¼Œä½†ç¼ºé»å°±æ˜¯æ¯æ¬¡å»ºç«‹ pod æ™‚éƒ½éœ€è¦æ‰‹å‹•å»æ‰“æŒ‡ä»¤ä¾†è¨­å®š portï¼Œä¸”æ™‚é–“ä¹…äº†ï¼Œä¹Ÿæœƒå¿˜è¨˜æœ¬æ©Ÿä¸Šå“ªäº› port æœ‰è¢«ä½¿ç”¨åˆ°ï¼Œå› æ­¤é€™é‚Šæ¨è–¦ä½¿ç”¨ &lt;code>Service&lt;/code> ä¾†å–ä»£ &lt;code>port-forward&lt;/code>ï¼Œé‚£æˆ‘å€‘ä¾†çœ‹çœ‹ &lt;code>Service&lt;/code> æ˜¯ä»€éº¼å§ã€‚&lt;/p>
&lt;br>
&lt;h2>ä»€éº¼æ˜¯ Service ?&lt;span class="hx-absolute -hx-mt-20" id="ä»€éº¼æ˜¯-service-">&lt;/span>
&lt;a href="#%e4%bb%80%e9%ba%bc%e6%98%af-service-" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>&lt;code>service&lt;/code> ä»–å…¶å¯¦å°±æ˜¯å»ºç«‹çš„ä¸€å€‹ç¶²è·¯é€£ç·šé€šé“ï¼Œå¯ä»¥è®“æ‡‰ç”¨ç¨‹å¼æ­£ç¢ºçš„é€£çµåˆ°æ­£åœ¨é‹è¡Œçš„ podsï¼Œè€Œ &lt;code>service&lt;/code> åˆæœ‰ 4 ç¨®çš„è¡¨ç¾å½¢å¼ï¼Œæˆ‘å€‘æ¥ä¸‹ä¾†æœƒä¸€å€‹ä¸€å€‹ç°¡å–®ä»‹ç´¹ï¼š&lt;/p>
&lt;h3>ClusterIP&lt;span class="hx-absolute -hx-mt-20" id="clusterip">&lt;/span>
&lt;a href="#clusterip" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>å®ƒæ˜¯ service çš„é è¨­å€¼ï¼Œæ‰€ä»¥æ²’æœ‰è¨­å®šæ™‚ï¼Œé è¨­å°±æ˜¯ä½¿ç”¨è©²æ–¹å¼åšé€£ç·šï¼Œå®ƒä»£è¡¨é€™å€‹ service åªèƒ½åœ¨ç›¸åŒçš„ cluster å…§ä½¿ç”¨ï¼Œç„¡æ³•è®“å¤–éƒ¨åšä½¿ç”¨ã€‚&lt;/p>
&lt;br>
&lt;h3>NodePort&lt;span class="hx-absolute -hx-mt-20" id="nodeport">&lt;/span>
&lt;a href="#nodeport" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>ç°¡å–®ä¾†èªªå®ƒå¯ä»¥å¾å¤–éƒ¨é€£ç·šåˆ°å…§éƒ¨ä½¿ç”¨ã€‚å‡è¨­æœ¬æ©Ÿæœ‰å…¶ä»–æœå‹™ï¼Œä¾‹å¦‚ï¼šnginx ä¹‹é¡çš„æœå‹™ï¼Œé‚„æœ‰æ¶ä¸€å€‹ K8s çš„ cluster ï¼Œé€™æ™‚å€™åªè¦è¨­å®šå¥½ NodePortï¼Œå°±å¯ä»¥è®“æœ¬æ©Ÿä½¿ç”¨ K8s cluster ä¾†ä½¿ç”¨å…§éƒ¨çš„æœå‹™ã€‚&lt;/p>
&lt;br>
&lt;h3>ExternalName&lt;span class="hx-absolute -hx-mt-20" id="externalname">&lt;/span>
&lt;a href="#externalname" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>ä¸»è¦æ˜¯ç‚ºäº†è®“ä¸åŒ namespace ï¼Œä»¥ ClusterIP æ‰€ç”Ÿæˆçš„ service å¯ä»¥åˆ©ç”¨ ExternalName è¨­å®šå¤–éƒ¨åç¨±ï¼Œè—‰ä»¥é€£åˆ°æŒ‡å®šçš„ namespace Serviceã€‚&lt;/p>
&lt;br>
&lt;h3>LoadBalancer&lt;span class="hx-absolute -hx-mt-20" id="loadbalancer">&lt;/span>
&lt;a href="#loadbalancer" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>é€™å€‹å±¬æ€§æ˜¯å¼·åŒ–ç‰ˆçš„ NodePortï¼Œé™¤äº† NodePort å¯ä»¥è®“å¤–éƒ¨é€£ç·šçš„å„ªé»ä»¥å¤–ï¼ŒåŒæ™‚ä¹Ÿå»ºç«‹è² è¼‰å¹³è¡¡çš„æ©Ÿåˆ¶ä¾†åˆ†æ•£æµé‡ï¼Œå¾ˆå¯æƒœ LoadBalaner åªæä¾›é›²ç«¯æœå‹™ï¼Œä¾‹å¦‚ï¼šGCPã€AWS ç­‰ç­‰éƒ½æœ‰æ”¯æ´ï¼Œç›®å‰ minikube è¦ä½¿ç”¨ LoadBalancer éœ€è¦å…ˆå•Ÿå‹• &lt;code>tunnel&lt;/code> æ‰èƒ½åšä½¿ç”¨ã€‚&lt;code>tunnel&lt;/code> æ˜¯ä»€éº¼å‘¢ï¼Ÿæˆ‘å€‘å¾Œé¢æœƒèªªæ˜ï¼&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/service.png"
alt="k8s service æµç¨‹åœ– Kubernetes é‚£äº›äº‹ â€” Service ç¯‡" width="300">&lt;figcaption>
&lt;p>k8s service æµç¨‹åœ– &lt;a href="https://medium.com/andy-blog/kubernetes-%E9%82%A3%E4%BA%9B%E4%BA%8B-service-%E7%AF%87-d19d4c6e945f" target="_blank" rel="noopener">Kubernetes é‚£äº›äº‹ â€” Service ç¯‡&lt;/a>&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;h3>NodePort å¯¦ä½œ&lt;span class="hx-absolute -hx-mt-20" id="nodeport-å¯¦ä½œ">&lt;/span>
&lt;a href="#nodeport-%e5%af%a6%e4%bd%9c" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>é‚£æˆ‘å€‘ä¾†ç”¨ Service (NodePort) æ”¹å¯«&lt;a href="../k8s" >åŸºæœ¬ç¯‡&lt;/a>çš„é€£ç·šå•é¡Œ ï¼š(&lt;a href="https://github.com/880831ian/kubernetes-tutorial/tree/master/Service-NodePort" target="_blank" rel="noopener">Github ç¨‹å¼ç¢¼é€£çµ&lt;/a>)&lt;/p>
&lt;ul>
&lt;li>service.yaml&lt;/li>
&lt;/ul>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">apiVersion&lt;/span>: &lt;span style="color:#ae81ff">v1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">kind&lt;/span>: &lt;span style="color:#ae81ff">Service&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">metadata&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">kubernetes-demo-service&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">labels&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">app&lt;/span>: &lt;span style="color:#ae81ff">demo&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">spec&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">type&lt;/span>: &lt;span style="color:#ae81ff">NodePort&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ports&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">protocol&lt;/span>: &lt;span style="color:#ae81ff">TCP&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">port&lt;/span>: &lt;span style="color:#ae81ff">3000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">targetPort&lt;/span>: &lt;span style="color:#ae81ff">3000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">nodePort&lt;/span>: &lt;span style="color:#ae81ff">30001&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">selector&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">app&lt;/span>: &lt;span style="color:#ae81ff">demo&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>çµæ§‹èˆ‡ kubernetes-demo.yaml ç›¸åŒï¼Œä»¥ä¸‹ç°¡å–®èªªæ˜ä¸åŒä¹‹è™•ï¼š&lt;/p>
&lt;p>kind&lt;/p>
&lt;p>è©²å…ƒä»¶çš„å±¬æ€§ï¼Œæ­¤è¨­å®šæª”çš„é¡å‹æ˜¯ï¼šService&lt;/p>
&lt;p>spec&lt;/p>
&lt;ul>
&lt;li>typeï¼šæŒ‡å®šæ­¤ Service è¦ä½¿ç”¨çš„æ–¹æ³•ï¼Œé€™é‚Šæˆ‘å€‘ä½¿ç”¨ NodePortã€‚&lt;/li>
&lt;li>ports.protocolï¼šæ­¤ç‚ºé€£ç·šçš„ç¶²è·¯å”è­°ï¼Œé è¨­å€¼ç‚º &lt;code>TCP&lt;/code>ï¼Œç•¶ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ &lt;code>UDP&lt;/code>ã€‚&lt;/li>
&lt;li>ports.portï¼šæ­¤ç‚ºå»ºç«‹å¥½çš„ Service è¦ä»¥å“ªå€‹ Port é€£æ¥åˆ° Pod ä¸Šã€‚&lt;/li>
&lt;li>ports.targetPortï¼šæ­¤ç‚ºç›®æ¨™ Pod çš„ Port ï¼Œé€šå¸¸ port è·Ÿ targetPort ä¸€æ¨£ã€‚&lt;/li>
&lt;li>ports.nodePortï¼šæ­¤ç‚ºæ©Ÿå™¨ä¸Šçš„ Port è¦å°æ‡‰åˆ°è©² Service ä¸Šï¼Œé€™å€‹è¨­å®šè¦ nodePort å½¢å¼çš„ Service æ‰æœƒæœ‰æ•ˆæœï¼Œå‡è¨­ä»Šå¤©æ²’æœ‰è¨­å®š nodePort ï¼ŒKubernetes æœƒè‡ªå‹•é–‹ä¸€å€‹æ©Ÿå™¨ä¸Šçš„ Port ä¾†å°æ‡‰è©² Service ï¼Œç¯„åœæ˜¯åœ¨ 30000 - 37267 ä¹‹é–“ã€‚&lt;/li>
&lt;li>selector.appï¼šå¦‚æœè¦ä½¿ Service é€£æ¥åˆ°æ­£ç¢ºçš„ Pod å°±å¿…é ˆåˆ©ç”¨ &lt;code>selector&lt;/code>ï¼Œåªè¦åŸå°ä¸å‹•çš„æŠŠ Pod çš„ &lt;code>Labels&lt;/code> è¤‡è£½ä¸Šå»å³å¯ã€‚&lt;/li>
&lt;/ul>
&lt;br>
&lt;p>æ¥ä¸‹ä¾†ä½¿ç”¨ &lt;code>kubectl apply&lt;/code> å»ºç«‹ serviceï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>$ kubectl apply -f service.yaml&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/service-4.png"
alt="k8s å»ºç«‹ service (NodePort)" width="1300">&lt;figcaption>
&lt;p>k8s å»ºç«‹ service (NodePort)&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>æ¥ä¸‹ä¾†å–å¾— minikube Node IPï¼Œå¯ä»¥ä½¿ç”¨ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>$ minikube ip
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.64.11&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;p>æ‰“é–‹ç€è¦½å™¨æœå°‹ &lt;code>192.168.64.11:30001&lt;/code> å°±å¯ä»¥çœ‹åˆ°æˆ‘å€‘å¯æ„›çš„æŸ´çŠ¬å›‰ &amp;gt;&amp;lt;&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/Shiba-Inu-1.png"
alt="æˆåŠŸé¡¯ç¤ºæŸ´çŠ¬" width="1000">&lt;figcaption>
&lt;p>æˆåŠŸé¡¯ç¤ºæŸ´çŠ¬&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;h3>LoadBalancer å¯¦ä½œ&lt;span class="hx-absolute -hx-mt-20" id="loadbalancer-å¯¦ä½œ">&lt;/span>
&lt;a href="#loadbalancer-%e5%af%a6%e4%bd%9c" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>é‚£æˆ‘å€‘ä¾†ç”¨ Service (LoadBalancer) æ”¹å¯«&lt;a href="../k8s" >åŸºæœ¬ç¯‡&lt;/a>çš„é€£ç·šå•é¡Œ ï¼š(&lt;a href="https://github.com/880831ian/kubernetes-tutorial/tree/master/Service-LoadBalancer" target="_blank" rel="noopener">Github ç¨‹å¼ç¢¼é€£çµ&lt;/a>)&lt;/p>
&lt;ul>
&lt;li>service.yaml&lt;/li>
&lt;/ul>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">apiVersion&lt;/span>: &lt;span style="color:#ae81ff">v1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">kind&lt;/span>: &lt;span style="color:#ae81ff">Service&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">metadata&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">kubernetes-demo-service&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">labels&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">app&lt;/span>: &lt;span style="color:#ae81ff">demo&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">spec&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">type&lt;/span>: &lt;span style="color:#ae81ff">LoadBalancer&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ports&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">protocol&lt;/span>: &lt;span style="color:#ae81ff">TCP&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">port&lt;/span>: &lt;span style="color:#ae81ff">3000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">targetPort&lt;/span>: &lt;span style="color:#ae81ff">3000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">selector&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">app&lt;/span>: &lt;span style="color:#ae81ff">demo&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>çµæ§‹èˆ‡ kubernetes-demo.yaml ç›¸åŒï¼Œä»¥ä¸‹ç°¡å–®èªªæ˜ä¸åŒä¹‹è™•ï¼š&lt;/p>
&lt;p>kind&lt;/p>
&lt;p>è©²å…ƒä»¶çš„å±¬æ€§ï¼Œæ­¤è¨­å®šæª”çš„é¡å‹æ˜¯ï¼šService&lt;/p>
&lt;p>spec&lt;/p>
&lt;ul>
&lt;li>typeï¼šæŒ‡å®šæ­¤ Service è¦ä½¿ç”¨çš„æ–¹æ³•ï¼Œé€™é‚Šæˆ‘å€‘ä½¿ç”¨ LoadBalancerã€‚&lt;/li>
&lt;li>ports.protocolï¼šæ­¤ç‚ºé€£ç·šçš„ç¶²è·¯å”è­°ï¼Œé è¨­å€¼ç‚º &lt;code>TCP&lt;/code>ï¼Œç•¶ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ &lt;code>UDP&lt;/code>ã€‚&lt;/li>
&lt;li>ports.portï¼šæ­¤ç‚ºå»ºç«‹å¥½çš„ Service è¦ä»¥å“ªå€‹ Port é€£æ¥åˆ° Pod ä¸Šã€‚&lt;/li>
&lt;li>ports.targetPortï¼šæ­¤ç‚ºç›®æ¨™ Pod çš„ Port ï¼Œé€šå¸¸ port è·Ÿ targetPort ä¸€æ¨£ã€‚&lt;/li>
&lt;li>selector.appï¼šå¦‚æœè¦ä½¿ Service é€£æ¥åˆ°æ­£ç¢ºçš„ Pod å°±å¿…é ˆåˆ©ç”¨ &lt;code>selector&lt;/code>ï¼Œåªè¦åŸå°ä¸å‹•çš„æŠŠ Pod çš„ &lt;code>Labels&lt;/code> è¤‡è£½ä¸Šå»å³å¯ã€‚&lt;/li>
&lt;/ul>
&lt;br>
&lt;p>æ¥ä¸‹ä¾†ä½¿ç”¨ &lt;code>kubectl apply&lt;/code> å»ºç«‹ serviceï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>$ kubectl apply -f service.yaml&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/service-1.png"
alt="k8s å»ºç«‹ service (LoadBalancer)" width="1300">&lt;figcaption>
&lt;p>k8s å»ºç«‹ service (LoadBalancer)&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;p>å¯ä»¥çœ‹åˆ° dashboard æœ‰æˆ‘å€‘å‰›å‰›å•Ÿå‹•çš„ Serviceï¼Œä½†æ˜¯å•Ÿå‹•å¾Œå‰é¢çš„ç‡ˆæ˜¯é»ƒè‰²çš„ï¼Œæ˜¯å› ç‚º minikube LoadBalancer éœ€è¦é€é &lt;code>tunnel&lt;/code> æ‰å¯ä»¥ä½¿ç”¨ï¼Œå¯ä»¥åƒè€ƒ minikube å®˜ç¶²èªªæ˜ï¼š&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/service-2.png"
alt="minikube å®˜ç¶² èªªæ˜ LoadBalancer minikube tunnel" width="800">&lt;figcaption>
&lt;p>&lt;a href="https://minikube.sigs.k8s.io/docs/handbook/accessing/#using-minikube-tunnel" target="_blank" rel="noopener">minikube å®˜ç¶²&lt;/a> èªªæ˜ LoadBalancer minikube tunnel&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;p>æ‰€ä»¥æˆ‘å€‘éœ€è¦ä½¿ç”¨ &lt;code>minikube tunnel&lt;/code> ä¾†å•Ÿå‹• tunnel&lt;/p>
&lt;br>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>$ minikube tunnel
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>âœ… Tunnel successfully started
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ğŸ“Œ NOTE: Please &lt;span style="color:#66d9ef">do&lt;/span> not close this terminal as this process must stay alive &lt;span style="color:#66d9ef">for&lt;/span> the tunnel to be accessible ...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ğŸƒ Starting tunnel &lt;span style="color:#66d9ef">for&lt;/span> service kubernetes-demo-service.&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;p>å°±å¯ä»¥çœ‹åˆ°ç‡ˆè™Ÿå·²ç¶“è®Šæˆç¶ ç‡ˆï¼Œåœ¨å¤–éƒ¨ Endpoints å¤šä¸€å€‹é€£çµï¼Œå¯ä»¥ç›´æ¥é»é–‹&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/service-3.png"
alt="k8s service" width="1300">&lt;figcaption>
&lt;p>k8s service&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>å°±å¯ä»¥çœ‹åˆ°æˆ‘å€‘å¯æ„›çš„æŸ´çŠ¬å›‰ &amp;gt;&amp;lt;&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/Shiba-Inu.png"
alt="æˆåŠŸé¡¯ç¤ºæŸ´çŠ¬" width="1000">&lt;figcaption>
&lt;p>æˆåŠŸé¡¯ç¤ºæŸ´çŠ¬&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;h2>ä»€éº¼æ˜¯ Ingress ?&lt;span class="hx-absolute -hx-mt-20" id="ä»€éº¼æ˜¯-ingress-">&lt;/span>
&lt;a href="#%e4%bb%80%e9%ba%bc%e6%98%af-ingress-" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>é‚„è¨˜å¾—æˆ‘å€‘åœ¨ Service - NodePort æ™‚ï¼Œéœ€è¦æ‰“ &lt;code>&amp;lt;ip&amp;gt;:&amp;lt;port&amp;gt;&lt;/code> ï¼Œä½†ç¾åœ¨ç¶²ç«™é™¤äº†ç¶²åŸŸä»¥å¤–ï¼ŒåŸºæœ¬ä¸Šä¸æœƒéœ€è¦è‡ªå·±å»æ‰“ IP ä»¥åŠ Port äº†å§ï¼é‚£ç‚ºäº†è§£æ±ºé€™å€‹å•é¡Œï¼Œæœ‰äº† Ingreessã€‚&lt;/p>
&lt;p>Ingress å¯ä»¥å¹«åŠ©æˆ‘å€‘çµ±ä¸€å°å¤–çš„ port numberï¼Œä¸¦æ ¹æ“š hostname æˆ–æ˜¯ pathname ä¾†æ±ºå®šè«‹æ±‚è¦è½‰ç™¼åˆ°å“ªä¸€å€‹ Service ä¸Šï¼Œä¹‹å¾Œå°±å¯ä»¥åˆ©ç”¨è©² Service é€£æ¥åˆ° Pod ä¾†è™•ç†æœå‹™ã€‚&lt;/p>
&lt;p>æˆ‘å€‘å…ˆä¾†çœ‹ä¸€ä¸‹ä¸€èˆ¬çš„ Service ï¼š&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/describe-service.png"
alt="Service åœ–ç‰‡ä¾†æºï¼š[Day 19] åœ¨ Kubernetes ä¸­å¯¦ç¾è² è¼‰å¹³è¡¡ - Ingress Controller" width="800">&lt;figcaption>
&lt;p>Service åœ–ç‰‡ä¾†æºï¼š&lt;a href="https://ithelp.ithome.com.tw/articles/10196261" target="_blank" rel="noopener">[Day 19] åœ¨ Kubernetes ä¸­å¯¦ç¾è² è¼‰å¹³è¡¡ - Ingress Controller&lt;/a>&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;p>å¯ä»¥çœ‹åˆ°ç•¶å¤šå€‹ Service åŒæ™‚é‹è¡Œæ™‚ï¼ŒNode éƒ½éœ€è¦æœ‰å°æ‡‰çš„ port number å»å°æ‡‰æ¯å€‹ Server çš„ port numberã€‚åƒæ˜¯ GCP é€™ç¨®é›²ç«¯æœå‹™ï¼Œæ¯å°æ©Ÿå™¨éƒ½æœƒé…ç½®å±¬æ–¼è‡ªå·±çš„é˜²ç«ç‰†ã€‚é€™ä¹Ÿä»£è¡¨ï¼Œä¸è«–æ–°å¢ã€åˆªé™¤ Service ç‰©ä»¶ï¼Œéƒ½å¿…é ˆè¦é¡å¤–å¤šèª¿æ•´é˜²ç«ç‰†çš„è¨­å®šï¼ŒPort çš„ç®¡ç†ä¹Ÿæƒ³å°è¤‡é›œã€‚&lt;/p>
&lt;br>
&lt;p>è‹¥æ˜¯ä½¿ç”¨ Ingressï¼Œæˆ‘å€‘åªéœ€è¦é–‹æ”¾ä¸€å€‹å°å¤–çš„ port numerï¼ŒIngree å¯ä»¥åœ¨è¨­å®šæª”ä¸­è¨­å®šä¸åŒçš„è·¯å¾‘ï¼Œæ±ºå®šè¦å°‡ä½¿ç”¨è€…çš„è«‹æ±‚å‚³é€åˆ°å“ªä¸€å€‹ Service ç‰©ä»¶ä¸Šï¼š&lt;/p>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/describe-ingress.png"
alt="Ingress åœ–ç‰‡ä¾†æºï¼š[Day 19] åœ¨ Kubernetes ä¸­å¯¦ç¾è² è¼‰å¹³è¡¡ - Ingress Controller" width="900">&lt;figcaption>
&lt;p>Ingress åœ–ç‰‡ä¾†æºï¼š&lt;a href="https://ithelp.ithome.com.tw/articles/10196261" target="_blank" rel="noopener">[Day 19] åœ¨ Kubernetes ä¸­å¯¦ç¾è² è¼‰å¹³è¡¡ - Ingress Controller&lt;/a>&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;p>é€™æ¨£çš„è¨­è¨ˆï¼Œé™¤äº†è®“ç¶­é‹äººå“¡ä¸éœ€è¦ç¶­è­·å¤šå€‹ port æˆ–æ˜¯é »ç¹çš„æ›´æ”¹é˜²ç«ç‰†å¤–ï¼Œå¯ä»¥è‡ªè¨‚æ¢ä»¶çš„åŠŸèƒ½ï¼Œä¹Ÿä½¿å¾—è«‹æ±‚çš„å°å‘å¯ä»¥æ›´åŠ å½ˆæ€§ã€‚&lt;/p>
&lt;br>
&lt;h3>Ingress åŠŸèƒ½&lt;span class="hx-absolute -hx-mt-20" id="ingress-åŠŸèƒ½">&lt;/span>
&lt;a href="#ingress-%e5%8a%9f%e8%83%bd" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;ul>
&lt;li>å°‡ä¸åŒ&amp;quot;è·¯å¾‘&amp;quot;çš„è«‹æ±‚å°æ‡‰åˆ°ä¸åŒçš„ Service ç‰©ä»¶&lt;/li>
&lt;/ul>
&lt;p>è‹¥æ²’æœ‰è¨­å®šç¶²åŸŸï¼Œå‰‡è©²æ©Ÿå™¨ä¸Šçš„æ‰€æœ‰ç¶²åŸŸåªè¦é€éæ­¤è·¯å¾‘éƒ½å¯ä»¥é€£æ¥åˆ°æŒ‡å®šçš„ Service ç‰©ä»¶ã€‚&lt;/p>
&lt;br>
&lt;ul>
&lt;li>å°‡ä¸åŒ&amp;quot;ç¶²åŸŸ&amp;quot;çš„è«‹æ±‚å°æ‡‰åˆ°ä¸åŒçš„ Service ç‰©ä»¶&lt;/li>
&lt;/ul>
&lt;p>è‹¥æ²’æœ‰è¨­å®šè·¯å¾‘ï¼Œå‰‡æœƒä»¥ &lt;code>/&lt;/code> è·¯å¾‘é€£æ¥åˆ°æŒ‡å®šçš„ Service ç‰©ä»¶ã€‚&lt;/p>
&lt;br>
&lt;ul>
&lt;li>æ”¯æ´ SSL Termination&lt;/li>
&lt;/ul>
&lt;p>SSL å…¨åæ˜¯å‚³è¼¸å±¤å®‰å…¨æ€§å”å®šï¼Œè€Œç¶²ç«™é€šå¸¸éƒ½æœƒåˆ©ç”¨ https é€²è¡ŒåŠ å¯†ä»¥ç¢ºä¿è³‡æ–™å®‰å…¨ï¼Œä½† Service èˆ‡ Pod ä¹‹é–“çš„æºé€šéƒ½æ˜¯ä»¥ç„¡åŠ å¯†æ–¹å¼å‚³è¼¸ï¼Œæ‰€ä»¥ Ingress å°±æ”¯æ´è§£å¯†ï¼Œè®“ Service èˆ‡ Pod å¯ä»¥æ­£å¸¸æºé€šå‚³éè³‡æ–™ã€‚&lt;/p>
&lt;br>
&lt;h3>minikube å•Ÿå‹• Ingress&lt;span class="hx-absolute -hx-mt-20" id="minikube-å•Ÿå‹•-ingress">&lt;/span>
&lt;a href="#minikube-%e5%95%9f%e5%8b%95-ingress" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>ç”±æ–¼ minikube é è¨­æ²’æœ‰å•Ÿå‹• Ingress åŠŸèƒ½ï¼Œå› æ­¤éœ€è¦é¡å¤–ä½¿ç”¨ &lt;code>minikube addons enable ingress&lt;/code> è®“ minikube å•Ÿå‹• Ingress (Ingress ä¹Ÿéœ€è¦å…ˆå®‰è£ Hyperfix)ï¼š&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/ingress.png"
alt="Ingress åœ–ç‰‡ä¾†æºï¼š[Day 19] åœ¨ Kubernetes ä¸­å¯¦ç¾è² è¼‰å¹³è¡¡ - Ingress Controller" width="900">&lt;figcaption>
&lt;p>Ingress åœ–ç‰‡ä¾†æºï¼š&lt;a href="https://ithelp.ithome.com.tw/articles/10196261" target="_blank" rel="noopener">[Day 19] åœ¨ Kubernetes ä¸­å¯¦ç¾è² è¼‰å¹³è¡¡ - Ingress Controller&lt;/a>&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;h3>è¨­å®š /etc/hosts&lt;span class="hx-absolute -hx-mt-20" id="è¨­å®š-etchosts">&lt;/span>
&lt;a href="#%e8%a8%ad%e5%ae%9a-etchosts" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>åŠ å…¥ Ingress åŸºæœ¬ä¸Šå°±éœ€è¦ç¶²åŸŸæ‰å¯ä»¥ä½¿ç”¨ï¼Œä½†æˆ‘å€‘åœ¨æœ¬æ©Ÿä¸Šåšç·´ç¿’ï¼Œæ‰€ä»¥åªè¦ä¿®æ”¹æœ¬æ©Ÿçš„ host æª”æ¡ˆå°±å¯ä»¥äº†(åŠ å…¥ minikube ip ä»¥åŠæƒ³è¦çš„ç¶²åŸŸåç¨±)ã€‚&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>$ vim /etc/hosts
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.64.11 test.tw
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>192.168.64.11 test-test.tw&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;p>å› ç‚ºæœ‰å…©ç¨®æ–¹æ³•ï¼Œç¬¬ä¸€ç¨® (è¨­å®šç¶²åŸŸä»¥åŠè·¯å¾‘)è·Ÿç¬¬äºŒç¨® (åªè¨­å®šè·¯å¾‘æ²’æœ‰è¨­å®šç¶²åŸŸ)ï¼Œæ‰€ä»¥åº•ä¸‹ä¹Ÿæœƒåˆ†æˆå…©ç¨®ä¾†èªªæ˜ï¼&lt;/p>
&lt;h3>è¨­å®šç¶²åŸŸä»¥åŠè·¯å¾‘&lt;span class="hx-absolute -hx-mt-20" id="è¨­å®šç¶²åŸŸä»¥åŠè·¯å¾‘">&lt;/span>
&lt;a href="#%e8%a8%ad%e5%ae%9a%e7%b6%b2%e5%9f%9f%e4%bb%a5%e5%8f%8a%e8%b7%af%e5%be%91" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>&lt;a href="https://github.com/880831ian/kubernetes-tutorial/tree/master/Ingress-Domain" target="_blank" rel="noopener">Github ç¨‹å¼ç¢¼é€£çµ&lt;/a>&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">apiVersion&lt;/span>: &lt;span style="color:#ae81ff">networking.k8s.io/v1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">kind&lt;/span>: &lt;span style="color:#ae81ff">Ingress&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">metadata&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">kubernetes-demo-ingress&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">spec&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">rules&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">host&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;test.tw&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">http&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">paths&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">path&lt;/span>: &lt;span style="color:#ae81ff">/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">pathType&lt;/span>: &lt;span style="color:#ae81ff">Prefix&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">backend&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">service&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">kubernetes-demo-service&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">port&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">number&lt;/span>: &lt;span style="color:#ae81ff">3000&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;h3>åªè¨­å®šè·¯å¾‘æ²’æœ‰è¨­å®šç¶²åŸŸ&lt;span class="hx-absolute -hx-mt-20" id="åªè¨­å®šè·¯å¾‘æ²’æœ‰è¨­å®šç¶²åŸŸ">&lt;/span>
&lt;a href="#%e5%8f%aa%e8%a8%ad%e5%ae%9a%e8%b7%af%e5%be%91%e6%b2%92%e6%9c%89%e8%a8%ad%e5%ae%9a%e7%b6%b2%e5%9f%9f" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>&lt;a href="https://github.com/880831ian/kubernetes-tutorial/tree/master/Ingress-Path" target="_blank" rel="noopener">Github ç¨‹å¼ç¢¼é€£çµ&lt;/a>&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">apiVersion&lt;/span>: &lt;span style="color:#ae81ff">networking.k8s.io/v1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">kind&lt;/span>: &lt;span style="color:#ae81ff">Ingress&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">metadata&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">kubernetes-demo-ingress&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">spec&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">rules&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">http&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">paths&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">path&lt;/span>: &lt;span style="color:#ae81ff">/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">pathType&lt;/span>: &lt;span style="color:#ae81ff">Prefix&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">backend&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">service&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">kubernetes-demo-service&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">port&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">number&lt;/span>: &lt;span style="color:#ae81ff">3000&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;p>Ingress æ•´é«”å¯«æ³•èˆ‡ Service å·®ä¸å¤šï¼Œåªå·®åœ¨ &lt;code>spec&lt;/code> çš„ç´°éƒ¨è¨­å®šï¼Œæˆ‘å€‘å°±ä¾†èªªä¸€ä¸‹ spec è¨­å®šå§ï¼š&lt;/p>
&lt;p>å°äº†ï½ Ingress çš„ apiVersion ä¸åƒæ˜¯ Pod è·Ÿ Service ä¸€æ¨£ä½¿ç”¨ &lt;code>v1&lt;/code> ï¼Œå› ç‚ºç›®å‰æ”¯æ´ Ingress çš„ API åªæœ‰ networking.k8s.io/v1ï¼Œè©³ç´°å¯ä»¥åƒè€ƒ &lt;a href="https://kubernetes.io/docs/concepts/services-networking/ingress/" target="_blank" rel="noopener">kubernetes Ingress å®˜ç¶²&lt;/a>&lt;/p>
&lt;ul>
&lt;li>rules&lt;/li>
&lt;/ul>
&lt;p>é€™ä»£è¡¨é€™å€‹ Ingress çš„è½‰ç™¼è¦å‰‡ï¼Œæ­¤ Ingress æ‰€æœ‰çš„è¨­å®šéƒ½å¿…é ˆå¯«è¼‰ &lt;code>rules&lt;/code> å…§ã€‚&lt;/p>
&lt;ul>
&lt;li>host&lt;/li>
&lt;/ul>
&lt;p>è¨­å®šå¯ä»¥é€£æ¥åˆ° Service ç‰©ä»¶çš„ç¶²è·¯åç¨±ã€‚&lt;/p>
&lt;ul>
&lt;li>path&lt;/li>
&lt;/ul>
&lt;p>è¨­å®šå¯ä»¥é€£æ¥åˆ° Service ç‰©ä»¶çš„è·¯å¾‘åç¨±ã€‚&lt;/p>
&lt;ul>
&lt;li>pathType&lt;/li>
&lt;/ul>
&lt;p>åˆ†ç‚º &lt;code>Prefix&lt;/code> å’Œ &lt;code>Exact&lt;/code> å…©ç¨®ï¼ŒPrefixï¼šå‰ç¶´ç¬¦åˆå°±ç¬¦åˆè¦å‰‡ ; Exactï¼šéœ€è¦å®Œå…¨ä¸€è‡´æ‰è¡Œï¼ŒåŒ…å«å¤§å°å¯«ã€‚&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:center">type&lt;/th>
&lt;th style="text-align:center">path&lt;/th>
&lt;th style="text-align:center">request path&lt;/th>
&lt;th style="text-align:center">macth&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:center">Prefix&lt;/td>
&lt;td style="text-align:center">/&lt;/td>
&lt;td style="text-align:center">å…¨éƒ¨è·¯å¾‘&lt;/td>
&lt;td style="text-align:center">Yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">Exact&lt;/td>
&lt;td style="text-align:center">/aa&lt;/td>
&lt;td style="text-align:center">/aa&lt;/td>
&lt;td style="text-align:center">Yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">Exact&lt;/td>
&lt;td style="text-align:center">/bb&lt;/td>
&lt;td style="text-align:center">/cc&lt;/td>
&lt;td style="text-align:center">No&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">Prefix&lt;/td>
&lt;td style="text-align:center">/aa&lt;/td>
&lt;td style="text-align:center">/aa,/aa/&lt;/td>
&lt;td style="text-align:center">Yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">Prefix&lt;/td>
&lt;td style="text-align:center">/aa/cc&lt;/td>
&lt;td style="text-align:center">/aa/ccc&lt;/td>
&lt;td style="text-align:center">No&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;ul>
&lt;li>service.name&lt;/li>
&lt;/ul>
&lt;p>è¨­å®šé€£æ¥åˆ°çš„ Service åç¨±ï¼Œé€™è£¡è¦å¡«å¯«çš„å°±æ˜¯ Service ä¸­åœ¨ &lt;code>metadata&lt;/code> å…§å¯«çš„ &lt;code>name&lt;/code>ã€‚&lt;/p>
&lt;ul>
&lt;li>service.port.number&lt;/li>
&lt;/ul>
&lt;p>è¨­å®šè¦ç¶“ç”±å“ªå€‹ port é€£æ¥åˆ° Service ç‰©ä»¶ï¼Œå°±åƒæ˜¯ Service çš„ Port è¦é€£æ¥åˆ° Pod çš„ targetPortã€‚&lt;/p>
&lt;br>
&lt;h3>å»ºç«‹ Ingress&lt;span class="hx-absolute -hx-mt-20" id="å»ºç«‹-ingress">&lt;/span>
&lt;a href="#%e5%bb%ba%e7%ab%8b-ingress" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>ä¸€æ¨£æˆ‘å€‘åˆ†æˆå…©å€‹åšèªªæ˜&lt;/p>
&lt;h4>è¨­å®šç¶²åŸŸä»¥åŠè·¯å¾‘&lt;span class="hx-absolute -hx-mt-20" id="è¨­å®šç¶²åŸŸä»¥åŠè·¯å¾‘-1">&lt;/span>
&lt;a href="#%e8%a8%ad%e5%ae%9a%e7%b6%b2%e5%9f%9f%e4%bb%a5%e5%8f%8a%e8%b7%af%e5%be%91-1" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h4>&lt;p>ä¸€æ¨£ä½¿ç”¨ &lt;code>apply&lt;/code> ä¾†å»ºç«‹ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>$ kubectl apply -f ingress.yaml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ingress.networking.k8s.io/kubernetes-demo-ingress created&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;p>ä½¿ç”¨ &lt;code>kubectl get ing&lt;/code> ä¾†æŸ¥è©¢ Ingress ç‹€æ³ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>$ kubectl get ing
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>NAME CLASS HOSTS ADDRESS PORTS AGE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubernetes-demo-ingress nginx test.tw 192.168.64.11 &lt;span style="color:#ae81ff">80&lt;/span> 10m&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>æ¥ä¸‹ä¾†æˆ‘å€‘åˆ†åˆ¥æ¸¬è©¦å¯«åœ¨ /etc/host è£¡é¢çš„å…©å€‹ç¶²åŸŸï¼Œä½¿ç”¨ç€è¦½å™¨æœå°‹ &lt;code>test.tw&lt;/code> è·Ÿ &lt;code>test-test.tw&lt;/code>ï¼š&lt;/p>
&lt;br>
&lt;ul>
&lt;li>&lt;code>test.tw&lt;/code>&lt;/li>
&lt;/ul>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/Shiba-Inu-3.png"
alt="æˆåŠŸé¡¯ç¤ºæŸ´çŠ¬" width="1000">&lt;figcaption>
&lt;p>æˆåŠŸé¡¯ç¤ºæŸ´çŠ¬&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;ul>
&lt;li>&lt;code>test-test.tw &lt;/code>&lt;/li>
&lt;/ul>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/Shiba-Inu-4.png"
alt="é¡¯ç¤º 404" width="800">&lt;figcaption>
&lt;p>é¡¯ç¤º 404&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>å¾ä¸Šé¢çµæœå¯ä»¥çŸ¥é“ï¼Œå› ç‚ºæˆ‘å€‘æœ‰è¨­å®š domainï¼Œæ‰€ä»¥åªæœ‰ç¬¦åˆçš„æ‰æœƒé€£æ¥åˆ° Service ã€‚&lt;/p>
&lt;br>
&lt;h4>åªè¨­å®šè·¯å¾‘æ²’æœ‰è¨­å®šç¶²åŸŸ&lt;span class="hx-absolute -hx-mt-20" id="åªè¨­å®šè·¯å¾‘æ²’æœ‰è¨­å®šç¶²åŸŸ-1">&lt;/span>
&lt;a href="#%e5%8f%aa%e8%a8%ad%e5%ae%9a%e8%b7%af%e5%be%91%e6%b2%92%e6%9c%89%e8%a8%ad%e5%ae%9a%e7%b6%b2%e5%9f%9f-1" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h4>&lt;p>ä¸€æ¨£ä½¿ç”¨ &lt;code>apply&lt;/code> ä¾†å»ºç«‹ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>$ kubectl apply -f ingress.yaml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ingress.networking.k8s.io/kubernetes-demo-ingress created&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;p>ä½¿ç”¨ &lt;code>kubectl get ing&lt;/code> ä¾†æŸ¥è©¢ Ingress ç‹€æ³ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>$ kubectl get ing
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>NAME CLASS HOSTS ADDRESS PORTS AGE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubernetes-demo-ingress nginx * 192.168.64.11 &lt;span style="color:#ae81ff">80&lt;/span> 5m56s&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>æ¥ä¸‹ä¾†æˆ‘å€‘åˆ†åˆ¥æ¸¬è©¦å¯«åœ¨ /etc/host è£¡é¢çš„å…©å€‹ç¶²åŸŸï¼Œä½¿ç”¨ç€è¦½å™¨æœå°‹ &lt;code>test.tw&lt;/code> è·Ÿ &lt;code>test-test.tw&lt;/code>ï¼š&lt;/p>
&lt;br>
&lt;ul>
&lt;li>&lt;code>test.tw&lt;/code>&lt;/li>
&lt;/ul>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/Shiba-Inu-3.png"
alt="æˆåŠŸé¡¯ç¤ºæŸ´çŠ¬" width="1000">&lt;figcaption>
&lt;p>æˆåŠŸé¡¯ç¤ºæŸ´çŠ¬&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;ul>
&lt;li>&lt;code>test-test.tw &lt;/code>&lt;/li>
&lt;/ul>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/Shiba-Inu-5.png"
alt="é¡¯ç¤º 404" width="1000">&lt;figcaption>
&lt;p>é¡¯ç¤º 404&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>å¾ä¸Šé¢çµæœå¯ä»¥çŸ¥é“ï¼Œå¯ä»¥ç™¼ç¾ hosts çš„éƒ¨åˆ†æ˜¯ &lt;code>*&lt;/code> ï¼Œé€™ä»£è¡¨æ‰€æœ‰èƒŒå¾ŒæŒ‡å‘ &lt;code>192.168.64.11&lt;/code> é€™å€‹ IP çš„ç¶²åŸŸéƒ½å¯ä»¥ç›´æ¥é€£æ¥åˆ° Service ç‰©ä»¶ã€‚&lt;/p>
&lt;br>
&lt;h2>ä»€éº¼æ˜¯ Replication Controller ?&lt;span class="hx-absolute -hx-mt-20" id="ä»€éº¼æ˜¯-replication-controller-">&lt;/span>
&lt;a href="#%e4%bb%80%e9%ba%bc%e6%98%af-replication-controller-" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>å¤§å®¶çœ‹åˆ° Controller å°±çŸ¥é“ Replication Controller ä¹Ÿæ˜¯ä¸€ç¨® Controller è² è²¬æ§åˆ¶ Replicationï¼Œè€Œ Replication ç¿»æˆä¸­æ–‡æ˜¯è¤‡è£½çš„æ„æ€ï¼Œåœ¨ Kubernetes ä¸­ Replication ä»£è¡¨åŒä¸€ç¨® Pod çš„è¤‡è£½å“ã€‚&lt;/p>
&lt;p>é€™é‚Šè¦å¸¶çµ¦å¤§å®¶èªè­˜ä¸€å€‹é‡è¦çš„è¨­å®šï¼š&lt;code>replica&lt;/code>ï¼Œ&lt;code>replica&lt;/code> å°±æ˜¯è¤‡è£½å“çš„æ„æ€ï¼Œé€éé€™å€‹è¨­å®šæˆ‘å€‘å°±å¯ä»¥å¿«é€Ÿç”¢ç”Ÿä¸€æ¨£å…§å®¹çš„ Podï¼Œèˆ‰ä¾‹ä¾†èªªï¼šä»Šå¤©è¨­å®šäº† &lt;code>replica: 3&lt;/code> å°±ä»£è¡¨æœƒç”¢ç”Ÿå…©å€‹å…§å®¹ä¸€æ¨£çš„ Pod å‡ºä¾†ã€‚&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/ReplicationController.png"
alt="Kubernetes StatefulSet æ¶æ§‹" width="700">&lt;figcaption>
&lt;p>Kubernetes StatefulSet æ¶æ§‹&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;h3>Replication Controller ç”¨é€”&lt;span class="hx-absolute -hx-mt-20" id="replication-controller-ç”¨é€”">&lt;/span>
&lt;a href="#replication-controller-%e7%94%a8%e9%80%94" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>ä¸Šé¢æœ‰æåˆ° Replication Controller å¯ä»¥åˆ©ç”¨è¨­å®š &lt;code>replica&lt;/code> çš„æ–¹å¼å¿«é€Ÿå»ºç«‹ Pod æ•¸é‡ï¼Œé™¤äº†å»ºç«‹ä¹‹å¤– Replication Controller ä¹Ÿç¢ºä¿ Pod æ•¸é‡èˆ‡æˆ‘å€‘è¨­å®šçš„ &lt;code>replica&lt;/code> ä¸€è‡´ï¼Œå‡å¦‚ä»Šå¤©ä¸å°å¿ƒåˆªé™¤å…¶ä¸­ä¸€å€‹ Podï¼Œé€™æ™‚å€™ Replication Controller æœƒè‡ªå‹•å†ç”¢ç”Ÿä¸€å€‹æ–°çš„ Pod ä¾†è£œé½Šåˆªé™¤çš„ Pod ç©ºç¼ºï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥å–„ç”¨ Replication Controller ä¾†è®“ç³»çµ±æ›´ä½³ç©©å®šã€‚&lt;/p>
&lt;br>
&lt;h3>Replication Controller å¯«æ³•&lt;span class="hx-absolute -hx-mt-20" id="replication-controller-å¯«æ³•">&lt;/span>
&lt;a href="#replication-controller-%e5%af%ab%e6%b3%95" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>æˆ‘å€‘ä¾†ä¿®æ”¹ä¸€ä¸‹ä¹‹å‰çš„ kubernetes-demo.yaml Pod æª”æ¡ˆï¼š(&lt;a href="https://github.com/880831ian/kubernetes-tutorial/tree/master/ReplicationController" target="_blank" rel="noopener">Github ç¨‹å¼ç¢¼é€£çµ&lt;/a>)&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">apiVersion&lt;/span>: &lt;span style="color:#ae81ff">v1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">kind&lt;/span>: &lt;span style="color:#ae81ff">ReplicationController&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">metadata&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">kubernetes-demo&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">spec&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">replicas&lt;/span>: &lt;span style="color:#ae81ff">3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">selector&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">app&lt;/span>: &lt;span style="color:#ae81ff">demo&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">template&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">metadata&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">labels&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">app&lt;/span>: &lt;span style="color:#ae81ff">demo&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">spec&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">containers&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">kubernetes-demo-container&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">image&lt;/span>: &lt;span style="color:#ae81ff">880831ian/kubernetes-demo&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ports&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">containerPort&lt;/span>: &lt;span style="color:#ae81ff">3000&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>é€™å€‹è¨­å®šæª”çœ‹ä¼¼è¤‡é›œä½†å…¶å¯¦å¾ˆç°¡å–®ï¼Œå¯ä»¥ç™¼ç¾ &lt;code>template&lt;/code> å€å¡Šå…§çš„è¨­å®šåŸºæœ¬ä¸Šå°±æ˜¯ Pod çš„è¨­å®šï¼Œå†åŠ ä¸Šä¸€äº›å±¬æ–¼ Replication Controller çš„è¨­å®šã€‚&lt;/p>
&lt;p>ç”±æ–¼æˆ‘å€‘è¦å»ºç«‹çš„æ˜¯ Replication Controllerï¼Œå› æ­¤åœ¨ä¸€é–‹å§‹çš„ &lt;code>spec&lt;/code> è¦å¡«çš„æ˜¯ Replication Controller çš„è¨­å®šï¼Œæ‰€ä»¥ &lt;code>replica&lt;/code> æœƒæ“ºåœ¨ç¬¬ä¸€å€‹ &lt;code>spec&lt;/code> å…§ã€‚&lt;/p>
&lt;p>å¯ä»¥å†çœ‹åˆ° &lt;code>selector&lt;/code>ï¼Œå‰é¢æåˆ° Replication Controller è¦æ§åˆ¶çš„å°±æ˜¯ Pod çš„æ•¸é‡ï¼Œæ‰€ä»¥é€™é‚Šçš„ &lt;code>selector&lt;/code> å°±æ˜¯è¦é¸å– Podï¼Œå°±è·Ÿæˆ‘å€‘åœ¨ Service è¦é¸å– Pod çš„ä¸€æ¨£ã€‚&lt;/p>
&lt;p>æœ€å¾Œä¸€å€‹æ–°çš„è¨­å®šï¼š&lt;code>template&lt;/code>ï¼Œ&lt;code>template&lt;/code> å°±æ˜¯ç”¨ä¾†å®šç¾© Pod çš„è³‡è¨Šï¼Œæ‰€ä»¥ Pod çš„å…§å®¹åƒæ˜¯ &lt;code>metadata&lt;/code>ã€&lt;code>spec&lt;/code> ç­‰ç­‰éƒ½æœƒå¯«åœ¨ &lt;code>template&lt;/code> å…§ï¼Œæ‰€ä»¥å¯ä»¥æŠŠ &lt;code>template&lt;/code> æƒ³åƒæˆä¸éœ€è¦å¯« &lt;code>apiVersion&lt;/code> è·Ÿ &lt;code>kind&lt;/code> çš„ Pod å£“æ¨¡æª”ï¼Œæœ‰äº†é€™å€‹è§€å¿µå†ä¾†çœ‹ &lt;code>template&lt;/code> å…§çš„æè¿°å°±å¾ˆç°¡å–®ï¼Œåªæ˜¯æŠŠ Pod çš„å…§å®¹è¤‡è£½éä¾†è€Œå·²ï¼Œè€Œ &lt;code>template&lt;/code> å…§çš„ &lt;code>spec&lt;/code> å°±æ˜¯å¯«ä¸Š Pod çš„ container è³‡è¨Šã€‚&lt;/p>
&lt;br>
&lt;h3>Replication Controller å»ºç«‹&lt;span class="hx-absolute -hx-mt-20" id="replication-controller-å»ºç«‹">&lt;/span>
&lt;a href="#replication-controller-%e5%bb%ba%e7%ab%8b" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>è€æ¨£å­ï¼Œä¹Ÿæ˜¯ä½¿ç”¨ &lt;code>apply&lt;/code> ä¾†å»ºç«‹å£“æ¨¡æª”ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>$ kubectl apply -f kubernetes-demo.yaml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>replicationcontroller/kubernetes-demo created&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;p>ä¾†æŸ¥çœ‹ä¸€ä¸‹ Replication Controller æ˜¯å¦æœ‰æˆåŠŸå»ºç«‹èµ·ä¾†ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>kubectl get rc&lt;/code> ä¾†æŸ¥è©¢ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>$ kubectl get rc
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>NAME DESIRED CURRENT READY AGE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubernetes-demo &lt;span style="color:#ae81ff">3&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span> 28s&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;p>æ¥ä¸‹ä¾†å¯ä»¥æŸ¥çœ‹ Pod æ˜¯å¦æœ‰å‡ºç¾ 3 å€‹ï¼Œæ‰€ä»¥ä½¿ç”¨ &lt;code>kubectl get po&lt;/code> ä¾†æŸ¥è©¢ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>$ kubectl get po
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubernetes-demo-4zkxm 1/1 Running &lt;span style="color:#ae81ff">0&lt;/span> 37s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubernetes-demo-cp8jt 1/1 Running &lt;span style="color:#ae81ff">0&lt;/span> 37s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubernetes-demo-pt9px 1/1 Running &lt;span style="color:#ae81ff">0&lt;/span> 37s&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>å¯ä»¥çœ‹åˆ°ç‚ºäº†ä¸è¦è®“åç¨±é‡è¤‡ï¼Œæ‰€ä»¥ Replication Controller æœƒåœ¨æ¯ä¸€å€‹ Pod åç¨±å¾Œé¢åŠ å…¥äº‚æ•¸ã€‚&lt;/p>
&lt;br>
&lt;p>æ¥ä¸‹ä¾†æˆ‘å€‘ç”¨ &lt;code>minikube dashboard&lt;/code> ä¾†æ¸¬è©¦ä¸€ä¸‹ï¼Œæ˜¯å¦åˆªé™¤å…¶ä¸­ä¸€å€‹ Pod å¾Œï¼ŒReplication Controller æœƒè‡ªå‹•å»ºç«‹æ–°çš„ï¼š&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/rc-1.png"
alt="åˆªé™¤éš¨æ©Ÿä¸€å€‹ Pod" width="1200">&lt;figcaption>
&lt;p>åˆªé™¤éš¨æ©Ÿä¸€å€‹ Pod&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>ç•¶æˆ‘å€‘éš¨æ©Ÿåˆªé™¤ä¸€å€‹ Pod æ™‚ï¼Œè¢«åˆªé™¤çš„ Pod æœƒ Terminating æº–å‚™åˆªé™¤ï¼Œä¸”å•Ÿå‹•ä¸€å€‹æ–°çš„ Pod ContainerCreatingï¼š&lt;/p>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/rc-2.png"
alt="Pod æœå‹™" width="1200">&lt;figcaption>
&lt;p>Pod æœå‹™&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>ç•¶æ–°çš„ Pod å•Ÿå‹•æˆåŠŸå¾Œï¼ŒèˆŠçš„ Pod æ‰æœƒè¢«åˆªé™¤ï¼Œæ‰€ä»¥å¯ä»¥ç¢ºä¿æˆ‘å€‘çš„æœå‹™ç©©å®šåº¦ã€‚&lt;/p>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/rc-3.png"
alt="Pod æœå‹™" width="1200">&lt;figcaption>
&lt;p>Pod æœå‹™&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>ç¶œä¸Šæ‰€è¿°ï¼Œå¯ä»¥çŸ¥é“ Replication Controller çœŸçš„æœƒæ§åˆ¶ Pod æ•¸é‡ï¼Œé‚£æˆ‘å€‘åˆªæ‰ä¸€å€‹ Pod ä»–å°±é‡ç”Ÿä¸€å€‹ï¼Œé€™æ¨£ä¸æœƒæ°¸é éƒ½åˆªä¸å®Œå—ï¼Ÿå…¶å¯¦æˆ‘å€‘å¯ä»¥æŠŠ Replication Controller ç æ‰å°±å¥½äº†ï¼Œè€Œ Replication Controller åˆªé™¤æ™‚ï¼Œä¹Ÿæœƒè‡ªå‹•çµ‚æ­¢åº•ä¸‹çš„ Pod ï¼Œæœ€å¾Œ Pod éƒ½æœƒè‡ªå‹•åˆªé™¤ã€‚&lt;/p>
&lt;p>ä½†å…¶å¯¦ Kubernetes å®˜æ–¹ä¸å»ºè­°ä½¿ç”¨ Replication Controller çš„æ–¹å¼ä¾†æ§åˆ¶ Podï¼Œè€Œæ˜¯å»ºè­°ä½¿ç”¨ Deployment æ­é… ReplicaSet ä¾†æ§åˆ¶ï¼Œæˆ‘å€‘æ¥ä¸‹ä¾†è¦ä»‹ç´¹çš„ä¸»é¡Œå°±æ˜¯ï¼š&lt;code>Deployment&lt;/code> è·Ÿ &lt;code>ReplicaSet&lt;/code> ã€‚&lt;/p>
&lt;br>
&lt;h2>ä»€éº¼æ˜¯ ReplicaSet ?&lt;span class="hx-absolute -hx-mt-20" id="ä»€éº¼æ˜¯-replicaset-">&lt;/span>
&lt;a href="#%e4%bb%80%e9%ba%bc%e6%98%af-replicaset-" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>çœ‹åˆ° &lt;code>Replica&lt;/code> å¤§å®¶æ‡‰è©²å°±çŸ¥é“é€™å€‹è·Ÿæ§åˆ¶ Pod çš„æ•¸é‡æœ‰é—œä¿‚äº†ï¼å…¶å¯¦ &lt;code>Replica&lt;/code> è·Ÿ &lt;code>Replication Controller&lt;/code> å¾ˆåƒï¼Œ&lt;code>ReplcaSet&lt;/code> æä¾›äº†æ›´å½ˆæ€§çš„ selectorï¼Œåœ¨ &lt;code>Replication Controller&lt;/code> ä¸­æˆ‘å€‘å¿…é ˆè¦æŠŠå®Œæ•´çš„ &lt;code>key/value&lt;/code> Label å¯«ä¸Šå»ï¼Œåœ¨ &lt;code>ReplicaSet&lt;/code> ä¸ç”¨é€™å€‹éº»ç…©ï¼Œä½† &lt;code>ReplicaSet&lt;/code> ä¸€æ¨£ä¹Ÿå¯ä»¥å¯«ä¸Šå®Œæ•´çš„ Label ï¼Œé€™å€‹å°±çœ‹é–‹ç™¼è€…è¦æ€éº¼å»è¨­è¨ˆäº†ï¼&lt;/p>
&lt;br>
&lt;h3>ReplcaSet çš„ç‰¹æ€§&lt;span class="hx-absolute -hx-mt-20" id="replcaset-çš„ç‰¹æ€§">&lt;/span>
&lt;a href="#replcaset-%e7%9a%84%e7%89%b9%e6%80%a7" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>ä¸Šé¢æœ‰æåˆ° &lt;code>ReplcaSet&lt;/code> éå¸¸å½ˆæ€§çš„ selectorï¼Œé€™é‚Šè¦èªªçš„æ˜¯ &lt;code>ReplcaSet&lt;/code> æ˜¯å¦‚ä½•è®“ selector è®Šå¾—æ›´åŠ å½ˆæ€§ï¼Œé€™è£¡ä¸€å…±è¦ä»‹ç´¹å…©ç¨® &lt;code>ReplcaSet&lt;/code> çš„ selector å¯«æ³•ï¼š&lt;/p>
&lt;br>
&lt;ul>
&lt;li>matchLabels&lt;/li>
&lt;/ul>
&lt;p>&lt;code>matchLabels&lt;/code> å…¶å¯¦è·Ÿä¸€èˆ¬çš„ selector åšçš„äº‹æƒ…ä¸€æ¨¡ä¸€æ¨£ï¼Œä¹Ÿè¦å¯«å‡ºå®Œæ•´çš„ Label å‡ºä¾†ï¼Œæ•´é«”å¤§æ¦‚æœƒé•·åƒé€™æ¨£ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">selector&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">matchLabels&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">app&lt;/span>: &lt;span style="color:#ae81ff">demo&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;ul>
&lt;li>matchExpressions&lt;/li>
&lt;/ul>
&lt;p>&lt;code>matchExpressions&lt;/code> å‰‡æ˜¯æä¾›æ›´å½ˆæ€§çš„é¸å–æ¢ä»¶ï¼Œæ¯ä¸€ç­†æ¢ä»¶ä¸»è¦ç”± keyã€operatorã€value çµ„æˆï¼Œä¸¦ä¸”ä½¿ç”¨ä¸€å€‹ &lt;code>{ }&lt;/code> åŒ…èµ·ä¾†ï¼Œçœ‹èµ·ä¾†å¾ˆåƒ JS çš„ ç‰©ä»¶å‹æ…‹ï¼Œæ•´é«”å¤§æ¦‚æœƒé•·åƒé€™æ¨£ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">selector&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">matchExpression&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - { &lt;span style="color:#f92672">key: app, operator: In, values&lt;/span>: [&lt;span style="color:#ae81ff">demo, test] }&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>çœ‹èµ·ä¾†ä¼¼ä¹å¾ˆè¤‡é›œä½†å…¶å¯¦å¾ˆå®¹æ˜“ç†è§£ï¼Œä¸Šé¢çš„ç¤ºç¯„ä¸­ Expression ç¿»æˆä¸­æ–‡å°±æ˜¯åªè¦ Label çš„ key æ˜¯ &lt;code>app&lt;/code> ä¸”å€¼ç¬¦åˆ &lt;code>[demo, test]&lt;/code> é™£åˆ—ä¸­çš„å…¶ä¸­ä¸€å€‹å€¼çš„ Pod å°±æœƒè¢«é¸å–åˆ°ã€‚&lt;/p>
&lt;br>
&lt;p>æˆ‘å€‘åœ¨éš¨ä¾¿å–å¾—ä¾‹å­ï¼šå‡è¨­æœ‰ä¸€å€‹ &lt;code>matchExpression&lt;/code> é•·å¾—åƒé€™æ¨£ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">selector&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">matchExpression&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - { &lt;span style="color:#f92672">key: env, operator: NotIn, values&lt;/span>: [&lt;span style="color:#ae81ff">hello, hi] }&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>æˆ‘å€‘å¯ä»¥å¾—çŸ¥è¦é¸å– Label çš„ key ç‚º &lt;code>env&lt;/code> ä¸”å€¼ä¸èƒ½æ˜¯ &lt;code>[hello, hi]&lt;/code> å…¶ä¸­ä¸€å€‹å€¼çš„ Podã€‚&lt;/p>
&lt;br>
&lt;h2>ä»€éº¼æ˜¯ Deployment ?&lt;span class="hx-absolute -hx-mt-20" id="ä»€éº¼æ˜¯-deployment-">&lt;/span>
&lt;a href="#%e4%bb%80%e9%ba%bc%e6%98%af-deployment-" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>Deployment æ˜¯ä¸€ç¨®è² è²¬ç®¡ç† &lt;code>ReplicaSet&lt;/code> ä»¥åŠæ§åˆ¶ Pod æ›´æ–°çš„ç‰©ä»¶ï¼Œåœ¨å…ˆå‰çš„æ–‡ç« éƒ½æ²’æœ‰æåˆ° Pod çš„æ›´æ–°ï¼Œæ˜¯å› ç‚º Pod ç„¡æ³•ç›´æ¥åšæ›´æ–°ï¼Œå¿…é ˆç æ‰é‡å»ºæ‰æœƒæ˜¯æ–°çš„å…§å®¹ï¼Œæœ‰äº† Deployment ä¹‹å¾Œæˆ‘å€‘å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„é€²è¡Œ Pod çš„æ›´æ–°äº†ï¼&lt;/p>
&lt;p>ç”±æ–¼ &lt;code>ReplicaSet&lt;/code> æœ¬èº«ä¹Ÿæœƒæ§åˆ¶ Podï¼Œæ‰€ä»¥æ•´å€‹çœ‹èµ·ä¾†æœƒåƒæ˜¯ Deployment æ§åˆ¶ Podï¼Œä½†å…¶å¯¦çœŸæ­£æ§åˆ¶ Pod çš„æ˜¯ &lt;code>ReplicaSet&lt;/code> ~&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/deployment.png"
alt="Deployment èˆ‡ ReplicaSet æ¶æ§‹åœ–" width="500">&lt;figcaption>
&lt;p>Deployment èˆ‡ ReplicaSet æ¶æ§‹åœ–&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;h3>Deployment çš„ç‰¹æ€§&lt;span class="hx-absolute -hx-mt-20" id="deployment-çš„ç‰¹æ€§">&lt;/span>
&lt;a href="#deployment-%e7%9a%84%e7%89%b9%e6%80%a7" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;ul>
&lt;li>éƒ¨ç½²ä¸€å€‹æ‡‰ç”¨æœå‹™&lt;/li>
&lt;/ul>
&lt;p>ä¸Šé¢æˆ‘å€‘æåˆ° Deployment å¯ä»¥å¹«åŠ© Pod é€²è¡Œæ›´æ–°ï¼Œé€šå¸¸åœ¨é–‹ç™¼ä¸€å€‹ç”¢å“çš„æ™‚å€™ä¸€å®šæœƒä¸æ–·çš„æ›´æ–°ï¼Œé€é Deployment æˆ‘å€‘å¯ä»¥å¿«é€Ÿçš„æ›´æ–° Pod å…§éƒ¨çš„ containerï¼Œæ‰€ä»¥é€šå¸¸åœ¨éƒ¨ç½²æ‡‰ç”¨çš„æ™‚å€™éƒ½æœƒä½¿ç”¨ Deployment ä¾†é€²è¡Œéƒ¨ç½²ã€‚&lt;/p>
&lt;br>
&lt;ul>
&lt;li>åœ¨æœå‹™å‡ç´šéç¨‹ä¸­å¯ä»¥é”æˆç„¡åœæ©Ÿæœå‹™é·ç§» (Zero downtime deployment)&lt;/li>
&lt;/ul>
&lt;p>åœ¨ Deployment å¹« Pod å…§éƒ¨ container é€²è¡Œæ›´æ–°çš„éç¨‹æœ‰ä¸€å€‹å°ˆæœ‰åç¨±å«åš &lt;code>RollingUpdate&lt;/code> ï¼Œ&lt;code>RollingUpdate&lt;/code> ç¿»æˆä¸­æ–‡çš„æ„æ€æ˜¯æ»¾å‹•æ›´æ–°ï¼Œåœ¨æ›´æ–°çš„éç¨‹ä¸­ Deployment æœƒå…ˆç”¢ç”Ÿä¸€å€‹æ–°çš„ ReplicaSet è€Œé€™å€‹ ReplicaSet å…§éƒ¨çš„ Pod æœƒé‹è¡Œæ–°çš„å…§å®¹ï¼Œå¾…æ–°çš„ Pod è¢« Kubernetes ç¢ºèªå¯ä»¥æ­£å¸¸é‹è¡Œå¾Œ Deployment æ‰æœƒå°‡èˆŠçš„ ReplicaSet é€²è¡Œå–ä»£çš„å‹•ä½œï¼Œé€™æ¨£å°±å®Œæˆäº†ç„¡åœæ©Ÿæœå‹™é·ç§»äº†ã€‚&lt;/p>
&lt;br>
&lt;ul>
&lt;li>å¯ä»¥ Rollback åˆ°å…ˆå‰ç‰ˆæœ¬&lt;/li>
&lt;/ul>
&lt;p>æ¯ä¸€æ¬¡çš„ Deployment åœ¨é€²è¡Œ RollingUpdate çš„æ™‚å€™éƒ½æœƒæŠŠç•¶å‰çš„ ReplicaSet åšä¸€å€‹ç‰ˆæœ¬æ§åˆ¶çš„ç´€éŒ„ï¼Œå°±åƒæ˜¯ git commit ä¸€æ¨£ï¼Œæ‰€ä»¥æˆ‘å€‘ä¹Ÿå¯ä»¥åˆ©ç”¨é€™äº›ç´€éŒ„ä¾†å¿«é€Ÿæ¢å¾©æˆä»¥å‰çš„ç‰ˆæœ¬ï¼Œé€™äº› Pod ä¹Ÿå°±æœƒè®Šæˆå…ˆå‰çš„å…§å®¹ã€‚&lt;/p>
&lt;br>
&lt;p>è¬›å®ŒåŸºæœ¬çš„ä»‹ç´¹å¾Œï¼Œæ¥ä¸‹ä¾†è¦ä»‹ç´¹çš„æ˜¯è¦å¦‚ä½•æ’°å¯«ä»¥åŠå»ºç«‹ä¸€å€‹ Deploymentï¼š&lt;/p>
&lt;h3>Deployment æ­é… ReplicaSet å¯«æ³•&lt;span class="hx-absolute -hx-mt-20" id="deployment-æ­é…-replicaset-å¯«æ³•">&lt;/span>
&lt;a href="#deployment-%e6%90%ad%e9%85%8d-replicaset-%e5%af%ab%e6%b3%95" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>&lt;a href="https://github.com/880831ian/kubernetes-tutorial/tree/master/Deployment-ReplicaSet" target="_blank" rel="noopener">Github ç¨‹å¼ç¢¼é€£çµ&lt;/a>&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">apiVersion&lt;/span>: &lt;span style="color:#ae81ff">apps/v1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">kind&lt;/span>: &lt;span style="color:#ae81ff">Deployment&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">metadata&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">kubernetes-deployment&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">spec&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">replicas&lt;/span>: &lt;span style="color:#ae81ff">3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">strategy&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">type&lt;/span>: &lt;span style="color:#ae81ff">RollingUpdate&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">rollingUpdate&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">maxSurge&lt;/span>: &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">maxUnavailable&lt;/span>: &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">minReadySeconds&lt;/span>: &lt;span style="color:#ae81ff">60&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">revisionHistoryLimit&lt;/span>: &lt;span style="color:#ae81ff">10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">template&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">metadata&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">labels&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">app&lt;/span>: &lt;span style="color:#ae81ff">demo&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">spec&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">containers&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">kubernetes-demo-container&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">image&lt;/span>: &lt;span style="color:#ae81ff">880831ian/kubernetes-demo&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ports&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">containerPort&lt;/span>: &lt;span style="color:#ae81ff">3000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">selector&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">matchLabels&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">app&lt;/span>: &lt;span style="color:#ae81ff">demo&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;p>çœ‹åˆ° Deployment æ˜¯ä¸æ˜¯è¦ºå¾—è·Ÿ Replication Controller éå¸¸ç›¸ä¼¼å‘¢ï¼Ÿå…¶å¯¦ Deployment å°±å¤šäº†å† RollingUpdate æ™‚çš„è¨­å®šä»¥åŠ ReplicaSet çš„è¨­å®šè€Œå·²ï¼Œä¸‹é¢ä¾†èªªæ˜ä¸€ä¸‹é€™äº›è¨­å®šï¼š&lt;/p>
&lt;p>é¦–å…ˆä¸€é–‹å§‹çš„ apiVersion çš„å€¼å·²ç¶“ä¸æ˜¯ &lt;code>v1&lt;/code> äº†ï¼Œæ”¹æˆ &lt;code>apps/v1&lt;/code>ï¼Œç”±æ–¼ Kubernetes é‡å° Deploymentã€RollingUpdateã€ReplicaSet ç­‰ç­‰è¨­å®šäº†æ–°çš„ &lt;code>apiVersion&lt;/code> å€¼ï¼Œé€šå¸¸éƒ½ç”¨ &lt;code>apps/v1&lt;/code> éƒ½æ˜¯ç”¨ä¾†è¨­å®šè·Ÿæ‡‰ç”¨ç¨‹å¼æœ‰é—œçš„æ¶è¨­ï¼Œæ‰€ä»¥ Deployment é€™é‚Šè¦è¨˜å¾—æ”¹æˆ &lt;code>apps/v1&lt;/code> æ­ï¼&lt;/p>
&lt;br>
&lt;p>åœ¨ &lt;code>spec&lt;/code> çš„åœ°æ–¹æœ‰çœ‹åˆ° &lt;code>strategy&lt;/code> æ–°çš„è¨­å®šå€¼ï¼Œé€™å€‹ä¸»è¦ç”¨ä¾†è¨­å®š Deployment æ›´æ–°çš„ç­–ç•¥ï¼Œé€™è£¡çš„ &lt;code>strategy.type&lt;/code> æœ‰å…©ç¨®è¨­å®šï¼š&lt;/p>
&lt;ul>
&lt;li>RollingUpdate&lt;/li>
&lt;/ul>
&lt;p>æ­¤ç‚ºé è¨­å€¼ï¼Œå…ˆå»ºç«‹æ–°çš„ ReplicaSet ä¸¦æ§åˆ¶æ–°å…§å®¹çš„ Podï¼Œå¾…æ–° Pod ä¹Ÿå¯ä»¥æ­£å¸¸é‹ä½œå¾Œï¼Œæ‰æœƒé€šçŸ¥ ReplicaSet å°‡åŸæœ‰çš„ Pod çµ¦ç§»é™¤ï¼Œç”±æ–¼éç¨‹ä¸­æœƒæœ‰æ–°èˆŠå…©ç¨® Pod åŒæ™‚ä¸Šç·šï¼Œå› æ­¤æœƒæœ‰ä¸€æ®µæ™‚é–“æ˜¯æ–°èˆŠå…§å®¹æœƒéš¨æ©Ÿå‡ºç¾çš„æƒ…å½¢ç™¼ç”Ÿã€‚&lt;/p>
&lt;p>é€™é‚Šå¯ä»¥çœ‹åˆ°é™¤äº† &lt;code>type&lt;/code> ä»¥å¤–é‚„å¯«äº† &lt;code>maxSurage&lt;/code> ä»¥åŠ &lt;code>maxUnavailablle&lt;/code>ï¼Œé€™å…©å€‹è¨­å®šå€¼ç‚º RollingUpdate éç¨‹çš„è¨­å®šï¼Œæ¥ä¸‹ä¾†ä¸€æ¨£èªªæ˜ä¸€ä¸‹å…©å€‹è¨­å®šçš„åŠŸèƒ½ï¼š&lt;/p>
&lt;p>&lt;code>macSurge&lt;/code>ï¼šä»£è¡¨ ReplicaSet å¯ä»¥ç”¢ç”Ÿæ¯” Deployment è¨­å®šä¸­çš„ &lt;code>replica&lt;/code> æ‰€è¨­å®šçš„æ•¸é‡é‚„å¤šå¹¾å€‹å‡ºä¾†ï¼Œå¤šæ–°å¢ Pod çš„å¥½è™•æ˜¯åœ¨ RollingUpdate éç¨‹ä¸­å¯ä»¥æ¸›å°‘èˆŠå…§å®¹é¡¯ç¤ºåœ¨é é¢çš„æ©Ÿç‡ã€‚&lt;/p>
&lt;p>&lt;code>macUnavailable&lt;/code>ï¼šä»£è¡¨åœ¨ RollingUpdate éç¨‹ä¸­ï¼Œå¯ä»¥å…è¨±å¤šå°‘çš„ Pod ç„¡æ³•ä½¿ç”¨ï¼Œå‡è¨­ &lt;code>macSurge&lt;/code> è¨­å®šé 0ï¼Œ&lt;code>maxUnavailable&lt;/code> ä¹Ÿè¦è¨­å®šé 0ã€‚&lt;/p>
&lt;br>
&lt;ul>
&lt;li>Recreate&lt;/li>
&lt;/ul>
&lt;p>å…ˆé€šçŸ¥ç•¶å‰ ReplicaSet æŠŠèˆŠçš„ Pod ç æ‰å†ç”¢ç”Ÿæ–°çš„ ReplicaSet ä¸¦æ§åˆ¶æ–°å…§å®¹çš„ Podï¼Œç”±æ–¼å…ˆç æ‰ Pod æ‰å»ºç«‹æ–°çš„ Pod ï¼Œæ‰€ä»¥ä¸­é–“æœ‰ä¸€æ®µæ™‚é–“ä¼ºæœå™¨æœƒç„¡æ³•é€£ç·šã€‚&lt;/p>
&lt;p>ä¹Ÿå› ç‚º Recreate æœƒç æ‰é‡å»ºï¼Œå› æ­¤ Recreate ç„¡æ³•åƒ RollingUpdate è¨­å®š &lt;code>maxSurge&lt;/code> ä»¥åŠ &lt;code>macUnavailable&lt;/code>ã€‚&lt;/p>
&lt;br>
&lt;p>è¬›å®Œ Deployment çš„æ›´æ–°æµç¨‹è¨­å®šå¾Œï¼Œæ¥ä¸‹ä¾†è¦è¬› Deployment å®Œæˆæ›´æ–°å¾Œçš„è¨­å®šï¼Œé€™é‚Šæœ‰å…©ç¨®è¨­å®šï¼š&lt;/p>
&lt;ul>
&lt;li>minReadySeconds&lt;/li>
&lt;/ul>
&lt;p>&lt;code>minReadySeconds&lt;/code> ä»£è¡¨ç•¶æ–°çš„ Pod å»ºç«‹å¥½ä¸¦ä¸”é‹è¡Œçš„ container æ²’æœ‰ crash çš„æƒ…æ³ä¸‹ï¼Œæœ€å°‘éœ€è¦å¤šå°‘æ™‚é–“å¯ä»¥é–‹å§‹æ¥å— Requestï¼Œé è¨­ç‚º 0 ç§’ï¼Œä»£è¡¨ç•¶ Pod ä¸€è¢«å»ºç«‹èµ·ä¾†ï¼Œå°±å¯ä»¥é¦¬ä¸Šé–‹å§‹æ¥å— Requestï¼Œå‡è¨­ä»Šå¤© container åœ¨å‰›é‹è¡Œçš„æ™‚å¾Œéœ€è¦èŠ±æ™‚é–“åšåˆå§‹åŒ–ï¼Œé€™æ™‚å€™å°±å¯ä»¥åˆ©ç”¨ &lt;code>minReadySeconds&lt;/code> è®“æ­¤ Pod ä¸æœƒé¦¬ä¸Šæ¥å—åˆ° Request ï¼Œé€™å€‹æ˜¯é¸å¡«çš„è¨­å®šã€‚&lt;/p>
&lt;br>
&lt;ul>
&lt;li>revisionHistoryLimit&lt;/li>
&lt;/ul>
&lt;p>æ¯æ¬¡ Deployment åœ¨é€²è¡Œæ›´æ–°çš„æ™‚å€™ï¼Œéƒ½æœƒç”¢ç”Ÿä¸€å€‹æ–°çš„ ReplicaSet ç”¨ä¾†é€²è¡Œç‰ˆæœ¬æ§åˆ¶ï¼Œåœ¨ Deployment ä¸­é€™å€‹å°ˆæœ‰åç¨±ç‚º &lt;code>revision&lt;/code>ï¼Œæ‰€ä»¥é€™å€‹è¨­å®šå°±æ˜¯è¦è¨­å®šæœ€å¤šåªæœƒæœ‰å¤šå°‘å€‹ &lt;code>revision&lt;/code>ï¼Œé€™å€‹ä¹Ÿæ˜¯é¸å¡«çš„è¨­å®šã€‚&lt;/p>
&lt;br>
&lt;h3>Deployment å»ºç«‹&lt;span class="hx-absolute -hx-mt-20" id="deployment-å»ºç«‹">&lt;/span>
&lt;a href="#deployment-%e5%bb%ba%e7%ab%8b" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>è€æ¨£å­ï¼Œä½¿ç”¨ &lt;code>apply&lt;/code> ä¾†å»ºç«‹ Deploymentï¼Œæˆ‘å€‘å¯ä½¿ç”¨ &lt;code>kubectl get deploy&lt;/code> ä¾†æŸ¥çœ‹æ˜¯å¦å»ºç«‹æˆåŠŸï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>$ kubectl get deploy
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>NAME READY UP-TO-DATE AVAILABLE AGE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubernetes-deployment 3/3 &lt;span style="color:#ae81ff">3&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span> 8m31s&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;p>ç”±æ–¼ Deployment ç›´æ¥ç®¡ç† ReplcaSetï¼Œå› æ­¤æˆ‘å€‘å¯ä»¥æŸ¥çœ‹ ReplcaSet æ˜¯å¦ä¹Ÿæœ‰è¢«å»ºç«‹èµ·ä¾†ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>$ kubectl get rs
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>NAME DESIRED CURRENT READY AGE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubernetes-deployment-dc5c59fdb &lt;span style="color:#ae81ff">3&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span> 10m&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>å¯ä»¥çœ‹åˆ° ReplcaSet å¾Œé¢æœƒè‡ªå‹•åŠ ä¸Šä¸€å°æ®µäº‚æ•¸ï¼Œé€™é‚Šæ˜¯ Deployment åœ¨å»ºç«‹ ReplicaSet çš„æ™‚å€™åŠ é€²å»çš„ï¼Œé€™æ¨£ä¹‹å¾Œå¯ä»¥æ›´æ–¹ä¾¿çš„åˆ©ç”¨ ReplcaSet é€²è¡Œ rollback çš„å‹•ä½œã€‚&lt;/p>
&lt;br>
&lt;p>ç”±æ–¼ ReplicaSet æœƒç›´æ¥ç®¡ç† Podï¼Œå› æ­¤æˆ‘å€‘ä¹Ÿå¯ä»¥æŸ¥çœ‹ Pod æ˜¯å¦æœ‰è¢«å»ºç«‹èµ·ä¾†ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>$ kubectl get po
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubernetes-deployment-dc5c59fdb-cjbz6 1/1 Running &lt;span style="color:#ae81ff">0&lt;/span> 12m
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubernetes-deployment-dc5c59fdb-mjvd7 1/1 Running &lt;span style="color:#ae81ff">0&lt;/span> 12m
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubernetes-deployment-dc5c59fdb-r92zt 1/1 Running &lt;span style="color:#ae81ff">0&lt;/span> 11m&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;p>é‚£æˆ‘å€‘ç”¨ &lt;code>minikube dashboard&lt;/code> ä¾†æŸ¥çœ‹ä¸€ä¸‹ï¼š&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/DeploymentReplicaSet.png"
alt="minikube dashboard æŸ¥çœ‹ Deployment èˆ‡ ReplicaSet" width="1200">&lt;figcaption>
&lt;p>minikube dashboard æŸ¥çœ‹ Deployment èˆ‡ ReplicaSet&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>Deployment çš„æœ€å¾Œè¦ä¾†èªªçš„æ˜¯è¦å¦‚ä½•æ›´æ–°åº•ä¸‹çš„ Pod å‘¢ï¼Œå¤§å®¶å°±æ¥è‘—å¾€ä¸‹çœ‹å›‰ï¼&lt;/p>
&lt;h3>å¦‚ä½•æ›´æ–° Deployment å…§éƒ¨çš„ Pod&lt;span class="hx-absolute -hx-mt-20" id="å¦‚ä½•æ›´æ–°-deployment-å…§éƒ¨çš„-pod">&lt;/span>
&lt;a href="#%e5%a6%82%e4%bd%95%e6%9b%b4%e6%96%b0-deployment-%e5%85%a7%e9%83%a8%e7%9a%84-pod" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>å¤§å®¶éƒ½çŸ¥é“ Pod æ˜¯ Kubernetes æœ€å°çš„é‹è¡Œå–®ä½ï¼Œæ‰€ä»¥æ›´æ–° Pod çš„æ„æ€å°±æ˜¯æŠŠå…§éƒ¨é‹è¡Œçš„ container é€²è¡Œæ›´æ–°ï¼Œä¹Ÿå°±æ˜¯èªªæˆ‘å€‘åªè¦æ›´æ–° Pod çš„ image å°±å¯ä»¥é †åˆ©çš„è®“ Pod é‹è¡Œæœ€æ–°çš„å…§å®¹ï¼ŒDeployment å°±æ˜¯é‹ç”¨é€™å€‹åŸç†æ‰é€²è¡Œ Pod çš„å…§å®¹æ›´æ–°ï¼Œæ–¹æ³•ä¹Ÿå¾ˆç°¡å–®åªè¦åˆ©ç”¨ &lt;code>Set&lt;/code> é€™å€‹åƒæ•¸å°±å¯ä»¥äº†ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>kubectl set -h&lt;/code> å¯ä»¥çœ‹ &lt;code>set&lt;/code> é€™å€‹åƒæ•¸çœŸæ­£çš„ç”¨æ³•ã€‚&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/set.png"
alt="kubectl set" width="800">&lt;figcaption>
&lt;p>kubectl set&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>å¯ä»¥çœ‹åˆ° &lt;code>set&lt;/code> å¾Œé¢é‚„è¦æ¥ &lt;code>SUBCOMMAND&lt;/code>ï¼Œè€Œ &lt;code>SUBCOMMAND&lt;/code> å°±æ˜¯ &lt;code>Available Commands&lt;/code> çš„å…§å®¹ï¼Œç”±æ–¼æˆ‘å€‘è¦æ›´æ–°çš„æ˜¯ image æ‰€ä»¥é€™é‚Šçš„ &lt;code>SUBCOMMAND&lt;/code> æœƒæ˜¯ &lt;code>image&lt;/code>ï¼Œå®Œæ•´æŒ‡ä»¤æ˜¯ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>$ kubectl set image deployment/kubernetes-deployment kubernetes-demo-container&lt;span style="color:#f92672">=&lt;/span>880831ian/kubernetes-demo:v1 --record
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>deployment.apps/kubernetes-deployment image updated&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;p>ä½¿ç”¨ set ä¾†æ›´æ–° Podï¼Œæ ¼å¼æ˜¯ &lt;code>kubectl set image deployment/&amp;lt;deployment name&amp;gt; &amp;lt;pod name&amp;gt;=&amp;lt;è¦æ›´æ–°çš„ image&amp;gt;&lt;/code>ï¼Œå¾Œé¢åŠ ä¸Š &lt;code>--record&lt;/code> åƒæ•¸ï¼Œé€™æ¨£æœƒç´€éŒ„æ¯æ¬¡æ›´æ–°çš„æ™‚å€™åˆ°åº•æ›´æ–°å“ªäº›å…§å®¹ï¼Œé€™æ¨£æ—¥å¾Œè¦é€²è¡Œ rollback ä¹Ÿæœƒæ¯”è¼ƒå®¹æ˜“çŸ¥é“è¦ rollback å›å“ªå€‹ revisionï¼Œç”±æ–¼è¦é¡¯ç¤ºå·®ç•°ï¼Œæ‰€ä»¥åœ¨ &lt;a href="https://hub.docker.com/repository/docker/880831ian/kubernetes-demo" target="_blank" rel="noopener">dockerhub&lt;/a> ä¸Šåˆå¤šæ¨ä¸€å€‹ç‰ˆæœ¬ &lt;code>v1&lt;/code>ï¼Œå°‡åŸæœ¬æŸ´çŠ¬çš„åœ–ç‰‡æ”¹æˆ kubernetes logoï¼Œç­‰æ–¼æˆ‘å€‘æ›´æ–°æ˜¯å¾ &lt;code>kubernetes-demo:latest&lt;/code> æ›´æ–°è‡³ &lt;code>kubernetes-demo:v1&lt;/code>ï¼Œæˆ‘å€‘ä¾†çœ‹çœ‹å®ƒçš„è®ŠåŒ–å§ï¼&lt;/p>
&lt;br>
&lt;p>é€™æ˜¯é‚„æ²’æ›´æ–° Pod å‰çš„ Deployment èˆ‡ ReplicaSetï¼š&lt;/p>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/DeploymentReplicaSet.png"
alt="Deployment èˆ‡ ReplicaSet" width="1200">&lt;figcaption>
&lt;p>Deployment èˆ‡ ReplicaSet&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>æˆ‘å€‘ç”¨ set ä¸‹å®Œæ›´æ–°æŒ‡ä»¤å¾Œï¼Œå¯ä»¥æŸ¥çœ‹ ReplicaSet ä»¥åŠ Pod åœ¨æ›´æ–°éç¨‹ä¸­çš„è®ŠåŒ–ï¼š&lt;/p>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/set-1.png"
alt="ReplicaSet ä»¥åŠ Pod åœ¨æ›´æ–°éç¨‹ä¸­çš„è®ŠåŒ–" width="1200">&lt;figcaption>
&lt;p>ReplicaSet ä»¥åŠ Pod åœ¨æ›´æ–°éç¨‹ä¸­çš„è®ŠåŒ–&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>å¯ä»¥ç™¼ç¾ strategy ç‚º RollingUpdate çš„æ™‚å€™ä¸¦ä¸æœƒæŠŠèˆŠæœ‰çš„ Pod ç§»é™¤åè€Œæœƒè®“æ–°èˆŠ Pod åŒæ™‚ä¸Šç·šï¼Œä»¥é”åˆ°ç„¡åœæ©Ÿæœå‹™çš„ä½œç”¨ï¼Œä½†é€™æ¨£åœ¨ç¶²é ä¸­å°±æœ‰å¯èƒ½æœƒåŒæ™‚å‡ºç¾æ–°èˆŠå…§å®¹ã€‚&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/set-2.png"
alt="å› ç‚º strategy ç‚º RollingUpdateï¼Œæ‰€ä»¥æœƒåŒæ™‚å‡ºç¾æ–°èˆŠå…§å®¹" width="1200">&lt;figcaption>
&lt;p>å› ç‚º strategy ç‚º RollingUpdateï¼Œæ‰€ä»¥æœƒåŒæ™‚å‡ºç¾æ–°èˆŠå…§å®¹&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>æœ€å¾Œç­‰åˆ°æ–°çš„ Pod å·²ç¶“å»ºç«‹å®Œæˆï¼Œä¸”æ­£å¸¸é‹ä½œï¼ŒReplicaSet å°±æœƒæŠŠèˆŠçš„ Pod çµ¦ç§»æ‰ï¼š&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/set-3.png"
alt="æ–°çš„ Pod å»ºç«‹æˆåŠŸï¼Œä¸¦åˆªé™¤èˆŠ Pod" width="1200">&lt;figcaption>
&lt;p>æ–°çš„ Pod å»ºç«‹æˆåŠŸï¼Œä¸¦åˆªé™¤èˆŠ Pod&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>å†æ¬¡ç€è¦½å°±å¯ä»¥ç™¼ç¾å·²ç¶“è®Šæˆæ–°çš„å…§å®¹äº†ï¼ä»£è¡¨æˆ‘å€‘å®Œæˆæ›´æ–°å‹•ä½œï½&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/set-4.png"
alt="æ›´æ–°è‡³ kubernetes-demo:v1" width="600">&lt;figcaption>
&lt;p>æ›´æ–°è‡³ kubernetes-demo:v1&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;h3>Deployment å›æœ”ç‰ˆæœ¬&lt;span class="hx-absolute -hx-mt-20" id="deployment-å›æœ”ç‰ˆæœ¬">&lt;/span>
&lt;a href="#deployment-%e5%9b%9e%e6%9c%94%e7%89%88%e6%9c%ac" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>æˆ‘å€‘è¬›å®Œæ›´æ–°å¾Œï¼Œæ¥è‘—è¦è¬›å¦‚ä½• rollback å›ä»¥å‰çš„ç‰ˆæœ¬ï¼Œé¦–å…ˆæˆ‘å€‘å¿…é ˆä½¿ç”¨ &lt;code>rollout&lt;/code> é€™å€‹åƒæ•¸ï¼Œä¸€æ¨£ä½¿ç”¨ &lt;code>kubectl rollout -h&lt;/code> å¯ä»¥æŸ¥çœ‹ rollout çš„ç”¨æ³•ï¼Œè·Ÿ &lt;code>set&lt;/code> ååˆ†ç›¸ä¼¼ã€‚&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/rollout.png"
alt="æ›´æ–°è‡³ kubernetes-demo:v1" width="800">&lt;figcaption>
&lt;p>æ›´æ–°è‡³ kubernetes-demo:v1&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>ç”±æ–¼æˆ‘å€‘é€™é‚Šè¦ rollback ï¼Œæ‰€ä»¥ &lt;code>SUBCOMMAND&lt;/code> æœƒä½¿ç”¨ &lt;code>undo&lt;/code>ï¼Œæˆ‘å€‘ä¸Šé¢æœ‰ç”¨ &lt;code>--record&lt;/code> å¯ä»¥æŸ¥çœ‹è¦ rollback çš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥æˆ‘å€‘é€™é‚Šå¯«æ³•æœƒé•·åƒé€™æ¨£ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>$ kubectl rollout undo deployment/kubernetes-deployment --to-revision&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>deployment.apps/kubernetes-deployment rolled back&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>æ ¼å¼æ˜¯ &lt;code>kubectl rollout undo deployment/&amp;lt;deployment name&amp;gt; --to-revision=&amp;lt;--record ç‰ˆæœ¬&amp;gt;&lt;/code>&lt;/p>
&lt;br>
&lt;p>å°±å¯ä»¥çœ‹åˆ°åˆå›å¾©æˆä»¥å‰çš„æŸ´çŠ¬å›‰ &amp;gt;&amp;lt;&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/Shiba-Inu-3.png"
alt="æˆåŠŸé‚„åŸæŸ´çŠ¬" width="1000">&lt;figcaption>
&lt;p>æˆåŠŸé‚„åŸæŸ´çŠ¬&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;h3>ç‚ºç”šéº¼ä¸ç”¨ Replication Controller&lt;span class="hx-absolute -hx-mt-20" id="ç‚ºç”šéº¼ä¸ç”¨-replication-controller">&lt;/span>
&lt;a href="#%e7%82%ba%e7%94%9a%e9%ba%bc%e4%b8%8d%e7%94%a8-replication-controller" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>æœ€å¾Œè¦è¨è«–çš„æ˜¯ç‚ºä»€éº¼è¦ä¸ç”¨ Replication Controller è€Œæ˜¯æ”¹ç”¨ ReplicaSet + Deploymentï¼Ÿ&lt;/p>
&lt;p>ç”±æ–¼å¯¦éš›å†ä½¿ç”¨ Kubernetes æ™‚æ¶æ§‹æœƒæ¯”ç¾åœ¨ç·´ç¿’çš„é‚„è¦è¤‡é›œï¼Œæ‰€ä»¥ç”¨ ReplicaSet è®“ selector ç”¨æ›´å½ˆæ€§çš„æ–¹å¼é¸å– Pod æœƒæ˜¯æ¯”è¼ƒå¥½çš„åšæ³•ã€‚&lt;/p>
&lt;br>
&lt;h2>ä»€éº¼æ˜¯ Stateless å’Œ Stateful&lt;span class="hx-absolute -hx-mt-20" id="ä»€éº¼æ˜¯-stateless-å’Œ-stateful">&lt;/span>
&lt;a href="#%e4%bb%80%e9%ba%bc%e6%98%af-stateless-%e5%92%8c-stateful" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;h3>Stateless&lt;span class="hx-absolute -hx-mt-20" id="stateless">&lt;/span>
&lt;a href="#stateless" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>Stateless é¡§åæ€ç¾©å°±æ˜¯ç„¡ç‹€æ…‹ï¼Œæˆ‘å€‘å¯ä»¥æƒ³æˆæˆ‘å€‘æ¯æ¬¡èˆ‡ä¼ºæœå™¨è¦è³‡æ–™çš„éç¨‹ä¸­éƒ½ä¸æœƒè¢«ä¼ºæœå™¨è¨˜éŒ„ç‹€æ…‹ï¼Œ&lt;strong>æ¯ä¸€æ¬¡çš„ Request éƒ½æ˜¯ç¨ç«‹çš„&lt;/strong>ï¼Œå½¼æ­¤æ˜¯æ²’æœ‰é—œè¯æ€§çš„ï¼Œä¹Ÿå°±æ˜¯æˆ‘å€‘ç•¶ä¸‹ç²å¾—çš„è³‡æ–™åªèƒ½ç•¶ä¸‹ä½¿ç”¨æ²’æœ‰è¾¦æ³•ä¿å­˜ï¼Œéœæ…‹ç¶²é é€šå¸¸éƒ½æ˜¯ä¸€ç¨® Stateless çš„æ‡‰ç”¨ã€‚&lt;/p>
&lt;p>èˆ‰å€‹ä¾‹å­ä¾†èªªï¼šä»Šå¤©æˆ‘æƒ³è¦æŸ¥è©¢ç«è»Šæ™‚åˆ»è¡¨ï¼Œæˆ‘å¯ä»¥è—‰ç”± Google æœå°‹ç«è»Šæ™‚åˆ»è¡¨ï¼Œä¸¦é»é¸é€£çµï¼Œæˆ–æ˜¯ç›´æ¥åœ¨ç€è¦½å™¨è¼¸å…¥ &lt;code>https://tip.railway.gov.tw/&lt;/code> ï¼Œé€™å…©ç¨®çµæœæœ€å¾Œéƒ½æœƒä¸€è‡´ï¼Œä¸¦ä¸æœƒå› ç‚ºæˆ‘çš„æ“ä½œä¸åŒè€Œç”¢ç”Ÿä¸åŒçµæœï¼Œé€™å°±æ˜¯ä¸€ç¨® Stateless çš„è¡¨ç¾ã€‚&lt;/p>
&lt;br>
&lt;h3>Stateful&lt;span class="hx-absolute -hx-mt-20" id="stateful">&lt;/span>
&lt;a href="#stateful" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>Stateful å°±æ˜¯ Stateless çš„ç›¸åï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡çš„ Request éƒ½æœƒè¢«è¨˜éŒ„ä¸‹ä¾†ï¼Œæ—¥å¾Œéƒ½å¯ä»¥é€²è¡Œå­˜å–ï¼ŒStateful æœ€å¸¸è¦‹çš„ä¾‹å­æ˜¯è³‡æ–™åº«ï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥ç†è§£æˆ Stateful èƒŒå¾Œä¸€å®šæœƒæœ‰ä¸€å€‹è² è²¬æ›´æ–°å…§å®¹çš„å„²å­˜ç©ºé–“ã€‚&lt;/p>
&lt;p>å¹¾å€‹ä¾‹å­ä¾†èªªï¼šä»Šå¤©æˆ‘å€‘æƒ³è¦æŸ¥çœ‹ Google é›²ç«¯ç¡¬ç¢Ÿçš„å…§å®¹ï¼Œæˆ‘å€‘å¿…é ˆå…ˆç™»å…¥è‡ªå·±çš„å¸³è™Ÿæ‰å¯ä»¥æŸ¥çœ‹å…§å®¹ï¼Œé€™ç¨®æœ‰æ“ä½œå…ˆå¾Œé †åºæ‰æœƒæœ‰çµæœçš„å°±æ˜¯ä¸€ç¨® Stateful çš„è¡¨ç¾ã€‚&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/stateless_ful.png"
alt="Stateless vs Stateful" width="700">&lt;figcaption>
&lt;p>Stateless vs Stateful&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>é‚£ç‚ºä»€éº¼è¦æåˆ° Stateless è·Ÿ Stateful å‘¢ï¼Ÿ&lt;/p>
&lt;p>å› ç‚ºè·Ÿ Pod æœ‰å¾ˆå¤§çš„é—œä¿‚ï¼Œåœ¨ Kubernetes ä¸­ Pod å°±å±¬æ–¼ Stateless çš„ï¼Œæˆ‘å€‘å‰é¢æœ‰æåˆ° Stateless çš„ç‰¹æ€§å°±æ˜¯æ¯æ¬¡çš„ Request éƒ½æ˜¯ç¨ç«‹çš„ï¼Œé€™æ¨£æœ‰ä¸€å€‹å¥½è™•æ˜¯å¯ä»¥å¿«é€Ÿçš„æ“´å……ã€‚&lt;/p>
&lt;p>åœ¨ &lt;a href="../k8s/#pod" >Kubernetes - åŸºæœ¬ç¯‡ä¸­çš„ Pod&lt;/a> æœ‰æåˆ°ï¼šPod æ˜¯ Kubernetes ä¸­æœ€å°çš„å–®ä½ï¼Œç”±æ–¼ Pod æ˜¯å±¬æ–¼ Stateless çš„ï¼Œå³ä¾¿ä»Šå¤©åŒä¸€ç¨®å…§å®¹çš„ Pod æœ‰å¾ˆå¤šå€‹ä¹Ÿæ²’æœ‰é—œä¿‚ï¼Œå› ç‚ºæ¯æ¬¡çš„ Request éƒ½æ˜¯ç¨ç«‹çš„ï¼Œå¤šå€‹ Pod å°±å¤šå€‹é€£ç·šçš„ç«¯é»è€Œå·²ã€‚&lt;/p>
&lt;br>
&lt;h3>Kubernetes çš„ Stateful&lt;span class="hx-absolute -hx-mt-20" id="kubernetes-çš„-stateful">&lt;/span>
&lt;a href="#kubernetes-%e7%9a%84-stateful" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>ä¸Šé¢æœ‰èªªåˆ° Kubernetes çš„ Pod æ˜¯ Stateless çš„ï¼Œé‚£é›£é“ Kubernetes æ²’æœ‰è¾¦æ³•åš Stateful æ‡‰ç”¨å—ï¼Ÿå…¶å¯¦æ˜¯å¯ä»¥çš„ï¼ŒKubernetes ç‚ºäº† Stateful æœ‰ç‰¹åˆ¥é–‹å•Ÿä¸€å€‹é¡åˆ¥å«ï¼š&lt;code>StatefulSet&lt;/code>&lt;/p>
&lt;br>
&lt;p>é€™é‚Šæœƒç°¡å–®èªªæ˜ä¸€ä¸‹ &lt;code>StatefulSet&lt;/code> çš„æ¶æ§‹ï¼š&lt;/p>
&lt;h3>StatefulSet&lt;span class="hx-absolute -hx-mt-20" id="statefulset">&lt;/span>
&lt;a href="#statefulset" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>StatefulSet ä¸€å…±æœ‰å…©å€‹é‡è¦çš„éƒ¨åˆ†ï¼š&lt;/p>
&lt;ul>
&lt;li>Persistent Volume Claim&lt;/li>
&lt;/ul>
&lt;p>å‰é¢æœ‰èªªåˆ° Stateful èƒŒå¾Œæœ‰ä¸€å€‹æ›´æ–°å…§å®¹çš„å„²å­˜ç©ºé–“ï¼Œåœ¨ Kubernetes ä¸­è² è²¬ç®¡ç†å„²å­˜çš„ç©ºé–“æ˜¯ &lt;code>Volume&lt;/code>ï¼Œä½œç”¨èˆ‡ Docker çš„ Volume å¹¾ä¹ä¸€æ¨¡ä¸€æ¨£ï¼Œä½† Kuberntes çš„ Volume åªæ˜¯åœ¨ Pod ä¸­æš«æ™‚å­˜æ”¾çš„å„²å­˜ç©ºé–“ï¼Œç•¶ Pod ç§»é™¤ä¹‹å¾Œé€™å€‹å„²å­˜ç©ºé–“å°±æœƒæ¶ˆå¤±ï¼Œç‚ºäº†è¦åœ¨ Kubernetes ä¸­å»ºç«‹ä¸€å€‹åƒæ˜¯è³‡æ–™åº«å¯ä»¥æ°¸ä¹…å„²å­˜çš„ç©ºé–“ï¼Œé€™å€‹ Volume ä¸èƒ½è¢«åŒ…å«åœ¨ Pod ä¸­ï¼Œè€Œé€™å€‹å°±æ˜¯ &lt;code>Persistent Volume (PV)&lt;/code>ã€‚&lt;/p>
&lt;p>Persistent Volume Claim (PVC) å°±æ˜¯è² è²¬é€£æ¥ Persistent Volume (PV) çš„ç‰©ä»¶ï¼Œæ‰€ä»¥å¯ä»¥æƒ³åƒä¸€ä¸‹ä»Šå¤©æœ‰å¤šå°‘çš„ Persistent Volume å°±æœƒæœ‰å¤šå°‘çš„ Persistent Volume Claimã€‚&lt;/p>
&lt;br>
&lt;ul>
&lt;li>Headless Service&lt;/li>
&lt;/ul>
&lt;p>é‚„è¨˜å¾—åœ¨ &lt;a href="#%e4%bb%80%e9%ba%bc%e6%98%af-service-" >Service&lt;/a> æœ‰æåˆ° ClusterIP å—ï¼Ÿå…¶å¯¦æ¯å€‹ Service éƒ½æœƒæœ‰è‡ªå·±ä¸€çµ„çš„ ClusterIP (ExternalName å½¢å¼çš„é™¤å¤–)ï¼Œæ‰€ä»¥ Headless çš„æ„æ€å…¶å¯¦å°±æ˜¯ä¸è¦æœ‰ ClusterIPï¼Œæ–¹æ³•ä¹Ÿå¾ˆç°¡å–®ï¼Œç›´æ¥åœ¨è¨­å®šæª”ä¸­åŠ å…¥ &lt;code>ClusterIP: None&lt;/code> å°±å¯ä»¥äº†ï¼&lt;/p>
&lt;p>é€™éº¼åšæœ‰ä»€éº¼å¥½è™•ï¼Ÿç”±æ–¼ Headless Service ä¸¦æ²’æœ‰ç›´æ¥è·Ÿ Pod æœ‰å°æ‡‰é—œä¿‚ï¼Œå› æ­¤ Service æœ¬èº«æ²’æœ‰ ClusterIPï¼Œæ‰€ä»¥ Kubernetes å…§éƒ¨åœ¨æºé€šæ™‚å°±æ²’æœ‰è¾¦æ³•æŠŠæˆ‘å€‘è¨­å®šå¥½çš„ Service åç¨±é€²è¡Œ IP è½‰æ›ï¼Œä¸é Headless Service æœƒå°‡å…§éƒ¨çš„ Pod çš„éƒ½å»ºç«‹å±¬æ–¼è‡ªå·±çš„ domainï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥è‡ªç”±çš„é¸æ“‡è¦é€£æ¥åˆ°å“ªä¸€å€‹ Podã€‚&lt;/p>
&lt;p>é€™æ™‚å€™ä½ æœƒèªªå¯ä»¥ç”¨æ‰‹å‹•ä¾†é€£æ¥å‘€ï¼Ÿä½†å› ç‚º Service ä¸€èˆ¬æ˜¯è·Ÿè‘— Pod çš„ Label ï¼Œæ‰€ä»¥ä¸€å€‹ Service éƒ½æœƒé€£æ¥è¨±å¤šå€‹ Podï¼Œé€™æ¨£æˆ‘å€‘å°±æ²’æœ‰è¾¦æ³•é‡å°æŸå€‹ Pod ä¾†åšäº‹æƒ…ï¼Œæ‰€ä»¥ Headless Service åœ¨ Stateful ä¸­ä¹Ÿæœƒè¢«å»ºç«‹ã€‚&lt;/p>
&lt;br>
&lt;p>æˆ‘å€‘ä¸€ç›´å¼·èª¿èªª Kubernetes æœ€å°çš„å–®ä½æ˜¯ Podï¼Œå³ä¾¿æ˜¯ StatefulSet ä¹Ÿæœƒæœ‰ Podï¼Œåªæ˜¯é€™å€‹ Pod æœƒæ­¸ StatefulSet ç®¡ç†ï¼Œç¶œåˆä¸Šé¢æ‰€è¿°å¯ä»¥çŸ¥é“ä¸€å€‹ StatefulSet è£¡é¢é™¤äº†åŸ·è¡Œçš„ Pod å¤–é‚„æœƒæœ‰è² è²¬è·Ÿ Persistent Volume é€£æ¥çš„ Persistent Volume Claimï¼Œæ•´é«”çš„ StatefulSet æ¶æ§‹æœƒé•·å¾—åƒé€™æ¨£ï¼š&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/StatefulSet.png"
alt="Kubernetes StatefulSet æ¶æ§‹" width="300">&lt;figcaption>
&lt;p>Kubernetes StatefulSet æ¶æ§‹&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>åŸºæœ¬ä¸Š StatefulSet ä¸­åœ¨ Pod çš„ç®¡ç†ä¸Šéƒ½æ˜¯èˆ‡ Deployment ç›¸åŒï¼ŒåŸºæ–¼ç›¸åŒçš„ container spec ä¾†é€²è¡Œ; è€Œå…¶ä¸­çš„å·®åˆ¥åœ¨æ–¼ &lt;strong>StatefulSet controller æœƒç‚ºæ¯ä¸€å€‹ Pod ç”¢ç”Ÿä¸€å€‹å›ºå®šè­˜åˆ¥è³‡è¨Šï¼Œä¸æœƒå› ç‚º Pod æ”¹è®Šå¾Œè€Œæœ‰æ‰€è®Šå‹•&lt;/strong>ã€‚&lt;/p>
&lt;br>
&lt;h3>ä»€éº¼æ™‚å€™éœ€è¦ä½¿ç”¨ StatefulSet ?&lt;span class="hx-absolute -hx-mt-20" id="ä»€éº¼æ™‚å€™éœ€è¦ä½¿ç”¨-statefulset-">&lt;/span>
&lt;a href="#%e4%bb%80%e9%ba%bc%e6%99%82%e5%80%99%e9%9c%80%e8%a6%81%e4%bd%bf%e7%94%a8-statefulset-" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>å¦‚ä½•ç ”åˆ¤å“ªäº› Application éœ€è¦ä½¿ç”¨ StatefulSet ä¾†éƒ¨ç½²ï¼Ÿåªè¦ç¬¦åˆä»¥ä¸‹æ¢ä»¶ï¼Œå°±éœ€è¦ä½¿ç”¨ StatefulSet ä¾†é€²è¡Œéƒ¨ç½²&lt;/p>
&lt;ul>
&lt;li>éœ€è¦ç©©å®š &amp;amp; å”¯ä¸€çš„ç¶²è·¯è­˜åˆ¥ (pod æ”¹è®Šå¾Œçš„ pod name &amp;amp; hostname éƒ½ä¸æœƒè®Šå‹•)&lt;/li>
&lt;li>éœ€è¦ç©©å®šçš„ Persistent storage (pod æ”¹è®Šå¾Œé‚„æ˜¯èƒ½å­˜å–ç›¸åŒçš„è³‡æ–™ï¼ŒåŸºæœ¬ä¸Šç”¨ PVC å°±å¯ä»¥è§£æ±º)&lt;/li>
&lt;li>éƒ¨ç½² &amp;amp; æ“´å±•çš„æ™‚å€™ï¼Œæ¯å€‹ Pod çš„ç”¢ç”Ÿéƒ½æ˜¯æœ‰å…¶é †åºä¸”é€ä¸€æ…¢æ…¢å®Œæˆçš„&lt;/li>
&lt;li>é€²è¡Œæ›´æ–°æ“ä½œæ™‚ï¼Œä¹Ÿæ˜¯èˆ‡ä¸Šé¢çš„éœ€æ±‚ç›¸åŒ&lt;/li>
&lt;/ul>
&lt;br>
&lt;h3>StatefulSet æœ‰ä»€éº¼é™åˆ¶ï¼Ÿ&lt;span class="hx-absolute -hx-mt-20" id="statefulset-æœ‰ä»€éº¼é™åˆ¶">&lt;/span>
&lt;a href="#statefulset-%e6%9c%89%e4%bb%80%e9%ba%bc%e9%99%90%e5%88%b6" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;ul>
&lt;li>v1.5 ä»¥å‰ç‰ˆæœ¬ä¸æ”¯æ´ï¼Œv1.5 ~ v1.9 ä¹‹é–“æ˜¯ betaï¼Œv1.9 å¾Œæ­£å¼æ”¯æ´&lt;/li>
&lt;li>storage çš„éƒ¨åˆ†ä¸€å®šè¦ç¶å®š PVCï¼Œä¸¦ç¶å®šåˆ°ç‰¹å®šçš„ StorageClass or é å…ˆé…ç½®å¥½çš„ Persistent Volumeï¼Œç¢ºä¿ Pod è¢«åˆªé™¤å¾Œè³‡æ–™ä¾ç„¶å­˜åœ¨ã€‚&lt;/li>
&lt;li>éœ€è¦é¡å¤–å®šç¾©ä¸€å€‹ Headless Service èˆ‡ StatefulSet æ­é…ï¼Œç¢ºä¿ Pod æœ‰å›ºå®šçš„ network identityã€‚&lt;/li>
&lt;/ul>
&lt;div class="hx-overflow-x-auto hx-mt-6 hx-flex hx-rounded-lg hx-border hx-py-2 ltr:hx-pr-4 rtl:hx-pl-4 contrast-more:hx-border-current contrast-more:dark:hx-border-current hx-border-orange-100 hx-bg-orange-50 hx-text-orange-800 dark:hx-border-orange-400/30 dark:hx-bg-orange-400/20 dark:hx-text-orange-300">
&lt;div class="ltr:hx-pl-3 ltr:hx-pr-2 rtl:hx-pr-3 rtl:hx-pl-2">&lt;/div>
&lt;div class="hx-w-full hx-min-w-0 hx-leading-7">
&lt;div class="hx-mt-6 hx-leading-7 first:hx-mt-0">&lt;p>network identityï¼š&lt;/p>
&lt;p>ä»£è¡¨å¯ä»¥ç›´æ¥é€é domain name ç›´æ¥å–çš„ Pod IP; å¯¦ç¾çš„æ–¹æ³•å‰‡æ˜¯éƒ¨ç½²ä¸€å€‹ ClusterIP=None çš„ Serviceï¼Œè®“ Cluster å…§éƒ¨å­˜å– Service æ™‚ï¼Œå¯ä»¥ç›´æ¥é€£åˆ° Pod è€Œä¸æ˜¯ Service IPã€‚&lt;/p>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;br>
&lt;h3>StatefulSet å¯«æ³•&lt;span class="hx-absolute -hx-mt-20" id="statefulset-å¯«æ³•">&lt;/span>
&lt;a href="#statefulset-%e5%af%ab%e6%b3%95" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>è¦å¯«ä¸€å€‹ StatefulSet ï¼Œæœ‰å¹¾å€‹é‡è¦çš„éƒ¨åˆ†å¿…é ˆæ¶µè“‹ï¼š&lt;/p>
&lt;ol>
&lt;li>Application &amp;amp; Persistent Volume Claim&lt;/li>
&lt;li>Headless Service&lt;/li>
&lt;li>&lt;code>.spec.selector&lt;/code> æ‰€å®šç¾©çš„å…§å®¹ (matchLabels) å¿…é ˆèˆ‡ &lt;code>.spec.template.metadata.labels&lt;/code> ç›¸åŒã€‚&lt;/li>
&lt;/ol>
&lt;p>å…¶ä»–éƒ¨åˆ†éƒ½èˆ‡ &lt;code>Deployment&lt;/code> å¹¾ä¹ç›¸åŒ ~&lt;/p>
&lt;br>
&lt;p>æˆ‘å€‘å…ˆä¾†çœ‹çœ‹è¦æ€éº¼å®šç¾© Application &amp;amp; Persistent Volume Claim (æŠŠ Service è·Ÿ StatefulSet å¯«åœ¨ä¸€èµ·) (&lt;a href="https://github.com/880831ian/kubernetes-tutorial/tree/master/StatefulSet" target="_blank" rel="noopener">Github ç¨‹å¼ç¢¼é€£çµ&lt;/a>)&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">apiVersion&lt;/span>: &lt;span style="color:#ae81ff">v1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">kind&lt;/span>: &lt;span style="color:#ae81ff">Service&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">metadata&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">nginx&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">labels&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">app&lt;/span>: &lt;span style="color:#ae81ff">nginx&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">spec&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ports&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">port&lt;/span>: &lt;span style="color:#ae81ff">80&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">web&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">clusterIP&lt;/span>: &lt;span style="color:#ae81ff">None&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">selector&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">app&lt;/span>: &lt;span style="color:#ae81ff">nginx&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>---
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">apiVersion&lt;/span>: &lt;span style="color:#ae81ff">apps/v1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">kind&lt;/span>: &lt;span style="color:#ae81ff">StatefulSet&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">metadata&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">web&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">spec&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">serviceName&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;nginx&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">replicas&lt;/span>: &lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">selector&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">matchLabels&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">app&lt;/span>: &lt;span style="color:#ae81ff">nginx&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">template&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">metadata&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">labels&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">app&lt;/span>: &lt;span style="color:#ae81ff">nginx&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">spec&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">containers&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">nginx&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">image&lt;/span>: &lt;span style="color:#ae81ff">k8s.gcr.io/nginx-slim:0.8&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ports&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">containerPort&lt;/span>: &lt;span style="color:#ae81ff">80&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">web&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">volumeMounts&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">www&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">mountPath&lt;/span>: &lt;span style="color:#ae81ff">/usr/share/nginx/html&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">volumeClaimTemplates&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">metadata&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">www&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">spec&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">accessModes&lt;/span>: [&lt;span style="color:#e6db74">&amp;#34;ReadWriteOnce&amp;#34;&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">resources&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">requests&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">storage&lt;/span>: &lt;span style="color:#ae81ff">1Gi&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;p>æˆ‘å€‘å…ˆæ‰“é–‹ä¸€å€‹ Terminal ä¾†è§€å¯Ÿ StatefulSet å‰µå»º Pod çš„éç¨‹ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>$ kubectl get pods -w -l app&lt;span style="color:#f92672">=&lt;/span>nginx&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;p>æˆ‘å€‘ä¸€æ¨£ä½¿ç”¨ &lt;code>kubectl apply&lt;/code> ä¾†å‰µå»ºå®šç¾©åœ¨ &lt;code>web.yaml&lt;/code> ä¸­çš„ Headless Service å’Œ StatefulSetã€‚&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>$ kubectl apply -f web.yaml&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;p>æˆ‘å€‘çœ‹ä¸€ä¸‹å‰›å‰›çš„ StatefulSet å‰µå»º Pod çš„éç¨‹ï¼Œå¯ä»¥ç™¼ç¾æˆ‘å€‘æ“æœ‰ N çš„å‰¯æœ¬çš„ StatefulSet ï¼Œ Pod éƒ¨ç½²æ™‚æœƒæŒ‰ç…§ {0 &amp;hellip;. N-1} çš„åºè™Ÿä¾åºå‰µå»ºã€‚&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>web-0 0/1 Pending &lt;span style="color:#ae81ff">0&lt;/span> 0s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>web-0 0/1 Pending &lt;span style="color:#ae81ff">0&lt;/span> 0s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>web-0 0/1 ContainerCreating &lt;span style="color:#ae81ff">0&lt;/span> 0s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>web-0 1/1 Running &lt;span style="color:#ae81ff">0&lt;/span> 2s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>web-1 0/1 Pending &lt;span style="color:#ae81ff">0&lt;/span> 0s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>web-1 0/1 Pending &lt;span style="color:#ae81ff">0&lt;/span> 0s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>web-1 0/1 ContainerCreating &lt;span style="color:#ae81ff">0&lt;/span> 0s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>web-1 1/1 Running &lt;span style="color:#ae81ff">0&lt;/span> 3s&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>å¯ä»¥ç™¼ç¾ web-1 Pod æ˜¯åœ¨ web-0 Pod è™•åœ¨ Running ç‹€æ…‹æ‰æœƒè¢«å•Ÿå‹•ã€‚æ­¤å¤–ï¼Œå¯ä»¥ç™¼ç¾å°±è·Ÿæˆ‘å€‘ä¸Šé¢è¬›çš„ä¸€æ¨£ï¼ŒStatefulSet ä¸­çš„ Pod æ“æœ‰ä¸€å€‹ç¨ä¸€ç„¡äºŒçš„èº«ä»½æ¨™è¨˜ï¼ŒåŸºæ–¼ StatefulSet æ§åˆ¶å™¨åˆ†é…çµ¦æ¯å€‹ Pod çš„å”¯ä¸€é †åºç´¢å¼•ã€‚&lt;/p>
&lt;p>Pod åç¨±çš„æ ¼å¼æ˜¯ &amp;lt; statefulset name &amp;gt;-&amp;lt; ordinal index &amp;gt;ï¼Œåƒæˆ‘å€‘ &lt;code>web&lt;/code> é€™å€‹ StatefulSet æœ‰å…©å€‹å‰¯æœ¬ï¼Œæ‰€ä»¥å®ƒå‰µå»ºäº†å…©å€‹ Podï¼š&lt;code>web-0&lt;/code>ã€&lt;code>web-1&lt;/code>ã€‚&lt;/p>
&lt;br>
&lt;h3>StatefulSet æ¸¬è©¦&lt;span class="hx-absolute -hx-mt-20" id="statefulset-æ¸¬è©¦">&lt;/span>
&lt;a href="#statefulset-%e6%b8%ac%e8%a9%a6" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>æˆ‘å€‘çŸ¥é“ StatefulSet å®ƒæœ‰ä½¿ç”¨ç©©å®šçš„ç¶²è·¯èº«ä»½ä»¥åŠ PV çš„æ°¸ä¹…å„²å­˜ï¼Œé‚£æˆ‘å€‘å°±åˆ†åˆ¥ä¾†æ¸¬è©¦çœ‹çœ‹ï¼š&lt;/p>
&lt;h4>StatefulSet ç©©å®šçš„ç¶²è·¯èº«ä»½&lt;span class="hx-absolute -hx-mt-20" id="statefulset-ç©©å®šçš„ç¶²è·¯èº«ä»½">&lt;/span>
&lt;a href="#statefulset-%e7%a9%a9%e5%ae%9a%e7%9a%84%e7%b6%b2%e8%b7%af%e8%ba%ab%e4%bb%bd" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h4>&lt;p>æˆ‘å€‘å…ˆä½¿ç”¨ &lt;code>kubectl exec&lt;/code> åœ¨æ¯å€‹ Pod ä¸­åŸ·è¡Œ &lt;code>hostname&lt;/code>&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>$ &lt;span style="color:#66d9ef">for&lt;/span> i in &lt;span style="color:#ae81ff">0&lt;/span> 1; &lt;span style="color:#66d9ef">do&lt;/span> kubectl exec &lt;span style="color:#e6db74">&amp;#34;web-&lt;/span>$i&lt;span style="color:#e6db74">&amp;#34;&lt;/span> -- sh -c &lt;span style="color:#e6db74">&amp;#39;hostname&amp;#39;&lt;/span>; &lt;span style="color:#66d9ef">done&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>web-0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>web-1&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;p>å†ä½¿ç”¨ &lt;code>kubectl run&lt;/code> ä¾†é‹è¡Œä¸€å€‹æä¾› &lt;code>nslookup&lt;/code> å‘½ä»¤çš„å®¹å™¨ï¼Œé€šéå° Pod çš„ä¸»æ©ŸååŸ·è¡Œ &lt;code>nslookup&lt;/code>ï¼Œæˆ‘å€‘å¯ä»¥æª¢æŸ¥ä»–åœ¨é›†ç¾¤å…§éƒ¨çš„ DNS ä½ç½®ã€‚&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>$ kubectl run -i --tty --image busybox:1.28 dns-test --restart&lt;span style="color:#f92672">=&lt;/span>Never --rm /bin/sh&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;p>å•Ÿå‹•ä¸€å€‹æ–°çš„ shell ï¼Œä¸¦é‹è¡Œ &lt;code>nslookup web-0.nginx &lt;/code> è·Ÿ &lt;code>nslookup web-1.nginx&lt;/code>ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>/ &lt;span style="color:#75715e"># nslookup web-0.nginx&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Server: 10.96.0.10
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Address 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Name: web-0.nginx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Address 1: 172.17.0.5 web-0.nginx.default.svc.cluster.local
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>/ &lt;span style="color:#75715e"># nslookup web-1.nginx&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Server: 10.96.0.10
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Address 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Name: web-1.nginx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Address 1: 172.17.0.6 web-1.nginx.default.svc.cluster.local&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>å¯ä»¥çœ‹åˆ° Headless Service çš„ CHANCE æŒ‡å‘ SRV è¨˜éŒ„ (è¨˜éŒ„æ¯å€‹ Running çš„ Pod)ã€‚SRV ç´€éŒ„æŒ‡å‘ä¸€å€‹åŒ…å« Pod IP ä½å€çš„è¨˜éŒ„è¡¨ã€‚&lt;/p>
&lt;br>
&lt;p>æˆ‘å€‘ä½¿ç”¨ &lt;code>kubectl delete pod -l app=nginx&lt;/code> åˆªé™¤ Pod å¾Œï¼Œæœƒç™¼ç¾ Pod çš„åºè™Ÿã€ä¸»æ©Ÿåã€SRV æ¢ç›®å’Œè¨˜éŒ„åç¨±éƒ½æ²’æœ‰æ”¹è®Šï¼&lt;/p>
&lt;br>
&lt;h4>StatefulSet æ°¸ä¹…å„²å­˜&lt;span class="hx-absolute -hx-mt-20" id="statefulset-æ°¸ä¹…å„²å­˜">&lt;/span>
&lt;a href="#statefulset-%e6%b0%b8%e4%b9%85%e5%84%b2%e5%ad%98" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h4>&lt;p>æˆ‘å€‘å…ˆæŸ¥çœ‹ &lt;code>web-0&lt;/code> è·Ÿ &lt;code>web-1&lt;/code> çš„ PersistentVolumeClaimsï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>$ kubectl get pvc -l app&lt;span style="color:#f92672">=&lt;/span>nginx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>NAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS AGE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>www-web-0 Bound pvc-e9a23104-d018-4d73-8cd9-89e5ea67f96c 1Gi RWO standard 39m
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>www-web-1 Bound pvc-00dd6c87-6d95-4d04-9c1b-49b43441f4a1 1Gi RWO standard 38m&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>StatefulSet æ§åˆ¶å™¨å‰µå»ºå…©å€‹ PersistentVolumeClaimsï¼Œç¶å®šå…©å€‹ PersistentVolumesï¼Œå› ç‚ºæˆ‘å€‘é…ç½®æ˜¯å‹•æ…‹æä¾› PersistentVolumeï¼Œæ‰€æœ‰çš„ PersistentVolume éƒ½æ˜¯è‡ªå‹•å‰µå»ºå’Œç¶å®šçš„ã€‚&lt;/p>
&lt;p>Nginx web æœå‹™å™¨é»˜èªæœƒåŠ è¼‰ä½æ–¼ &lt;code>/usr/share/nginx/html/index.html&lt;/code> çš„ index æ–‡ä»¶ã€‚å› æ­¤æˆ‘å€‘åœ¨ &lt;code>spec&lt;/code> ä¸­çš„ &lt;code>volumeMounts&lt;/code> å°‡ &lt;code>/usr/share/nginx/html&lt;/code> è³‡æ–™å¤¾ç”±ä¸€å€‹ PersistentVolume æ”¯æŒã€‚&lt;/p>
&lt;br>
&lt;p>é‚£æˆ‘å€‘å°‡ Pod ä¸»æ©Ÿåç¨±å¯«å…¥ &lt;code>index.html&lt;/code> ï¼Œå†åˆªæ‰ Pod çœ‹çœ‹å¯«å…¥å…§å®¹æ˜¯å¦é‚„æœƒå­˜åœ¨ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>$ &lt;span style="color:#66d9ef">for&lt;/span> i in &lt;span style="color:#ae81ff">0&lt;/span> 1; &lt;span style="color:#66d9ef">do&lt;/span> kubectl exec &lt;span style="color:#e6db74">&amp;#34;web-&lt;/span>$i&lt;span style="color:#e6db74">&amp;#34;&lt;/span> -- sh -c &lt;span style="color:#e6db74">&amp;#39;echo &amp;#34;$(hostname)&amp;#34; &amp;gt; /usr/share/nginx/html/index.html&amp;#39;&lt;/span>; &lt;span style="color:#66d9ef">done&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ &lt;span style="color:#66d9ef">for&lt;/span> i in &lt;span style="color:#ae81ff">0&lt;/span> 1; &lt;span style="color:#66d9ef">do&lt;/span> kubectl exec -i -t &lt;span style="color:#e6db74">&amp;#34;web-&lt;/span>$i&lt;span style="color:#e6db74">&amp;#34;&lt;/span> -- curl http://localhost/; &lt;span style="color:#66d9ef">done&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>web-0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>web-1&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;p>ç•¶æˆ‘å€‘åˆªé™¤ Pod å¾Œï¼Œå¦‚æœæ²’æœ‰ä½¿ç”¨ PersistentVolumeClaims å»ç¶å®š PersistentVolumes çš„è©±ï¼Œè³‡æ–™å°±æœƒæ¶ˆå¤±ï¼Œé‚£æˆ‘å€‘ä¾†çœ‹çœ‹æœ‰ç¶å®šçš„çµæœï¼š&lt;/p>
&lt;p>ä½¿ç”¨ &lt;code>kubectl delete pod -l app=nginx&lt;/code> åˆªé™¤ Podï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>pod &lt;span style="color:#e6db74">&amp;#34;web-0&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>pod &lt;span style="color:#e6db74">&amp;#34;web-1&amp;#34;&lt;/span> deleted&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;p>å†æ¬¡ä½¿ç”¨ &lt;code>kubectl get pod -w -l app=nginx&lt;/code> ä¾†æª¢æŸ¥ Pod çš„ç‹€æ…‹ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>web-0 0/1 ContainerCreating &lt;span style="color:#ae81ff">0&lt;/span> 0s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>web-0 1/1 Running &lt;span style="color:#ae81ff">0&lt;/span> 2s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>web-1 0/1 Pending &lt;span style="color:#ae81ff">0&lt;/span> 0s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>web-1 0/1 Pending &lt;span style="color:#ae81ff">0&lt;/span> 0s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>web-1 0/1 ContainerCreating &lt;span style="color:#ae81ff">0&lt;/span> 0s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>web-1 1/1 Running &lt;span style="color:#ae81ff">0&lt;/span> 1s&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;p>ä¸€æ¨£ä½¿ç”¨ &lt;code>for i in 0 1; do kubectl exec -i -t &amp;quot;web-$i&amp;quot; -- curl http://localhost/; done&lt;/code> ä¾†æŸ¥çœ‹ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>web-0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>web-1&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>å¯ä»¥ç™¼ç¾ &lt;code>web-0&lt;/code>ã€&lt;code>web-1&lt;/code> é›–ç„¶é‡æ–°å•Ÿå‹•ï¼Œä½†ä¾èˆŠæœƒç›£è½å®ƒå€‘ä¸»æ©Ÿåï¼Œå› ç‚ºå’Œå®ƒå€‘çš„ PersistentVolumeClaim ç›¸é—œè¯çš„ PersistentVolume è¢«é‡æ–°æ›è¼‰åˆ°äº†å„è‡ªçš„ &lt;code>volumeMount&lt;/code> ä¸Šã€‚&lt;/p>
&lt;br>
&lt;h2>ä»€éº¼æ˜¯ ConfigMap ?&lt;span class="hx-absolute -hx-mt-20" id="ä»€éº¼æ˜¯-configmap-">&lt;/span>
&lt;a href="#%e4%bb%80%e9%ba%bc%e6%98%af-configmap-" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>çœ‹åˆ° Config æ‡‰è©²æœƒè¯æƒ³åˆ°èˆ‡è¨­å®šæª”æœ‰é—œï¼Œæ²’éŒ¯ ConfigMap é€šå¸¸éƒ½æ˜¯ç”¨ä¾†å­˜æ”¾è¨­å®šæª”ç”¨çš„ï¼Œæ›å¥è©±ä¾†èªªé€™å€‹ç‰©ä»¶æœƒç›´æ¥é€£çµä¸€å€‹æˆ–å¤šå€‹æª”æ¡ˆï¼Œè€Œ ConfigMap é€šå¸¸éƒ½æ˜¯ç”¨ä¾†å­˜æ”¾åå‘éƒ¨ç½²é¢çš„è¨­å®šæª”ï¼Œåƒæ˜¯è³‡æ–™åº«çš„åˆå§‹åŒ–è¨­å®šã€nginx è¨­å®šæª”ç­‰ç­‰ï¼Œé€™ç¨®ä¸ç”¨è¢«åŒ…é€²å» image å…§ï¼Œä½†éœ€è¦è®“ container å¯ä»¥ä½¿ç”¨çš„æª”æ¡ˆã€‚&lt;/p>
&lt;br>
&lt;h3>ConfigMap ç‰¹æ€§&lt;span class="hx-absolute -hx-mt-20" id="configmap-ç‰¹æ€§">&lt;/span>
&lt;a href="#configmap-%e7%89%b9%e6%80%a7" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;ul>
&lt;li>ä¸€å€‹ ConfigMap ç‰©ä»¶å¯ä»¥æ”¾ä¸€å€‹æˆ–å¤šå€‹è¨­å®šæª”ï¼šæˆ‘å€‘ä¸Šé¢æœ‰æåˆ°å®ƒæ˜¯ç”¨ä¾†å­˜æ”¾è¨­å®šæª”ç”¨çš„ï¼Œæœƒç›´æ¥é€£æ¥è©²è¨­å®šæª”ã€‚&lt;/li>
&lt;li>ç„¡éœ€ä¿®æ”¹ç¨‹å¼ç¢¼ï¼Œå¯ä»¥æ›¿æ›ä¸åŒç’°å¢ƒçš„è¨­å®šæª”ï¼šç”±æ–¼è¨­å®šæª”éƒ½äº¤ç”± ConfigMap ç®¡ç†ï¼Œä¸¦ä¸æ˜¯åŒ…åœ¨ image å…§ï¼Œå› æ­¤å¯ä»¥è—‰ç”±ä¿®æ”¹ ConfigMap çš„æ–¹å¼ä¾†é”åˆ°ä¸ç”¨æ›´æ–° Pod å…§å®¹å°±å¯ä»¥æ›´æ›è¨­å®šæª”çš„ä½œç”¨ã€‚&lt;/li>
&lt;li>çµ±ä¸€å­˜æ”¾æ‰€æœ‰çš„è¨­å®šæª”ï¼šä¸€å€‹ ConfigMap å¯ä»¥é€£çµä¸€å€‹ä»¥ä¸Šçš„è¨­å®šæª”ï¼Œå› æ­¤ä¹Ÿå¯ä»¥å°‡è©²å°ˆæ¡ˆæœƒç”¨åˆ°çš„æ‰€æœ‰è¨­å®šæª”é€šé€šå­˜æ”¾åœ¨åŒä¸€å€‹ ConfigMap ç‰©ä»¶ä¸­é€²è¡Œç®¡ç†ã€‚&lt;/li>
&lt;/ul>
&lt;br>
&lt;h3>å¦‚ä½•å»ºç«‹ ConfigMapï¼Ÿ&lt;span class="hx-absolute -hx-mt-20" id="å¦‚ä½•å»ºç«‹-configmap">&lt;/span>
&lt;a href="#%e5%a6%82%e4%bd%95%e5%bb%ba%e7%ab%8b-configmap" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>ç”±æ–¼ ConfigMap å¯ä»¥ç›´æ¥å­˜å…¥è¨­å®šæª”ï¼Œæ‰€ä»¥æˆ‘å€‘ä»¥ç¾æœ‰è¨­å®šæª”ç‚ºåŸºæº–ï¼Œæ¥ä¸‹ä¾†è¦ç”¨ &lt;code>create&lt;/code> é€™å€‹åƒæ•¸ä¾†å»ºç«‹ ConfipMap ç‰©ä»¶å‡ºä¾†ï¼Œé€™æ™‚å¯èƒ½æœƒæƒ³ï¼Œä¹‹å‰éƒ½æ˜¯ä½¿ç”¨ &lt;code>apply&lt;/code> æ€éº¼é€™æ¬¡è¦æ”¹ç”¨ &lt;code>create&lt;/code>å‘¢ï¼ï¼Ÿ é›–ç„¶å…©è€…éƒ½æœ‰å»ºç«‹çš„æ„æ€ï¼Œä½†èƒŒå¾Œå¯¦ä½œçš„æŠ€è¡“å®Œå…¨ä¸åŒï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>create&lt;/code> ä½¿ç”¨çš„æ˜¯ &lt;a href="https://kubernetes.io/docs/tasks/manage-kubernetes-objects/imperative-config/" target="_blank" rel="noopener">Imperative Management&lt;/a>ï¼ŒImperative Management æœƒå‘Šè¨´ Kubernetes æˆ‘ç›®å‰çš„å‹•ä½œè¦åšä»€éº¼ï¼Œä¾‹å¦‚ï¼š&lt;code>create&lt;/code>ã€&lt;code>delete&lt;/code>ã€&lt;code>replace&lt;/code> æŸå€‹ç‰©ä»¶ã€‚&lt;/li>
&lt;li>&lt;code>apply&lt;/code> æ˜¯ä½¿ç”¨ &lt;a href="https://kubernetes.io/docs/tasks/manage-kubernetes-objects/declarative-config/" target="_blank" rel="noopener">Declarative Management&lt;/a>ï¼ŒDeclarative Management æ˜¯ç”¨å®£å‘Šçš„æ–¹å¼ä¾†å»ºç«‹ç‰©ä»¶ï¼Œæ›´ç™½è©±ä¸€é»å°±æ˜¯æˆ‘å¸Œæœ›é€™å€‹ç‰©ä»¶è¦é•·æ€éº¼æ¨£ï¼Œæ‰€ä»¥ &lt;code>apply&lt;/code> é€šå¸¸éƒ½æœƒæ­é… yaml æª”ï¼Œè€Œé€™ä»½ yaml æª”å°±æœƒåœ¨ &lt;code>kind&lt;/code> é€™å€‹è¨­å®šå€¼å‘Šè¨´ Kubernetes é€™å€‹ç‰©ä»¶è¦é•·æˆä»€éº¼æ¨£å­ã€‚&lt;/li>
&lt;/ul>
&lt;br>
&lt;p>å› ç‚ºæˆ‘å€‘é€™æ¬¡è¦ç›´æ¥ä½¿ç”¨ç¾æœ‰çš„è¨­å®šæª”ä¾†å»ºç«‹ ConfigMapï¼Œæ‰€ä»¥é€™æ™‚å€™ä¸èƒ½ä½¿ç”¨ &lt;code>apply&lt;/code> çš„æ–¹å¼ï¼Œåªèƒ½ä½¿ç”¨ &lt;code>create&lt;/code> ä¾†å»ºç«‹ï¼ŒæŒ‡ä»¤ä¹Ÿå¾ˆç°¡å–®ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>$ kubectl create configmap &amp;lt;configmapName&amp;gt; --from-file&lt;span style="color:#f92672">=&lt;/span>&amp;lt;filePath&amp;gt;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/configmap.png"
alt="å»ºç«‹ ConfigMap" width="1000">&lt;figcaption>
&lt;p>å»ºç«‹ ConfigMap&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>å»ºç«‹å®Œæˆä½¿ç”¨ &lt;code>get&lt;/code> ä¾†æŸ¥è©¢æ˜¯å¦æ­£ç¢ºå»ºç«‹ ConfigMapï¼š&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/configmap_1.png"
alt="ä½¿ç”¨ get æŸ¥è©¢æ˜¯å¦æ­£ç¢º ConfigMap" width="700">&lt;figcaption>
&lt;p>ä½¿ç”¨ get æŸ¥è©¢æ˜¯å¦æ­£ç¢º ConfigMap&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>æœ€å¾Œå¯ä»¥ä¸‹ &lt;code>describe&lt;/code> é€™å€‹åƒæ•¸ä¾†æŸ¥çœ‹ ConfigMap çš„å…§å®¹ï¼Œæœƒç™¼ç¾è£¡é¢å°±æ˜¯æˆ‘å€‘è¨­å®šæª”çš„å®Œæ•´å…§å®¹ï¼š&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/configmap_2.png"
alt="ä½¿ç”¨ describe æŸ¥çœ‹ ConfigMap çš„å…§å®¹" width="800">&lt;figcaption>
&lt;p>ä½¿ç”¨ describe æŸ¥çœ‹ ConfigMap çš„å…§å®¹&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;h2>ä»€éº¼æ˜¯ Secrets ?&lt;span class="hx-absolute -hx-mt-20" id="ä»€éº¼æ˜¯-secrets-">&lt;/span>
&lt;a href="#%e4%bb%80%e9%ba%bc%e6%98%af-secrets-" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>çœ‹åˆ° Secrets é€™å€‹åå­—å°±çŸ¥é“é€™æ˜¯éå¸¸æ©Ÿå¯†çš„ç‰©ä»¶ï¼Œç›¸è¼ƒæ–¼ ConfigMap æ˜¯ç”¨ä¾†å­˜æ”¾éƒ¨ç½²é¢çš„æª”æ¡ˆï¼ŒSecrets é€šå¸¸éƒ½æ˜¯ç”¨ä¾†å­˜æ©Ÿå¯†çš„è³‡æ–™ï¼Œåƒæ˜¯ä½¿ç”¨è€…å¸³è™Ÿã€SSL æ†‘è­‰ç­‰ã€‚&lt;/p>
&lt;h3>Secrets ç‰¹æ€§&lt;span class="hx-absolute -hx-mt-20" id="secrets-ç‰¹æ€§">&lt;/span>
&lt;a href="#secrets-%e7%89%b9%e6%80%a7" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>ä¸Šé¢ ConfigMap æåˆ°çš„ç‰¹æ€§ Secrets ä¸€æ¨£ï¼Œæ¯”è¼ƒç‰¹åˆ¥çš„æ˜¯ Secrets æœƒå°‡å…§éƒ¨çš„è³‡æ–™é€²è¡Œ base64 ç·¨ç¢¼ã€‚å› ç‚ºé‡æ–°ç·¨ç¢¼æ‰€ä»¥å¯ä»¥ç¢ºä¿è³‡æ–™ç›¸è¼ƒæ–¼ ConfigMap ä¸‹å®‰å…¨ä¸€äº›ï¼Œæ‰€ä»¥å»ºè­°å¦‚æœæ˜¯æ©Ÿå¯†æ€§çš„è³‡æ–™å°±å­˜åœ¨ Secrets è£¡é¢å§ï¼&lt;/p>
&lt;br>
&lt;h3>å¦‚ä½•å»ºç«‹ Secretsï¼Ÿ&lt;span class="hx-absolute -hx-mt-20" id="å¦‚ä½•å»ºç«‹-secrets">&lt;/span>
&lt;a href="#%e5%a6%82%e4%bd%95%e5%bb%ba%e7%ab%8b-secrets" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>æˆ‘å€‘ä¸€æ¨£ç”¨ç¾æœ‰çš„æª”æ¡ˆä¾†åšåŸºæº–ä½œç‚ºç¤ºç¯„ï¼Œç”±æ–¼ä¸Šé¢ ConfigMap åªå­˜å…¥ä¸€å€‹æª”æ¡ˆè€Œå·²ï¼Œæ‰€ä»¥é€™é‚Š Secrets æˆ‘å€‘æ”¹æˆå­˜å…¥å¤šå€‹æª”æ¡ˆï¼š&lt;/p>
&lt;p>ä¸€æ¨£ç”¨ &lt;code>create&lt;/code> çš„åƒæ•¸é€²è¡Œ Secrets å»ºç«‹ï¼Œä½†é€™é‚Šè¦å¤šåŠ ä¸€å€‹ &lt;code>SUBCOMMAND&lt;/code> å« &lt;code>generic&lt;/code>ï¼Œgeneric ä»£è¡¨æ„æ€æ˜¯å¾æœ¬æ©Ÿæª”æ¡ˆã€ç›®éŒ„å»ºç«‹ Secretsï¼Œæ¥ä¸‹ä¾†åªè¦ä¸‹ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>kubectl create secret generic &amp;lt;secretName&amp;gt; --from-file&lt;span style="color:#f92672">=&lt;/span>&amp;lt;filePath&amp;gt;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/secret.png"
alt="å»ºç«‹ Secrets" width="800">&lt;figcaption>
&lt;p>å»ºç«‹ Secrets&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>å»ºç«‹å®Œæˆä½¿ç”¨ &lt;code>get&lt;/code> ä¾†æŸ¥è©¢æ˜¯å¦æ­£ç¢ºå»ºç«‹ Secretsï¼š&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/secret_1.png"
alt="ä½¿ç”¨ get æŸ¥è©¢æ˜¯å¦æ­£ç¢º Secrets" width="700">&lt;figcaption>
&lt;p>ä½¿ç”¨ get æŸ¥è©¢æ˜¯å¦æ­£ç¢º Secrets&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>æœ€å¾Œä¸€æ¨£å¯ä»¥ä¸‹ &lt;code>describe&lt;/code> é€™å€‹åƒæ•¸ä¾†æŸ¥çœ‹ Secrets çš„å…§å®¹ï¼Œä½†å› ç‚ºåŠ å¯†æ‰€ä»¥ä¸æœƒé¡¯ç¤ºåŸæœ¬å…§å®¹ï¼Œåªæœƒçœ‹åˆ°çš„ç¢ºæœ‰å…©å€‹æª”æ¡ˆï¼š&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s-advanced/secret_2.png"
alt="ä½¿ç”¨ describe æŸ¥çœ‹ Secrets çš„å…§å®¹" width="700">&lt;figcaption>
&lt;p>ä½¿ç”¨ describe æŸ¥çœ‹ Secrets çš„å…§å®¹&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;h2>åƒè€ƒè³‡æ–™&lt;span class="hx-absolute -hx-mt-20" id="åƒè€ƒè³‡æ–™">&lt;/span>
&lt;a href="#%e5%8f%83%e8%80%83%e8%b3%87%e6%96%99" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>Kubernetes é‚£äº›äº‹ â€” Service ç¯‡ï¼š&lt;a href="https://medium.com/andy-blog/kubernetes-%E9%82%A3%E4%BA%9B%E4%BA%8B-service-%E7%AF%87-d19d4c6e945f" target="_blank" rel="noopener">https://medium.com/andy-blog/kubernetes-%E9%82%A3%E4%BA%9B%E4%BA%8B-service-%E7%AF%87-d19d4c6e945f&lt;/a>&lt;/p>
&lt;p>Kubernetes é‚£äº›äº‹ â€” Ingress ç¯‡ï¼ˆä¸€ï¼‰ï¼š&lt;a href="https://medium.com/andy-blog/kubernetes-%E9%82%A3%E4%BA%9B%E4%BA%8B-ingress-%E7%AF%87-%E4%B8%80-92944d4bf97d" target="_blank" rel="noopener">https://medium.com/andy-blog/kubernetes-%E9%82%A3%E4%BA%9B%E4%BA%8B-ingress-%E7%AF%87-%E4%B8%80-92944d4bf97d&lt;/a>&lt;/p>
&lt;p>Kubernetes é‚£äº›äº‹ â€” Ingress ç¯‡ï¼ˆäºŒï¼‰ï¼š&lt;a href="https://medium.com/andy-blog/kubernetes-%E9%82%A3%E4%BA%9B%E4%BA%8B-ingress-%E7%AF%87-%E4%BA%8C-559c7a41404b" target="_blank" rel="noopener">https://medium.com/andy-blog/kubernetes-%E9%82%A3%E4%BA%9B%E4%BA%8B-ingress-%E7%AF%87-%E4%BA%8C-559c7a41404b&lt;/a>&lt;/p>
&lt;p>Kubernetes é‚£äº›äº‹ â€” Stateless èˆ‡ Statefulï¼š&lt;a href="https://medium.com/andy-blog/kubernetes-%E9%82%A3%E4%BA%9B%E4%BA%8B-stateless-%E8%88%87stateful-2c68cebdd635" target="_blank" rel="noopener">https://medium.com/andy-blog/kubernetes-%E9%82%A3%E4%BA%9B%E4%BA%8B-stateless-%E8%88%87stateful-2c68cebdd635&lt;/a>&lt;/p>
&lt;p>kubernetes ReplicationControllerï¼š&lt;a href="https://kubernetes.io/docs/concepts/workloads/controllers/replicationcontroller/" target="_blank" rel="noopener">https://kubernetes.io/docs/concepts/workloads/controllers/replicationcontroller/&lt;/a>&lt;/p>
&lt;p>Kubernetes é‚£äº›äº‹ â€” Replication Controllerï¼š&lt;a href="https://medium.com/andy-blog/kubernetes-%E9%82%A3%E4%BA%9B%E4%BA%8B-replication-controller-5c8592d37083" target="_blank" rel="noopener">https://medium.com/andy-blog/kubernetes-%E9%82%A3%E4%BA%9B%E4%BA%8B-replication-controller-5c8592d37083&lt;/a>&lt;/p>
&lt;p>Kubernetes é‚£äº›äº‹ â€” Deployment èˆ‡ ReplicaSetï¼ˆä¸€ï¼‰ï¼š&lt;a href="https://medium.com/andy-blog/kubernetes-%E9%82%A3%E4%BA%9B%E4%BA%8B-deployment-%E8%88%87-replicaset-%E4%B8%80-406234a63d43" target="_blank" rel="noopener">https://medium.com/andy-blog/kubernetes-%E9%82%A3%E4%BA%9B%E4%BA%8B-deployment-%E8%88%87-replicaset-%E4%B8%80-406234a63d43&lt;/a>&lt;/p>
&lt;p>Kubernetes é‚£äº›äº‹ â€” Deployment èˆ‡ ReplicaSetï¼ˆäºŒï¼‰ï¼š&lt;a href="https://medium.com/andy-blog/kubernetes-%E9%82%A3%E4%BA%9B%E4%BA%8B-deployment-%E8%88%87-replicaset-%E4%BA%8C-f60146c878e4" target="_blank" rel="noopener">https://medium.com/andy-blog/kubernetes-%E9%82%A3%E4%BA%9B%E4%BA%8B-deployment-%E8%88%87-replicaset-%E4%BA%8C-f60146c878e4&lt;/a>&lt;/p>
&lt;p>Kubernetes é‚£äº›äº‹ â€” Deployment èˆ‡ ReplicaSetï¼ˆä¸‰ï¼‰ï¼š&lt;a href="https://medium.com/andy-blog/kubernetes-%E9%82%A3%E4%BA%9B%E4%BA%8B-deployment-%E8%88%87-replicaset-%E4%B8%89-142b2863eb94" target="_blank" rel="noopener">https://medium.com/andy-blog/kubernetes-%E9%82%A3%E4%BA%9B%E4%BA%8B-deployment-%E8%88%87-replicaset-%E4%B8%89-142b2863eb94&lt;/a>&lt;/p>
&lt;p>kubernetes Deploymentsï¼š&lt;a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" target="_blank" rel="noopener">https://kubernetes.io/docs/concepts/workloads/controllers/deployment/&lt;/a>&lt;/p>
&lt;p>[Kubernetes] StatefulSet Overviewï¼š&lt;a href="https://godleon.github.io/blog/Kubernetes/k8s-StatefulSets-Overview/" target="_blank" rel="noopener">https://godleon.github.io/blog/Kubernetes/k8s-StatefulSets-Overview/&lt;/a>&lt;/p></description></item><item><title>Kubernetes (K8s) ä»‹ç´¹ - åŸºæœ¬</title><link>https://pin-yi.me/blog/kubernetes/k8s/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://pin-yi.me/blog/kubernetes/k8s/</guid><description>
&lt;h2>ä»€éº¼æ˜¯ Kubernetes (K8s)?&lt;span class="hx-absolute -hx-mt-20" id="ä»€éº¼æ˜¯-kubernetes-k8s">&lt;/span>
&lt;a href="#%e4%bb%80%e9%ba%bc%e6%98%af-kubernetes-k8s" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>Kubernetes ä¹Ÿå¯ä»¥å« K8sï¼Œé€™å€‹åç¨±ä¾†æºå¸Œè‡˜èªï¼Œæ„æ€æ˜¯èˆµæ‰‹æˆ–æ˜¯é£›è¡Œå“¡ï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥çœ‹åˆ°å®ƒçš„ logo æ˜¯ä¸€å€‹èˆ¹èˆµçš„æ¨™èªŒï¼Œä¹‹æ‰€ä»¥å« K8s æ˜¯å› ç‚º Kubernetes çš„ k åˆ° s ä¸­é–“æœ‰ 8 çš„è‹±æ–‡å­—æ¯ï¼Œç‚ºäº†æ–¹ä¾¿ï¼Œå¤§å®¶å¸¸ä»¥é€™å€‹åç¨±ä¾†ç¨±å‘¼ä»–ï¼&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s/logo.jpg"
alt="kubernetes logo" width="200">&lt;figcaption>
&lt;p>kubernetes logo&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>Kubernetes æ˜¯ä¸€ç¨®é–‹æºå¯ç”¨ä¾†è‡ªå‹•åŒ–éƒ¨å±¬ã€æ“´å±•ä»¥åŠç®¡ç†å¤šå€‹å®¹å™¨çš„ç³»çµ±ï¼Œé©ç”¨æ–¼ç•¶å®¹å™¨æ•¸é‡å¢åŠ ï¼Œéœ€è¦ç©©å®šå®¹å™¨ç’°å¢ƒï¼Œä»¥åŠç®¡ç†è³‡æºæˆ–æ¬Šé™åˆ†é…çš„ç‹€æ³ã€‚&lt;/p>
&lt;p>æˆ‘å€‘ä¹‹å‰åœ¨ &lt;a href="../../docker/docker" >Docker ä»‹ç´¹&lt;/a> æ–‡ç« ä¸­ï¼Œå·²ç¶“æœ‰ä»‹ç´¹ä»¥å¾€å‚³çµ±è™›æ“¬æ©Ÿä»¥åŠå®¹å™¨åŒ–çš„ Docker å·®ç•°ä»¥åŠå„ªé»ï¼Œé‚£ç•¶æˆ‘å€‘åœ¨ç®¡ç†å®¹å™¨æ™‚ï¼Œå…¶ä¸­ä¸€å€‹å®¹å™¨å‡ºç¾æ•…éšœï¼Œå‰‡éœ€è¦å•Ÿå‹•å¦ä¸€å€‹å®¹å™¨ï¼Œå¦‚æœè¦ç”¨æ‰‹å‹•ï¼Œæœƒååˆ†éº»ç…©ï¼Œæ‰€ä»¥é€™æ™‚å°±æ˜¯ Kubernetes çš„å²å®³çš„åœ°æ–¹äº†ï¼ŒKubernetes æä¾›ï¼š&lt;/p>
&lt;ul>
&lt;li>æœå‹™ç™¼ç¾å’Œè² è¼‰å¹³è¡¡ï¼šK8s å¯ä»¥ä½¿ç”¨ DNS åç¨±æˆ–æ˜¯è‡ªå·±çš„ IP ä½å€ä¾†å…¬é–‹å®¹å™¨ã€‚å¦‚æœå®¹å™¨æµé‡éé«˜ï¼ŒKubernetes èƒ½å¤ ä½¿ç”¨è² è¼‰å¹³è¡¡å’Œåˆ†é…ç¶²è·¯æµé‡ï¼Œèƒ½ä½¿éƒ¨ç½²æ›´ç©©å®šã€‚&lt;/li>
&lt;li>ç·¨æ’å„²å­˜ï¼šKubernetes å…è¨±ä½¿ç”¨è‡ªå‹•æ›è¼‰ä¾†é¸æ“‡å„²å­˜ç³»çµ±ï¼Œä¾‹å¦‚ä½¿ç”¨æœ¬åœ°å„²å­˜ï¼Œæˆ–æ˜¯å…¬å…±é›²ç­‰ã€‚&lt;/li>
&lt;li>è‡ªå‹•éƒ¨ç½²ã€åˆªé™¤ï¼šå¯ä»¥ä½¿ç”¨ Kubernetes ä¾†å¹«æˆ‘å€‘è‡ªå‹•åŒ–éƒ¨å±¬æ–°çš„å®¹å™¨ã€åˆªé™¤ç¾æœ‰çš„å®¹å™¨ä¸¦å°‡å…¶è³‡æºç”¨æ–¼æ–°å®¹å™¨ã€‚&lt;/li>
&lt;li>è‡ªå‹•æ‰“åŒ…ï¼šç•¶æˆ‘å€‘ç‚º Kubernetes æä¾›ä¸€å€‹ç¯€é»å¢é›†ï¼Œå®ƒå¯ä»¥ç”¨ä¾†é‹è¡Œå®¹å™¨åŒ–çš„ä»»å‹™ï¼Œå‘Šè¨´ Kubernetes æ¯å€‹å®¹å™¨éœ€è¦å¤šå°‘ CPU å’Œ RAMã€‚Kubernetes å¯ä»¥å°‡å®¹å™¨å®‰è£åˆ°ç¯€é»ä¸Šï¼Œå……åˆ†åˆ©ç”¨è³‡æºã€‚&lt;/li>
&lt;li>è‡ªå‹•ä¿®å¾©ï¼šKubernetes æœƒé‡æ–°å•Ÿå‹•å¤±æ•—çš„å®¹å™¨ã€æ›¿æ›å®¹å™¨ã€åˆªé™¤ä¸å›æ‡‰ç”¨æˆ¶çš„ä¸å¥åº·å®¹å™¨ï¼Œä¸¦ä¸”åœ¨å®¹å™¨æº–å‚™å¥½æœå‹™ä¹‹å‰ä¸æœƒé€šçŸ¥å®¢æˆ¶ç«¯ã€‚&lt;/li>
&lt;li>æ©Ÿå¯†å’Œé…ç½®ç®¡ç†ï¼šKubernetes å…è¨±å„²å­˜å’Œç®¡ç†æ•æ„Ÿè¨Šæ¯ï¼Œä¾‹å¦‚å¯†ç¢¼ã€OAuth token å’Œ SSH é‡‘é‘°ã€‚å¯ä»¥éƒ¨ç½²å’Œæ›´æ–°æ©Ÿå¯†çš„æ‡‰ç”¨ç¨‹åºé…ç½®ã€‚&lt;/li>
&lt;/ul>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s/flower.jpg"
alt="kubernetes å®˜ç¶²" width="600">&lt;figcaption>
&lt;p>&lt;a href="https://kubernetes.io/" target="_blank" rel="noopener">kubernetes å®˜ç¶²&lt;/a>&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>Kubernetes å¾ˆå¸¸è¢«æ‹¿ä¾†èˆ‡ Docker Swarm åšæ¯”è¼ƒï¼Œå…©è€…ä¸åŒçš„æ˜¯ï¼ŒDocker Swarm å¿…é ˆå»ºæ§‹åœ¨ Docker çš„æ¶æ§‹ä¸‹ï¼ŒåŠŸèƒ½ä¾·é™ã€ç„¡æ³•è·³è„«ã€‚&lt;/p>
&lt;p>Kubernetes å‰‡å› ç‚ºåŠŸèƒ½è¼ƒç‚ºå»£æ³›ï¼Œè€Œé€æ¼¸å–ä»£ Docker Swarm åœ¨å¸‚å ´ä¸Šçš„åœ°ä½ã€‚ä¸‹æ–¹æœ‰ç°¡æ˜“çš„æ¯”è¼ƒè¡¨æ ¼ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:center">æ¯”è¼ƒ&lt;/th>
&lt;th style="text-align:center">Kubernetes&lt;/th>
&lt;th style="text-align:center">Docker Swarm&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:center">èªªæ˜&lt;/td>
&lt;td style="text-align:center">Kubernetes æ˜¯ä¸€å€‹é–‹æºå®¹å™¨çš„ç·¨æ’å¹³å°ï¼ŒKubernetes çš„å¢é›†çµæ§‹æ¯” Docker Swarm æ›´ç‚ºè¤‡é›œã€‚&lt;br> Kubernetes é€šå¸¸æœ‰å»ºæ§‹å™¨å’Œå·¥ä½œç¯€é»ï¼Œé‚„å¯é€²ä¸€æ­¥åˆ†ç‚º Podã€å‘½åç©ºé–“ã€é…ç½®æ˜ å°„ç­‰ã€‚&lt;/td>
&lt;td style="text-align:center">Docker Swarm æ˜¯ä¸€å€‹ç”± Docker æ§‹å»ºå’Œç¶­è­·çš„é–‹æºå®¹å™¨ç·¨æ’å¹³å°ã€‚&lt;br>ä¸€å€‹ Docker Swarm å¢é›†é€šå¸¸åŒ…å«ä¸‰å€‹é …ç›®ï¼šNodesã€Services and tasksã€Load balancersã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">å„ªé»&lt;/td>
&lt;td style="text-align:center">å®ƒæœ‰é¾å¤§çš„é–‹æºç¤¾ç¾¤ï¼Œç”± Google æ”¯æŒã€‚&lt;br>å®ƒå¯ä»¥ç¶­æŒå’Œç®¡ç†å¤§å‹æ¶æ§‹å’Œè¤‡é›œçš„å·¥ä½œè² è¼‰ã€‚&lt;br>å®ƒæ˜¯è‡ªå‹•åŒ–ï¼Œä¸¦æ”¯æŒè‡ªå‹•åŒ–æ“´å±•çš„è‡ªæˆ‘ä¿®è­·èƒ½åŠ›ã€‚&lt;br>å®ƒæœ‰å…§å»ºç›£æ§å’Œå»£æ³›çš„å¯ç”¨é›†æˆã€‚&lt;/td>
&lt;td style="text-align:center">Docker Swarm å®‰è£ç°¡å–®ï¼Œå®ƒè¼•é‡åŒ–ä¸”å®¹æ˜“å­¸ç¿’ä½¿ç”¨ã€‚&lt;br>Docker Swarm èˆ‡ Docker CLI ä¸€èµ·é‹ä½œï¼Œå› æ­¤ä¸éœ€è¦å¤šé‹è¡Œæˆ–æ˜¯å®‰è£æ–°çš„ CLI&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:center">ç¼ºé»&lt;/td>
&lt;td style="text-align:center">å®ƒè¤‡é›œçš„å®‰è£éç¨‹ä»¥åŠè¼ƒé›£å­¸ç¿’&lt;br>å®ƒéœ€è¦å®‰è£å–®ç¨çš„ CLI å·¥å…·ä¸¦ä¸”å­¸ç¿’æ¯ä¸€é …åŠŸèƒ½&lt;/td>
&lt;td style="text-align:center">å®ƒæ˜¯è¼•é‡ç´šä¸”èˆ‡ Docker API ç›¸é—œè¯ï¼Œèˆ‡ Kubernetes ç›¸æ¯”ï¼ŒDocker Swarm è¢«é™åˆ¶å¾ˆå¤šåŠŸèƒ½ï¼Œä¸”è‡ªå‹•åŒ–ä¹Ÿæ²’æœ‰ Kubernetes å¼·å¤§ã€‚&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;br>
&lt;h2>Kubernetes å…ƒä»¶ä»‹ç´¹èˆ‡èªªæ˜&lt;span class="hx-absolute -hx-mt-20" id="kubernetes-å…ƒä»¶ä»‹ç´¹èˆ‡èªªæ˜">&lt;/span>
&lt;a href="#kubernetes-%e5%85%83%e4%bb%b6%e4%bb%8b%e7%b4%b9%e8%88%87%e8%aa%aa%e6%98%8e" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>Kubernetes æ˜¯å¦‚ä½•å¹«æˆ‘å€‘ç®¡ç†ä»¥åŠéƒ¨ç½² Container ? è¦äº†è§£ Kubernetes å¦‚ä½•é‹ä½œï¼Œå°±è¦å…ˆäº†è§£å®ƒçš„å…ƒä»¶ä»¥åŠæ¶æ§‹ï¼š&lt;/p>
&lt;p>é‚£æˆ‘å€‘ç”±å°çš„å¾€å¤§çš„ä¾†åšä»‹ç´¹ï¼šä¾åºæ˜¯ Podã€Worker Nodeã€Master Nodeã€Cluster&lt;/p>
&lt;h3>Pod&lt;span class="hx-absolute -hx-mt-20" id="pod">&lt;/span>
&lt;a href="#pod" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>Kubernetes é‹ä½œä¸­æœ€å°çš„å–®ä½ï¼Œä¸€å€‹ Pod æœƒå°æ‡‰åˆ°ä¸€å€‹æ‡‰ç”¨æœå‹™ (Application)ï¼Œèˆ‰ä¾‹ä¾†èªªä¸€å€‹ Pod å¯èƒ½æœƒå°æ‡‰åˆ°ä¸€å€‹ NginxServerã€‚&lt;/p>
&lt;ul>
&lt;li>æ¯å€‹ Pod éƒ½æœ‰ä¸€å€‹å®šç¾©æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯å±¬æ–¼é€™å€‹ Pod çš„ &lt;code>yaml&lt;/code> æª”ã€‚&lt;/li>
&lt;li>ä¸€å€‹ Pod è£¡é¢å¯ä»¥æœ‰ä¸€å€‹æˆ–å¤šå€‹ Containerï¼Œä½†ä¸€èˆ¬æƒ…æ³ä¸€å€‹ Pod æœ€å¥½åªæœ‰ä¸€å€‹ Containerã€‚&lt;/li>
&lt;li>åŒä¸€å€‹ Pod ä¸­çš„ Containers å…±äº«ç›¸åŒçš„è³‡æºä»¥åŠç¶²è·¯ï¼Œå½¼æ­¤é€é local port number æºé€šã€‚&lt;/li>
&lt;/ul>
&lt;br>
&lt;h3>Worker Node&lt;span class="hx-absolute -hx-mt-20" id="worker-node">&lt;/span>
&lt;a href="#worker-node" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>Kubernetes é‹ä½œçš„æœ€å°ç¡¬é«”å–®ä½ï¼Œä¸€å€‹ Worker Node (ç°¡ç¨± Node) å°æ‡‰åˆ°ä¸€å°æ©Ÿå™¨ï¼Œå¯ä»¥æ˜¯å¯¦é«”ä¾‹å¦‚ä½ çš„ç­†é›»ã€æˆ–æ˜¯è™›æ“¬æ©Ÿä¾‹å¦‚ GCP ä¸Šçš„ä¸€å° Computer Engineã€‚&lt;/p>
&lt;p>æ¯ä¸€å€‹ Node éƒ½æœ‰ä¸‰å€‹çµ„ä»¶æ‰€çµ„æˆï¼škubeletã€kube-proxyã€Container Runtime&lt;/p>
&lt;h4>kubelet&lt;span class="hx-absolute -hx-mt-20" id="kubelet">&lt;/span>
&lt;a href="#kubelet" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h4>&lt;p>è©² Node çš„ç®¡ç†å“¡ï¼Œè² è²¬ç®¡ç†è©² Node ä¸Šçš„æ‰€æœ‰ Pods çš„ç‹€æ…‹ä¸¦è² è²¬èˆ‡ Master Node æºé€šã€‚&lt;/p>
&lt;br>
&lt;h4>kube-proxy&lt;span class="hx-absolute -hx-mt-20" id="kube-proxy">&lt;/span>
&lt;a href="#kube-proxy" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h4>&lt;p>è©² Node çš„å‚³è¨Šå“¡ï¼Œè² è²¬æ›´æ–° Node çš„ iptablesï¼Œè®“ Kubernetes ä¸­ä¸åœ¨è©² Node çš„å…¶ä»–ç‰©ä»¶å¯ä»¥å¾—çŸ¥è©² Node ä¸Šçš„æ‰€æœ‰ Pods çš„æœ€æ–°ç‹€æ…‹ã€‚&lt;/p>
&lt;br>
&lt;h4>Container Runtime&lt;span class="hx-absolute -hx-mt-20" id="container-runtime">&lt;/span>
&lt;a href="#container-runtime" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h4>&lt;p>è©² Node çœŸæ­£è² è²¬å®¹å™¨åŸ·è¡Œçš„ç¨‹å¼ï¼ŒK8s é è¨­æ˜¯ &lt;code>Docker&lt;/code>ï¼Œä½†ä¹Ÿæ”¯æ´å…¶ä»– Runtime Engineï¼Œä¾‹å¦‚ Mirantis Container Runtimeã€CRI-Oã€containerd&lt;/p>
&lt;div class="hx-overflow-x-auto hx-mt-6 hx-flex hx-rounded-lg hx-border hx-py-2 ltr:hx-pr-4 rtl:hx-pl-4 contrast-more:hx-border-current contrast-more:dark:hx-border-current hx-border-orange-100 hx-bg-orange-50 hx-text-orange-800 dark:hx-border-orange-400/30 dark:hx-bg-orange-400/20 dark:hx-text-orange-300">
&lt;div class="ltr:hx-pl-3 ltr:hx-pr-2 rtl:hx-pr-3 rtl:hx-pl-2">&lt;/div>
&lt;div class="hx-w-full hx-min-w-0 hx-leading-7">
&lt;div class="hx-mt-6 hx-leading-7 first:hx-mt-0">&lt;p>å¸¸è¦‹èª¤è§£ï¼š&lt;/p>
&lt;p>å¾ˆå¤šäººèªç‚º Kubernetes æ˜¯ &lt;code>docker container&lt;/code> çš„ç®¡ç†å·¥å…·ï¼ŒåŒ…å«æˆ‘ä¸€é–‹å§‹ä¹Ÿæ˜¯é€™æ¨£èªç‚ºï¼Œä½†å…¶å¯¦ Kubernetes æ˜¯ç”¨ä¾†ç®¡ç†å®¹å™¨åŒ– (&lt;code>containerized applications&lt;/code>) &lt;strong>ä¸¦ä¸æ˜¯å°ˆå±¬æ–¼ &lt;code>docker&lt;/code>&lt;/strong> ç¨äº«ï¼Œä½œç‚ºä¸€å€‹ &lt;code>container orchestrator&lt;/code> çš„è§’è‰²ï¼ŒKubernetes å¸Œæœ›&lt;strong>èƒ½å¤ ç®¡ç†æ‰€æœ‰å®¹å™¨åŒ–&lt;/strong>çš„æ‡‰ç”¨ç¨‹å¼&lt;/p>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;br>
&lt;h3>Master Node&lt;span class="hx-absolute -hx-mt-20" id="master-node">&lt;/span>
&lt;a href="#master-node" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>Kubernetes é‹ä½œçš„æŒ‡æ®ä¸­å¿ƒï¼Œå¯ä»¥ç°¡åŒ–çœ‹æˆä¸€å€‹ç‰¹æ®ŠåŒ–çš„ Node ä¾†è² è²¬ç®¡ç†æ‰€æœ‰å…¶ä»–çš„ Nodeã€‚&lt;/p>
&lt;p>ä¸€å€‹ Master Node (ç°¡ç¨± Master) ä¸­æœ‰å››å€‹çµ„ä»¶çµ„æˆï¼škube-apiserverã€etcdã€kube-schedulerã€kube-controller-manager&lt;/p>
&lt;h4>kube-apiserver&lt;span class="hx-absolute -hx-mt-20" id="kube-apiserver">&lt;/span>
&lt;a href="#kube-apiserver" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h4>&lt;ul>
&lt;li>ç®¡ç†æ•´å€‹ Kubernetes æ‰€éœ€ API çš„æ¥å£ (Endpoint)ï¼Œä¾‹å¦‚å¾ Command Line ä¸‹ kubectl æŒ‡ä»¤å°±æœƒæŠŠæŒ‡ä»¤é€åˆ°é€™è£¡ã€‚&lt;/li>
&lt;li>è² è²¬ Node ä¹‹é–“çš„æ§‹é€šæ©‹æ¨‘ï¼Œæ¯å€‹ Node å½¼æ­¤ä¸èƒ½ç›´æ¥æºé€šï¼Œå¿…é ˆè¦é€é apiserver è½‰ä»‹ã€‚&lt;/li>
&lt;li>è² è²¬ Kubernetes ä¸­çš„è«‹æ±‚çš„èº«ä»½èªè­‰èˆ‡æˆæ¬Šã€‚&lt;/li>
&lt;/ul>
&lt;br>
&lt;h4>etcd&lt;span class="hx-absolute -hx-mt-20" id="etcd">&lt;/span>
&lt;a href="#etcd" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h4>&lt;ul>
&lt;li>etcd æ˜¯å…¼å…·ä¸€åˆ¶æ€§å’Œé«˜å¯ç”¨æ€§çš„åˆ†æ•£å¼éµå€¼æ•¸æ“šåº«ï¼Œå¯ä»¥ä¿å­˜ Kubernetes æ‰€æœ‰ Cluster çš„å¾Œå°æ•¸æ“šåº«ã€‚&lt;/li>
&lt;/ul>
&lt;br>
&lt;h4>kube-scheduler&lt;span class="hx-absolute -hx-mt-20" id="kube-scheduler">&lt;/span>
&lt;a href="#kube-scheduler" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h4>&lt;ul>
&lt;li>æ•´å€‹ Kubernetes çš„ Pods èª¿åº¦å“¡ï¼Œscheduler æœƒç›£è¦–æ–°å»ºç«‹ä½†é‚„æ²’æœ‰è¢«æŒ‡å®šè¦è·‘åœ¨å“ªå€‹ Node ä¸Šçš„ Pod ï¼Œä¸¦æ ¹æ“šæ¯å€‹ Node ä¸Šé¢è³‡æºè¦å®šï¼Œç¡¬é«”é™åˆ¶ç­‰æ¢ä»¶å»å”èª¿å‡ºä¸€å€‹æœ€é©åˆæ”¾ç½® Node ä¾†è®“è©² Pod é‹è¡Œã€‚&lt;/li>
&lt;/ul>
&lt;br>
&lt;h4>kube-controller-manager&lt;span class="hx-absolute -hx-mt-20" id="kube-controller-manager">&lt;/span>
&lt;a href="#kube-controller-manager" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h4>&lt;ul>
&lt;li>è² è²¬ç®¡ç†ä¸¦é‹è¡Œ Kubernetes controller çš„çµ„ä»¶ï¼Œç°¡å–®ä¾†èªª controller å°±æ˜¯ Kubernetes è£¡ä¸€å€‹è² è²¬ç›£è¦– Cluster ç‹€æ…‹çš„ Processï¼Œä¾‹å¦‚ï¼šNode Controllerã€Replication Controllerã€‚&lt;/li>
&lt;li>é€™äº› Process æœƒåœ¨ Cluster èˆ‡é æœŸç‹€æ…‹ (desire state) ä¸ç¬¦æ™‚å˜—è©¦æ›´æ–°ç¾æœ‰ç‹€æ…‹ (current state)ã€‚ä¾‹å¦‚ï¼šç¾åœ¨è¦å¤šé–‹ä¸€å°æ©Ÿå™¨ä»¥æ‡‰ä»˜çªç„¶å¢åŠ çš„æµé‡ï¼Œé‚£æˆ‘çš„é æœŸç‹€æ…‹å°±æœƒæ›´æ–°æˆ N+1ï¼Œç¾æœ‰ç‹€æ…‹æ˜¯ Nï¼Œé€™æ™‚ç›¸å°æ‡‰çš„ controller å°±æœƒæƒ³è¾¦æ³•å¤šé–‹ä¸€å°æ©Ÿå™¨ã€‚&lt;/li>
&lt;li>controller-manager çš„ç›£è¦–èˆ‡å˜—è©¦æ›´æ–°ä¹Ÿéƒ½éœ€è¦é€éè¨ªå• kube-apiserver é”æˆã€‚&lt;/li>
&lt;/ul>
&lt;br>
&lt;h3>Cluster&lt;span class="hx-absolute -hx-mt-20" id="cluster">&lt;/span>
&lt;a href="#cluster" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>Cluster ä¹Ÿå«å¢é›†ï¼Œå¯ä»¥ç®¡ç†çœ¾å¤šæ©Ÿå™¨çš„å­˜åœ¨ï¼Œåœ¨ä¸€èˆ¬çš„ç³»çµ±æ¶è¨­ä¸­æˆ‘å€‘ä¸æœƒåªæœ‰ä¸€å°æ©Ÿå™¨è€Œå·²ï¼Œé€šå¸¸éƒ½æ˜¯å¤šå€‹æ©Ÿå™¨ä¸€èµ·é‹è¡ŒåŒä¸€ç¨®å…§å®¹ï¼Œåœ¨æ²’æœ‰ Kubernetes çš„æ™‚å€™å°±å¿…é ˆè¦åœŸæ³•ç…‰é‹¼çš„ä¸€å°ä¸€å°æ©Ÿå™¨å»æ›´æ–°ï¼Œä½†æœ‰äº† Kubernetes æˆ‘å€‘å°±å¯ä»¥é€é Cluster é€²è¡Œæ§ç®¡ï¼Œåªè¦æ›´æ–° Master æ——ä¸‹çš„æ©Ÿå™¨ï¼Œä¹Ÿæœƒä¸€ä½µå°‡æ›´æ–°çš„å…§å®¹æ”¾ä¸Šå»ï¼Œååˆ†æ–¹ä¾¿ã€‚åœ¨ Kubernetes ä¸­å¤šå€‹ Worker Node èˆ‡ Master Node çš„é›†åˆã€‚&lt;/p>
&lt;br>
&lt;h2>åŸºæœ¬é‹ä½œ&lt;span class="hx-absolute -hx-mt-20" id="åŸºæœ¬é‹ä½œ">&lt;/span>
&lt;a href="#%e5%9f%ba%e6%9c%ac%e9%81%8b%e4%bd%9c" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s/k8s.jpg"
alt="kubernetes çµ„ä»¶ Kubernetes åŸºç¤æ•™å­¸ï¼ˆä¸€ï¼‰åŸç†ä»‹ç´¹" width="600">&lt;figcaption>
&lt;p>kubernetes çµ„ä»¶ &lt;a href="https://cwhu.medium.com/kubernetes-basic-concept-tutorial-e033e3504ec0" target="_blank" rel="noopener">Kubernetes åŸºç¤æ•™å­¸ï¼ˆä¸€ï¼‰åŸç†ä»‹ç´¹&lt;/a>&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;p>æ¥ä¸‹ä¾†æˆ‘å€‘ç”¨ ã€ŒKuberntes æ˜¯å¦‚ä½•å»ºç«‹ä¸€å€‹ Pod ï¼Ÿã€ä¾†è¤‡ç¿’ä¸€ä¸‹æ•´å€‹ Kubernetes çš„æ¶æ§‹ã€‚&lt;/p>
&lt;p>(ä¸Šåœ–æ˜¯ä¸€å€‹ç°¡æ˜“çš„ Kubernetes Cluster ï¼Œé€šå¸¸ Cluster ç‚ºäº†é«˜ç©©å®šæ€§éƒ½æœƒæœ‰å¤šå€‹ Master ä½œç‚ºå‚™æ´ï¼Œä½†ç‚ºäº†ç°¡åŒ–æˆ‘å€‘åªé¡¯ç¤ºä¸€å€‹ã€‚)&lt;/p>
&lt;ol>
&lt;li>ç•¶ä½¿ç”¨è€…è¦éƒ¨ç½²ä¸€å€‹æ–°çš„ Pod åˆ° Kubernetes Cluster æ™‚ï¼Œä½¿ç”¨è€…è¦å…ˆé€é User Command (kubectl) è¼¸å…¥å»ºç«‹ Pod å°æ‡‰çš„æŒ‡ä»¤ (å¾Œé¢æœƒèªªæ˜è¦å¦‚ä½•å¯¦éš›çš„å‹•æ‰‹å»ºç«‹ä¸€å€‹ Pod)ã€‚æ­¤æ™‚æŒ‡ä»¤æœƒç¶“éä¸€å±¤ç¢ºèªä½¿ç”¨è€…èº«ä»½å¾Œï¼Œå‚³éåˆ° Master Node ä¸­çš„ API Serverï¼ŒAPI Server æœƒæŠŠæŒ‡ä»¤å‚™ä»½åˆ° etcdã€‚&lt;/li>
&lt;li>controller-manager æœƒå¾ API Server æ”¶åˆ°éœ€è¦å‰µå»ºä¸€å€‹æ–°çš„ Pod çš„è¨Šæ¯ï¼Œä¸¦æª¢æŸ¥å¦‚æœè³‡æºè¨±å¯ï¼Œå°±æœƒå»ºç«‹ä¸€å€‹æ–°çš„ Podã€‚æœ€å¾Œ Scheduler åœ¨å®šæœŸè¨ªå• API Server æ™‚ï¼Œæœƒè©¢å• controller-manager æ˜¯å¦æœ‰å»ºç½®æ–°çš„ Podï¼Œå¦‚æœç™¼ç¾æ–°å»ºç«‹çš„ Pod æ™‚ï¼ŒScheduler å°±æœƒè² è²¬æŠŠ Pod é…é€åˆ°æœ€é©åˆçš„ Node ä¸Šé¢ã€‚&lt;/li>
&lt;/ol>
&lt;p>é›–ç„¶ä¸Šé¢åŸºæœ¬çš„é‹ä½œçœ‹èµ·ä¾†ååˆ†è¤‡é›œï¼Œä½†å…¶å¯¦æˆ‘å€‘åœ¨å¯¦éš›æ“ä½œæ™‚ï¼Œåªæ˜¯éœ€å…¥ä¸€è¡ŒæŒ‡ä»¤å¾Œï¼Œå‰©ä¸‹çš„éƒ½æ˜¯ Kubernetes æœƒè‡ªå‹•å¹«æˆ‘å€‘å®Œæˆå¾ŒçºŒçš„å‹•ä½œã€‚&lt;/p>
&lt;h2>å®‰è£ Kubernetes&lt;span class="hx-absolute -hx-mt-20" id="å®‰è£-kubernetes">&lt;/span>
&lt;a href="#%e5%ae%89%e8%a3%9d-kubernetes" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>åœ¨æˆ‘å€‘é–‹å§‹æ“ä½œ Kubernetes ä¹‹å‰ï¼Œéœ€è¦å…ˆä¸‹è¼‰ Minikubeã€Hyperkitã€Kubectl å¥—ä»¶ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://minikube.sigs.k8s.io/docs/start/" target="_blank" rel="noopener">Minikube&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>ä¸€å€‹ Google ç™¼ä½ˆçš„è¼•é‡ç´šå·¥å…·ï¼Œè®“é–‹ç™¼è€…å¯ä»¥è¼•é¬†é«”é©—ä¸€å€‹ Kubernetes Clusterã€‚&lt;font color='red'>(åƒ…é™é–‹ç™¼æ¸¬è©¦ç’°å¢ƒ)&lt;/font>&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s/minikube.png"
alt="å®‰è£ minikube" width="900">&lt;figcaption>
&lt;p>å®‰è£ minikube&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;ul>
&lt;li>(Mac å°ˆç”¨) &lt;a href="https://minikube.sigs.k8s.io/docs/drivers/hyperkit/" target="_blank" rel="noopener">Hyperkit&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>Hyperkit æ˜¯ MacOS ç³»çµ±ç´°éƒ¨è¨­å®šçš„é©…å‹•ç¨‹å¼ã€‚&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s/hyperkit.png"
alt="å®‰è£ hyperkit" width="900">&lt;figcaption>
&lt;p>å®‰è£ hyperkit&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/tasks/tools/" target="_blank" rel="noopener">Kubectl&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>Kubectl æ˜¯ Kubernetes çš„ Command Line å·¥å…·ï¼Œæˆ‘å€‘ä¹‹å¾Œæœƒé€é Kubectl å»æ“ä½œæˆ‘å€‘çš„ Kubernetes Clusterã€‚&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s/kubectl.png"
alt="å®‰è£ kubectl" width="800">&lt;figcaption>
&lt;p>å®‰è£ kubectl&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;h2>å¦‚ä½•å»ºç«‹ä¸€å€‹ Pod&lt;span class="hx-absolute -hx-mt-20" id="å¦‚ä½•å»ºç«‹ä¸€å€‹-pod">&lt;/span>
&lt;a href="#%e5%a6%82%e4%bd%95%e5%bb%ba%e7%ab%8b%e4%b8%80%e5%80%8b-pod" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>ç‰ˆæœ¬è³‡è¨Š&lt;/p>
&lt;ul>
&lt;li>Minikubeï¼šv1.25.2&lt;/li>
&lt;li>hyperkitï¼š0.20200908&lt;/li>
&lt;li>Kubectlï¼šClient Versionï¼šv1.22.5ã€Server Versionï¼šv1.23.3&lt;/li>
&lt;/ul>
&lt;p>ä¸‹è¼‰å®Œ Minikube å¾Œï¼Œæˆ‘å€‘å¯ä»¥å…ˆé€é &lt;code>Minikube&lt;/code> ä¾†æŸ¥è©¢å…¨éƒ¨çš„æŒ‡ä»¤ï¼Œç”±æ–¼æˆ‘å€‘å‰é¢æœ‰å®‰è£ Hyperkit é€™å€‹é©…å‹•ç¨‹å¼ï¼Œå•Ÿå‹• Minikube é è¨­æ˜¯ä½¿ç”¨ Dockerï¼Œæˆ‘å€‘é€™é‚Šè¦åˆ©ç”¨ Hyperkit ä¾†å•Ÿå‹•ï¼Œæ‰€ä»¥ä½¿ç”¨ &lt;code>Minikube start --vm-driver=hyperkit&lt;/code> ä¾†å•Ÿå‹• Minikubeã€‚&lt;/p>
&lt;div class="hx-overflow-x-auto hx-mt-6 hx-flex hx-rounded-lg hx-border hx-py-2 ltr:hx-pr-4 rtl:hx-pl-4 contrast-more:hx-border-current contrast-more:dark:hx-border-current hx-border-orange-100 hx-bg-orange-50 hx-text-orange-800 dark:hx-border-orange-400/30 dark:hx-bg-orange-400/20 dark:hx-text-orange-300">
&lt;div class="ltr:hx-pl-3 ltr:hx-pr-2 rtl:hx-pr-3 rtl:hx-pl-2">&lt;/div>
&lt;div class="hx-w-full hx-min-w-0 hx-leading-7">
&lt;div class="hx-mt-6 hx-leading-7 first:hx-mt-0">&lt;p>Minikube å…¶ä»–æŒ‡ä»¤ä»‹ç´¹ï¼š&lt;/p>
&lt;p>é¡¯ç¤º minikube ç‹€æ…‹ &lt;code>minikube status&lt;/code>&lt;/p>
&lt;p>åœæ­¢ minikube é‹è¡Œ &lt;code>minikube stop&lt;/code>&lt;/p>
&lt;p>ssh é€²å…¥ minikube ä¸­ &lt;code>minikube ssh&lt;/code>&lt;/p>
&lt;p>æŸ¥è©¢ minikube å°å¤–çš„ ip &lt;code>minikube ip&lt;/code>&lt;/p>
&lt;p>ä½¿ç”¨ minikube æ‰€æä¾›çš„ç€è¦½å™¨ GUI &lt;code>minikube dashboard &lt;/code> (å¯ä»¥åŠ  - - url çœ‹ç¶²å€æ­)&lt;/p>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;p>æˆ‘å€‘å•Ÿå‹• minikube å¾Œï¼Œæˆ‘å€‘è¦æ‰“åšä¸€å€‹å¯ä»¥åœ¨ Pod é‹è¡Œçš„å°ç¨‹å¼ã€‚é€™å€‹å°ç¨‹å¼æ˜¯ä¸€å€‹ Node.js çš„ Web ç¨‹å¼ï¼Œä»–æœƒå»ºç«‹ä¸€å€‹ Server ä¾†ç›£è½ 3000 Portï¼Œæ”¶åˆ° request é€²ä¾†å¾Œæœƒæ¸²æŸ“ &lt;code>index.html&lt;/code> é€™å€‹æª”æ¡ˆï¼Œé€™å€‹æª”æ¡ˆè£¡é¢æœƒæœ‰ä¸€éš»å¯æ„›çš„å°æŸ´çŠ¬ã€‚&lt;/p>
&lt;p>å› ç‚ºæœ¬æ–‡ç« æ˜¯åœ¨ä»‹ç´¹ kubernetes æ‰€ä»¥åœ¨ç¨‹å¼éƒ¨åˆ†å°±ä¸å¤šåšèªªæ˜ï¼Œæˆ‘æŠŠç¨‹å¼ç¢¼æ”¾åœ¨ &lt;a href="https://github.com/880831ian/kubernetes-demo" target="_blank" rel="noopener">Github&lt;/a>ï¼Œä»¥åŠé™„ä¸Š &lt;a href="https://hub.docker.com/repository/docker/880831ian/kubernetes-demo" target="_blank" rel="noopener">Dockerhub çš„ Repository&lt;/a> å¯ä»¥ç›´æ¥ä½¿ç”¨åŒ…å¥½çš„ image ä¾†åšæ¸¬è©¦ï¼&lt;/p>
&lt;br>
&lt;h3>Pod yaml æª”æ¡ˆèªªæ˜&lt;span class="hx-absolute -hx-mt-20" id="pod-yaml-æª”æ¡ˆèªªæ˜">&lt;/span>
&lt;a href="#pod-yaml-%e6%aa%94%e6%a1%88%e8%aa%aa%e6%98%8e" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>æ¥ä¸‹ä¾†æˆ‘å€‘è¦å…ˆæ’°å¯«ä¸€å€‹ Pod çš„å®šç¾©æ–‡ä»¶ (.yaml) æª”ï¼Œé€™å€‹ &lt;code>.yaml&lt;/code> æª”å°±å¯ä»¥å»ºç«‹å‡º Pod äº†ï¼&lt;/p>
&lt;ul>
&lt;li>kubernetes-demo.yaml (ç¨‹å¼ç¸®æ’è¦æ­£ç¢ºï¼Œä¸ç„¶æœƒç„¡æ³•åŸ·è¡Œæ­ï¼)&lt;/li>
&lt;/ul>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yml" data-lang="yml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">apiVersion&lt;/span>: &lt;span style="color:#ae81ff">v1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">kind&lt;/span>: &lt;span style="color:#ae81ff">Pod&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">metadata&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">kubernetes-demo-pod&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">labels&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">app&lt;/span>: &lt;span style="color:#ae81ff">demo&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">spec&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">containers&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">kubernetes-demo-container&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">image&lt;/span>: &lt;span style="color:#ae81ff">880831ian/kubernetes-demo&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ports&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">containerPort&lt;/span>: &lt;span style="color:#ae81ff">3000&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>apiVersion&lt;/p>
&lt;p>è©²å…ƒä»¶çš„ç‰ˆæœ¬è™Ÿï¼Œå¿…é ˆä¾ç…§ Server ä¸Š K8s ç‰ˆæœ¬ä¾†åšè¨­å®š (æƒ³è¦çŸ¥é“ k8s ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>kubectl version&lt;/code> æŒ‡ä»¤ä¾†æŸ¥è©¢ï¼Œæœƒé¡¯ç¤º client è·Ÿ server çš„ç‰ˆæœ¬è¨Šæ¯ï¼Œclient ä»£è¡¨ kubectl ç‰ˆæœ¬è¨Šæ¯ï¼Œserver ä»£è¡¨çš„æ˜¯ master node çš„ k8s ç‰ˆæœ¬è¨Šæ¯)ï¼Œç›®å‰ k8s éƒ½ä½¿ç”¨ 1.23 ç‰ˆæœ¬ä»¥ä¸Šï¼Œæ‰€ä»¥ &lt;code>apiVersion&lt;/code> ç›´æ¥å¯« &lt;code>v1&lt;/code> å³å¯ã€‚&lt;/p>
&lt;br>
&lt;p>kind&lt;/p>
&lt;p>è©²å…ƒä»¶çš„å±¬æ€§ï¼Œç”¨ä¾†æ±ºå®šæ­¤è¨­å®šæª”çš„é¡å‹ï¼Œå¸¸è¦‹çš„æœ‰ &lt;code>Pod&lt;/code>ã€&lt;code>Node&lt;/code>ã€&lt;code>Service&lt;/code>ã€&lt;code>Namespace&lt;/code>ã€&lt;code>ReplicationController&lt;/code> ç­‰ç­‰&lt;/p>
&lt;br>
&lt;p>metadata&lt;/p>
&lt;p>ç”¨ä¾†æ“ºæ”¾æè¿°æ€§è³‡æ–™çš„åœ°æ–¹ï¼Œåƒæ˜¯ Pod åç¨±æˆ–æ˜¯æ¨™ç±¤ç­‰ç­‰éƒ½æœƒæ”¾åœ¨æ­¤è™•ã€‚&lt;/p>
&lt;ul>
&lt;li>nameï¼šæŒ‡å®šè©² Pod çš„åç¨±&lt;/li>
&lt;li>labelsï¼šæŒ‡å®šè©² Pod çš„æ¨™ç±¤&lt;/li>
&lt;/ul>
&lt;br>
&lt;p>spec&lt;/p>
&lt;p>ç”¨ä¾†æè¿°ç‰©ä»¶ç”Ÿæˆçš„ç´°ç¯€ï¼Œåƒæ˜¯ Pod å…§å…¶å¯¦æ˜¯è·‘ Dokcer containerï¼Œæ‰€ä»¥åœ¨ Pod çš„ spec å…§å°±æœƒæè¿° container çš„ç´°ç¯€ã€‚&lt;/p>
&lt;ul>
&lt;li>container.nameï¼šæŒ‡å®šé‹è¡Œçš„ Container çš„åç¨±&lt;/li>
&lt;li>container.imageï¼šæŒ‡å®š Container è¦ä½¿ç”¨å“ªå€‹ Imageï¼Œé€™è£¡æœƒå¾ DockerHub ä¸Šæœå°‹&lt;/li>
&lt;li>container.portsï¼šæŒ‡å®šè©² Container æœ‰å“ªäº› Port number æ˜¯å…è¨±å¤–éƒ¨å­˜å–çš„&lt;/li>
&lt;/ul>
&lt;br>
&lt;h3>ä½¿ç”¨ kubectl å»ºç«‹ Pod&lt;span class="hx-absolute -hx-mt-20" id="ä½¿ç”¨-kubectl-å»ºç«‹-pod">&lt;/span>
&lt;a href="#%e4%bd%bf%e7%94%a8-kubectl-%e5%bb%ba%e7%ab%8b-pod" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>ç•¶æˆ‘å€‘æœ‰äº†å®šç¾©æ–‡ä»¶å¾Œï¼Œæˆ‘å€‘å°±å¯ä»¥ä½¿ç”¨ kubectl çš„æŒ‡ä»¤ä¾†å»ºç«‹ Pod&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>kubectl create -f kubernetes-demo.yaml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubectl apply -f kubernetes-demo.yaml&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;p>å¯ä»¥ä½¿ç”¨ &lt;code>create&lt;/code> or &lt;code>apply&lt;/code> ä¾†å»ºç«‹ Pod ï¼Œé‚£é€™å…©å€‹çš„å·®ç•°æ˜¯ä»€éº¼å‘¢ï¼Ÿ&lt;/p>
&lt;ul>
&lt;li>kubectl create&lt;/li>
&lt;/ul>
&lt;ol>
&lt;li>
&lt;p>&lt;code>kubectl create&lt;/code> æ˜¯æ‰€è¬‚çš„ &amp;ldquo;å‘½ä»¤å¼ç®¡ç†&amp;rdquo; (&lt;code>Imperative Management&lt;/code>)ã€‚é€šéé€™ç¨®æ–¹å¼ï¼Œå¯ä»¥å‘Šè¨´ Kubernets API ä½ è¦å»ºç«‹ã€æ›´æ–°ã€åˆªé™¤çš„å…§å®¹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>kubectl create&lt;/code> å‘½ä»¤æ˜¯å…ˆåˆªé™¤æ‰€æœ‰ç¾æœ‰çš„æ±è¥¿ï¼Œé‡æ–°æ ¹æ“š YAML æ–‡ä»¶ç”Ÿæˆæ–°çš„ Podã€‚æ‰€ä»¥è¦æ±‚ YAML æ–‡ä»¶ä¸­çš„é…ç½®å¿…é ˆå®Œæ•´ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>kubectl create&lt;/code> å‘½ä»¤ï¼Œä½¿ç”¨åŒä¸€å€‹ YAML æ–‡ä»¶é‡è¤‡å»ºç«‹æœƒå¤±æ•—ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;br>
&lt;ul>
&lt;li>kubectl apply&lt;/li>
&lt;/ul>
&lt;ol>
&lt;li>
&lt;p>&lt;code>kubectl apply&lt;/code> æ˜¯ &amp;ldquo;è²æ˜å¼ç®¡ç†&amp;rdquo; (&lt;code>Declarative Management&lt;/code>)æ–¹æ³•çš„ä¸€éƒ¨åˆ†ã€‚åœ¨è©²æ–¹æ³•ä¸­ï¼Œå³ä½¿å°ç›®æ¨™ç”¨äº†å…¶ä»–æ›´æ–°ï¼Œä¹Ÿå¯ä»¥ä¿æŒä½ å°ç›®æ¨™æ‡‰ç”¨çš„æ›´æ–°ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>kubectl apply&lt;/code> å‘½ä»¤ï¼Œæ ¹æ“šé…ç½®æ–‡ä»¶è£¡é¢å‡ºä¾†çš„å…§å®¹ï¼Œç”Ÿæˆå°±æœ‰çš„ã€‚æ‰€ä»¥ YAML æ–‡ä»¶çš„å…§å®¹å¯ä»¥åªå¯«éœ€è¦å‡ç´šçš„æ¬„ä½ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;br>
&lt;p>å¦‚æœçœ‹åˆ° &lt;code>pod/kubernetes-demo-pod created&lt;/code> å°±ä»£è¡¨æˆ‘å€‘æˆåŠŸå»ºç«‹ç¬¬ä¸€å€‹ Pod äº†ï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘å¯ä»¥ä½¿ç”¨ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>kubectl get pods&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>å¯ä»¥æŸ¥çœ‹æˆ‘å€‘é‹è¡Œä¸­çš„ Podï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubernetes-demo-pod 1/1 Running &lt;span style="color:#ae81ff">0&lt;/span> 3m5s&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;div class="hx-overflow-x-auto hx-mt-6 hx-flex hx-rounded-lg hx-border hx-py-2 ltr:hx-pr-4 rtl:hx-pl-4 contrast-more:hx-border-current contrast-more:dark:hx-border-current hx-border-orange-100 hx-bg-orange-50 hx-text-orange-800 dark:hx-border-orange-400/30 dark:hx-bg-orange-400/20 dark:hx-text-orange-300">
&lt;div class="ltr:hx-pl-3 ltr:hx-pr-2 rtl:hx-pr-3 rtl:hx-pl-2">&lt;/div>
&lt;div class="hx-w-full hx-min-w-0 hx-leading-7">
&lt;div class="hx-mt-6 hx-leading-7 first:hx-mt-0">&lt;p>Pod æŒ‡ä»¤ä»‹ç´¹ï¼š&lt;/p>
&lt;p>æŸ¥è©¢ç¾æœ‰ Pod ç‹€æ…‹ &lt;code>kubectl get po/pod/pods&lt;/code>&lt;/p>
&lt;p>æŸ¥çœ‹è©² Pod è©³ç´°è³‡è¨Š &lt;code>kubectl describe pods &amp;lt;pod-name&amp;gt;&lt;/code>&lt;/p>
&lt;p>åˆªé™¤ Pod &lt;code>kubectl delete pods&lt;/code>&lt;/p>
&lt;p>æŸ¥çœ‹ Pod log &lt;code>kubectl logs &amp;lt;pod-name&amp;gt;&lt;/code>&lt;/p>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;br>
&lt;p>ä¹Ÿå¯ä»¥ä½¿ç”¨ minikube åœ–å½¢åŒ–é é¢ä¾†çœ‹ä¸€ä¸‹æ˜¯å¦æˆåŠŸï¼&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>minikube dashboard --url
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ğŸ¤” Verifying dashboard health ...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ğŸš€ Launching proxy ...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ğŸ¤” Verifying proxy health ...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>http://127.0.0.1:55991/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s/minikube-k8s.png"
alt="minikube dashboard" width="1000">&lt;figcaption>
&lt;p>minikube dashboard&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;h3>é€£ç·šåˆ° Pod çš„æœå‹™&lt;span class="hx-absolute -hx-mt-20" id="é€£ç·šåˆ°-pod-çš„æœå‹™">&lt;/span>
&lt;a href="#%e9%80%a3%e7%b7%9a%e5%88%b0-pod-%e7%9a%84%e6%9c%8d%e5%8b%99" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>ç•¶æˆ‘å€‘å»ºç«‹å¥½ Pod ä¹‹å¾Œï¼Œæ‰“é–‹ç€è¦½å™¨ &lt;code>localhost:3000&lt;/code> æœƒç™¼ç¾ï¼Œä»€éº¼éƒ½æ²’æœ‰ï¼Œæ˜¯å› ç‚ºæˆ‘å€‘å‰›å‰›åœ¨ &lt;code>.yaml&lt;/code> è£¡é¢è¨­å®šçš„æ˜¯ Pod çš„ Port ï¼Œå®ƒèˆ‡æœ¬æ©Ÿçš„ Port æ˜¯ä¸ç›¸é€šçš„ï¼Œå› æ­¤æˆ‘å€‘éœ€è¦ä½¿ç”¨ &lt;code>kubectl port-forward &amp;lt;pod&amp;gt; &amp;lt;external-port&amp;gt;:&amp;lt;pod-port&amp;gt;&lt;/code> ï¼Œä¾†å°‡ Pod èˆ‡æœ¬æ©Ÿç«¯åš mappingã€‚&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>kubectl port-forward kubernetes-demo-pod 3000:3000
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Forwarding from 127.0.0.1:3000 -&amp;gt; &lt;span style="color:#ae81ff">3000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Forwarding from &lt;span style="color:#f92672">[&lt;/span>::1&lt;span style="color:#f92672">]&lt;/span>:3000 -&amp;gt; &lt;span style="color:#ae81ff">3000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Handling connection &lt;span style="color:#66d9ef">for&lt;/span> &lt;span style="color:#ae81ff">3000&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>æˆ‘å€‘åœ¨æ­¤ç€è¦½ &lt;code>localhost:3000&lt;/code>ï¼Œå°±æœƒçœ‹åˆ°å¯æ„›çš„æŸ´çŠ¬å›‰ï¼&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/kubernetes/k8s/Shiba-Inu.png"
alt="æˆåŠŸé¡¯ç¤ºæŸ´çŠ¬" width="900">&lt;figcaption>
&lt;p>æˆåŠŸé¡¯ç¤ºæŸ´çŠ¬&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>å‰é¢æˆ‘å€‘å·²ç¶“å‰µå»ºå±¬æ–¼æˆ‘å€‘ç¬¬ä¸€å€‹ Pod äº†ï¼Œä½†ç•¶æˆ‘å€‘ Pod è¶Šå»ºè¶Šå¤šæ™‚ï¼Œè¦æ€éº¼å¿«é€Ÿçš„å¾—çŸ¥æ¯å€‹ Pod åœ¨åšä»€éº¼äº‹æƒ…ï¼Ÿé™¤äº†ç”¨ Pod çš„ metadata name ä¾†å‘½åå¤–ï¼Œé‚„æœ‰å¦ä¸€ç¨®æ–¹å¼ï¼š&lt;/p>
&lt;h2>ä»€éº¼æ˜¯ Label ?&lt;span class="hx-absolute -hx-mt-20" id="ä»€éº¼æ˜¯-label-">&lt;/span>
&lt;a href="#%e4%bb%80%e9%ba%bc%e6%98%af-label-" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>Label é¡§åæ€ç¾©å°±æ˜¯æ¨™ç±¤ï¼Œå¯ä»¥ç‚ºæ¯ä¸€å€‹ Pod è²¼ä¸Šæ¨™ç±¤ï¼Œè®“ Kubernetes æ›´æ–¹ä¾¿çš„ç®¡æ§é€™äº› Podã€‚&lt;/p>
&lt;p>Label çš„å¯«æ³•å¾ˆç°¡å–®ï¼Œå¯ä»¥è‡ªå·±è‡ªè¨‚ä¸€å°å…·æœ‰è¾¨è­˜åº¦çš„ key/valueï¼Œèˆ‰æˆ‘å€‘ä¸Šé¢çš„ä¾‹å­ä¾†èªªï¼šæˆ‘å€‘å¯ä»¥åœ¨ labels å…§åŠ å…¥ &lt;code>app: demo&lt;/code>ï¼Œé‚£ Label æœ‰ä»€éº¼å¥½è™•å‘¢?&lt;/p>
&lt;p>é€™é‚Šè¦ç¨å¾®æä¸€ä¸‹ &lt;code>Selector&lt;/code>ï¼Œå®ƒçš„åŠŸç”¨æ˜¯é¸å–å°æ‡‰çš„ç‰©ä»¶ã€‚ç‚ºäº†è¦æ–¹ä¾¿é¸å–åˆ°æˆ‘å€‘è¨­å®šå¥½çš„ Podï¼Œé€™æ™‚å€™ Label å°±æ´¾ä¸Šç”¨å ´äº†ï¼&lt;/p>
&lt;p>&lt;code>Selector&lt;/code> çš„å¯«æ³•ä¹Ÿå¾ˆç°¡å–®ï¼Œåªè¦æŠŠæˆ‘å€‘åœ¨ Label å®šç¾©çš„ key/value ç›´æ¥å®Œæ•´çš„è²¼éä¾†å°±å¯ä»¥äº†ï½&lt;/p>
&lt;br>
&lt;p>å°±åƒé€™æ¨£ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">selectors&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">app&lt;/span>: &lt;span style="color:#ae81ff">demo&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>é‚£é¸å–å¾Œæœ‰ä»€éº¼åŠŸç”¨å‘¢ï¼è«‹çœ‹ &lt;a href="../../kubernetes/k8s-advanced/#%E4%BB%80%E9%BA%BC%E6%98%AF-service-" >Kubernetes - é€²éš - Service&lt;/a>&lt;/p>
&lt;br>
&lt;p>è¬›å®Œ Label å¾Œï¼Œé †é‚Šæä¸€ä¸‹è·Ÿ Label æœ‰ç›¸ä¼¼çš„ï¼š&lt;/p>
&lt;h2>ä»€éº¼æ˜¯ Annotation ?&lt;span class="hx-absolute -hx-mt-20" id="ä»€éº¼æ˜¯-annotation-">&lt;/span>
&lt;a href="#%e4%bb%80%e9%ba%bc%e6%98%af-annotation-" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>å‰é¢æåˆ°çš„ Label åŠŸç”¨å…¶ç›®çš„æ˜¯è¦è®“ Kubernetes çŸ¥é“å¯ä»¥å»æ›´æ–¹ä¾¿ç®¡ç†çš„ï¼Œé‚£æˆ‘å€‘å¦‚æœæƒ³è¦è²¼æ¨™ç±¤ä½†ä¸æƒ³è®“ Kubernetes çŸ¥é“ï¼Œè¦æ€éº¼åšå‘¢ï¼Ÿ&lt;/p>
&lt;p>é€™æ™‚æˆ‘å€‘å°±å¯ä»¥ç”¨ &lt;code>Annotation&lt;/code>ï¼Œé€é &lt;code>Annotation&lt;/code> å¯ä»¥å°‡æ¨™ç±¤å–®ç´”çµ¦é–‹ç™¼äººå“¡æŸ¥çœ‹ï¼Œé‚£è½èµ·ä¾† &lt;code>Annotation&lt;/code> å¥½åƒæ²’æœ‰ä»€éº¼å¯¦è³ªä¸Šçš„ç”¨é€”ï¼Œå› ç‚º Kubernetes ä¸æœƒæ¡ç”¨é€™äº›æ¨™ç±¤ï¼Œä½†å…¶å¯¦ &lt;code>Annotation&lt;/code> é‚„æ˜¯æœ‰ç”¨çš„æ­ï¼å¾ŒçºŒæ–‡ç« æœƒå†æåˆ° &amp;gt;&amp;lt;&lt;/p>
&lt;br>
&lt;p>é‚£æ—¢ç„¶ Label è·Ÿ Annotation æœ‰ç›¸ä¼¼ï¼Œæ‰€ä»¥å¯«æ³•æƒ³å¿…ä¹Ÿæ˜¯å·®ä¸å¤šå§ï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">annotations&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">author&lt;/span>: &lt;span style="color:#ae81ff">Pin-YI&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">contact&lt;/span>: &lt;span style="color:#ae81ff">880831ian@gmail.com&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>ä¸€æ¨£ä¹Ÿæ˜¯å®šç¾©ä¸€çµ„å…·æœ‰è¾¨è­˜åº¦çš„ key/value ï¼Œæˆ‘å€‘é€™é‚Šå°±å…ˆæ”¾ authorã€contact&lt;/p>
&lt;br>
&lt;p>é‚£ Label èˆ‡ Annotation è¦æ”¾åœ¨ Pod çš„å“ªä¸€è™•å‘¢ï¼Ÿ&lt;/p>
&lt;p>é‚„è¨˜å¾—æˆ‘å€‘ä¸Šé¢èªª &lt;code>metadata&lt;/code> æ˜¯ç”¨ä¾†æ“ºæè¿°æ€§è³‡æ–™çš„åœ°æ–¹å—ï¼Œæ‰€ä»¥ä¸ç®¡æ˜¯ Label æˆ–æ˜¯ Annotation éƒ½æ˜¯æ”¾åœ¨ &lt;code>metadata&lt;/code> ä¸­æ­ï¼&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">metadata&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">kubernetes-demo-pod&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">labels&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">app&lt;/span>: &lt;span style="color:#ae81ff">demo&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">annotations&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">author&lt;/span>: &lt;span style="color:#ae81ff">Pin-YI&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">contact&lt;/span>: &lt;span style="color:#ae81ff">880831ian@gmail.com&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;h2>åƒè€ƒè³‡æ–™&lt;span class="hx-absolute -hx-mt-20" id="åƒè€ƒè³‡æ–™">&lt;/span>
&lt;a href="#%e5%8f%83%e8%80%83%e8%b3%87%e6%96%99" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>kubernetes å®˜ç¶²ï¼š&lt;a href="https://kubernetes.io/" target="_blank" rel="noopener">https://kubernetes.io/&lt;/a>&lt;/p>
&lt;p>Kubernetesï¼ˆK8sï¼‰æ˜¯ä»€éº¼ï¼ŸåŸºç¤ä»‹ç´¹+3 å¤§å„ªé»è§£æï¼š&lt;a href="https://www.sysage.com.tw/news/technology/293" target="_blank" rel="noopener">https://www.sysage.com.tw/news/technology/293&lt;/a>&lt;/p>
&lt;p>Docker Swarm vs Kubernetes: how to choose a container orchestration toolï¼š&lt;a href="https://circleci.com/blog/docker-swarm-vs-kubernetes/" target="_blank" rel="noopener">https://circleci.com/blog/docker-swarm-vs-kubernetes/&lt;/a>&lt;/p>
&lt;p>Kubernetes åŸºç¤æ•™å­¸ï¼ˆä¸€ï¼‰åŸç†ä»‹ç´¹ï¼š&lt;a href="https://cwhu.medium.com/kubernetes-basic-concept-tutorial-e033e3504ec0" target="_blank" rel="noopener">https://cwhu.medium.com/kubernetes-basic-concept-tutorial-e033e3504ec0&lt;/a>&lt;/p>
&lt;p>Kubernetes é‚£äº›äº‹ â€” åŸºç¤è§€å¿µèˆ‡æ“ä½œï¼š&lt;a href="https://medium.com/andy-blog/kubernetes%E9%82%A3%E4%BA%9B%E4%BA%8B-%E5%9F%BA%E7%A4%8E%E8%A7%80%E5%BF%B5%E8%88%87%E6%93%8D%E4%BD%9C-97cc203a2660" target="_blank" rel="noopener">https://medium.com/andy-blog/kubernetes%E9%82%A3%E4%BA%9B%E4%BA%8B-%E5%9F%BA%E7%A4%8E%E8%A7%80%E5%BF%B5%E8%88%87%E6%93%8D%E4%BD%9C-97cc203a2660&lt;/a>&lt;/p>
&lt;p>Kubernetes é‚£äº›äº‹ â€” Pod ç¯‡ï¼š&lt;a href="https://medium.com/andy-blog/kubernetes-%E9%82%A3%E4%BA%9B%E4%BA%8B-pod-%E7%AF%87-57475cec22f3" target="_blank" rel="noopener">https://medium.com/andy-blog/kubernetes-%E9%82%A3%E4%BA%9B%E4%BA%8B-pod-%E7%AF%87-57475cec22f3&lt;/a>&lt;/p>
&lt;p>Kubernetes é‚£äº›äº‹ â€” Label ç¯‡ï¼š&lt;a href="https://medium.com/andy-blog/kubernetes-%E9%82%A3%E4%BA%9B%E4%BA%8B-label-%E7%AF%87-4186af2af556" target="_blank" rel="noopener">https://medium.com/andy-blog/kubernetes-%E9%82%A3%E4%BA%9B%E4%BA%8B-label-%E7%AF%87-4186af2af556&lt;/a>&lt;/p></description></item></channel></rss>