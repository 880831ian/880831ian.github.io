<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>PIN-YI â€“ RD ä½¿ç”¨çš„ç›¸é—œå·¥å…·</title><link>https://pin-yi.me/blog/rd/</link><description>Recent content in RD ä½¿ç”¨çš„ç›¸é—œå·¥å…· on PIN-YI</description><generator>Hugo -- gohugo.io</generator><language>zh-tw</language><atom:link href="https://pin-yi.me/blog/rd/index.xml" rel="self" type="application/rss+xml"/><item><title>ç”¨ EFK æ”¶é›†å®¹å™¨æ—¥èªŒ (HAProxyã€Redis Sentinelã€Docker-compose)</title><link>https://pin-yi.me/blog/rd/redis-sentinel-docker-compose-haproxy-efk/</link><pubDate>Fri, 22 Apr 2022 00:00:00 +0000</pubDate><guid>https://pin-yi.me/blog/rd/redis-sentinel-docker-compose-haproxy-efk/</guid><description>
&lt;p>å‰æƒ…æè¦ï¼šæœ¬ç¯‡æ˜¯ &lt;a href="../../redis/redis-sentinel-docker-compose-haproxy/" >ç”¨ HAProxy å° Redis åšè² è¼‰å¹³è¡¡ (Redis Sentinelã€Docker-compose)&lt;/a>
ä»¥åŠ &lt;a href="../../redis/redis-sentinel-docker-compose/" >Redis å“¨å…µæ¨¡å¼ (Sentinel) æ­é… Docker-compose å¯¦ä½œ&lt;/a> çš„å¾ŒçºŒæ–‡ç« ï¼Œä¸»è¦æœƒå„ªåŒ–åŸæœ¬çš„ç¨‹å¼ç¢¼ï¼Œä¸¦ä½¿ç”¨ EFK ä¾†æ”¶é›† LOGï¼&lt;/p>
&lt;h2>ä»€éº¼æ˜¯ EFK ?&lt;span class="hx-absolute -hx-mt-20" id="ä»€éº¼æ˜¯-efk-">&lt;/span>
&lt;a href="#%e4%bb%80%e9%ba%bc%e6%98%af-efk-" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>éš¨è‘—ç¾åœ¨å„ç¨®ç¨‹å¼ç³»çµ±è¤‡é›œåº¦è¶Šä¾†è¶Šé«˜ï¼Œç‰¹åˆ¥æ˜¯ç¾åœ¨éƒ½å¾€é›²ä¸Šé–‹å§‹ä½œéƒ¨ç½²ï¼Œç•¶æˆ‘å€‘æƒ³è¦æŸ¥çœ‹ log çš„æ™‚å€™ï¼Œä¸å¯èƒ½ä¸€å€‹ä¸€å€‹å»ç™»å…¥å„ç¯€é»å»æŸ¥çœ‹ logï¼Œä¸åƒ…æ•ˆç‡ä½ï¼Œä¹Ÿæœƒæœ‰å®‰å…¨æ€§çš„å•é¡Œï¼Œæ‰€ä»¥ä¸å¯èƒ½è®“å·¥ç¨‹å¸«ç›´æ¥å»è¨ªå•æ¯ä¸€å€‹ç¯€é»ã€‚&lt;/p>
&lt;p>è€Œä¸”ç¾åœ¨å¤§è¦æ¨¡çš„ç³»çµ±åŸºæœ¬ä¸Šéƒ½æ¡ç”¨å¢é›†çš„éƒ¨ç½²æ–¹å¼ï¼Œæ„å‘³è‘—å°æ¯å€‹ serviceï¼Œæœƒå•Ÿå‹•å¤šå€‹å®Œå…¨ä¸€æ¨£çš„ POD å°å¤–æä¾›æœå‹™ï¼Œæ¯å€‹ container éƒ½æœƒç”¢ç”Ÿè‡ªå·±çš„ logï¼Œå¾ç”¢ç”Ÿ log ä¾†çœ‹ï¼Œä½ æ ¹æœ¬ä¸çŸ¥é“æ˜¯ç”±å“ªå€‹ POD ç”¢ç”Ÿçš„ï¼Œé€™æ¨£å°æŸ¥çœ‹åˆ†ä½ˆå¼çš„æ—¥èªŒæ›´åŠ å›°é›£ã€‚&lt;/p>
&lt;p>æ‰€ä»¥åœ¨é›²æ™‚ä»£ï¼Œéœ€è¦ä¸€å€‹æ”¶é›†ä¸¦åˆ†æ log çš„è§£æ±ºæ–¹æ¡ˆã€‚é¦–å…ˆéœ€è¦å°‡åˆ†ä½ˆåœ¨å„å€‹è§’è½çš„ log çµ±ä¸€æ”¶é›†åˆ°ä¸€å€‹é›†ä¸­çš„åœ°æ–¹ï¼Œæ–¹ä¾¿æŸ¥çœ‹ã€‚æ”¶é›†ä¹‹å¾Œï¼Œé‚„å¯ä»¥é€²è¡Œå„ç¨®çµ±è¨ˆä»¥åŠåˆ†æï¼Œç”šè‡³ç”¨æµè¡Œçš„å¤§æ•¸æ“šæˆ–æ©Ÿå™¨å­¸ç¿’çš„æ–¹æ³•ä¾†é€²è¡Œåˆ†æã€‚&lt;/p>
&lt;br>
&lt;p>æ‰€ä»¥èª•ç”Ÿäº† ELK æˆ–æ˜¯ EFK çš„è§£æ±ºæ–¹å¼ï¼š&lt;/p>
&lt;p>ELK æ˜¯ç”± Elasticsearchã€Logstashã€Kibana æ‰€çµ„æˆï¼Œ EFK æ˜¯ç”± Elasticsearchã€(Filebeats or Fluentd)ã€Kibana æ‰€çµ„æˆï¼Œå…©è€…çš„å·®ç•°åœ¨ä¸­é–“ä½¿ç”¨çš„é–‹æºç¨‹å¼ï¼Œæˆ‘æœƒåˆ†åˆ¥ä»‹ç´¹ä¸€ä¸‹æ¯ä¸€å€‹ç¨‹å¼ä¸»è¦çš„ç”¨é€”ï¼š&lt;/p>
&lt;ul>
&lt;li>Elasticsearchï¼šå®ƒæ˜¯ä¸€å€‹é›†ä¸­å„²å­˜ log çš„åœ°æ–¹ï¼Œæ›´é‡è¦çš„æ˜¯å®ƒæ˜¯ä¸€å€‹å…¨æ–‡æª¢ç´¢ä»¥åŠåˆ†æçš„å¼•æ“ï¼Œå®ƒèƒ½è®“ç”¨æˆ¶ä»¥è¿‘ä¹å¯¦æ™‚çš„æ–¹å¼ä¾†æŸ¥çœ‹ã€åˆ†ææµ·é‡çš„æ•¸æ“šã€‚&lt;/li>
&lt;li>Logstashã€Filebeatsã€Fluentdï¼šå®ƒå€‘ä¸»è¦æ˜¯æ”¶é›†åˆ†ä½ˆåœ¨å„è™•çš„ log ä¸¦é€²è¡Œè™•ç†(Filebeats åƒ…æ”¶é›†)ã€‚&lt;/li>
&lt;li>Kibanaï¼šå®ƒæ˜¯ç‚º Elasticsearch é–‹ç™¼çš„å‰ç«¯ GUIï¼Œå¯ä»¥è®“ç”¨æˆ¶å¾ˆæ–¹ä¾¿çš„ä»¥åœ–å½¢åŒ–é€²è¡ŒæŸ¥è©¢ Elasticsearch ä¸­å„²å­˜çš„æ•¸æ“šï¼ŒåŒæ™‚ä¹Ÿæä¾›å„å¼å„æ¨£çš„æ¨¡çµ„å¯ä»¥ä½¿ç”¨ã€‚&lt;/li>
&lt;/ul>
&lt;br>
&lt;p>Logstashã€Filebeatsã€Fluentd é—œä¿‚ï¼š&lt;/p>
&lt;p>Filebeats æ˜¯ä¸€å€‹è¼•é‡ç´šæ”¶é›†æœ¬åœ° log æ•¸æ“šçš„æ–¹æ¡ˆï¼Œå®ƒåƒ…èƒ½æ”¶é›†æœ¬åœ°çš„ logï¼Œä¸èƒ½å° log åšè™•ç†ï¼Œæ‰€ä»¥ Filebeats é€šå¸¸æœƒå°‡ log é€åˆ° Logstash åšé€²ä¸€æ­¥çš„è™•ç†ã€‚&lt;/p>
&lt;p>é‚£ç‚ºä»€éº¼ä¸ç›´æ¥ä½¿ç”¨ Logstash ä¾†æ”¶é›†æ”¶é›†ä¸¦è™•ç† log å‘¢ï¼Ÿ&lt;/p>
&lt;p>å› ç‚º Logstash æœƒæ¶ˆè€—è¨±å¤šçš„è¨˜æ†¶é«”ï¼Œæ‰€ä»¥æ‰æœƒå…ˆé€é Filebeats æ”¶é›†è³‡æ–™å†å‚³çµ¦ Logstash åšè™•ç†ã€‚&lt;/p>
&lt;p>å¦å¤– Filebeatsã€Logstashã€Elasticsearch å’Œ Kibana éƒ½æ˜¯å±¬æ–¼åŒä¸€å®¶å…¬å¸çš„é–‹æºé …ç›®ï¼š&lt;a href="https://www.elastic.co/guide/index.html" target="_blank" rel="noopener">https://www.elastic.co/guide/&lt;/a>&lt;/p>
&lt;p>è€Œ Fluentd å‰‡æ˜¯å¦ä¸€å®¶å…¬å¸çš„é–‹æºé …ç›®ï¼š&lt;a href="https://docs.fluentd.org/" target="_blank" rel="noopener">https://docs.fluentd.org/&lt;/a>&lt;/p>
&lt;p>é‚£æˆ‘å€‘åœ¨é€™é‚Šå°±ä½¿ç”¨ Fluentd ä¾†åšæˆ‘å€‘çš„ EFK ç¤ºç¯„ï¼š&lt;/p>
&lt;figure>&lt;img src="https://pin-yi.me/rd/redis-sentinel-docker-compose-haproxy-efk/efk.jpeg"
alt="EFK ç¤ºæ„åœ– EFK Stack: Elasticsearch, Fluentd and Kibana on Docker" width="700">&lt;figcaption>
&lt;p>EFK ç¤ºæ„åœ– &lt;a href="https://aesher9o1.medium.com/efk-stack-elasticsearch-fluentd-and-kibana-on-docker-be60597fa99" target="_blank" rel="noopener">EFK Stack: Elasticsearch, Fluentd and Kibana on Docker&lt;/a>&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>ä¸Šé¢é€™å¼µåœ–ä»£è¡¨æˆ‘å€‘æœƒæœ‰å¾ˆå¤š Docker å®¹å™¨çš„ log (ä¹Ÿå°±æ˜¯ä¹‹å‰çš„ redis ä»¥åŠå…¶ä»– nginx ç­‰çš„å®¹å™¨)ï¼Œæœƒå…ˆé€é Fluentd æ”¶é›†ä¸¦è™•ç†å„å®¹å™¨çš„ log åœ¨å‚³é€åˆ° Elasticsearch é›†ä¸­å„²å­˜ï¼Œå†ä½¿ç”¨ Kibana åœ–å½¢åŒ–ä»‹é¢ä¾†æŸ¥è©¢æˆ–æª¢ç´¢å„²åœ¨ Elasticsearch çš„ logã€‚&lt;/p>
&lt;br>
&lt;h2>å¯¦ä½œ&lt;span class="hx-absolute -hx-mt-20" id="å¯¦ä½œ">&lt;/span>
&lt;a href="#%e5%af%a6%e4%bd%9c" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>é‚£æ¥ä¸‹ä¾†æœƒä½¿ç”¨ Docker-compose å¯¦ä½œ EFK çš„ LOG åˆ†æï¼Œ&lt;a href="https://github.com/880831ian/docker-compose-redis-sentinel-haproxy-efk" target="_blank" rel="noopener">ç¯„ä¾‹ç¨‹å¼é€£çµ é»æˆ‘&lt;/a> ğŸ˜˜&lt;/p>
&lt;p>ç‰ˆæœ¬è³‡è¨Š&lt;/p>
&lt;ul>
&lt;li>macOSï¼š11.6&lt;/li>
&lt;li>Dockerï¼šDocker version 20.10.12, build e91ed57&lt;/li>
&lt;li>Nginxï¼š1.20&lt;/li>
&lt;li>PHPï¼š7.4-fpm&lt;/li>
&lt;li>Redisï¼š6.2.6&lt;/li>
&lt;li>HAProxyï¼šHAProxy version 2.5.5-384c5c5 2022/03/14 - &lt;a href="https://haproxy.org/" target="_blank" rel="noopener">https://haproxy.org/&lt;/a>&lt;/li>
&lt;li>Elasticsearchï¼š8.1.3&lt;/li>
&lt;li>Fluentdï¼šv1.14&lt;/li>
&lt;li>Kibanaï¼š8.1.3&lt;/li>
&lt;/ul>
&lt;br>
&lt;h3>æª”æ¡ˆçµæ§‹&lt;span class="hx-absolute -hx-mt-20" id="æª”æ¡ˆçµæ§‹">&lt;/span>
&lt;a href="#%e6%aa%94%e6%a1%88%e7%b5%90%e6%a7%8b" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;pre>&lt;code>.
â”œâ”€â”€ docker-volume
â”‚Â Â  â”œâ”€â”€ fluentd
â”‚Â Â  â”‚Â Â  â””â”€â”€ fluent.conf
â”‚Â Â  â”œâ”€â”€ haproxy
â”‚Â Â  â”‚Â Â  â””â”€â”€ haproxy.cfg
â”‚Â Â  â”œâ”€â”€ nginx
â”‚Â Â  â”‚Â Â  â””â”€â”€ nginx.conf
â”‚Â Â  â”œâ”€â”€ php
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ info.php
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ r.php
â”‚Â Â  â”‚Â Â  â””â”€â”€ rw.php
â”‚Â Â  â””â”€â”€ redis
â”‚Â Â  â”œâ”€â”€ redis.conf
â”‚Â Â  â”œâ”€â”€ redis1
â”‚Â Â  â”œâ”€â”€ redis2
â”‚Â Â  â””â”€â”€ redis3
â”œâ”€â”€ docker.sh
â”œâ”€â”€ efk
â”‚Â Â  â””â”€â”€ Docker-compose.yaml
â”œâ”€â”€ fluentd
â”‚Â Â  â””â”€â”€ Dockerfile
â”œâ”€â”€ haproxy_sentinel
â”‚Â Â  â”œâ”€â”€ Docker-compose.yaml
â”‚Â Â  â”œâ”€â”€ sentinel1
â”‚Â Â  â”‚Â Â  â””â”€â”€ sentinel.conf
â”‚Â Â  â”œâ”€â”€ sentinel2
â”‚Â Â  â”‚Â Â  â””â”€â”€ sentinel.conf
â”‚Â Â  â””â”€â”€ sentinel3
â”‚Â Â  â””â”€â”€ sentinel.conf
â”œâ”€â”€ nginx_php_redis
â”‚Â Â  â””â”€â”€ Docker-compose.yaml
â””â”€â”€ php
â””â”€â”€ Dockerfile&lt;/code>&lt;/pre>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;p>é€™æ˜¯ä¸»è¦çš„çµæ§‹ï¼Œç°¡å–®èªªæ˜ä¸€ä¸‹ï¼š(æª”æ¡ˆè¶Šä¾†è¶Šå¤šäº†XDï¼Œé€™æ¬¡æŠŠæ¯ä¸€å€‹éƒ½æœ‰åˆ†é¡ï¼Œæ‰€ä»¥çµæ§‹æœƒèˆ‡ä¹‹å‰ä¸å¤ªç›¸åŒ)&lt;/p>
&lt;ul>
&lt;li>docker-volume/fluentd/fluent.confï¼šfluentd çš„è¨­å®šæª”ã€‚&lt;/li>
&lt;li>docker-volume/haproxy/haproxy.cfgï¼šhaproxy çš„è¨­å®šæª”ã€‚&lt;/li>
&lt;li>docker-volume/nginx/nginx.confï¼šnginx çš„è¨­å®šæª”ã€‚&lt;/li>
&lt;li>docker-volume/php/(r.phpã€rw.php)ï¼šæ¸¬è©¦ç”¨æª”æ¡ˆã€‚&lt;/li>
&lt;li>docker-volume/redis/redis.confï¼šredis çš„è¨­å®šæª”ã€‚&lt;/li>
&lt;li>docker-volume/redis/(redis1ã€redis2ã€redis3)ï¼šæ”¾ redis çš„è³‡æ–™ã€‚&lt;/li>
&lt;li>docker.shï¼šæ˜¯æˆ‘å¦å¤–å¤šå¯«çš„è…³æœ¬ï¼Œå¯ä»¥æŸ¥çœ‹ç›¸å°æ‡‰çš„è§’è‰²ã€‚&lt;/li>
&lt;li>efk/Docker-compose.yamlï¼šæœƒæ”¾ç½®è¦ç”¢ç”Ÿçš„ elasticsearchã€kibanaã€fluentd çš„å®¹å™¨è¨­å®šæª”ã€‚&lt;/li>
&lt;li>fluentd/Dockerfileï¼šå› ç‚º fluentd éœ€è¦å¦å¤–å®‰è£ fluent-plugin-elasticsearch æ‰èƒ½ä½¿ç”¨ï¼Œæ‰€ä»¥ç”¨ Dockerfile å¦å¤–å¯« fluent çš„æ˜ åƒæª”ã€‚&lt;/li>
&lt;li>haproxy_sentinel/Docker-compose.yamlï¼šæœƒæ”¾ç½®è¦ç”¢ç”Ÿçš„ haproxyã€sentinel1ã€sentinel2ã€sentinel3 çš„å®¹å™¨è¨­å®šæª”ã€‚&lt;/li>
&lt;li>haproxy_sentinel/(sentinel1ã€sentinel2ã€sentinel3)/.confï¼šå“¨å…µçš„è¨­å®šæª”ã€‚&lt;/li>
&lt;li>nginx_php_redis/Docker-compose.yamlï¼šæœƒæ”¾ç½®è¦ç”¢ç”Ÿçš„ nginxã€phpã€redis1ã€redis2ã€redis3 çš„å®¹å™¨è¨­å®šæª”ã€‚&lt;/li>
&lt;li>php/Dokcerfileï¼šå› ç‚ºåœ¨ php è¦ä½¿ç”¨ redis éœ€è¦å¤šå®‰è£ä¸€äº›è¨­å®šï¼Œæ‰€ä»¥ç”¨ Dockerfile å¦å¤–å¯« PHP çš„æ˜ åƒæª”ã€‚&lt;/li>
&lt;/ul>
&lt;br>
&lt;p>é‚£æˆ‘å€‘å°±ä¾ç…§å®‰è£çš„è¨­å®šé–‹å§‹èªªæ˜ï¼š(é€™é‚Šåªèªªæ˜èˆ‡ä¸Šä¸€ç¯‡ä¸åŒåœ°æ–¹ï¼Œé‡è¤‡çš„å°±è«‹å¤§å®¶å›å»çœ‹ä¹‹å‰çš„æ–‡ç« )
&lt;br>&lt;/p>
&lt;h3>docker-volume/fluentd/fluent.conf&lt;span class="hx-absolute -hx-mt-20" id="docker-volumefluentdfluentconf">&lt;/span>
&lt;a href="#docker-volumefluentdfluentconf" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;pre>&lt;code>&amp;lt;source&amp;gt;
@type forward
bind 0.0.0.0
port 24224
&amp;lt;/source&amp;gt;
&amp;lt;match *.**&amp;gt;
@type copy
&amp;lt;store&amp;gt;
@type elasticsearch
host elasticsearch
port 9200
logstash_format true
logstash_prefix fluentd
logstash_dateformat %Y%m%d
include_tag_key true
type_name access_log
tag_key @log_name
flush_interval 1s
&amp;lt;/store&amp;gt;
&amp;lt;store&amp;gt;
@type stdout
&amp;lt;/store&amp;gt;
&amp;lt;/match&amp;gt;&lt;/code>&lt;/pre>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>é€™æ˜¯ fluent çš„è¨­å®šæª”ï¼Œå¯ä»¥åœ¨é€™é‚Šåšè‡ªè¨‚çš„è¨­å®šï¼Œä¾‹å¦‚ hostã€portã€é è¨­æ—¥æœŸã€tag_key ç­‰ç­‰ã€‚&lt;/p>
&lt;br>
&lt;h3>fluentd/Dockerfile&lt;span class="hx-absolute -hx-mt-20" id="fluentddockerfile">&lt;/span>
&lt;a href="#fluentddockerfile" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-Dockerfile" data-lang="Dockerfile">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">FROM&lt;/span>&lt;span style="color:#e6db74"> fluent/fluentd:v1.14&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">USER&lt;/span>&lt;span style="color:#e6db74"> root&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">RUN&lt;/span> &lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;gem&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;install&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;fluent-plugin-elasticsearch&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>å› ç‚ºæˆ‘å€‘éœ€è¦å…ˆå®‰è£ fluent-plugin-elasticsearch æ‰å¯ä»¥è®“ fluentd ä¾†ä½¿ç”¨ elasticsearchï¼Œæ‰€ä»¥å¤šå¯«ä¸€å€‹ Dockerfile ä¾†è¨­å®šã€‚&lt;/p>
&lt;br>
&lt;h3>efk/Docker-compose.yaml&lt;span class="hx-absolute -hx-mt-20" id="efkdocker-composeyaml">&lt;/span>
&lt;a href="#efkdocker-composeyaml" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yml" data-lang="yml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">version&lt;/span>: &lt;span style="color:#e6db74">&amp;#39;3.8&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">services&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">elasticsearch&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">image&lt;/span>: &lt;span style="color:#ae81ff">elasticsearch:8.1.3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">container_name&lt;/span>: &lt;span style="color:#ae81ff">elasticsearch&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">environment&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">discovery.type=single-node&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">xpack.security.enabled=false&lt;/span> &lt;span style="color:#75715e"># elasticsearch 8.xç‰ˆæœ¬å¾Œæœƒè‡ªå‹•é–‹å•ŸSSL&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">networks&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">efk_network&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ipv4_address&lt;/span>: &lt;span style="color:#ae81ff">172.20.0.3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ports&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">9200&lt;/span>:&lt;span style="color:#ae81ff">9200&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">kibana&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">image&lt;/span>: &lt;span style="color:#ae81ff">kibana:8.1.3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">container_name&lt;/span>: &lt;span style="color:#ae81ff">kibana&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">environment&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">ELASTICSEARCH_HOSTS=http://elasticsearch:9200&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># - I18N_LOCALE=zh-CN&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">networks&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">efk_network&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ipv4_address&lt;/span>: &lt;span style="color:#ae81ff">172.20.0.4&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ports&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">5601&lt;/span>:&lt;span style="color:#ae81ff">5601&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">depends_on&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">elasticsearch&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">fluentd&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">build&lt;/span>: &lt;span style="color:#ae81ff">../fluentd&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">container_name&lt;/span>: &lt;span style="color:#ae81ff">fluentd&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">volumes&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">../docker-volume/fluentd:/fluentd/etc&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">depends_on&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">elasticsearch&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ports&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e6db74">&amp;#34;24224:24224&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#e6db74">&amp;#34;24224:24224/udp&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">networks&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">efk_network&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ipv4_address&lt;/span>: &lt;span style="color:#ae81ff">172.20.0.5&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">networks&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">efk_network&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">driver&lt;/span>: &lt;span style="color:#ae81ff">bridge&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">efk_network&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ipam&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">config&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#f92672">subnet&lt;/span>: &lt;span style="color:#ae81ff">172.20.0.0&lt;/span>&lt;span style="color:#ae81ff">/16&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">gateway&lt;/span>: &lt;span style="color:#ae81ff">172.20.0.1&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>é€™é‚Šæ˜¯è¨­å®š EFK ä¸‰å€‹å®¹å™¨çš„æª”æ¡ˆï¼Œæ¯”è¼ƒç‰¹åˆ¥çš„æ˜¯ elasticsearch åœ¨ 8.x ç‰ˆæœ¬å¾Œæœƒè‡ªå‹•é–‹å•Ÿ SSL é€£ç·šï¼Œæ‰€ä»¥æ²’æœ‰ä½¿ç”¨çš„æˆ–æ˜¯åœ¨æ¸¬è©¦ä¸­çš„è¦å…ˆæŠŠå®ƒé—œæ‰ï¼Œä¸ç„¶æœƒé€£ä¸ä¸Šï¼ï¼Œkibana å®ƒæ”¯æ´ I18N å¤šèªç³»ï¼Œä½†ç›®å‰æ²’æœ‰ç¹é«”ä¸­æ–‡ï¼Œæ‰€ä»¥æƒ³è¦çœ‹ä¸­æ–‡çš„å¯ä»¥åˆ‡æˆ zh-CH çš„ç°¡é«”ä¸­æ–‡ä¾†ä½¿ç”¨ï¼Œå…¶ä»–å°±æ˜¯åŸºæœ¬çš„è¨­å®š Posts ä»¥åŠæˆ‘å€‘å…¨éƒ¨è¨­å®šå¥½ IPï¼Œåœ¨å¾ŒçºŒæ¸¬è©¦æœƒæ¯”è¼ƒæ–¹ä¾¿ï½&lt;/p>
&lt;br>
&lt;h3>nginx_php_redis/Docker-compose.yaml&lt;span class="hx-absolute -hx-mt-20" id="nginx_php_redisdocker-composeyaml">&lt;/span>
&lt;a href="#nginx_php_redisdocker-composeyaml" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yml" data-lang="yml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">version&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;3.8&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">services&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">nginx&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">image&lt;/span>: &lt;span style="color:#ae81ff">nginx&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">container_name&lt;/span>: &lt;span style="color:#ae81ff">nginx&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">networks&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">efk_network&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ports&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">8080&lt;/span>:&lt;span style="color:#ae81ff">80&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">volumes&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">../docker-volume/nginx/:/etc/nginx/conf.d/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">environment&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">TZ=Asia/Taipei&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">logging&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">driver&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;fluentd&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">options&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">fluentd-address&lt;/span>: &lt;span style="color:#ae81ff">172.20.0.5&lt;/span>:&lt;span style="color:#ae81ff">24224&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">tag&lt;/span>: &lt;span style="color:#ae81ff">nginx&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">php&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">build&lt;/span>: &lt;span style="color:#ae81ff">../php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">container_name&lt;/span>: &lt;span style="color:#ae81ff">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">networks&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">efk_network&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">expose&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">9000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">volumes&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">../docker-volume/php/:/var/www/html&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">environment&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">TZ=Asia/Taipei&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">logging&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">driver&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;fluentd&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">options&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">fluentd-address&lt;/span>: &lt;span style="color:#ae81ff">172.20.0.5&lt;/span>:&lt;span style="color:#ae81ff">24224&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">tag&lt;/span>: &lt;span style="color:#ae81ff">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">redis1&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">image&lt;/span>: &lt;span style="color:#ae81ff">redis&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">container_name&lt;/span>: &lt;span style="color:#ae81ff">redis1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">command&lt;/span>: &lt;span style="color:#ae81ff">redis-server /usr/local/etc/redis/redis.conf --appendonly yes&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">volumes&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">../docker-volume/redis/redis1/:/data&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">../docker-volume/redis/:/usr/local/etc/redis/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">environment&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">TZ=Asia/Taipei&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">networks&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">efk_network&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ipv4_address&lt;/span>: &lt;span style="color:#ae81ff">172.20.0.11&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ports&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">6379&lt;/span>:&lt;span style="color:#ae81ff">6379&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">logging&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">driver&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;fluentd&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">options&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">fluentd-address&lt;/span>: &lt;span style="color:#ae81ff">172.20.0.5&lt;/span>:&lt;span style="color:#ae81ff">24224&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">tag&lt;/span>: &lt;span style="color:#ae81ff">redis1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">redis2&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">image&lt;/span>: &lt;span style="color:#ae81ff">redis&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">container_name&lt;/span>: &lt;span style="color:#ae81ff">redis2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">command&lt;/span>: &lt;span style="color:#ae81ff">redis-server /usr/local/etc/redis/redis.conf --slaveof redis1 6379 --appendonly yes&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">volumes&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">../docker-volume/redis/redis2/:/data&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">../docker-volume/redis/:/usr/local/etc/redis/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">environment&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">TZ=Asia/Taipei&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">networks&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">efk_network&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ipv4_address&lt;/span>: &lt;span style="color:#ae81ff">172.20.0.12&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ports&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">6380&lt;/span>:&lt;span style="color:#ae81ff">6379&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">depends_on&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">redis1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">logging&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">driver&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;fluentd&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">options&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">fluentd-address&lt;/span>: &lt;span style="color:#ae81ff">172.20.0.5&lt;/span>:&lt;span style="color:#ae81ff">24224&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">tag&lt;/span>: &lt;span style="color:#ae81ff">redis2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">redis3&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">image&lt;/span>: &lt;span style="color:#ae81ff">redis&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">container_name&lt;/span>: &lt;span style="color:#ae81ff">redis3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">command&lt;/span>: &lt;span style="color:#ae81ff">redis-server /usr/local/etc/redis/redis.conf --slaveof redis1 6379 --appendonly yes&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">volumes&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">../docker-volume/redis/redis3/:/data&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">../docker-volume/redis/:/usr/local/etc/redis/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">environment&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">TZ=Asia/Taipei&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">networks&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">efk_network&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ipv4_address&lt;/span>: &lt;span style="color:#ae81ff">172.20.0.13&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ports&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">6381&lt;/span>:&lt;span style="color:#ae81ff">6379&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">depends_on&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">redis1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">redis2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">logging&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">driver&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;fluentd&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">options&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">fluentd-address&lt;/span>: &lt;span style="color:#ae81ff">172.20.0.5&lt;/span>:&lt;span style="color:#ae81ff">24224&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">tag&lt;/span>: &lt;span style="color:#ae81ff">redis3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">networks&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">efk_network&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">external&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">efk_network&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>é‚£é€™é‚ŠåŸºæœ¬ä¸Šéƒ½èˆ‡ä¸Šä¸€ç¯‡ä¸€æ¨£ï¼Œæ²’æœ‰ä¿®æ”¹ç‰¹åˆ¥çš„åœ°æ–¹ï¼Œåªæœ‰ä¿®æ”¹ç¶²è·¯åç¨±ä»¥åŠï¼š&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yml" data-lang="yml">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">logging&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">driver&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;fluentd&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">options&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">fluentd-address&lt;/span>: &lt;span style="color:#ae81ff">172.20.0.5&lt;/span>:&lt;span style="color:#ae81ff">24224&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">tag&lt;/span>: &lt;span style="color:#ae81ff">nginx&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>æˆ‘å€‘è¦æŠŠæ¯ä¸€å€‹å®¹å™¨çš„ log é€²è¡Œæ”¶é›†èˆ‡è™•ç†ï¼Œæ‰€ä»¥æˆ‘å€‘ä½¿ç”¨ logging ç„¶å¾Œ driver é¸æ“‡ fluentdï¼Œä¸¦ä¸”è¦è¨­å®š fluentd çš„ IP ä½ç½®ä»¥åŠæ¯ä¸€å€‹å®¹å™¨å¯è¨­å®šä¸åŒçš„ tag æ–¹ä¾¿æˆ‘å€‘æŸ¥è©¢ã€‚&lt;/p>
&lt;br>
&lt;h3>haproxy_sentinel/Docker-compose.yaml&lt;span class="hx-absolute -hx-mt-20" id="haproxy_sentineldocker-composeyaml">&lt;/span>
&lt;a href="#haproxy_sentineldocker-composeyaml" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yml" data-lang="yml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">version&lt;/span>: &lt;span style="color:#e6db74">&amp;#39;3.8&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">services&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">haproxy&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">image&lt;/span>: &lt;span style="color:#ae81ff">haproxy&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">container_name&lt;/span>: &lt;span style="color:#ae81ff">haproxy&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">volumes&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">../docker-volume/haproxy/:/usr/local/etc/haproxy&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">environment&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">TZ=Asia/Taipei&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">networks&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">efk_network&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ipv4_address&lt;/span>: &lt;span style="color:#ae81ff">172.20.0.20&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ports&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">16379&lt;/span>:&lt;span style="color:#ae81ff">6379&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">8404&lt;/span>:&lt;span style="color:#ae81ff">8404&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">logging&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">driver&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;fluentd&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">options&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">fluentd-address&lt;/span>: &lt;span style="color:#ae81ff">172.20.0.5&lt;/span>:&lt;span style="color:#ae81ff">24224&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">tag&lt;/span>: &lt;span style="color:#ae81ff">haproxy&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">sentinel1&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">image&lt;/span>: &lt;span style="color:#ae81ff">redis&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">container_name&lt;/span>: &lt;span style="color:#ae81ff">redis-sentinel-1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">networks&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">efk_network&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ports&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">26379&lt;/span>:&lt;span style="color:#ae81ff">26379&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">command&lt;/span>: &lt;span style="color:#ae81ff">redis-server /usr/local/etc/redis/sentinel.conf --sentinel&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">volumes&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">./sentinel1:/usr/local/etc/redis/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">environment&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">TZ=Asia/Taipei&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">logging&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">driver&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;fluentd&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">options&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">fluentd-address&lt;/span>: &lt;span style="color:#ae81ff">172.20.0.5&lt;/span>:&lt;span style="color:#ae81ff">24224&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">tag&lt;/span>: &lt;span style="color:#ae81ff">sentinel1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">sentinel2&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">image&lt;/span>: &lt;span style="color:#ae81ff">redis&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">container_name&lt;/span>: &lt;span style="color:#ae81ff">redis-sentinel-2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">networks&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">efk_network&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ports&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">26380&lt;/span>:&lt;span style="color:#ae81ff">26379&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">command&lt;/span>: &lt;span style="color:#ae81ff">redis-server /usr/local/etc/redis/sentinel.conf --sentinel&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">volumes&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">./sentinel2:/usr/local/etc/redis/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">environment&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">TZ=Asia/Taipei&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">logging&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">driver&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;fluentd&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">options&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">fluentd-address&lt;/span>: &lt;span style="color:#ae81ff">172.20.0.5&lt;/span>:&lt;span style="color:#ae81ff">24224&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">tag&lt;/span>: &lt;span style="color:#ae81ff">sentinel2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">sentinel3&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">image&lt;/span>: &lt;span style="color:#ae81ff">redis&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">container_name&lt;/span>: &lt;span style="color:#ae81ff">redis-sentinel-3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">networks&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">efk_network&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">ports&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">26381&lt;/span>:&lt;span style="color:#ae81ff">26379&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">command&lt;/span>: &lt;span style="color:#ae81ff">redis-server /usr/local/etc/redis/sentinel.conf --sentinel&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">volumes&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">./sentinel3:/usr/local/etc/redis/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">environment&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">TZ=Asia/Taipei&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">logging&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">driver&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;fluentd&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">options&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">fluentd-address&lt;/span>: &lt;span style="color:#ae81ff">172.20.0.5&lt;/span>:&lt;span style="color:#ae81ff">24224&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">tag&lt;/span>: &lt;span style="color:#ae81ff">sentinel3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">networks&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">efk_network&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">external&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">efk_network&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>èˆ‡å‰é¢ä¸€æ¨£ï¼Œå¤šäº†ä¸€å€‹ logging ä¾†è¨­å®š fluentd ä½ç½®ä»¥åŠ tagã€‚&lt;/p>
&lt;br>
&lt;h2>æ¸¬è©¦&lt;span class="hx-absolute -hx-mt-20" id="æ¸¬è©¦">&lt;/span>
&lt;a href="#%e6%b8%ac%e8%a9%a6" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>æˆ‘å€‘å…ˆç”¨ docker-compose up ä¾†å•Ÿå‹• efk/Docker-compose.yamlï¼Œæ¥è‘—å†å•Ÿå‹• nginx_php_redis/Docker-compose.yamlï¼Œæœ€å¾Œå•Ÿå‹• haproxy_sentinel/Docker-compose.yamlï¼š&lt;/p>
&lt;figure>&lt;img src="https://pin-yi.me/rd/redis-sentinel-docker-compose-haproxy-efk/efk-compose.png"
alt="å•Ÿå‹• efk/Docker-compose.yaml" width="700">&lt;figcaption>
&lt;p>å•Ÿå‹• efk/Docker-compose.yaml&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;figure>&lt;img src="https://pin-yi.me/rd/redis-sentinel-docker-compose-haproxy-efk/nginx-php-redis-compose.png"
alt="å•Ÿå‹• nginx_php_redis/Docker-compose.yaml" width="700">&lt;figcaption>
&lt;p>å•Ÿå‹• nginx_php_redis/Docker-compose.yaml&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;figure>&lt;img src="https://pin-yi.me/rd/redis-sentinel-docker-compose-haproxy-efk/haproxy-sentinel-compose.png"
alt="å•Ÿå‹• efk/Docker-compose.yaml" width="700">&lt;figcaption>
&lt;p>å•Ÿå‹• efk/Docker-compose.yaml&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;p>(å•Ÿå‹• efk æ™‚è¦ç­‰ä»–è·‘å®Œï¼Œå› ç‚ºä»–éœ€è¦å•Ÿå‹•ä¸€é™£å­ï¼Œå¦‚æœé‚„æ²’ç­‰ä»–å•Ÿå‹•å®Œç•¢å°±å•Ÿå‹•ä¸‹ä¸€å€‹ï¼Œæœƒå°è‡´ fluentd çš„ fluentd-address å°šæœªè¨­å®šå¥½ï¼Œå°è‡´å•Ÿå‹•éŒ¯èª¤)&lt;/p>
&lt;br>
&lt;p>é€™æ™‚å€™å¯ä»¥ä½¿ç”¨ç€è¦½å™¨æœå°‹ä»¥ä¸‹ç¶²å€ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>test.com:5601&lt;/code>ï¼šKibana GUI é é¢ã€‚&lt;/li>
&lt;/ul>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/rd/redis-sentinel-docker-compose-haproxy-efk/gui.png"
alt="kibana è¨­å®š" width="1000">&lt;figcaption>
&lt;p>kibana è¨­å®š&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>å¦‚æœé€£ç·šæˆåŠŸé€²ä¾†ï¼Œå°±ä»£è¡¨æˆ‘å€‘æœ‰å®‰è£å¥½ Elasticsearch ä»¥åŠ kibanaï¼Œé‚£æˆ‘å€‘ä¾†åšä¸€äº›è¨­å®šï¼Œè®“æˆ‘å€‘å¯ä»¥åœ¨ kibana ä¸Šé¢çœ‹åˆ° logã€‚&lt;/p>
&lt;p>å…ˆé»é¸å·¦é‚Šçš„æ¬„ä½ï¼Œé»é¸ &amp;ldquo;Stack Management&amp;rdquo; ï¼Œå¯ä»¥çœ‹åˆ°ç›®å‰çš„ kibana çš„ç‰ˆæœ¬ï¼Œå†é»é¸å·¦é‚Šçš„ &amp;ldquo;Kibana &amp;gt; Date Views&amp;rdquo;ï¼š&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/rd/redis-sentinel-docker-compose-haproxy-efk/kibana.png"
alt="kibana è¨­å®š" width="1000">&lt;figcaption>
&lt;p>kibana è¨­å®š&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;p>ç„¶å¾Œæœƒè·³å‡ºä¸€å€‹è¦–çª—é»é¸ &amp;ldquo;Create data view&amp;rdquo;ï¼Œåœ¨ name æ¬„ä½è¼¸å…¥ fluentd* (å³å´æœ‰ fluentd åŠ æ™‚é–“ï¼Œä»£è¡¨æˆ‘å€‘æ¥ fluentd æœ‰æˆåŠŸ)ï¼ŒæŒ‰ä¸‹ &amp;ldquo;Create data view&amp;rdquo;&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/rd/redis-sentinel-docker-compose-haproxy-efk/fluentd.png"
alt="kibana è¨­å®š" width="1000">&lt;figcaption>
&lt;p>kibana è¨­å®š&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;p>æ¥è‘—é»é¸å·¦å´çš„æ¬„ä½ï¼Œé»é¸ &amp;ldquo;Analytics &amp;gt; Discover&amp;rdquo; ï¼Œå°±å¯ä»¥çœ‹åˆ°æˆ‘å€‘ç›®å‰æ‰€æœ‰çš„ log å›‰ï¼&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/rd/redis-sentinel-docker-compose-haproxy-efk/fluentd-1.png"
alt="kibana è¨­å®š" width="1000">&lt;figcaption>
&lt;p>kibana è¨­å®š&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;figure>&lt;img src="https://pin-yi.me/rd/redis-sentinel-docker-compose-haproxy-efk/log.png"
alt="kibana Analytics &amp;amp;gt; Discover" width="1000">&lt;figcaption>
&lt;p>kibana Analytics &amp;gt; Discover&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;h2>åƒè€ƒè³‡æ–™&lt;span class="hx-absolute -hx-mt-20" id="åƒè€ƒè³‡æ–™">&lt;/span>
&lt;a href="#%e5%8f%83%e8%80%83%e8%b3%87%e6%96%99" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>elastic å®˜ç¶²ï¼š&lt;a href="https://www.elastic.co/" target="_blank" rel="noopener">https://www.elastic.co/&lt;/a>&lt;/p>
&lt;p>fluentd å®˜ç¶²ï¼š&lt;a href="https://www.fluentd.org/" target="_blank" rel="noopener">https://www.fluentd.org/&lt;/a>&lt;/p>
&lt;p>Build the EFK system used for simulating logging server on Dockerï¼š&lt;a href="https://stackoverflow.com/questions/71155142/build-the-efk-system-used-for-simulating-logging-server-on-docker" target="_blank" rel="noopener">https://stackoverflow.com/questions/71155142/build-the-efk-system-used-for-simulating-logging-server-on-docker&lt;/a>&lt;/p>
&lt;p>é–‹æºæ—¥èªŒç®¡ç†æ–¹æ¡ˆELK å’ŒEFK çš„å€åˆ¥ï¼š&lt;a href="https://wsgzao.github.io/post/efk/" target="_blank" rel="noopener">https://wsgzao.github.io/post/efk/&lt;/a>&lt;/p></description></item><item><title>Fluentd-Server å‡ºç¾ Fluent::Plugin::Elasticsearch Error 400 - Rejected by Elasticsearch éŒ¯èª¤è§£æ±º</title><link>https://pin-yi.me/blog/rd/fluentd-server-show-fluent-plugin-elasticsearch-error400/</link><pubDate>Thu, 08 Dec 2022 00:00:00 +0000</pubDate><guid>https://pin-yi.me/blog/rd/fluentd-server-show-fluent-plugin-elasticsearch-error400/</guid><description>
&lt;p>å…ˆèªªçµè«– &amp;hellip; &lt;del>EFK çœŸçš„å¥½å¤šé›· ğŸ˜†&lt;/del> æˆ‘å€‘ä»Šå¤©åˆå†åº¦è¸©é›·æ‹‰ï¼Œé€™æ¬¡åˆæ˜¯ç‚¸çš„åˆ†èº«ç¢éª¨ï¼ŒèŠ±äº† 4 å€‹å¤šå°æ™‚æ‰æ‰¾åˆ°åŸå› ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯å°å¼Ÿæˆ‘è·Ÿ EFK ä¸æ˜¯å¾ˆç†Ÿ XDã€‚å°±å¦‚æ¨™é¡Œæ‰€èªªï¼Œæˆ‘åœ¨æŠ½ Log çš„æ™‚å€™ç™¼ç¾æœ‰éƒ¨åˆ†çš„ Log é€ä¸åˆ° Kibanaï¼Œæª¢æŸ¥ Fluentd-Server çš„ Log ç™¼ç¾è£¡é¢æœ‰ &lt;code>Fluent::Plugin::Elasticsearch Error 400 - Rejected by Elasticsearch&lt;/code> çš„éŒ¯èª¤è¨Šæ¯ï¼Œåˆ°åº•é€™å€‹ Error 400 æ˜¯ä»€éº¼å’§ï¼Œå°±è·Ÿè‘—æˆ‘ä¸€èµ·é‡æº«æ‰¾å•é¡Œçš„è‹¦é›£å§ XD&lt;/p>
&lt;br>
&lt;h2>EFK çµæ§‹&lt;span class="hx-absolute -hx-mt-20" id="efk-çµæ§‹">&lt;/span>
&lt;a href="#efk-%e7%b5%90%e6%a7%8b" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>åœ¨é–‹å§‹ä¹‹å‰æˆ‘å…ˆç°¡å–®èªªä¸€ä¸‹æˆ‘ç¾åœ¨çš„ EFK çµæ§‹ï¼š&lt;/p>
&lt;figure>&lt;img src="https://pin-yi.me/rd/fluentd-server-show-fluent-plugin-elasticsearch-error400/1.png"
alt="EFK çµæ§‹" width="900">&lt;figcaption>
&lt;p>EFK çµæ§‹&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;p>ç¾åœ¨çš„ EFK çµæ§‹å¦‚ä¸Šåœ–ï¼Œæˆ‘åœ¨è¦æŠ½ Log çš„ Pod ä¸­å¤šå¡ä¸€å€‹ fluentd-bit containerï¼Œå°‡ fluentd-bit èˆ‡æœå‹™(ä¾‹å¦‚ nginx) çš„ log æ›ç›¸åŒè·¯å¾‘ï¼Œè®“ fluentd-bit å¯ä»¥æŠ½åˆ°æœå‹™ logï¼Œæ¥è‘—å°±é€é fluentd-server-svc æ‰“åˆ° fluentd-server podï¼Œå¾Œé¢å°±æ˜¯å¸¸è¦‹çš„ EFK çµæ§‹ï¼Œå°±ä¸å¤šåšèªªæ˜ã€‚&lt;/p>
&lt;br>
&lt;h2>å•é¡Œçš„å‡ºç¾&lt;span class="hx-absolute -hx-mt-20" id="å•é¡Œçš„å‡ºç¾">&lt;/span>
&lt;a href="#%e5%95%8f%e9%a1%8c%e7%9a%84%e5%87%ba%e7%8f%be" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>æˆ‘å€‘å°±åƒå¹³å¸¸ä¸€æ¨£å¯«å¥½æ•´å€‹ EFK çš„ yamlï¼Œrun çš„æ™‚å€™ä¹Ÿæ­£å¸¸ï¼Œå¯ä»¥æ”¶åˆ° logï¼Œä½†å¾ˆå¥‡æ€ªçš„æ˜¯æˆ‘å€‘å…ˆé€ &lt;code>log_false&lt;/code> çš„ log å¯ä»¥æ­£å¸¸æ”¶åˆ°ï¼Œä½†å†æ¥è‘—é€ &lt;code>log_true &lt;/code> å°±æ”¶ä¸åˆ°ï¼Œæˆ‘å€‘ä¹Ÿå˜—è©¦åéä¾†é€ï¼Œå…ˆé€ &lt;code>log_true&lt;/code>ï¼Œå†é€ &lt;code>log_false&lt;/code>ï¼Œç™¼ç¾æ›æ”¶ä¸åˆ° &lt;code>log_false&lt;/code> çš„ log&lt;/p>
&lt;br>
&lt;ul>
&lt;li>log_false&lt;/li>
&lt;/ul>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;result&amp;#34;&lt;/span>: &lt;span style="color:#66d9ef">false&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;message&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;æˆ‘æ˜¯é¦¬è³½å…‹&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;code&amp;#34;&lt;/span>: &lt;span style="color:#ae81ff">11223344&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;data&amp;#34;&lt;/span>: {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;end_at&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;2022-12-19 04:09:00&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> },
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;response_code&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;326dgf241geh1596489&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;job_name&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;å®å®å™¹å™¹è–èª•ç¯€&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;method&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;GET&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;url&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;url.com&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;ul>
&lt;li>log_true&lt;/li>
&lt;/ul>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;result&amp;#34;&lt;/span>: &lt;span style="color:#66d9ef">true&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;data&amp;#34;&lt;/span>: &lt;span style="color:#66d9ef">true&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;response_code&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;wkCJl1dfr45671607965&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;p>æ¥è‘—åœ¨ Fluentd-Server Log ä¸­ç™¼ç¾ Fluent::Plugin::Elasticsearch Error 400 - Rejected by Elasticsearch éŒ¯èª¤&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/rd/fluentd-server-show-fluent-plugin-elasticsearch-error400/2.png"
alt="fluentd-server è·³å‡ºéŒ¯èª¤ LOG" width="1000">&lt;figcaption>
&lt;p>fluentd-server è·³å‡ºéŒ¯èª¤ LOG&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>æˆ‘åˆ°ç¶²è·¯ä¸Šæœå°‹ï¼Œçœ‹çœ‹æœ‰æ²’æœ‰äººæœ‰é‡åˆ°è·Ÿæˆ‘ä¸€æ¨£çš„å•é¡Œï¼Œç™¼ç¾åœ¨ &lt;a href="https://github.com/uken/fluent-plugin-elasticsearch/issues/467" target="_blank" rel="noopener">uken/fluent-plugin-elasticsearch&lt;/a> ä¹Ÿæœ‰å…¶ä»–äººæœ‰é‡åˆ°åŒæ¨£çš„å•é¡Œ&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/rd/fluentd-server-show-fluent-plugin-elasticsearch-error400/3.png"
alt="uken/fluent-plugin-elasticsearch issus è©¢å•" width="1000">&lt;figcaption>
&lt;p>uken/fluent-plugin-elasticsearch issus è©¢å•&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;p>æœ‰äººèªªå¯èƒ½æ˜¯ Elasticsearch çš„ disk æ»¿äº†ï¼Œä¹Ÿæœ‰äººèªªæ˜¯è£åœ¨ Fluentd-Server çš„å¥—ä»¶ fluent-plugin-elasticsearch ç‰ˆæœ¬æœ‰å•é¡Œï¼Œæˆ–æ˜¯å°‡ Elasticsearch è·Ÿ Kibana index åˆªé™¤å°±å¯ä»¥ï¼Œæˆ‘æœ‰ç æ‰ index å†é‡æ–°å€’å…¥ Logï¼Œé‚„æ˜¯æœƒæœ‰å•é¡Œã€‚&lt;/p>
&lt;p>ä¸€é–‹å§‹ä»¥ç‚ºæ˜¯ &lt;code>log_false&lt;/code> è·Ÿ &lt;code>log_true&lt;/code> çš„æ¬„ä½ä¸åŒï¼Œæ‰€ä»¥æ‰æœƒæœ‰é€™å€‹å•é¡Œç™¼ç”Ÿï¼ˆä½ çœ‹å°±çŸ¥é“æˆ‘è·Ÿ EFK ä¸ç†Ÿå§ï¼¸ï¼¤ï¼‰ï¼Œæ‰€ä»¥æœ‰å¦å¤–å€’ä¸€äº›å…¶ä»–æœå‹™(æ¬„ä½ä¹Ÿä¸åŒ)çš„ log é€²å»æ¸¬è©¦ï¼Œç™¼ç¾æ˜¯å¯ä»¥æ­£å¸¸æŠ½åˆ°ï¼Œä¸” kibana é‚£é‚Šæœƒä¾ç…§ es æä¾›çš„æ¬„ä½è‡ªå‹•æ–°å¢ï¼Œæ‰€ä»¥ä¹Ÿä¸æ˜¯æ¬„ä½çš„å•é¡Œï¼Œé‚£æœ€å¾Œçš„å•é¡Œæ˜¯ä»€éº¼å‘¢ï¼Ÿ&lt;/p>
&lt;br>
&lt;h2>å¦‚ä½•è§£æ±ºå•é¡Œ&lt;span class="hx-absolute -hx-mt-20" id="å¦‚ä½•è§£æ±ºå•é¡Œ">&lt;/span>
&lt;a href="#%e5%a6%82%e4%bd%95%e8%a7%a3%e6%b1%ba%e5%95%8f%e9%a1%8c" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>æœ€å¾Œåœ¨æˆ‘å€‘ä»”ç´°æª¢æŸ¥å¾Œç™¼ç¾ï¼Œ&lt;code>log_false&lt;/code> è·Ÿ &lt;code>log_true&lt;/code> çš„æ¬„ä½å…¶ä¸­ä¸€æ¨£å­˜çš„è³‡æ–™å‹æ…‹ä¸å¤ªä¸€æ¨£ï¼Œç™¼ç¾å…¶ä¸­çš„ &lt;code>data&lt;/code> æ¬„ä½åœ¨ &lt;code>log_false&lt;/code> çš„è³‡æ–™å‹æ…‹æ˜¯ arrayï¼Œåœ¨ &lt;code>log_true&lt;/code> å­˜çš„æ™‚å€™æ˜¯å­—ä¸²ï¼Œæ‰€ä»¥å°è‡´ç•¶å…¶ä¸­ä¸€å€‹ log å¯«å…¥å¾Œï¼Œå¦ä¸€å€‹ log å°±æœƒå› ç‚ºåŒæ¬„ä½çš„è³‡æ–™å‹æ…‹æœ‰æ‰€ä¸åŒï¼Œè€Œç„¡æ³•å¯«å…¥ logï¼Œä¸”åœ¨ Fluentd-Server æœƒå‡ºç¾æ¨™é¡Œçš„ Error 400 åŸå› æ‹‰ï½&lt;/p>
&lt;p>æœ€å¾Œé‡æ–°èª¿æ•´æ¬„ä½çš„è³‡æ–™å‹æ…‹ï¼Œå°±é †åˆ©è§£æ±ºæ­¤æ¬¡å•é¡Œ âœŒï¸âœŒï¸âœŒï¸&lt;/p>
&lt;br>
&lt;h2>åƒè€ƒè³‡æ–™&lt;span class="hx-absolute -hx-mt-20" id="åƒè€ƒè³‡æ–™">&lt;/span>
&lt;a href="#%e5%8f%83%e8%80%83%e8%b3%87%e6%96%99" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>Elasticsearch 400 error #467ï¼š&lt;a href="https://github.com/uken/fluent-plugin-elasticsearch/issues/467" target="_blank" rel="noopener">https://github.com/uken/fluent-plugin-elasticsearch/issues/467&lt;/a>&lt;/p></description></item><item><title>Kibana æ–°å¢ index ç´¢å¼•æ™‚ä¸€ç›´è½‰åœˆåœˆä»¥åŠé¡¯ç¤º HTTP 403 Forbidden</title><link>https://pin-yi.me/blog/rd/kibana-create-index-forbidden/</link><pubDate>Wed, 01 May 2024 00:00:00 +0000</pubDate><guid>https://pin-yi.me/blog/rd/kibana-create-index-forbidden/</guid><description>
&lt;p>å‰å¹¾å¤©åœ¨å·¥ä½œä½¿ç”¨ Kibana æ™‚ï¼Œæƒ³è¦æ–°å¢ä¸€å€‹æ–°çš„ç´¢å¼•ï¼Œç™¼ç¾é¸æ“‡ç´¢å¼•ä¸¦æŒ‰ä¸‹æ–°å¢çš„æŒ‰éˆ•ï¼Œæœƒä¸€ç›´è½‰åœˆåœˆï¼Œç­‰äº†ä¸€é™£å­ï¼Œä½¿ç”¨é–‹ç™¼å·¥å…· F12 æŸ¥çœ‹ï¼Œè·³å‡ºäº† HTTP 403 Forbiddenï¼Œåˆ°åº•æ˜¯ä»€éº¼åŸå› å°è‡´çš„å‘¢ï¼ï¼Ÿæˆ‘å€‘ä¸€èµ·çœ‹ä¸‹å»å§ï¼Œæœƒå¾å•é¡Œçš„å‡ºç¾åˆ°å•é¡ŒåŸå› å†åˆ°å¦‚ä½•è§£æ±ºå•é¡Œï¼Œä¾†ä»”ç´°ä»‹ç´¹ï¼Œå¸Œæœ›å¤§å®¶ä¸è¦åƒæˆ‘ä¸€æ¨£è¸©åˆ°é›· ğŸ¤£&lt;/p>
&lt;br>
&lt;h2>å•é¡Œçš„å‡ºç¾&lt;span class="hx-absolute -hx-mt-20" id="å•é¡Œçš„å‡ºç¾">&lt;/span>
&lt;a href="#%e5%95%8f%e9%a1%8c%e7%9a%84%e5%87%ba%e7%8f%be" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>&lt;del>é‚£å¤©æ˜¯å€‹è®Šå†·çš„ 12 æœˆ&lt;/del>ï¼Œè¦å¹« RD åŒä»æ–°å¢ Kibana çš„ç´¢å¼•æ™‚ï¼Œç…§å¾€å¸¸ä¸€æ¨£è¼¸å…¥ Index patternï¼ŒæŒ‰ä¸‹ä¸€æ­¥ï¼Œé¸æ“‡ Configure settings ï¼š&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/rd/kibana-create-index-forbidden/1.png"
alt="è¼¸å…¥ Index pattern (åœ–ç‰‡ç‚ºç¯„ä¾‹ï¼Œæ­£å¸¸éƒ½æ˜¯ç”¨ -* )" width="800">&lt;figcaption>
&lt;p>è¼¸å…¥ Index pattern (åœ–ç‰‡ç‚ºç¯„ä¾‹ï¼Œæ­£å¸¸éƒ½æ˜¯ç”¨ -* )&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>æŒ‰ä¸‹æ–°å¢ç´¢å¼•ï¼Œä»–å°±é–‹å§‹ç„¡é™çš„è½‰åœˆåœˆï¼Œæœ‰å»æŸ¥çœ‹ ElasticSearch çš„ logï¼Œç™¼ç¾ä¹Ÿæ²’æœ‰ç‰¹åˆ¥çš„éŒ¯èª¤è¨Šæ¯&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/rd/kibana-create-index-forbidden/2.png"
alt="æ–°å¢ç´¢å¼•å¾Œï¼Œä¸€ç›´è½‰åœˆåœˆ" width="800">&lt;figcaption>
&lt;p>æ–°å¢ç´¢å¼•å¾Œï¼Œä¸€ç›´è½‰åœˆåœˆ&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>æ¥è‘—æƒ³èªªæ‰“é–‹é–‹ç™¼è€…å·¥å…· F12 ä¾†çœ‹çœ‹ï¼Œæ˜¯å¡åœ¨å“ªä¸€å€‹é»ï¼Œå»ç™¼ç¾æœ‰å¹¾å€‹ç´…å­—å¯«è‘— HTTP 403 Forbidden&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/rd/kibana-create-index-forbidden/3.png"
alt="é–‹ç™¼è€…å·¥å…·ç¶²é å…§å®¹é¡¯ç¤º HTTP 403 Forbidden" width="800">&lt;figcaption>
&lt;p>é–‹ç™¼è€…å·¥å…·ç¶²é å…§å®¹é¡¯ç¤º HTTP 403 Forbidden&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>æƒ³èªªç‚ºä»€éº¼æœƒæœ‰ HTTP 403 Forbiddenï¼Œä¹‹å‰ä¹Ÿæ²’æœ‰çœ‹éé¡ä¼¼çš„éŒ¯èª¤è¨Šæ¯ï¼Œæ–¼æ˜¯å°±é–‹å§‹åœ¨ç¶²è·¯ä¸Šäº‚æ™ƒï¼Œæœ€å¾Œåœ¨åŒäº‹çš„å¹«åŠ©ä¸‹æ‰¾åˆ°äº†ä¸€å€‹è·Ÿæˆ‘å€‘æƒ…æ³å¾ˆç›¸ä¼¼çš„æ–‡ç«  &lt;a href="https://www.cnblogs.com/caoweixiong/p/10972120.html" target="_blank" rel="noopener">Kibana åˆ›å»ºç´¢å¼• POST 403 (forbidden) on create index&lt;/a>&lt;/p>
&lt;br>
&lt;h2>å•é¡ŒåŸå› &lt;span class="hx-absolute -hx-mt-20" id="å•é¡ŒåŸå› ">&lt;/span>
&lt;a href="#%e5%95%8f%e9%a1%8c%e5%8e%9f%e5%9b%a0" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>æ–‡ç« çš„èªªæ˜æ˜¯ç´¢å¼•è®Šæˆåªå…è¨±è®€å–çš„ç‹€æ…‹ï¼Œå…¶åŸå› æ˜¯å› ç‚ºå‡ºç¾é€™å€‹ HTTP 403 Forbidden å‰ï¼ŒElasticSearch çš„ç©ºé–“æ»¿äº†ï¼Œå°è‡´ Kibana æœƒè‡ªå‹•çš„å°‡ç´¢å¼•æ”¹æˆåªå…è¨±è®€å–çš„ç‹€æ…‹ï¼Œæˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹å‰›å‰›çš„ Index ç‹€æ…‹æ˜¯ä¸æ˜¯åƒä»–èªªçš„ä¸€æ¨£è®Šæˆåªå…è¨±è®€å–çš„ç‹€æ…‹å‘¢&lt;/p>
&lt;br>
&lt;div class="hx-overflow-x-auto hx-mt-6 hx-flex hx-rounded-lg hx-border hx-py-2 ltr:hx-pr-4 rtl:hx-pl-4 contrast-more:hx-border-current contrast-more:dark:hx-border-current hx-border-orange-100 hx-bg-orange-50 hx-text-orange-800 dark:hx-border-orange-400/30 dark:hx-bg-orange-400/20 dark:hx-text-orange-300">
&lt;div class="ltr:hx-pl-3 ltr:hx-pr-2 rtl:hx-pr-3 rtl:hx-pl-2">&lt;/div>
&lt;div class="hx-w-full hx-min-w-0 hx-leading-7">
&lt;div class="hx-mt-6 hx-leading-7 first:hx-mt-0">å¯ä»¥åˆ° kibana çš„ Dev Tools ä¸‹æŒ‡ä»¤ä¾†æŸ¥è©¢æ­ï¼Œè¼¸å…¥ &lt;code>GET _settings&lt;/code>ï¼Œå°±æœƒé¡¯ç¤ºä»¥ä¸‹åœ–ç‰‡çš„å…§å®¹å›‰&lt;/div>
&lt;/div>
&lt;/div>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/rd/kibana-create-index-forbidden/4.png"
alt="ç´¢å¼•åªå…è¨±è®€å–çš„è¨­å®šè®Šæˆ" width="900">&lt;figcaption>
&lt;p>ç´¢å¼•åªå…è¨±è®€å–çš„è¨­å®šè®Šæˆ&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>ç™¼ç¾æ­£å¦‚æ–‡ç« æ‰€èªªï¼Œæ˜¯å› ç‚º read_only_allow_delete çš„ç‹€æ…‹è®Šæˆäº† &lt;code>true&lt;/code>ï¼Œæ‰€ä»¥æ‰æ²’è¾¦æ³•æ–°å¢ç´¢å¼•ï½&lt;/p>
&lt;br>
&lt;h2>å¦‚ä½•è§£æ±ºå•é¡Œ&lt;span class="hx-absolute -hx-mt-20" id="å¦‚ä½•è§£æ±ºå•é¡Œ">&lt;/span>
&lt;a href="#%e5%a6%82%e4%bd%95%e8%a7%a3%e6%b1%ba%e5%95%8f%e9%a1%8c" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>æˆ‘å€‘æŸ¥çœ‹æ–‡ç« çš„è§£æ±ºè¾¦æ³•ï¼Œæœ‰å…©ç¨®è¾¦æ³•ï¼Œä¸€å€‹æ˜¯æ“´å¤§ ElasticSearch çš„ç©ºé–“ï¼Œä»¥åŠä½¿ç”¨ kibana çš„ Dev Tools ä¸‹æŒ‡ä»¤ä¿®æ”¹ï¼Œé‚£æˆ‘å€‘å…©ç¨®éƒ½æœ‰åšï¼Œé€™é‚Šå°±ç›´æ¥ä»‹ç´¹ä¸‹æŒ‡ä»¤éœ€è¦è¼¸å…¥ä»€éº¼ï½&lt;/p>
&lt;p>éœ€è¦å† Dev Tools è¼¸å…¥ä»¥ä¸‹æŒ‡ä»¤ï¼Œä¾†ä¿®æ”¹ Index çš„ç‹€æ…‹ï¼š&lt;/p>
&lt;br>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">PUT&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">_settings&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;index&amp;#34;&lt;/span>: {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;blocks&amp;#34;&lt;/span>: {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;read_only_allow_delete&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;false&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/rd/kibana-create-index-forbidden/5.png"
alt="Dev Tools ä¿®æ”¹ Index çš„ç‹€æ…‹" width="600">&lt;figcaption>
&lt;p>Dev Tools ä¿®æ”¹ Index çš„ç‹€æ…‹&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>æœ€å¾Œæˆ‘å€‘ç”¨ &lt;code>GET _settings&lt;/code> æª¢æŸ¥ä¸€ä¸‹ç´¢å¼•ç‹€æ…‹æ˜¯ä¸æ˜¯å·²ç¶“è®Šå›åŸæœ¬çš„äº†ï¼š&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/rd/kibana-create-index-forbidden/6.png"
alt="ç´¢å¼•åªå…è¨±è®€å–çš„è¨­å®šè®Šæˆ false" width="900">&lt;figcaption>
&lt;p>ç´¢å¼•åªå…è¨±è®€å–çš„è¨­å®šè®Šæˆ false&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>æœ€å¾Œå°±å¯ä»¥é †åˆ©æ–°å¢ç´¢å¼•æ‹‰ ğŸ‘ğŸ‘ğŸ‘&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/rd/kibana-create-index-forbidden/7.png"
alt="é †åˆ©æ–°å¢ç´¢å¼•" width="900">&lt;figcaption>
&lt;p>é †åˆ©æ–°å¢ç´¢å¼•&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;h2>åƒè€ƒè³‡æ–™&lt;span class="hx-absolute -hx-mt-20" id="åƒè€ƒè³‡æ–™">&lt;/span>
&lt;a href="#%e5%8f%83%e8%80%83%e8%b3%87%e6%96%99" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>Kibana åˆ›å»ºç´¢å¼• POST 403 (forbidden) on create indexï¼š&lt;a href="https://www.cnblogs.com/caoweixiong/p/10972120.html" target="_blank" rel="noopener">https://www.cnblogs.com/caoweixiong/p/10972120.html&lt;/a>&lt;/p></description></item></channel></rss>