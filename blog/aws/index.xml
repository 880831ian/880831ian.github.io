<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>PIN-YI – Amazon Web Services</title><link>https://pin-yi.me/blog/aws/</link><description>Recent content in Amazon Web Services on PIN-YI</description><generator>Hugo -- gohugo.io</generator><language>zh-tw</language><atom:link href="https://pin-yi.me/blog/aws/index.xml" rel="self" type="application/rss+xml"/><item><title>Elastic Kubernetes Service (EKS) 介紹</title><link>https://pin-yi.me/blog/aws/eks-introduce/</link><pubDate>Fri, 26 Jul 2024 00:00:00 +0000</pubDate><guid>https://pin-yi.me/blog/aws/eks-introduce/</guid><description>
&lt;p>由於公司政策調整，除了原先的 Google Cloud Platform (GCP) 之外，我們也開始使用 AWS 服務，其中包括了 EKS (Elastic Kubernetes Service)。這篇文章將會介紹 EKS 的基本概念以及一些使用上的注意事項。&lt;/p>
&lt;p>後面也會有幾篇 AWS 文章，歡迎大家持續關注。&lt;/p>
&lt;br>
&lt;h2>什麼是 EKS？&lt;span class="absolute -mt-20" id="什麼是-eks">&lt;/span>
&lt;a href="#%e4%bb%80%e9%ba%bc%e6%98%af-eks" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>那熟悉 Kubernetes 的朋友應該對 EKS 並不陌生，EKS 是 AWS 提供的 Kubernetes 服務，讓使用者可以在 AWS 上快速建立、擴展和管理 Kubernetes 集群。就跟 GCP 的 GKE 一樣。&lt;/p>
&lt;br>
&lt;p>流程也跟 GKE 差不多，如圖：&lt;/p>
&lt;ol>
&lt;li>
&lt;p>建立 Cluster：可以透過 eksctl、AWS Console、AWS CLI、Terraform 等等來建立。&lt;/p>
&lt;ul>
&lt;li>eksctl：是一個官方專門給 EKS 的 CLI 工具，可以快速建立、更新和刪除 EKS 集群，詳細可以看：&lt;a href="https://eksctl.io/" target="_blank" rel="noopener">eksctl&lt;/a>、&lt;a href="https://docs.aws.amazon.com/zh_tw/eks/latest/userguide/getting-started-eksctl.html" target="_blank" rel="noopener">Amazon EKS 入門&lt;/a>。&lt;/li>
&lt;/ul>
&lt;p>Mac 安裝指令：&lt;/p>
&lt;div class="code-block relative mt-6 first:mt-0 group/code">&lt;pre>&lt;code>brew tap weaveworks/tap
brew install weaveworks/tap/eksctl&lt;/code>&lt;/pre>&lt;div class="opacity-0 transition group-hover/code:opacity-100 flex gap-1 absolute m-[11px] right-0 top-0">
&lt;button
class="code-copy-btn group/copybtn transition-all active:opacity-50 bg-primary-700/5 border border-black/5 text-gray-600 hover:text-gray-900 rounded-md p-1.5 dark:bg-primary-300/10 dark:border-white/10 dark:text-gray-400 dark:hover:text-gray-50"
title="Copy code"
>
&lt;div class="group-[.copied]/copybtn:hidden copy-icon pointer-events-none h-4 w-4">&lt;/div>
&lt;div class="hidden group-[.copied]/copybtn:block success-icon pointer-events-none h-4 w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;ul>
&lt;li>AWS CLI：是官方的 CLI 工具，除了建立 EKS 集群，還可以管理其他 AWS 服務，詳細可以看：我的另一篇筆記 &lt;a href="../aws-cli" >設定 AWS CLI 以及 AWS CLI 指令說明&lt;/a>。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>選擇運算資源的方式：可以分成 &lt;a href="https://aws.amazon.com/tw/fargate/" target="_blank" rel="noopener">Fargate&lt;/a>、&lt;a href="https://karpenter.sh/" target="_blank" rel="noopener">Karpenter&lt;/a>、託管節點群組和自管理節點。那我們使用主要是使用自我管理節點。其他的方式會在後面的文章介紹。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>設定：設定必要的控制器、驅動程式或是服務等等。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>部署工作負載：自訂 Kubernetes 物件，例如 Pod、Service、Deployment 等等。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>管理：監督工作負載，整合 AWS 服務以簡化維運並提高工作負載效能。&lt;/p>
&lt;/li>
&lt;/ol>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/aws/eks-introduce/1.png"
alt="在雲端中執行 Amazon EKS 的基本流程" width="750">&lt;figcaption>
&lt;p>在雲端中執行 Amazon EKS 的基本流程&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>其他比較詳細的架構以及部署選項可以參考：&lt;a href="https://docs.aws.amazon.com/eks/latest/userguide/eks-architecture.html" target="_blank" rel="noopener">Amazon EKS 架構&lt;/a>、&lt;a href="https://docs.aws.amazon.com/eks/latest/userguide/eks-deployment-options.html" target="_blank" rel="noopener">部署選項&lt;/a>，這邊就不再贅述。&lt;/p>
&lt;br>
&lt;h2>EKS 定價&lt;span class="absolute -mt-20" id="eks-定價">&lt;/span>
&lt;a href="#eks-%e5%ae%9a%e5%83%b9" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;br>
&lt;h2>參考資料&lt;span class="absolute -mt-20" id="參考資料">&lt;/span>
&lt;a href="#%e5%8f%83%e8%80%83%e8%b3%87%e6%96%99" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>What is Amazon EKS?：&lt;a href="https://docs.aws.amazon.com/eks/latest/userguide/what-is-eks.html" target="_blank" rel="noopener">https://docs.aws.amazon.com/eks/latest/userguide/what-is-eks.html&lt;/a>&lt;/p></description></item><item><title>如何使用 MFA Token 驗證 AWS CLI</title><link>https://pin-yi.me/blog/aws/cli-mfa/</link><pubDate>Thu, 01 Aug 2024 00:00:00 +0000</pubDate><guid>https://pin-yi.me/blog/aws/cli-mfa/</guid><description>
&lt;p>會有這一篇文章也是跟 &lt;a href="../iam-introduce" >Identity and Access Management (IAM) 介紹&lt;/a> 一樣，在測試 eksctl 建立 EKS 時，發現一直噴錯，說我沒有權限，但我去看我的 IAM Policy 也有加上對應 action 以及 resource，但還是不行，後來發現 &lt;code>cloudformation:*&lt;/code> 這個 action 所在的 Policy 有加上 Condition MFA 驗證的條件，所以就來寫一篇如何使用 MFA Token 驗證 AWS CLI 的文章。&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/aws/cli-mfa/1.png"
alt="沒有權限噴錯QQ" width="850">&lt;figcaption>
&lt;p>沒有權限噴錯QQ&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;h2>前情提要&lt;span class="absolute -mt-20" id="前情提要">&lt;/span>
&lt;a href="#%e5%89%8d%e6%83%85%e6%8f%90%e8%a6%81" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>我目前有 3 個 IAM Policy，分別是：&lt;/p>
&lt;ol>
&lt;li>default-policy：放一些個人基本的 IAM 權限&lt;/li>
&lt;/ol>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/aws/cli-mfa/2.png"
alt="default-policy" width="650">&lt;figcaption>
&lt;p>default-policy&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;ol start="2">
&lt;li>poc-general-policy：放一些我在測試的 PoC 的 IAM 權限，&lt;b>但是仔細看這邊有 Condition MFA 驗證的條件&lt;/b>。&lt;/li>
&lt;/ol>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/aws/cli-mfa/3.png"
alt="poc-general-policy" width="650">&lt;figcaption>
&lt;p>poc-general-policy&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;ol start="3">
&lt;li>ReadOnlyAccess：預設的 ReadOnlyAccess 權限。&lt;/li>
&lt;/ol>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/aws/cli-mfa/4.png"
alt="ReadOnlyAccess" width="650">&lt;figcaption>
&lt;p>ReadOnlyAccess&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>當你設定好 &lt;code>aws configure&lt;/code> 後，你會拿到一個永久性的 IAM 憑證 (也就是 Access Key ID 和 Secret Access Key，設定可以看&lt;a href="../aws-cli/#%e9%85%8d%e7%bd%ae-aws-cli" >配置 AWS CLI&lt;/a>)，但是如果你的 Policy 有加上 MFA 驗證的條件，那你就需要使用 MFA Token 來驗證，那要怎麼做呢？&lt;/p>
&lt;br>
&lt;h2>查詢目前有沒有設定 MFA&lt;span class="absolute -mt-20" id="查詢目前有沒有設定-mfa">&lt;/span>
&lt;a href="#%e6%9f%a5%e8%a9%a2%e7%9b%ae%e5%89%8d%e6%9c%89%e6%b2%92%e6%9c%89%e8%a8%ad%e5%ae%9a-mfa" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>可以先查詢目前有沒有設定 MFA，可以透過以下指令：&lt;/p>
&lt;div class="code-block relative mt-6 first:mt-0 group/code">&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>aws iam list-mfa-devices --user-name &lt;span style="color:#f92672">{&lt;/span>USER_NAME&lt;span style="color:#f92672">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="opacity-0 transition group-hover/code:opacity-100 flex gap-1 absolute m-[11px] right-0 top-0">
&lt;button
class="code-copy-btn group/copybtn transition-all active:opacity-50 bg-primary-700/5 border border-black/5 text-gray-600 hover:text-gray-900 rounded-md p-1.5 dark:bg-primary-300/10 dark:border-white/10 dark:text-gray-400 dark:hover:text-gray-50"
title="Copy code"
>
&lt;div class="group-[.copied]/copybtn:hidden copy-icon pointer-events-none h-4 w-4">&lt;/div>
&lt;div class="hidden group-[.copied]/copybtn:block success-icon pointer-events-none h-4 w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>將 &lt;code>{USER_NAME}&lt;/code> 換成自己的使用者名稱，如果有設定 MFA，就會顯示出來，如下：&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/aws/cli-mfa/5.png"
alt="顯示 mfa 裝置" width="650">&lt;figcaption>
&lt;p>顯示 mfa 裝置&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;h2>產生 MFA Token&lt;span class="absolute -mt-20" id="產生-mfa-token">&lt;/span>
&lt;a href="#%e7%94%a2%e7%94%9f-mfa-token" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>我們確定我們有 MFA 設定後，就可以透過已經設定好的 MFA 以及剛剛的 SerialNumber 來產生 MFA Token，指令如下：&lt;/p>
&lt;div class="code-block relative mt-6 first:mt-0 group/code">&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>aws sts get-session-token --duration-seconds &lt;span style="color:#ae81ff">129600&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --serial-number &lt;span style="color:#f92672">{&lt;/span>MFA_DEVICES_NUMBER&lt;span style="color:#f92672">}&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --token-code &lt;span style="color:#f92672">{&lt;/span>MFA_CODE&lt;span style="color:#f92672">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="opacity-0 transition group-hover/code:opacity-100 flex gap-1 absolute m-[11px] right-0 top-0">
&lt;button
class="code-copy-btn group/copybtn transition-all active:opacity-50 bg-primary-700/5 border border-black/5 text-gray-600 hover:text-gray-900 rounded-md p-1.5 dark:bg-primary-300/10 dark:border-white/10 dark:text-gray-400 dark:hover:text-gray-50"
title="Copy code"
>
&lt;div class="group-[.copied]/copybtn:hidden copy-icon pointer-events-none h-4 w-4">&lt;/div>
&lt;div class="hidden group-[.copied]/copybtn:block success-icon pointer-events-none h-4 w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>首先 &lt;code>--duration-seconds&lt;/code> 參數是 MFA Token 的有效時間，單位是秒，預設是 12 小時，我們可以調整 900 秒 (15 分鐘) 到 129600 秒 (36 小時)，root 使用者憑證，範圍為 900 秒 (15 分鐘）到 3600 秒 (1 小時)，大家可以自行調整。&lt;/p>
&lt;p>&lt;code>{MFA_DEVICES_NUMBER}&lt;/code> 換成剛剛查詢到的 MFA 裝置的 SerialNumber，最後將 &lt;code>{MFA_CODE}&lt;/code> 換成你的 MFA 的 Code。&lt;/p>
&lt;br>
&lt;p>一起來看一下輸出結果：&lt;/p>
&lt;div class="code-block relative mt-6 first:mt-0 group/code">&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;Credentials&amp;#34;&lt;/span>: &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;AccessKeyId&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;ASIA2HCXXXXXXXXXXXXX&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;SecretAccessKey&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;25CBN6CjRNLPukXXXXXXXXXXXXX&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;SessionToken&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;FwoGZXIvYXdzEXXXXXXXXXXXXX&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;Expiration&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;2024-08-02T19:42:36+00:00&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="opacity-0 transition group-hover/code:opacity-100 flex gap-1 absolute m-[11px] right-0 top-0">
&lt;button
class="code-copy-btn group/copybtn transition-all active:opacity-50 bg-primary-700/5 border border-black/5 text-gray-600 hover:text-gray-900 rounded-md p-1.5 dark:bg-primary-300/10 dark:border-white/10 dark:text-gray-400 dark:hover:text-gray-50"
title="Copy code"
>
&lt;div class="group-[.copied]/copybtn:hidden copy-icon pointer-events-none h-4 w-4">&lt;/div>
&lt;div class="hidden group-[.copied]/copybtn:block success-icon pointer-events-none h-4 w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>AccessKeyId、SecretAccessKey 就跟 &lt;code>aws configure&lt;/code> 拿到的 Access Key ID 和 Secret Access Key 是一樣的類型，只是還多一個 SessionToken，這個 SessionToken 是有經過 MFA 驗證過，所以可以用來執行需要 MFA 驗證條件的 Policy。&lt;/p>
&lt;br>
&lt;h2>寫入設定檔&lt;span class="absolute -mt-20" id="寫入設定檔">&lt;/span>
&lt;a href="#%e5%af%ab%e5%85%a5%e8%a8%ad%e5%ae%9a%e6%aa%94" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>當你拿到 Token 以外，你不可能每次下指令都帶 Token，所以我們要把它寫到 &lt;code>~/.aws/credentials&lt;/code> 檔案中，這樣就可以自動帶入 Token 了。&lt;/p>
&lt;p>我們在 &lt;code>aws configure&lt;/code> 的時候，會有一個 &lt;code>profile&lt;/code> 的選項，這個選項就是用來設定不同的憑證，預設是 &lt;code>default&lt;/code>，我們可以自己設定一個新的憑證，如下：&lt;/p>
&lt;div class="code-block relative mt-6 first:mt-0 group/code">&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>mfa&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>aws_access_key_id &lt;span style="color:#f92672">=&lt;/span> ASIA2HCXXXXXXXXXXXXX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>aws_secret_access_key &lt;span style="color:#f92672">=&lt;/span> 25CBN6CjRNLPukXXXXXXXXXXXXX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>aws_session_token &lt;span style="color:#f92672">=&lt;/span> FwoGZXIvYXdzEXXXXXXXXXXXXX&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="opacity-0 transition group-hover/code:opacity-100 flex gap-1 absolute m-[11px] right-0 top-0">
&lt;button
class="code-copy-btn group/copybtn transition-all active:opacity-50 bg-primary-700/5 border border-black/5 text-gray-600 hover:text-gray-900 rounded-md p-1.5 dark:bg-primary-300/10 dark:border-white/10 dark:text-gray-400 dark:hover:text-gray-50"
title="Copy code"
>
&lt;div class="group-[.copied]/copybtn:hidden copy-icon pointer-events-none h-4 w-4">&lt;/div>
&lt;div class="hidden group-[.copied]/copybtn:block success-icon pointer-events-none h-4 w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;p>所以當你要使用 MFA Token 的時候，只要在指令後面加上 &lt;code>--profile mfa&lt;/code> 就可以了。&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/aws/cli-mfa/6.png"
alt="就可以用 poc-general-policy 的 action 囉～" width="850">&lt;figcaption>
&lt;p>就可以用 poc-general-policy 的 action 囉～&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;p>當然，如果每次都需要下指令去取得 Token 也是很麻煩的，所以我寫了一個 Shell Script 來幫我們取得 Token 並寫入 &lt;code>~/.aws/credentials&lt;/code> 檔案中，這樣就可以省去每次都要下指令的麻煩了。程式也會同步到 &lt;a href="https://github.com/880831ian/aws-cli-mfa" target="_blank" rel="noopener">Github&lt;/a>，大家可以自行下載使用。&lt;/p>
&lt;div class="code-block relative mt-6 first:mt-0 group/code">&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#! /bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>USER_NAME&lt;span style="color:#f92672">=&lt;/span>$1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>MFA_CODE&lt;span style="color:#f92672">=&lt;/span>$2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 顏色設定&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>RED&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;\033[1;31m&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>GREEN&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;\033[1;32m&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>YELLOW&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;\033[1;33m&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>BLUE&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;\033[1;34m&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>WHITE&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;\033[0m&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">[&lt;/span> -z $USER_NAME &lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">||&lt;/span> &lt;span style="color:#f92672">[&lt;/span> -z $MFA_CODE &lt;span style="color:#f92672">]&lt;/span>; &lt;span style="color:#66d9ef">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> echo -e &lt;span style="color:#e6db74">&amp;#34;\n&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>YELLOW&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">提醒說明：請輸入使用者名稱 與 MFA 驗證碼\n格式如下：./aws_mfa.sh ian_zhuang 235821 &amp;lt;&amp;lt; (請依照手機上的 MFA 號碼)。&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>WHITE&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">\n&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> exit &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">[[&lt;/span> ! &lt;span style="color:#e6db74">&amp;#34;&lt;/span>$MFA_CODE&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&lt;/span>~ ^&lt;span style="color:#f92672">[&lt;/span>0-9&lt;span style="color:#f92672">]{&lt;/span>6&lt;span style="color:#f92672">}&lt;/span>$ &lt;span style="color:#f92672">]]&lt;/span>; &lt;span style="color:#66d9ef">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> echo -e &lt;span style="color:#e6db74">&amp;#34;\n&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>YELLOW&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">提醒說明：MFA 驗證碼只支援 6 碼數字。&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>WHITE&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">\n&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> exit &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>MFA_DEVICES_NUMBER&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">$(&lt;/span>aws iam list-mfa-devices --user-name &lt;span style="color:#e6db74">${&lt;/span>USER_NAME&lt;span style="color:#e6db74">}&lt;/span> | jq -r &lt;span style="color:#e6db74">&amp;#39;.MFADevices[0].SerialNumber&amp;#39;&lt;/span>&lt;span style="color:#66d9ef">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">[&lt;/span> -z $MFA_DEVICES_NUMBER &lt;span style="color:#f92672">]&lt;/span>; &lt;span style="color:#66d9ef">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> echo -e &lt;span style="color:#e6db74">&amp;#34;\n&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>RED&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">錯誤說明：MFA 裝置不存在，請確認使用者名稱是否輸入正確&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>WHITE&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">\n&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> exit &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>MFA_INFO&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">$(&lt;/span>aws sts get-session-token --duration-seconds &lt;span style="color:#ae81ff">129600&lt;/span> --serial-number &lt;span style="color:#e6db74">${&lt;/span>MFA_DEVICES_NUMBER&lt;span style="color:#e6db74">}&lt;/span> --token-code &lt;span style="color:#e6db74">${&lt;/span>MFA_CODE&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#66d9ef">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">[&lt;/span> $? -eq &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#f92672">]&lt;/span>; &lt;span style="color:#66d9ef">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MFA_ACCESS_KEY_ID&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">$(&lt;/span>echo $MFA_INFO | jq -r &lt;span style="color:#e6db74">&amp;#39;.Credentials.AccessKeyId&amp;#39;&lt;/span>&lt;span style="color:#66d9ef">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MFA_SECRET_ACCESS_KEY&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">$(&lt;/span>echo $MFA_INFO | jq -r &lt;span style="color:#e6db74">&amp;#39;.Credentials.SecretAccessKey&amp;#39;&lt;/span>&lt;span style="color:#66d9ef">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MFA_SESSION_TOKEN&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">$(&lt;/span>echo $MFA_INFO | jq -r &lt;span style="color:#e6db74">&amp;#39;.Credentials.SessionToken&amp;#39;&lt;/span>&lt;span style="color:#66d9ef">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MFA_EXPIRATION&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">$(&lt;/span>echo $MFA_INFO | jq -r &lt;span style="color:#e6db74">&amp;#39;.Credentials.Expiration&amp;#39;&lt;/span>&lt;span style="color:#66d9ef">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 計算 MFA 到期時間(轉換時區)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MFA_0_TIME&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">$(&lt;/span>date -j -f &lt;span style="color:#e6db74">&amp;#34;%Y-%m-%dT%H:%M:%S&amp;#34;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#66d9ef">$(&lt;/span>echo &lt;span style="color:#e6db74">&amp;#34;&lt;/span>$MFA_EXPIRATION&lt;span style="color:#e6db74">&amp;#34;&lt;/span> | sed &lt;span style="color:#e6db74">&amp;#39;s/+00:00//&amp;#39;&lt;/span>&lt;span style="color:#66d9ef">)&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;+%Y-%m-%d %H:%M:%S&amp;#34;&lt;/span>&lt;span style="color:#66d9ef">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MFA_8_TIME&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">$(&lt;/span>date -j -v+8H -f &lt;span style="color:#e6db74">&amp;#34;%Y-%m-%d %H:%M:%S&amp;#34;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>$MFA_0_TIME&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;+%Y-%m-%d %H:%M:%S&amp;#34;&lt;/span>&lt;span style="color:#66d9ef">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MFA_CREDENTIALS&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;[mfa]\naws_access_key_id = &lt;/span>$MFA_ACCESS_KEY_ID&lt;span style="color:#e6db74">\naws_secret_access_key = &lt;/span>$MFA_SECRET_ACCESS_KEY&lt;span style="color:#e6db74">\naws_session_token = &lt;/span>$MFA_SESSION_TOKEN&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 檢查是否已經有 [mfa] 區塊&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> grep -q &lt;span style="color:#e6db74">&amp;#34;\[mfa\]&amp;#34;&lt;/span> ~/.aws/credentials; &lt;span style="color:#66d9ef">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 更新 [mfa] 區塊&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sed -i &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;/\[mfa\]/,/^$/d&amp;#39;&lt;/span> ~/.aws/credentials
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> echo -e &lt;span style="color:#e6db74">&amp;#34;&lt;/span>$MFA_CREDENTIALS&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &amp;gt;&amp;gt;~/.aws/credentials
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 新增 [mfa] 區塊&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> echo -e &lt;span style="color:#e6db74">&amp;#34;\n\n&lt;/span>$MFA_CREDENTIALS&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &amp;gt;&amp;gt;~/.aws/credentials
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> echo -e &lt;span style="color:#e6db74">&amp;#34;\n&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>GREEN&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">MFA 驗證成功，將 Key 跟 Token 加入or修改到 ~/.aws/credentials 檔案中&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>WHITE&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> echo -e &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>BLUE&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">到期時間：&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>MFA_8_TIME&lt;span style="color:#e6db74">}${&lt;/span>WHITE&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">\n&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> echo -e &lt;span style="color:#e6db74">&amp;#34;\n&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>RED&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">MFA 驗證失敗，請確認 MFA 驗證碼是否正確&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>WHITE&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">\n&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> exit &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">fi&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="opacity-0 transition group-hover/code:opacity-100 flex gap-1 absolute m-[11px] right-0 top-0">
&lt;button
class="code-copy-btn group/copybtn transition-all active:opacity-50 bg-primary-700/5 border border-black/5 text-gray-600 hover:text-gray-900 rounded-md p-1.5 dark:bg-primary-300/10 dark:border-white/10 dark:text-gray-400 dark:hover:text-gray-50"
title="Copy code"
>
&lt;div class="group-[.copied]/copybtn:hidden copy-icon pointer-events-none h-4 w-4">&lt;/div>
&lt;div class="hidden group-[.copied]/copybtn:block success-icon pointer-events-none h-4 w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;p>只需要執行 &lt;code>./aws_mfa.sh {USER_NAME} {MFA_CODE}&lt;/code> 就可以了，程式會自動幫你取得 Token 並寫入 &lt;code>~/.aws/credentials&lt;/code> 檔案中。&lt;/p>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/aws/cli-mfa/7.png"
alt="執行腳本" width="700">&lt;figcaption>
&lt;p>執行腳本&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;h2>參考資料&lt;span class="absolute -mt-20" id="參考資料">&lt;/span>
&lt;a href="#%e5%8f%83%e8%80%83%e8%b3%87%e6%96%99" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>How do I use an MFA token to authenticate access to my AWS resources through the AWS CLI?
：&lt;a href="https://repost.aws/knowledge-center/authenticate-mfa-cli" target="_blank" rel="noopener">https://repost.aws/knowledge-center/authenticate-mfa-cli&lt;/a>&lt;/p></description></item><item><title>設定 AWS CLI 以及 AWS CLI 指令說明</title><link>https://pin-yi.me/blog/aws/aws-cli/</link><pubDate>Fri, 26 Jul 2024 00:00:00 +0000</pubDate><guid>https://pin-yi.me/blog/aws/aws-cli/</guid><description>
&lt;h2>介紹&lt;span class="absolute -mt-20" id="介紹">&lt;/span>
&lt;a href="#%e4%bb%8b%e7%b4%b9" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>AWS CLI 是用於使用 AWS 服務的命令列工具。它也用於對 IAM 使用者或角色進行身份驗證，以便從本機電腦存取 Amazon EKS 叢集和其他 AWS 資源。若要從命令列在 AWS 中設定資源，您需要取得要在命令列中使用的 AWS 存取金鑰 ID 和金鑰。&lt;/p>
&lt;br>
&lt;h2>如何安裝 AWS CLI&lt;span class="absolute -mt-20" id="如何安裝-aws-cli">&lt;/span>
&lt;a href="#%e5%a6%82%e4%bd%95%e5%ae%89%e8%a3%9d-aws-cli" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>Mac 安裝指令：&lt;/p>
&lt;div class="code-block relative mt-6 first:mt-0 group/code">&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>brew install awscli&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="opacity-0 transition group-hover/code:opacity-100 flex gap-1 absolute m-[11px] right-0 top-0">
&lt;button
class="code-copy-btn group/copybtn transition-all active:opacity-50 bg-primary-700/5 border border-black/5 text-gray-600 hover:text-gray-900 rounded-md p-1.5 dark:bg-primary-300/10 dark:border-white/10 dark:text-gray-400 dark:hover:text-gray-50"
title="Copy code"
>
&lt;div class="group-[.copied]/copybtn:hidden copy-icon pointer-events-none h-4 w-4">&lt;/div>
&lt;div class="hidden group-[.copied]/copybtn:block success-icon pointer-events-none h-4 w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>自動補齊指令：&lt;/p>
&lt;div class="code-block relative mt-6 first:mt-0 group/code">&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>complete -C &lt;span style="color:#e6db74">&amp;#39;/usr/local/bin/aws_completer&amp;#39;&lt;/span> aws&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="opacity-0 transition group-hover/code:opacity-100 flex gap-1 absolute m-[11px] right-0 top-0">
&lt;button
class="code-copy-btn group/copybtn transition-all active:opacity-50 bg-primary-700/5 border border-black/5 text-gray-600 hover:text-gray-900 rounded-md p-1.5 dark:bg-primary-300/10 dark:border-white/10 dark:text-gray-400 dark:hover:text-gray-50"
title="Copy code"
>
&lt;div class="group-[.copied]/copybtn:hidden copy-icon pointer-events-none h-4 w-4">&lt;/div>
&lt;div class="hidden group-[.copied]/copybtn:block success-icon pointer-events-none h-4 w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;h2>如何設定 AWS CLI&lt;span class="absolute -mt-20" id="如何設定-aws-cli">&lt;/span>
&lt;a href="#%e5%a6%82%e4%bd%95%e8%a8%ad%e5%ae%9a-aws-cli" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>AWS 跟 GCP 比較不一樣的是 CLI 在 Google (gcloud) 可以使用 Web 登入的方式來驗證 &lt;code>gcloud auto login&lt;/code>，但是在 AWS 需要使用 Access Key ID 和 Secret Access Key 來驗證。&lt;/p>
&lt;p>因此我們在開始使用前，需要先透過 UI 產生自己帳號的 Access Key ID 和 Secret Access Key，才能夠有權限下指令。&lt;/p>
&lt;br>
&lt;h3>建立存取密鑰&lt;span class="absolute -mt-20" id="建立存取密鑰">&lt;/span>
&lt;a href="#%e5%bb%ba%e7%ab%8b%e5%ad%98%e5%8f%96%e5%af%86%e9%91%b0" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>需要先確認是否有以下的 IAM 權限：&lt;/p>
&lt;div class="code-block relative mt-6 first:mt-0 group/code">&lt;pre>&lt;code>&amp;#34;Action&amp;#34;: [
&amp;#34;iam:CreateAccessKey&amp;#34;,
&amp;#34;iam:DeleteAccessKey&amp;#34;,
&amp;#34;iam:GetAccessKeyLastUsed&amp;#34;,
&amp;#34;iam:ListAccessKeys&amp;#34;,
&amp;#34;iam:UpdateAccessKey&amp;#34;,
&amp;#34;iam:TagUser&amp;#34;
]&lt;/code>&lt;/pre>&lt;div class="opacity-0 transition group-hover/code:opacity-100 flex gap-1 absolute m-[11px] right-0 top-0">
&lt;button
class="code-copy-btn group/copybtn transition-all active:opacity-50 bg-primary-700/5 border border-black/5 text-gray-600 hover:text-gray-900 rounded-md p-1.5 dark:bg-primary-300/10 dark:border-white/10 dark:text-gray-400 dark:hover:text-gray-50"
title="Copy code"
>
&lt;div class="group-[.copied]/copybtn:hidden copy-icon pointer-events-none h-4 w-4">&lt;/div>
&lt;div class="hidden group-[.copied]/copybtn:block success-icon pointer-events-none h-4 w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;ul>
&lt;li>TagUser：是用來幫金鑰加上標籤值，方便管理。&lt;/li>
&lt;/ul>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/aws/aws-cli/1.png"
alt="沒有權限會噴錯" width="850">&lt;figcaption>
&lt;p>沒有權限會噴錯&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;ol>
&lt;li>先登入 AWS 的管理控制台。&lt;/li>
&lt;li>點擊右上角的 AWS 使用者名稱，並點選「安全憑證」。&lt;/li>
&lt;/ol>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/aws/aws-cli/2.png"
alt="在 AWS 的管理控制台，選擇安全憑證" width="750">&lt;figcaption>
&lt;p>在 AWS 的管理控制台，選擇安全憑證&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;ol start="3">
&lt;li>找到存取金鑰，並點選「建立存取金鑰」，如果有建立過，也會顯示在這邊。&lt;/li>
&lt;/ol>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/aws/aws-cli/3.png"
alt="建立存取金鑰" width="1100">&lt;figcaption>
&lt;p>建立存取金鑰&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;ol start="4">
&lt;li>點選「命令列介面 (CLI)」，下方要勾選一個確認建議的選項，最後按下一步。&lt;/li>
&lt;/ol>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/aws/aws-cli/4.png"
alt="選擇命令列介面 (CLI)案例" width="900">&lt;figcaption>
&lt;p>選擇命令列介面 (CLI)案例&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;ol start="5">
&lt;li>可以選擇是否要建立標籤，如果要建立，需要前面提到的 &lt;code>iam:TagUser&lt;/code> IAM 權限。&lt;/li>
&lt;/ol>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/aws/aws-cli/5.png"
alt="設定描述標籤" width="950">&lt;figcaption>
&lt;p>設定描述標籤&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;ol start="6">
&lt;li>就可以拿到存取金鑰 (Access Key ID) 以及私密存取金鑰 (Secret Access Key)，&lt;b>要記住私密存取金鑰，只有這個畫面可以拿到，如果沒有儲存，就需要重新建立一個新的金鑰&lt;/b>。&lt;/li>
&lt;/ol>
&lt;br>
&lt;figure>&lt;img src="https://pin-yi.me/aws/aws-cli/6.png"
alt="產生完金鑰" width="1100">&lt;figcaption>
&lt;p>產生完金鑰&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;br>
&lt;br>
&lt;h3>配置 AWS CLI&lt;span class="absolute -mt-20" id="配置-aws-cli">&lt;/span>
&lt;a href="#%e9%85%8d%e7%bd%ae-aws-cli" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;ol>
&lt;li>接下來我們要在本機把剛剛產生的 Access Key ID 和 Secret Access Key 設定到 AWS CLI，我們可以下這個指令。&lt;/li>
&lt;/ol>
&lt;div class="code-block relative mt-6 first:mt-0 group/code">&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>aws configure&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="opacity-0 transition group-hover/code:opacity-100 flex gap-1 absolute m-[11px] right-0 top-0">
&lt;button
class="code-copy-btn group/copybtn transition-all active:opacity-50 bg-primary-700/5 border border-black/5 text-gray-600 hover:text-gray-900 rounded-md p-1.5 dark:bg-primary-300/10 dark:border-white/10 dark:text-gray-400 dark:hover:text-gray-50"
title="Copy code"
>
&lt;div class="group-[.copied]/copybtn:hidden copy-icon pointer-events-none h-4 w-4">&lt;/div>
&lt;div class="hidden group-[.copied]/copybtn:block success-icon pointer-events-none h-4 w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;ol start="2">
&lt;li>下完後，就會顯示以下設定畫面，分別輸入 Access Key ID、Secret Access Key、預設區域以及輸出格式。&lt;/li>
&lt;/ol>
&lt;div class="code-block relative mt-6 first:mt-0 group/code">&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>AWS Access Key ID &lt;span style="color:#f92672">[&lt;/span>None&lt;span style="color:#f92672">]&lt;/span>: AAKIA2HCM5WKG7R647HTV
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>AWS Secret Access Key &lt;span style="color:#f92672">[&lt;/span>None&lt;span style="color:#f92672">]&lt;/span>: ******************************
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Default region name &lt;span style="color:#f92672">[&lt;/span>None&lt;span style="color:#f92672">]&lt;/span>: region-code &lt;span style="color:#f92672">(&lt;/span>例如：亞太地區東京 ap-northeast-1&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Default output format &lt;span style="color:#f92672">[&lt;/span>None&lt;span style="color:#f92672">]&lt;/span>: json&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="opacity-0 transition group-hover/code:opacity-100 flex gap-1 absolute m-[11px] right-0 top-0">
&lt;button
class="code-copy-btn group/copybtn transition-all active:opacity-50 bg-primary-700/5 border border-black/5 text-gray-600 hover:text-gray-900 rounded-md p-1.5 dark:bg-primary-300/10 dark:border-white/10 dark:text-gray-400 dark:hover:text-gray-50"
title="Copy code"
>
&lt;div class="group-[.copied]/copybtn:hidden copy-icon pointer-events-none h-4 w-4">&lt;/div>
&lt;div class="hidden group-[.copied]/copybtn:block success-icon pointer-events-none h-4 w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>就代表成功設定完成囉 ლ(́◕◞౪◟◕‵ლ)&lt;/p>
&lt;br>
&lt;p>另外，設定的內容會寫到 &lt;code>~/.aws/credentials&lt;/code> 和 &lt;code>~/.aws/config&lt;/code> 這兩個檔案中，如果想要修改設定，也可以直接修改這兩個檔案。&lt;/p>
&lt;br>
&lt;div class="code-block relative mt-6 first:mt-0 group/code">&lt;div class="filename">~/.aws/credentials&lt;/div>&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>default&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>aws_access_key_id &lt;span style="color:#f92672">=&lt;/span> AAKIA2HCM5WKG7R647HTV
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>aws_secret_access_key &lt;span style="color:#f92672">=&lt;/span> t5CMmR4Y7cuFC/RgxJS1XXXXXXXXXXXXXXXXXXXX&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="opacity-0 transition group-hover/code:opacity-100 flex gap-1 absolute m-[11px] right-0 top-8">
&lt;button
class="code-copy-btn group/copybtn transition-all active:opacity-50 bg-primary-700/5 border border-black/5 text-gray-600 hover:text-gray-900 rounded-md p-1.5 dark:bg-primary-300/10 dark:border-white/10 dark:text-gray-400 dark:hover:text-gray-50"
title="Copy code"
>
&lt;div class="group-[.copied]/copybtn:hidden copy-icon pointer-events-none h-4 w-4">&lt;/div>
&lt;div class="hidden group-[.copied]/copybtn:block success-icon pointer-events-none h-4 w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;div class="code-block relative mt-6 first:mt-0 group/code">&lt;div class="filename">~/.aws/config&lt;/div>&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>default&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>region &lt;span style="color:#f92672">=&lt;/span> ap-northeast-1&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="opacity-0 transition group-hover/code:opacity-100 flex gap-1 absolute m-[11px] right-0 top-8">
&lt;button
class="code-copy-btn group/copybtn transition-all active:opacity-50 bg-primary-700/5 border border-black/5 text-gray-600 hover:text-gray-900 rounded-md p-1.5 dark:bg-primary-300/10 dark:border-white/10 dark:text-gray-400 dark:hover:text-gray-50"
title="Copy code"
>
&lt;div class="group-[.copied]/copybtn:hidden copy-icon pointer-events-none h-4 w-4">&lt;/div>
&lt;div class="hidden group-[.copied]/copybtn:block success-icon pointer-events-none h-4 w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;br>
&lt;h2>常用 的 AWS CLI 指令說明&lt;span class="absolute -mt-20" id="常用-的-aws-cli-指令說明">&lt;/span>
&lt;a href="#%e5%b8%b8%e7%94%a8-%e7%9a%84-aws-cli-%e6%8c%87%e4%bb%a4%e8%aa%aa%e6%98%8e" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>指令&lt;/th>
&lt;th>描述&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>aws sts get-caller-identity&lt;/code>&lt;/td>
&lt;td>驗證使用者身份&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>aws eks list-clusters --region {REGION}&lt;/code>&lt;/td>
&lt;td>列出區域的 EKS&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>aws iam list-mfa-devices --user-name {USER_NAME}&lt;/code>&lt;/td>
&lt;td>列出使用者的 MFA 裝置&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>aws sts get-session-token --duration-seconds 129600 --serial-number ${MFA_DEVICES_NUMBER} --token-code ${MFA_CODE}&lt;/code>&lt;/td>
&lt;td>取得 MFA Token&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;br>
&lt;h2>參考資料&lt;span class="absolute -mt-20" id="參考資料">&lt;/span>
&lt;a href="#%e5%8f%83%e8%80%83%e8%b3%87%e6%96%99" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>探索 AWS：從菜鳥到熟練的完全指南(四)IAM 登入方式：&lt;a href="https://hackmd.io/@gdw7l5sPTOyNv76kZ_twjA/SkTPl-xP3" target="_blank" rel="noopener">https://hackmd.io/@gdw7l5sPTOyNv76kZ_twjA/SkTPl-xP3&lt;/a>&lt;/p>
&lt;p>設定 AWS CLI：&lt;a href="https://docs.aws.amazon.com/eks/latest/userguide/install-awscli.html" target="_blank" rel="noopener">https://docs.aws.amazon.com/eks/latest/userguide/install-awscli.html&lt;/a>&lt;/p>
&lt;p>AWS CLI 指令參考：&lt;a href="https://docs.aws.amazon.com/zh_tw/cli/latest/userguide/cli_code_examples_categorized.html" target="_blank" rel="noopener">https://docs.aws.amazon.com/zh_tw/cli/latest/userguide/cli_code_examples_categorized.html&lt;/a>&lt;/p></description></item></channel></rss>