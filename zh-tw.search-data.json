{"/about/":{"data":{"":" å“ˆå›‰å¤§å®¶å¥½ï¼Œæˆ‘å«èŠå“æ¯…ï¼Œä¹Ÿå¯ä»¥å«æˆ‘ Ianï¼Œç›®å‰æ˜¯ä¸€ä½ Site Reliability Engineering (SRE) å·¥ç¨‹å¸«ï¼Œä¸»è¦è² è²¬ç¶­è­·å…¬å¸çš„ Google Cloud Platform (GCP) é›²ç«¯ç›¸é—œæœå‹™ï¼ŒåŒ…å« GKEã€GCEã€GCSã€GLB ç­‰ç­‰ï¼Œé™¤æ­¤ä¹‹å¤–ä¹Ÿç†Ÿæ‚‰ä½¿ç”¨ Terraform + Terragrunt ä¾†ç®¡ç†é›²ç«¯å¤§é‡çš„ IaC è³‡æºï¼Œé…åˆä½¿ç”¨ Grafanaã€Prometheusã€Datadogã€EFK ç­‰ç›£æ§ Log æ”¶é›†å·¥å…·ä¾†ç¢ºä¿æœå‹™çš„ç©©å®šæ€§ä»¥åŠå¯è¿½è¹¤æ€§ã€‚ä¸¦å”åŠ© RD å»ºç«‹ CICD éƒ¨ç½²æµç¨‹ã€‚\nåœ¨ä¸‹ç­ç©ºé–’æ™‚é–“ï¼Œæˆ‘å–œæ­¡é–±è®€æŠ€è¡“ç›¸é—œçš„æ–‡ä»¶ã€éƒ¨è½æ ¼ï¼Œä¹ŸæœƒåƒåŠ ä¸€äº›ç·šä¸‹æŠ€è¡“ç¤¾ç¾¤çš„æ´»å‹•ï¼Œä¾‹å¦‚ DevOpsDayï¼Œå¸Œæœ›èƒ½å¤ é€éé€™äº›æ´»å‹•ä¾†å­¸ç¿’æ›´å¤šçš„çŸ¥è­˜ï¼Œä¸¦ä¸”èˆ‡æ›´å¤šçš„æŠ€è¡“äººå“¡äº¤æµã€‚\næ­¡è¿å¤§å®¶ä½¿ç”¨ä¸‹æ–¹ giscus ç•™è¨€ç³»çµ±ç•™è¨€äº¤æµ d(`ï½¥âˆ€ï½¥)bã€‚","è¯çµ¡æ–¹å¼#è¯çµ¡æ–¹å¼":" Emailï¼š880831ian@gmail.com LinkedInï¼šhttps://www.linkedin.com/in/pinyi/ GitHubï¼šhttps://github.com/880831ian Telegramï¼šhttps://t.me/pinyichuchu "},"title":"é—œæ–¼æˆ‘"},"/blog/":{"data":{"":"","ä»‹ç´¹#ä»‹ç´¹":"ğŸ‘‹ ä½ å¥½ã€å¦³å¥½ã€å¤§å®¶å¥½ï¼Œæ­¡è¿ä¾†åˆ°æˆ‘çš„ç§˜å¯†èŠ±åœ’ï¼Œé€™é‚Šä¸»è¦æœƒè¨˜éŒ„æˆ‘ç ”ç©¶ä¸€å€‹æ–°çš„æŠ€è¡“æˆ–å·¥å…·ã€ä»¥åŠè™•ç†ä¸€äº› SRE é‡åˆ°çš„éˆç•°äº‹ä»¶å•é¡Œçš„å°å¤©åœ°ã€‚\næœƒé–‹å§‹å¯« Blog çš„åˆè¡·ä¸»è¦æ˜¯æˆ‘çš„å°è…¦è¢‹ç“œï¼Œå¦‚æœä¸å¯«ä¸‹ä¾†ï¼Œéé™£å­å¾ˆå®¹æ˜“å°±å¿˜è¨˜ (Â´_ã‚`)ï¼Œç•¶ç„¶ä¹Ÿå¸Œæœ›å¯ä»¥å¹«åŠ©åˆ°æœ‰ç›¸åŒå•é¡Œçš„äºº (å¯ä»¥ä½¿ç”¨æœå°‹åŠŸèƒ½ä¾†å¿«é€Ÿæ‰¾åˆ°ç›¸é—œæ–‡æª”å–”)ï¼Œå¦‚æœæœ‰ä»»ä½•å•é¡Œæˆ–å»ºè­°ï¼Œæ­¡è¿åœ¨ä¸‹æ–¹ç•™è¨€ã€‚","è²æ˜#è²æ˜":"ç”±æ–¼åœ¨å­¸ç¿’æ–°çš„æŠ€è¡“æˆ–å·¥å…·æ™‚ï¼Œæœƒåƒè€ƒç¶²è·¯ä¸Šè¨±å¤šçš„æ–‡ä»¶å’Œç…§ç‰‡ï¼Œé›–ç„¶æœƒåŠ ä¸Šè‡ªå·±çš„è¦‹è§£èˆ‡å¯¦ä½œå…§å®¹æ”¹å¯«è€Œæˆï¼Œä¸”æœƒæ–¼æ–‡ç« å¾Œé™„ä¸Šç›¸é—œè³‡æ–™ä¾†æºï¼Œå¦‚æœ‰ä¾µçŠ¯åˆ°æ‚¨çš„æ¬Šç›Šï¼Œè«‹æ–¼ä¸‹æ–¹å‘ŠçŸ¥ï¼Œæˆ‘æœƒç«‹å³åˆªé™¤ç›¸é—œå…§å®¹ï¼Œè¬è¬ (à¹‘â€¢Ì â‚ƒ â€¢Ì€à¹‘)ã€‚"},"title":"Blog"},"/blog/docker/":{"data":{"":"æ­¤åˆ†é¡åŒ…å« Docker ç›¸é—œçš„æ–‡ç« ã€‚\nä½¿ç”¨ Prometheus å’Œ Grafana æ‰“é€ ç›£æ§é è­¦ç³»çµ± (Docker ç¯‡) Docker ä»‹ç´¹ (å¦‚ä½•ä½¿ç”¨ Docker-compose å»ºç½® PHP+MySQl+Nginx ç’°å¢ƒ "},"title":"Docker ç›¸é—œ"},"/blog/docker/docker/":{"data":{"":" ","docker-åŸºæœ¬æ¦‚å¿µ#Docker åŸºæœ¬æ¦‚å¿µ":" Dockerfile æ˜ åƒæª” (Image) å®¹å™¨ (Container) å€‰åº« (Repository) é€™å››å€‹æ˜¯ Docker æœ€åŸºæœ¬çš„çµ„æˆï¼Œäº†è§£å¾Œå°±å¯ä»¥çŸ¥é“æ•´å€‹ Docker çš„ç”Ÿå‘½é€±æœŸã€‚\nDockerfile é–‹ç™¼äººå“¡åœ¨ä½¿ç”¨ Docker æ™‚ç™¼ç¾ï¼Œå¤§å¤šç¾æˆçš„ Docker æ˜ åƒæª”ç„¡æ³•æ»¿è¶³ä»–å€‘çš„éœ€æ±‚ï¼Œå› æ­¤éœ€è¦ä¸€ç¨®èƒ½å¤ ç”Ÿæˆæ˜ åƒæª”çš„å·¥å…·ã€‚Dockerfile æ˜¯ä¸€ç¨®ç°¡æ˜“çš„æ–‡ä»¶æª”ï¼Œè£¡é¢åŒ…å«äº†å»ºç«‹æ–°æ˜ åƒæª”æ‰€éœ€çš„æŒ‡ä»¤ã€‚\nDockerfile èªæ³•ä¸»è¦ç”± Commandï¼ˆå‘½ä»¤ï¼‰å’Œ Argument ï¼ˆåƒæ•¸é¸æ“‡ï¼‰å…©å¤§å…ƒç´ çµ„æˆã€‚ä»¥ä¸‹æ˜¯ä¸€å€‹ç°¡æ˜“çš„ Dockerfile ç¤ºæ„åœ–ï¼š\nå‘½ä»¤å¼èªæ³•ï¼‹é¸æ“‡åƒæ•¸ï¼ˆCommand + Argumentï¼‰\næ˜ åƒæª” (Image) Docker æ˜ åƒæª”æ˜¯ä¸€å€‹å”¯ç¨çš„æ¨¡æ¿ã€‚\nä¾‹å¦‚ï¼šä¸€å€‹æ˜ åƒæª”å¯åœ¨åŒ…å«ä¸€å€‹å®Œæ•´çš„ Linux ä½œæ¥­ç³»çµ±ç’°å¢ƒï¼Œè£¡é¢å¯ä»¥åªå®‰è£ Nginx æˆ–ä½¿ç”¨è€…æœƒä½¿ç”¨åˆ°çš„å…¶ä»–æ‡‰ç”¨ç¨‹å¼ã€‚\næˆ‘å€‘æœƒä½¿ç”¨æ˜ åƒæª”ä¾†å»ºç«‹ Docker çš„å®¹å™¨ (Container) ï¼ŒDocker ä¹Ÿæä¾›å¾ˆç°¡å–®çš„æ©Ÿåˆ¶ä¾†å»ºç«‹æ˜ åƒæª”æˆ–æ˜¯æ›´æ–°ç¾æœ‰çš„æ˜ åƒæª”ï¼Œä¹Ÿå¯ä»¥å»ä¸‹è¼‰åˆ¥äººå·²ç¶“åšå¥½çš„æ˜ åƒæª”ã€‚\nå®¹å™¨ (Container) Docker æ˜¯åˆ©ç”¨å®¹å™¨ä¾†åŸ·è¡Œæ‡‰ç”¨ç¨‹å¼ã€‚\næ¯ä¸€å€‹å®¹å™¨éƒ½æ˜¯ç”±æ˜ åƒæª”æ‰€å»ºç«‹çš„çš„åŸ·è¡Œç¨‹å¼ã€‚å®ƒå¯ä»¥è¢«å•Ÿå‹•ã€é–‹å§‹ã€åœæ­¢ã€åˆªé™¤ã€‚ä¸”æ¯ä¸€å€‹å®¹å™¨éƒ½æ˜¯ç›¸äº’éš”é›¢çš„ï¼Œä¸æœƒç›¸äº’å½±éŸ¿ã€‚","docker-å¯¦ä½œ#Docker å¯¦ä½œ":"æœ¬ç« ç¯€æœƒä»‹ç´¹ Docker ä¸‰å¤§çµ„ä»¶æ˜ åƒæª” (image)ã€å®¹å™¨ (Container)ã€å€‰åº« (Repository) è¦å¦‚ä½•å¯¦éš›æ“ä½œï¼Œä»¥åŠä»–å€‘çš„é—œè¯æ€§æ˜¯ä»€éº¼ï½ æ˜ åƒæª” (Image) æœ¬å°ç¯€æœƒä»‹ç´¹æœ‰é—œæ˜ åƒæª”çš„å…§å®¹ï¼ŒåŒ…æ‹¬ï¼š\nå¦‚ä½•å¾å€‰åº«å–å¾—æ˜ åƒæª” å¦‚ä½•ç®¡ç†æœ¬åœ°ä¸»æ©Ÿä¸Šçš„æ˜ åƒæª” æ˜ åƒæª”å¯¦ä½œ (Dockerfile) å¦‚ä½•å¾å€‰åº«å–å¾—æ˜ åƒæª” æˆ‘å€‘å¯ä»¥å…ˆåˆ° Docker hub ä¸Šé¢çœ‹çœ‹æœ‰ä»€éº¼æœå‹™æˆ–ç¨‹å¼æƒ³è¦ä¸‹è¼‰ä¾†åšä½¿ç”¨ [ è©³ç´°ä»‹ç´¹æœƒæ”¾åˆ°å€‰åº« (Repository) ç« ç¯€]ï¼Œæ‰¾åˆ°æƒ³è¦çš„æœå‹™ï¼Œæˆ‘å€‘å¯ä»¥ä¸‹ docker pull {è¦ä¸‹è¼‰çš„æœå‹™ã€ç¨‹å¼åç¨±} ï¼Œæˆ‘å€‘é€™é‚Šå°±å…ˆä¸‹è¼‰ Mysql é€™å€‹æ˜ åƒæª”ã€‚\nmysql $ docker pull mysql Using default tag: latest latest: Pulling from library/mysql 15115158dd02: Pull complete .... çœç•¥ .... Digest: sha256:b17a66b49277a68066559416cf44a185cfee538d0e16b5624781019bc716c122 Status: Downloaded newer image for mysql:latest docker.io/library/mysql:latest ç”±æ–¼æˆ‘å€‘ä¸‹è¼‰çš„æ²’æœ‰åŠ ä»»ä½•çš„ tag ï¼Œä¹Ÿå°±æ˜¯ç‰ˆæœ¬ï¼Œæ‰€ä»¥æˆ‘å€‘éƒ½æ˜¯ä¸‹è¼‰æœ€æ–°ç‰ˆ latest ï¼Œå¦‚æœæƒ³è¦ä¸‹è¼‰ç‰¹å®šç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨æœå‹™åç¨±å¾Œé¢åŠ ä¸Š :{ç‰ˆæœ¬} ï¼Œå°±å¯ä»¥ä¸‹è¼‰å°æ‡‰çš„ç‰ˆæœ¬å›‰ï¼\nå¦‚æœæœ‰æ¨™è¨˜ Official Image å°±ä»£è¡¨æ˜¯å®˜æ–¹é‡‹å‡ºçš„æ˜ åƒæª” ~ åœ¨ç©©å®šæ€§ä»¥åŠå®‰å…¨ä¸Šæ›´æœ‰ä¿éšœï¼Œæ‰€ä»¥å¤§å®¶å¯ä»¥å„ªå…ˆä¸‹è¼‰æ­ï¼\nDocker hub ä¸‹è¼‰ Image\nç®¡ç†æœ¬åœ°ä¸»æ©Ÿä¸Šçš„æ˜ åƒæª” æŸ¥çœ‹æ˜ åƒæª” (images) ç•¶æˆ‘å€‘ä¸‹è¼‰å¥½æ˜ åƒæª”å¾Œï¼Œå¯ä»¥ä½¿ç”¨ docker images ä¾†åˆ—å‡ºæœ¬æ©Ÿå·²ä¸‹è¼‰çš„æ˜ åƒæª”ã€‚\n$ docker images REPOSITORY TAG IMAGE ID CREATED SIZE php latest d6229b88aa29 3 days ago 484MB mysql latest 826efd84393b 6 days ago 521MB nginx latest c919045c4c2b 13 days ago 142MB æˆ‘å€‘ä¾†çœ‹çœ‹éƒ½åˆ—å‡ºå“ªäº›è¨Šæ¯å§ï¼\nREPOSITORYï¼šä¾†è‡ªæ–¼å“ªä¸€å€‹å€‰åº«ï¼Œåƒæ˜¯ phpã€mysqlã€nginxã€‚ TAGï¼šæ˜ åƒæª”çš„æ¨™ç±¤ï¼Œå› ç‚ºæˆ‘å€‘éƒ½ä¸‹è¼‰æœ€æ–°ç‰ˆæœ¬æ‰€ä»¥æ˜¯ latestã€‚ IMAGE IDï¼šå®ƒçš„å”¯ä¸€ ID è™Ÿç¢¼ã€‚ CREATEDï¼šå»ºç«‹æ™‚é–“ã€‚ VIRTUAL SIZEï¼šæ˜ åƒæª”å¤§å°ã€‚ å„²å­˜æ˜ åƒæª” (save) æƒ³è¦å„²å­˜æ˜ åƒæª”ï¼Œå¯ä»¥ä½¿ç”¨ docker save {æ˜ åƒæª”åç¨±} \u003e {æª”æ¡ˆåç¨±}.tarï¼Œä¾†åšå„²å­˜ã€‚\n$ docker save mysql \u003e mysql.tar $ ls | grep 'mysql' mysql.tar åˆªé™¤æ˜ åƒæª” (rmi) æƒ³è¦åˆªé™¤æ˜ åƒæª”ï¼Œå¯ä»¥ä½¿ç”¨ docker rmi {æ˜ åƒæª”åç¨±} ä¾†åšåˆªé™¤ã€‚\n$ docker rmi demo-image Untagged:demo-image:latest Deleted: sha256:1f56acbcbe9ec613a37e26934a84d98bed73879059f424dc69754520086baa37 æƒ³è¦åŒæ™‚åˆªé™¤æ˜ åƒæª”æ™‚ï¼Œå¯ä»¥å…ˆç”¨ docker images -aq åˆ—å‡ºå…¨éƒ¨æ˜ åƒæª”çš„ IMAGE IDï¼Œå†ä¸€èµ·åˆªé™¤ã€‚\ndocker rmi -f $(docker images -aq) æ³¨æ„ï¼åˆªé™¤æ˜ åƒæª”(Image)æ™‚ï¼Œè¦å…ˆç”¨ docker rm {å®¹å™¨} å»åˆªé™¤æ‰€æœ‰ä¾è³´é€™å€‹æ˜ åƒæª”çš„å®¹å™¨ã€‚ æ¥è‘—è¦æ€éº¼å»ºç«‹è‡ªå·±çš„æ˜ åƒæª”å‘¢ï¼Ÿæˆ‘å€‘è¦ä½¿ç”¨ Dockerfile ä¾†å»ºç«‹æ˜ åƒæª”ã€‚\næ˜ åƒæª”å¯¦ä½œ æ’°å¯« Dockerfile æ˜ åƒæª” Dockerfile æ˜¯ä¸€ç¨®æ–‡å­—æ ¼å¼çš„è¨­å®šæª”ï¼Œå¯ä»¥é€é Dockerfile å¿«é€Ÿå»ºç«‹è‡ªè¨‚çš„æ˜ åƒæª”ï¼Œæ›å¥è©±èªªï¼ŒDockerfile å°±åƒæ˜¯å»ºç½® Docker Image çš„è…³æœ¬ã€‚\nèˆ‰å€‹ä¾‹å­ï¼šå¯ä»¥æŠŠè‡ªå·±æƒ³åƒæˆä¸€ä½è¨­è¨ˆå¸«ï¼Œè¨­è¨ˆå¥½æˆ¿å­çš„æ ¼å±€ã€æ“ºé£¾ç­‰ï¼Œç•«å¥½è¨­è¨ˆåœ– (Dockerfile) å¾Œï¼Œæœ€å¾Œè«‹å¸«å‚… (Docker) ä¾ä½ çš„æ§‹æ€å®Œæˆå°±å¯ä»¥äº†ã€‚\næˆ‘å€‘å°±ä¾†é–‹å§‹å¯¦ä½œä¸€å€‹ Dockerfile å§ ~\næˆ‘å€‘å…ˆå‰µå»ºä¸€å€‹ä¾†æ”¾ Dockerfile çš„è³‡æ–™å¤¾ï¼Œå¯ä»¥ç›´æ¥åœ¨è·¯å¾‘ä¸‹å»ºç«‹å‡ºæ˜ åƒæª” mkdir demo-dockerfile cd demo-dockerfile/ Dockerfile çµæ§‹ï¼Œå¤§è‡´å¯ä»¥åˆ†ç‚ºå››å€‹éƒ¨åˆ†\nåŸºç¤æ˜ åƒæª”è³‡è¨Š ç¶­è­·è€…è³‡è¨Š æ˜ åƒæª”æ“ä½œæŒ‡ä»¤ å®¹å™¨å•Ÿå‹•æ™‚éœ€åŸ·è¡Œçš„æŒ‡ä»¤ æˆ‘å€‘æœ‰èªªé Dockerfile æ˜¯ä¸€å€‹æ–‡å­—æ ¼å¼çš„è¨­å®šæª”ï¼Œæ‰€ä»¥æˆ‘å€‘ç”¨ vim ä¾†ç·¨å¯« Dockerfileã€‚ vim Dockerfile # åŸºç¤æ˜ åƒæª”è³‡è¨Š FROM nginx:latest # ç¶­è­·è€…è³‡è¨Š LABEL maintainer=\"880831ian@gmail.com\" # æ˜ åƒæª”æ“ä½œæŒ‡ä»¤ RUN apt-get update -y\\ \u0026\u0026 apt-get install nginx -y # é‹è¡Œæ™‚å®¹å™¨æä¾›æœå‹™çš„é€šé“ EXPOSE 80 # å®¹å™¨å•Ÿå‹•æ™‚éœ€åŸ·è¡Œçš„æŒ‡ä»¤ CMD [\"nginx\",\"-g\",\"daemon off;\"] FROM nginx:latest\nç¬¬ä¸€è¡Œç‚ºå¿…è¦çš„æŒ‡å®šåŸºç¤æ˜ åƒæª”ï¼Œé€™é‚Šä½¿ç”¨ nginx ä½œç‚ºåŸºç¤æ˜ åƒæª”ï¼Œæˆ‘å€‘ç”¨æœ€æ–°ç‰ˆæœ¬ï¼Œæ‰€ä»¥æ˜¯ latestã€‚\nLABEL maintainer=\"880831ian@gmail.com\"\nç¶­è­·è€…è³‡è¨Šæƒ³ä¸ä¹Ÿæ˜¯ä¸å¯ä»¥å°‘çš„ï¼Œé€™é‚Šä¹Ÿå¯ä»¥è¼¸å…¥ Email è³‡è¨Šï¼Œåªæ˜¯è¦æ³¨æ„çš„æ˜¯æ­¤è³‡è¨Šæœƒå¯«å…¥ç”¢å‡ºæ˜ åƒæª”çš„ Author åç¨±å±¬æ€§ä¸­ã€‚\nRUN apt-get update -y\\ \u0026\u0026 apt-get install nginx -y\né€™é‚Šæ˜¯æœ€é‡è¦çš„éƒ¨åˆ†ï¼Œæƒ³è¦åœ¨æ˜ åƒæª”æ¡ˆä¸Šè¨­å®šæˆ–å®‰è£éƒ½éœ€è¦å°‡å‘½ä»¤å¯«åœ¨é€™ï¼Œæ ¼å¼å¿…é ˆä¾ RUN ï¼ŒRUN æŒ‡ä»¤å¾Œé¢æ”¾ Linux æŒ‡ä»¤ï¼Œå¦‚æœæŒ‡ä»¤å¤ªé•·å¯ä»¥ä½¿ç”¨\\ä¾†æ›è¡Œã€‚ -y æ˜¯åœ¨å®‰è£ Nginxï¼ŒæœƒåŒæ„æ‰€æœ‰é€²è¡Œä¸­æ‰€å‡ºç¾çš„å•é¡Œã€‚\nEXPOSE 80\nè¨­å®šé‹è¡Œæ™‚å®¹å™¨æä¾›æœå‹™çš„é€šé“ã€‚\nCMD [\"nginx\",\"-g\",\"daemon off;\"]\næœ€å¾Œå°±æ˜¯å•Ÿå‹•æŒ‡å®šå®¹å™¨æ™‚é è¨­åŸ·è¡Œçš„æŒ‡ä»¤ï¼Œæ ¼å¼æ˜¯ CMD [â€œexecutableâ€,â€œparam1â€,â€œparam2â€]ã€‚\nDocker é‹è¡Œ Nginx æ™‚ç‚ºä»€éº¼è¦ä½¿ç”¨ daemon off;\nå› ç‚º Docker å®¹å™¨å•Ÿå‹•æ™‚ï¼Œé»˜èªæœƒæŠŠå®¹å™¨å…§éƒ¨ç¬¬ä¸€å€‹é€²ç¨‹ï¼Œä½œçˆ² docker å®¹å™¨æ˜¯å¦æ­£å¸¸é‹è¡Œçš„ä¾æ“šï¼Œå¦‚æœ docker å®¹å™¨ pid = 1 åˆ°é€²ç¨‹å°±æ›äº†ï¼Œdocker å°±æœƒé€€å‡ºï¼\nDocker æœªåŸ·è¡Œè‡ªå®šç¾©çš„ CMD ä¹‹å‰ï¼Œ Nginx çš„ pid æ˜¯ 1ï¼ŒåŸ·è¡Œåˆ° CMD ä¹‹å¾Œï¼ŒNginx å°±åœ¨å¾Œå°é‹è¡Œï¼Œbash æˆ–æ˜¯ sh çš„è…³æœ¬å°±æœƒè®Šæˆ pid =1 ã€‚\næ‰€ä»¥ä¸€ä½†åŸ·è¡Œå®Œ CMDï¼ŒNginx å®¹å™¨å°±æœƒé€€å‡ºäº†ï¼Œæ‰€ä»¥æ‰éœ€è¦åŠ ä¸Š -g daemon off;ã€‚\nåœ¨ Nginx å®˜æ–¹çš„ Docker Repository ä¹Ÿæœ‰èªªæ˜ï¼Œåœ¨ Complex configuration å…§ã€‚\né †ä¾¿èªªä¸€ä¸‹ä½¿ç”¨ Dockerfile çš„å„ªé»ï¼š1 . å¯ä»¥é€²è¡Œ Git ç‰ˆæ§ï¼Œè®“ä½ ç®¡ç†æˆ–åˆ†äº«æ›´æ–¹ä¾¿ 2 . ä½”ç”¨å®¹é‡å°ï¼Œå› ç‚ºåªæ˜¯ç´”æ–‡å­—æª”è€Œå·²ã€‚\nä½¿ç”¨ Dockerfile å»ºç«‹æ˜ åƒæª” æˆ‘å€‘å·²ç¶“æ’°å¯«å®Œ Dockerfile æª”æ¡ˆäº†ï¼Œæ¥ä¸‹ä¾†è¦åŸ·è¡Œä¾†ç”¢ç”Ÿæ˜ åƒæª”ï¼Œæˆ‘å€‘è¦ä½¿ç”¨ docker build ä¾†å»ºç«‹ï¼Œæˆ‘å€‘ä¸€èµ·ä¾†çœ‹çœ‹å§\ndocker build -t demo-image . å› ç‚ºæˆ‘å€‘åœ¨ dockerfile çš„ç›®éŒ„ä¸‹ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨ â€œ.â€ ä¾†åšå»ºç«‹å‹•ä½œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ -f ä¾†æŒ‡å®š dockerfile çš„è·¯å¾‘ä½ç½®ã€‚ä½¿ç”¨ -t ä¾†è¨­å®šæ˜ åƒæª”çš„åç¨±ï¼Œæˆ‘å€‘é€™é‚Šå–åå« demo-imageã€‚\n[+] Building 2.7s (7/7) FINISHED =\u003e [internal] load build definition from Dockerfile 0.0s =\u003e =\u003e transferring dockerfile: 44B 0.0s =\u003e [internal] load .dockerignore 0.0s =\u003e =\u003e transferring context: 2B 0.0s =\u003e [internal] load metadata for docker.io/library/nginx:latest 2.6s =\u003e [auth] library/ubuntu:pull token for registry-1.docker.io 0.0s =\u003e [1/2] FROM docker.io/library/nginx:latest@sha256:8ae9bafbb64f63a50caab98fd3a5e37b3eb837a3e0780b78e5218e63193961f 0.0s =\u003e CACHED [2/2] RUN apt-get update -y \u0026\u0026 apt-get install nginx -y 0.0s =\u003e exporting to image 0.0s =\u003e =\u003e exporting layers 0.0s =\u003e =\u003e writing image sha256:1f56acbcbe9ec613a37e26934a84d98bed73879059f424dc69754520086baa37 0.0s =\u003e =\u003e naming to docker.io/demo-image å®Œæˆå¾Œæˆ‘å€‘ä½¿ç”¨ docker images ä¾†çœ‹çœ‹æ˜¯å¦å»ºç«‹æˆåŠŸã€‚\n$ docker images REPOSITORY TAG IMAGE ID CREATED SIZE demo-image latest 1f56acbcbe9e 2 hours ago 166MB php latest d6229b88aa29 4 days ago 484MB mysql latest 826efd84393b 6 days ago 521MB nginx latest c919045c4c2b 13 days ago 142MB åŸ·è¡Œå®¹å™¨çš„éƒ¨åˆ†ï¼Œæˆ‘å€‘æ”¾åˆ°å®¹å™¨ (Container)çš„ç« ç¯€åœ¨ä»‹ç´¹ ~\nå®¹å™¨ (Container) æˆ‘å€‘åœ¨ä»‹ç´¹æŒ‡ä»¤å‰ï¼Œå…ˆä¾†äº†è§£ä¸€ä¸‹ Dockerfileã€Docker Imageã€Docker Container é€™ä¸‰å€‹çš„é—œä¿‚ï¼Œå¯ä»¥å…ˆåƒè€ƒä»¥ä¸‹åœ–ç‰‡\nå®¹å™¨ Container çµ„æˆ\næˆ‘å€‘åœ¨å•Ÿå‹• Container æ™‚ï¼Œæœƒæœ‰é€™ä¸‰å€‹éƒ¨åˆ†çµ„æˆï¼Œæœ€åº•å±¤æ˜¯æ˜ åƒæª” (Image)ï¼Œé€™ä¸€å±¤ä¸»è¦æ˜¯é€éæ’°å¯« Dockerfile ä¹‹å¾Œ build å‡ºä¾†çš„ Docker Imageï¼Œå°±åƒæˆ‘å€‘å‰é¢èªªçš„å®ƒæ˜¯ä¸€å€‹å”¯ç¨çš„æª”æ¡ˆã€‚åŸ·è¡Œå•Ÿå‹•äº† Docker Containerï¼Œå°±æœƒåŠ ä¸Šç¬¬äºŒå±¤ï¼Œå°±æ˜¯éœ€è¦å…ˆ Init Container çš„è¨­å®šï¼Œä¾‹å¦‚æ˜¯ hostnameã€ç’°å¢ƒè®Šæ•¸ã€ç¶²è·¯é€£æ¥ç­‰ç³»çµ±è¨­å®šï¼Œæœ€å¾Œæœ€ä¸Šå±¤å†åŠ ä¸Šä¸€å±¤è®“ä½¿ç”¨è€…å¯ä»¥åœ¨æ­¤å±¤å»è®€å¯«è³‡æ–™ã€‚\næœ‰é—œæ–¼å®¹å™¨ (Container) çš„æŒ‡ä»¤éå¸¸å¤šï¼Œå…‰æ˜¯ç°¡å–®çš„ run å°±æœ‰å¾ˆå¤šåƒæ•¸ï¼Œæˆ‘å€‘å…ˆåˆ—å‡ºæ¯”è¼ƒå¸¸ç”¨ä¸”åŸºæœ¬çš„ Container æŒ‡ä»¤ï½\nContainer åŸ·è¡Œæ™‚çš„æ“ä½œ åŸ·è¡Œå®¹å™¨ (run) æˆ‘å€‘æƒ³è¦å‰µå»ºä¸€å€‹æ–°çš„å®¹å™¨ä¸¦é‹è¡Œï¼Œå°±å¯ä»¥ä½¿ç”¨ docker runï¼Œæˆ‘å€‘ä¾†çœ‹çœ‹ä»–å¯ä»¥ä½¿ç”¨å“ªäº›åƒæ•¸å§ï¼\ndocker run [OPTIONS] IMAGE [COMMAND] [ARG...] OPTIONS èªªæ˜ï¼š åƒæ•¸ æè¿° -d å¾Œå°é‹è¡Œå®¹å™¨ -i å‘½ä»¤äº’å‹•æ¨¡å¼ï¼Œé€šå¸¸èˆ‡ -t åŒæ™‚ä½¿ç”¨ -t ç‚ºå®¹å™¨é‡æ–°åˆ†é…ä¸€å€‹å‡è£çš„è¼¸å…¥çµ‚ç«¯ï¼Œé€šå¸¸èˆ‡ -i åŒæ™‚ä½¿ç”¨ -p æŒ‡å®šå®¹å™¨èˆ‡æœ¬æ©Ÿçš„ Port ï¼Œæ ¼å¼æ˜¯ ä¸»æ©Ÿ Port : å®¹å™¨ Port â€“name=\"{åç¨±}\" ç‚ºå®¹å™¨è¨­å®šåç¨± â€“net=\"{ç¶²è·¯é¡å‹}\" æŒ‡å®šå®¹å™¨çš„ç¶²è·¯é€£æ¥é¡å‹ï¼Œæ”¯æ´ bridge/host/none/container å››ç¨®æ¨¡å¼ â€“link=\"{å…¶ä»–å®¹å™¨}\" æ·»åŠ é€£æ¥åˆ°å¦ä¸€å€‹å®¹å™¨ â€“volume,-v å°‡å®¹å™¨æª”æ¡ˆè·¯å¾‘æ˜ å°„åˆ°æœ¬åœ°ç«¯ï¼Œæ ¼å¼æ˜¯ æœ¬æ©Ÿè·¯å¾‘ï¼šå®¹å™¨è·¯å¾‘ æˆ‘å€‘å•Ÿå‹•æˆ‘å€‘ä¸‹è¼‰å¥½çš„ Nginx ä¾†è©¦è©¦çœ‹å§ï¼\n$ docker run -d -p 7777:80 --name=\"demo-nginx\" -v /Users/ian_zhuang/Desktop/data:/var/www/html nginx 31a4a4a56e3ef2fb75d538c4c9eea4914ac506a84a6ff97e1fbbb6c3213cc6b7 æˆ‘å€‘å°‡ Nginx å®¹å™¨åœ¨èƒŒæ™¯åŸ·è¡Œï¼Œä¸”å°‡é è¨­çš„ 80 Port èˆ‡æœ¬æ©Ÿçš„ 7777 Port ç¶åœ¨ä¸€èµ·ï¼Œè®“æˆ‘å€‘åœ¨æœ¬æ©Ÿç€è¦½ 7777 Port æœƒç›´æ¥å°å‘å®¹å™¨çš„ 80Portï¼Œè¨­å®šå®¹å™¨çš„åå­—å«åš â€œdemo-nginx\" ï¼Œæˆ‘å€‘ Nginx å®¹å™¨çš„æª”æ¡ˆè·¯å¾‘æ˜ å°„åˆ°æœ¬åœ°ç«¯çš„æ¡Œé¢ data è³‡æ–™å¤¾ï¼Œæˆ‘å€‘å°±å¯ä»¥åœ¨æœ¬æ©Ÿæ–°å¢æª”æ¡ˆåŒæ­¥åˆ°å®¹å™¨ä¸­ã€‚\né¡¯ç¤ºå®¹å™¨ (ps) ä½¿ç”¨ docker ps ä¾†æª¢æŸ¥ä¸€ä¸‹æ˜¯å¦å•Ÿå‹•æˆåŠŸ (ps å¯ä»¥é¡¯ç¤ºæ˜ åƒæª”çš„åŸºæœ¬è³‡è¨Šï¼Œå¦‚æœæ²’æœ‰åŠ  -a åªæœƒé¡¯ç¤ºåŸ·è¡Œä¸­çš„å®¹å™¨)\n$ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 31a4a4a56e3e demo-image \"nginx -g 'daemon ofâ€¦\" About a minute ago Up About a minute 0.0.0.0:7777-\u003e80/tcp demo-nginx æ¥è‘—æˆ‘å€‘æ¸¬è©¦æ˜¯å¦æœ‰æŠŠæ¡Œé¢ data è³‡æ–™å¤¾æ›åˆ°å®¹å™¨çš„è·¯å¾‘ï¼Œæˆ‘å€‘å…ˆåœ¨ data æ–°å¢ä¸€å€‹ hello.html ï¼Œè£¡é¢éš¨æ„è¼¸å…¥ï¼Œç€è¦½ä¸€ä¸‹ http://127.0.0.1:7777/hello.html ï¼Œçœ‹çœ‹æ˜¯å¦æˆåŠŸã€‚\nå®¹å™¨ Container -volume æ¸¬è©¦\né¡¯ç¤ºå®¹å™¨ç´€éŒ„ (logs) æƒ³è¦çœ‹åˆ°æˆ‘å€‘åŸ·è¡Œ Container çš„ç´€éŒ„ï¼Œå¯ä»¥ä½¿ç”¨ logs æŒ‡ä»¤ä¾†é¡¯ç¤ºã€‚\n$ docker logs demo-nginx /docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration /docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/ /docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh ... çœç•¥ ... 2022/03/15 09:27:51 [notice] 1#1: start worker process 33 2022/03/15 09:27:51 [notice] 1#1: start worker process 34 2022/03/15 09:27:51 [notice] 1#1: start worker process 35 åˆªé™¤å®¹å™¨ (rm -f) æƒ³è¦åˆªé™¤ä¸éœ€è¦çš„ Containerï¼Œå¯ä»¥ä½¿ç”¨ rm æŒ‡ä»¤ä¾†åšåˆªé™¤ï¼Œ-f æ˜¯å¼·åˆ¶åˆªé™¤å®¹å™¨ã€‚\n$ docker rm -f demo-nginx demo-nginx é€²å…¥å®¹å™¨ (exec) æƒ³è¦é€²å…¥ container ä¾†æŸ¥çœ‹è³‡æ–™æˆ–æ˜¯ä¿®æ”¹æª”æ¡ˆï¼Œå¯ä»¥ä½¿ç”¨ exec ä¾†é€²å…¥å®¹å™¨ä¸­ã€‚\n$ docker exec -it demo-nginx /bin/bash root@31a4a4a56e3e:/# ls bin boot dev\tdocker-entrypoint.d docker-entrypoint.sh etc\thome lib lib64 media mnt opt proc root run sbin srv sys tmp usr var root@31a4a4a56e3e:/# cd usr/bin/ root@31a4a4a56e3e:/usr/bin# pwd /usr/bin åŒ¯å‡ºæª”æ¡ˆ (export) æˆ‘å€‘å‰é¢æœ‰æåˆ°èªªï¼Œå¦‚æœåˆªé™¤äº†å®¹å™¨ï¼Œä»¥å‰å¯«å…¥çš„è³‡æ–™ä¹Ÿæœƒä¸è¦‹ï¼Œå¦‚æœæƒ³è¦è¼¸å‡ºè³‡æ–™ï¼Œå¯ä»¥ä½¿ç”¨ export å°‡å¯è®€å¯å¯«çš„é‚£ä¸€å±¤åŒ¯æˆæª”æ¡ˆã€‚\n$ docker export demo-nginx \u003e demo-nginx.tar $ ls | grep 'demo' demo-nginx.tar save è·Ÿ export çš„å€åˆ¥ï¼š\né‚„è¨˜å¾—æˆ‘å€‘åœ¨å„²å­˜æ˜ åƒæª”çš„æ™‚å€™æœ‰ä»‹ç´¹åˆ° save å—ï¼Œé‚£ä»–è·Ÿ export çš„å€åˆ¥æ˜¯ä»€éº¼å‘¢ï¼Ÿæˆ‘å€‘å¯ä»¥ç†è§£æˆ\nsave æ˜¯æŠŠ Docker Image åŸå§‹æª”åšå„²å­˜ï¼Œexport æ˜¯æŠŠä¿®æ”¹ Docker Image çš„å…§å®¹éƒ½ä¸€ä½µå„²å­˜ã€‚\nåŒ¯å…¥æª”æ¡ˆ (import) æœ‰åŒ¯å‡ºæª”æ¡ˆï¼Œç•¶ç„¶ä¹Ÿæœ‰åŒ¯å…¥æª”æ¡ˆæ‹‰ï¼Œå¯ä»¥ä½¿ç”¨ import å°‡æˆ‘å€‘åŒ¯å‡ºçš„æª”æ¡ˆåŒ¯å…¥ Docker Image è£¡é¢ã€‚\n$ cat ~/Desktop/demo-nginx.tar| docker import - import-nginx sha256:7106935f0bfbdbb84f9eb20edb8cdb2c53207f5e0963f6a4e89d8267e9d98c56 $ docker images REPOSITORY TAG IMAGE ID CREATED SIZE import-nginx latest 7106935f0bfb 19 seconds ago 140MB Container çš„ç‹€æ…‹ æª¢æŸ¥å®¹å™¨ç‹€æ…‹ (inspect) æƒ³è¦æŸ¥çœ‹å®¹å™¨çš„ç‹€æ…‹æ•¸æ“šï¼Œå¯ä»¥ä½¿ç”¨ inspect ä¾†é¡¯ç¤ºã€‚\n[ { \"Id\": \"sha256:1f56acbcbe9ec613a37e26934a84d98bed73879059f424dc69754520086baa37\", \"RepoTags\": [ \"demo-image:latest\" ], \"RepoDigests\": [], \"Parent\": \"\", \"Comment\": \"buildkit.dockerfile.v0\", \"Created\": \"2022-03-15T03:02:26.8321887Z\", \"Container\": \"\", \"ContainerConfig\": { \"Hostname\": \"\", \"Domainname\": \"\", \"User\": \"\", .... çœç•¥ .... æŸ¥çœ‹å®¹å™¨çš„ CPUã€è¨˜æ†¶é«”åŠç¶²è·¯ä½¿ç”¨ (stats) æƒ³è¦æŸ¥çœ‹å®¹å™¨çš„ CPUã€è¨˜æ†¶é«”åŠç¶²è·¯ä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ stats ä¾†é¡¯ç¤ºã€‚\nCONTAINER ID NAME CPU % MEM USAGE / LIMIT MEM % NET I/O BLOCK I/O PIDS 31a4a4a56e3e demo-nginx 0.00% 5.797MiB / 1.939GiB 0.29% 6.29kB / 2.83kB 1.46MB / 20.5kB 5 å€‰åº« (Repository) æˆ‘å€‘åœ¨æ˜ åƒæª”çš„ç« ç¯€æœ‰ä½¿ç”¨ docker pull ä¾†ä¸‹è¼‰åˆ¥äººçš„æ˜ åƒæª”ä¾†ä½¿ç”¨ï¼Œé‚£æˆ‘å€‘è¦å¦‚ä½•æŠŠæˆ‘å€‘åšå¥½çš„ä¸Šå‚³ä¸Šå» Docker hub å‘¢ï¼(ç”±æ–¼ Docker hub æ˜¯å…¬é–‹å¹³å°ï¼Œæ‰€ä»¥å¤§å®¶éƒ½å¯ä»¥è‡ªç”±çš„ä¸‹è¼‰æ˜ åƒæª”ï¼Œæ‰€ä»¥æ˜¯å…¬å¸æ©Ÿå¯†çš„æ˜ åƒæª”ï¼Œå°±è¦é¿å…ä¸Šå‚³æ­ï¼)\n$ docker login Authenticating with existing credentials... Login Succeeded ç”±æ–¼æˆ‘æœ‰ä¸‹è¼‰æ¡Œé¢ç‰ˆçš„ Docker ï¼Œæ‰€ä»¥ç™»å…¥æ™‚ä¸éœ€è¦å†å¦å¤–è¨­å®šï¼\næˆ‘å€‘åœ¨ä¸Šå‚³åˆ° Docker hub ä¹‹å‰ï¼Œéœ€è¦å…ˆä¿®æ”¹ Image çš„ tag ï¼Œæ ¼å¼ docker tag {Image Name} {DockerHubå¸³è™Ÿ}/{æƒ³è¦å–çš„ Image Name}\n$ docker images | grep 'demo-image' demo-image latest 1f56acbcbe9e 24 hours ago 166MB $ docker tag demo-image 880831ian/demo-image $ docker images | grep 'demo-image' 880831ian/demo-image latest 1f56acbcbe9e 24 hours ago 166MB demo-image latest 1f56acbcbe9e 24 hours ago 166MB æ¥ä¸‹ä¾†å°±ä½¿ç”¨ docker pushï¼Œå°‡æ˜ åƒæª”ä¸Šå‚³åˆ° Docker hub ä¸Šï¼\n$ docker push 880831ian/demo-image Using default tag: latest The push refers to repository [docker.io/880831ian/demo-image] 7722c88c8d69: Pushed 68a85fa9d77e: Mounted from library/ubuntu latest: digest: sha256:814caacaf3dad3eccb43dc9bcad635d0473bd5946295d40ca1ec23d13a5f6d0f size: 741 æˆ‘å€‘ä¹Ÿç™»å…¥ Docker hub çœ‹ä¸€ä¸‹ï¼Œæ˜¯ä¸æ˜¯çœŸçš„ä¸Šå‚³æˆåŠŸäº†ï½\nrepository","docker-é€²éš#Docker é€²éš":"æœ¬ç« ç¯€æœƒåˆ†æˆä¸‰å€‹å¸¸ç”¨åŠŸèƒ½ä¾†èªªæ˜\nVolumes ä»‹ç´¹ Network æ¨¡å¼ä»‹ç´¹å’Œæ¯”è¼ƒ Docker-compose ä»‹ç´¹èˆ‡å¯¦ä½œ Volumes ä»‹ç´¹ æˆ‘å€‘åœ¨å…ˆå‰ä»‹ç´¹ Container æ™‚ï¼Œä¹Ÿæœ‰èªªåˆ°ï¼ŒContainer æœƒåˆ†æˆ Image å±¤ã€Init å±¤ä»¥åŠä½¿ç”¨è€…å¯è®€å¯å¯«å±¤çš„é€™ä¸‰å±¤ã€‚ç•¶æˆ‘å€‘å°‡ Container åˆªé™¤å¾Œï¼Œå­˜æ”¾åœ¨ Docker Container ä¸Šçš„è³‡æ–™ä¹Ÿæœƒä¸è¦‹ï¼Œé›–ç„¶å¯ä»¥ç”¨ export ä¾†å„²å­˜ï¼Œä½†æˆ‘å€‘æ‡‰è©²åœ¨æ ¹æœ¬ä¸Šè§£æ±ºå•é¡Œã€‚\næ‰€ä»¥æˆ‘å€‘å¯ä»¥ä½¿ç”¨å…©ç¨®æ–¹å¼ä¾†è§£æ±ºï¼\nåœ¨åŸ·è¡Œ docker run æŒ‡ä»¤æ™‚åŠ å…¥ -v åƒæ•¸ï¼Œå°‡ Container çš„æª”æ¡ˆè·¯å¾‘æ˜ å°„åˆ°æœ¬åœ°ç«¯çš„æª”æ¡ˆè·¯å¾‘ã€‚ åœ¨æ’°å¯« Dockerfile æ™‚ï¼ŒåŠ å…¥ VOLUME æŒ‡ä»¤ï¼Œå¯ä»¥å°‡è³‡æ–™å­˜æ”¾åœ¨å¯¦é«”ä¸»æ©Ÿä¸Šã€‚ä½¿ç”¨é€™å€‹æ–¹æ³•é‚„è¦æ­é…æˆ‘å€‘ä»‹ç´¹ Container çš„ç‹€æ…‹ \u003e æª¢æŸ¥å®¹å™¨ç‹€æ…‹ (inspect) ï¼Œä¾†æŸ¥è©¢æœ¬åœ°ç«¯æª”æ¡ˆçš„å­˜æ”¾è·¯å¾‘åœ¨å“ªã€‚ ä½¿ç”¨ -v æŒ‡ä»¤å°‡å®¹å™¨æ˜ å°„åˆ°æœ¬åœ°ç«¯ åœ¨ä½¿ç”¨ docker run æŒ‡ä»¤æ™‚ï¼Œä½¿ç”¨ -v å°‡å®¹å™¨æª”æ¡ˆè·¯å¾‘æ˜ å°„åˆ°æœ¬åœ°çš„æª”æ¡ˆè·¯å¾‘ã€‚\n$ docker run -it -v /Users/ian_zhuang/Desktop/data:/storage centos /bin/bash latest: Pulling from library/centos Digest: sha256:a27fd8080b517143cbbbab9dfb7c8571c40d67d534bbdee55bd6c473f432b177 Status: Downloaded newer image for centos:latest [root@a99b41fba3ca /]# æˆ‘å€‘åœ¨è‘—é¢çš„ data è³‡æ–™å¤¾éš¨æ„æ–°å¢æª”æ¡ˆæˆ–æ˜¯è³‡æ–™ï¼Œå†é€²å…¥ Docker Container å…§çš„ /storage (è©²æª”æ¡ˆæ˜¯å› ç‚ºä½¿ç”¨ -v è€Œæ–°å¢çš„è³‡æ–™å¤¾) ï¼Œçœ‹çœ‹æœ‰æ²’æœ‰åŒæ­¥æ–°å¢ã€‚\n[root@a99b41fba3ca /]# cd storage [root@a99b41fba3ca storage]# pwd /storage [root@a99b41fba3ca storage]# ls 1.html\t2.html\t3.html Dockerfile VOLUME ä½¿ç”¨ æˆ‘å€‘å…ˆæ‰“é–‹ä¸Šæ¬¡çš„ Dockerfile æª”æ¡ˆï¼Œåœ¨åŸºç¤æ˜ åƒæª”è³‡è¨Šçš„åº•ä¸‹ä½¿ç”¨ VOLUME æŒ‡ä»¤ï¼ŒåŠ å…¥ storage è³‡æ–™å¤¾ï¼Œå†å°‡ Image Build èµ·ä¾†ï¼Œå•Ÿå‹• Containerï¼Œåœ¨ /storage è£¡é¢éš¨ä¾¿æ–°å¢è³‡æ–™ï¼Œæœ€å¾Œæˆ‘å€‘åœ¨ç”¨ docker inspect æŒ‡ä»¤ä¾†æ‰¾æ˜ å°„åœ¨æœ¬åœ°ç«¯çš„è·¯å¾‘ã€‚\nåœ¨åŸºç¤æ˜ åƒæª”è³‡è¨Šçš„åº•ä¸‹ä½¿ç”¨ VOLUME æŒ‡ä»¤ï¼ŒåŠ å…¥ storage è³‡æ–™å¤¾ # åŸºç¤æ˜ åƒæª”è³‡è¨Š FROM ubuntu:latest VOLUME [\"/storage\"] .... çœç•¥ .... å»ºç«‹æ˜ åƒæª” $ docker build -t demo-image:v2 . [+] Building 1.3s (6/6) FINISHED =\u003e [internal] load build definition from Dockerfile 0.0s =\u003e =\u003e transferring dockerfile: 44B 0.0s =\u003e [internal] load .dockerignore 0.0s =\u003e =\u003e transferring context: 2B 0.0s =\u003e [internal] load metadata for docker.io/library/ubuntu:latest 1.2s =\u003e [1/2] FROM docker.io/library/ubuntu:latest@sha256:8ae9bafbb64f63a50caab98fd3a5e37b3eb837a3e0780b78e5218e63193961f9 0.0s =\u003e CACHED [2/2] RUN apt-get update -y \u0026\u0026 apt-get install nginx -y 0.0s =\u003e exporting to image 0.0s =\u003e =\u003e exporting layers 0.0s =\u003e =\u003e writing image sha256:0618bb2685ecfe200d9df4a91380d482031352d0e00cbfdf70fcd063aa8654fa 0.0s =\u003e =\u003e naming to docker.io/library/demo-image:v2 å•Ÿå‹• Containerï¼Œä¸¦åœ¨ /storage å…§æ–°å¢éš¨æ„è³‡æ–™ $ docker run -it demo-image:v2 /bin/bash root@4f8712562dfe:/# echo \"Hello ian\" \u003e /storage/helloworld.txt root@4f8712562dfe:/# ll /storage total 12 drwxr-xr-x 2 root root 4096 Mar 16 05:39 ./ drwxr-xr-x 1 root root 4096 Mar 16 05:38 ../ -rw-r--r-- 1 root root 10 Mar 16 05:39 helloworld.txt ä½¿ç”¨ inspect æŒ‡ä»¤ï¼Œä¾†æ‰¾åˆ° Volume åœ¨æœ¬åœ°ç«¯æ˜ å°„çš„è³‡æ–™å¤¾è·¯å¾‘ï¼Œçœ‹çœ‹è£¡é¢æœ‰æ²’æœ‰æˆ‘å€‘åœ¨ Container è£¡é¢æ–°å¢çš„è³‡æ–™å§ $ docker inspect -f '{{.Mounts}}' 4f8712562dfe [{volume 4fe10ca3f...çœç•¥ /var/lib/docker/volumes/4fe10ca3f234633164d9b3c541893c68db1b4f98806525076a2edd5c1c7863c4/_data /storage local true }] $ docker run -it --privileged --pid=host debian nsenter -t 1 -m -u -n -i sh / # cd /var/lib/docker/volumes/4fe10ca3f234633164d9b3c541893c68db1b4f98806525076a2edd5c1c7863c4/_data /var/lib/docker/volumes/4fe10ca3f234633164d9b3c541893c68db1b4f98806525076a2edd5c1c7863c4/_data # ls helloworld.txt mac OS æ‰¾ä¸åˆ° /var/lib/docker/volumesï¼š ç”±æ–¼ macOS ä¸‹çš„ docker å¯¦éš›æ˜¯åœ¨ vm è£¡åˆå¤šåŠ ä¸€å±¤ï¼Œæ‰€ä»¥æ²’è¾¦æ³•ç›´æ¥è¨ªå• /var/lib/docker/volumesï¼Œå¿…é ˆå…ˆé€éä»¥ä¸‹æŒ‡ä»¤é€²å…¥ VM ä¸­ã€‚\ndocker run -it --privileged --pid=host debian nsenter -t 1 -m -u -n -i sh è©³ç´°å…§å®¹å¯ä»¥åƒè€ƒ Where is /var/lib/docker on Mac/OS Xã€‚\nå®¹å™¨èˆ‡å®¹å™¨ä¹‹é–“è³‡æ–™å…±äº« å¦‚ä½•å•Ÿç”¨å®¹å™¨èˆ‡å®¹å™¨ä¹‹é–“çš„è³‡æ–™å…±äº«ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹æ–¹å¼\nå…ˆå•Ÿå‹•ç¬¬ä¸€å€‹å®¹å™¨æŒ‡ä»¤å¦‚ä¸‹ docker run -it -v /data --name=container1 centos /bin/bash [root@ a0307ce757ca /]# å¦äºŒå€‹å®¹å™¨æŒ‡ä»¤å¦‚ä¸‹ docker run -it --volumes-from container1 --name=container2 centos /bin/bash [root@720d57983cd4 /]# --volumes-from åƒæ•¸æŒ‡å®š container1 çš„è³‡æ–™æœƒèˆ‡ container2 åšå…±äº«ã€‚ æˆ‘å€‘åœ¨ç¬¬ä¸€å€‹å®¹å™¨ï¼Œé€²å…¥ /data è³‡æ–™å¤¾ï¼Œéš¨æ©Ÿè¼¸å…¥è³‡æ–™ [root@a0307ce757ca /]# cd /data/ [root@a0307ce757ca data]# echo \"ian~\" \u003e hello.txt å†ä¾†çœ‹ä¸€ä¸‹ç¬¬äºŒå€‹å®¹å™¨ /data è³‡æ–™å¤¾ï¼Œæ˜¯å¦æœ‰æˆ‘å€‘åœ¨å®¹å™¨(a0307ce757ca)ç”¢ç”Ÿçš„è³‡æ–™ [root@720d57983cd4 /]# cat /data/hello.txt ian~ Network æ¨¡å¼å’Œæ¯”è¼ƒ åœ¨åŸ·è¡Œ docker run å…¶ä¸­ä¸€å€‹åƒæ•¸æ˜¯ --net ï¼Œä»–å¯ä»¥è¨­å®š Container è¦ä½¿ç”¨å“ªä¸€ç¨®çš„ç¶²è·¯æ¨¡å¼ï¼Œä»¥ä¸‹åˆ†åˆ¥èªªæ˜é€™äº›ç¶²è·¯æ¨¡å¼\nnoneï¼šåœ¨åŸ·è¡Œ Container æ™‚ï¼Œç¶²è·¯åŠŸèƒ½æ˜¯é—œé–‰çš„ï¼Œæ‰€ä»¥ç„¡æ³•èˆ‡æ­¤ Container é€£ç·šã€‚ containerï¼šä½¿ç”¨ç›¸åŒçš„ Network Namespace ï¼Œå‡è¨­ Container 1 çš„ IP æ˜¯ 172.17.0.2ï¼Œé‚£ Container 2 çš„ IP ä¹Ÿæ˜¯ 172.17.0.2ã€‚ hostï¼šContainer çš„ç¶²è·¯è¨­å®šå’Œå¯¦é«”ä¸»æ©Ÿä½¿ç”¨ç›¸åŒçš„ç¶²è·¯è¨­å®šï¼Œæ‰€ä»¥ Container è£¡é¢ä¹Ÿå¯ä»¥ä¿®æ”¹å¯¦é«”æ©Ÿå™¨çš„ç¶²è·¯è¨­å®šï¼Œå› æ­¤ä½¿ç”¨æ­¤æ¨¡å¼éœ€è¦è€ƒæ…®ç¶²è·¯å®‰å…¨æ€§ä¸Šçš„å•é¡Œã€‚ bridgeï¼šDocker é è¨­å°±æ˜¯æ­¤ç¶²è·¯æ¨¡å¼ï¼Œé€™å€‹ç¶²è·¯æ¨¡å¼å°±åƒæ˜¯ NAT çš„ç¶²è·¯æ¨¡å¼ï¼Œä¾‹å¦‚å¯¦é«”ä¸»æ©Ÿçš„ IP æ˜¯ 192.168.1.10 å®ƒæœƒå°æ‡‰åˆ° Container è£¡é¢çš„ 172.17.0.2ï¼Œåœ¨å•Ÿå‹• Docker çš„æœå‹™æ™‚æœƒæœ‰ä¸€å€‹ docker0 çš„ç¶²è·¯å¡ä¾†åšæ­¤ç¶²è·¯çš„æ©‹æ¥ã€‚ overlayï¼šContainer ä¹‹é–“å¯ä»¥åœ¨ä¸åŒçš„å¯¦é«”æ©Ÿå™¨ä¸Šåšé€£ç·šï¼Œä¾‹å¦‚ ï¼¨ ost 1 æœ‰ä¸€å€‹ Container 1 ï¼Œç„¶å¾Œ Host 2 æœ‰ä¸€å€‹ Container 2ï¼ŒContainer 1 å¯ä»¥ç›´æ¥ä½¿ç”¨ overlay çš„ç¶²è·¯æ¨¡å¼å’Œ Container 2 åšç¶²è·¯é€£ç·šã€‚ macvlanï¼šå¯ä»¥ç›´æ¥åˆ†é…å¯¦é«”ç¶²å¡çš„ MAC address çµ¦ç‰¹å®šçš„ Containerï¼Œè®“ Container é€éå¯¦é«”çš„ç¶²å¡ä½¿ç”¨ç¶²è·¯ã€‚ é‚£æˆ‘å€‘å°±ä¾†å¯¦ä½œæ¯ä¸€å€‹ç¶²è·¯æ¨¡å¼å§ï¼\nnone æˆ‘å€‘ä½¿ç”¨ docker runæŒ‡ä»¤ï¼Œåœ¨å¾Œé¢åŠ å…¥åƒæ•¸ --net=none ï¼Œæˆ‘å€‘å»ºç«‹ jonlabelle/network-tools (è£¡é¢æœ‰å¾ˆå¤šç¶²è·¯æ¸¬è©¦å·¥å…·)ã€‚\n$ docker run -it --net=none jonlabelle/network-tools [docker@network-tools]$ ifconfig lo Link encap:Local Loopback inet addr:127.0.0.1 Mask:255.0.0.0 .... çœç•¥ .... å¯ä»¥çœ‹åˆ°æˆ‘å€‘ä½¿ç”¨ ifconfig æŸ¥è©¢ï¼Œåªæœ‰æœ¬åœ°ç«¯çš„ 127.0.0.1 IPï¼Œæˆ‘å€‘åœ¨ä½¿ç”¨ ping ä¾†æ¸¬è©¦ google ç¶²ç«™å§\n[docker@network-tools]$ ping www.google.com ping: www.google.com: Try again container æˆ‘å€‘å…ˆå•Ÿå‹•ä¸€å€‹åç‚º container1 çš„å®¹å™¨\ndocker run --name container1 -it jonlabelle/network-tools å†é–‹å•Ÿå¦ä¸€å€‹ Terminal ä¾†å•Ÿå‹• container2 çš„å®¹å™¨ï¼Œä¸¦è¨­å®šç›¸åŒçš„ Network Namespace\ndocker run --name container2 --net=container:container1 -it jonlabelle/network-tools ä¸€æ¨£ä½¿ç”¨ ifconfig æŸ¥è©¢ï¼Œå¯ä»¥ç™¼ç¾å…©å€‹å®¹å™¨çš„ IP éƒ½æ˜¯ç›¸åŒçš„\neth0 Link encap:Ethernet HWaddr 02:42:AC:11:00:02 inet addr:172.17.0.2 Bcast:172.17.255.255 Mask:255.255.0.0 UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 .... çœç•¥ .... host åœ¨åŸ·è¡Œ docker run æŒ‡ä»¤æ™‚ï¼Œåœ¨å¾Œé¢åŠ å…¥åƒæ•¸ --net=host ï¼Œä¾†æ¸¬è©¦ host æ¨¡å¼\ndocker run --net=host -it jonlabelle/network-tools å¯ä»¥çœ‹åˆ° Container çš„ç¶²è·¯è³‡è¨Šå’Œå¯¦é«”ä¸»æ©Ÿçš„ç¶²è·¯è³‡è¨Šæ˜¯ç›¸åŒçš„çµæœ\n[docker@network-tools]$ ifconfig br-36a27cab1817 Link encap:Ethernet HWaddr 02:42:20:DF:DB:FD inet addr:172.20.0.1 Bcast:172.20.255.255 Mask:255.255.0.0 UP BROADCAST MULTICAST MTU:1500 Metric:1 RX packets:0 errors:0 dropped:0 overruns:0 frame:0 TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 .... çœç•¥ .... host ç¶²è·¯æ¨¡å¼\nbridge åœ¨åŸ·è¡Œ docker run æŒ‡ä»¤æ™‚ï¼Œåœ¨å¾Œé¢åŠ å…¥åƒæ•¸ --net=bridge ï¼Œä¾†æ¸¬è©¦ bridge æ¨¡å¼\ndocker run --net=bridge -it jonlabelle/network-tools docker æœƒæ–°å¢ä¸€å€‹è™›æ“¬ç¶²å¡ä½œç‚ºå®¹å™¨ç¶²è·¯å°å¤–çš„å‡ºå£ï¼Œé è¨­åç¨±ç‚º docker0ï¼Œdocker0 æœƒè·Ÿæœ¬æ©Ÿçš„å°å¤–ç¶²å¡(åœ–ä¸­çš„ eth0 )ç›¸é€£ï¼Œè—‰æ­¤å–å¾—å°å¤–é€£ç·šçš„èƒ½åŠ›ï¼Œä¹Ÿå› ç‚ºæ¯ä¸€å€‹å®¹å™¨éƒ½æœƒä½¿ç”¨ä¸€å€‹ veth device èˆ‡ docker0 ç›¸é€£ï¼Œæ‰€ä»¥ä¹Ÿå…·å‚™å°å¤–é€£ç·šçš„èƒ½åŠ›ã€‚\nbridge ç¶²è·¯æ¨¡å¼\noverlay ä¸‹åœ–æ˜¯èªªæ˜ Host1 å¯¦é«”ä¸»æ©Ÿè£¡é¢æœ‰ Container1ï¼Œç„¶å¾Œ Host2 å¯¦é«”ä¸»æ©Ÿè£¡é¢æœ‰ Container2ï¼Œå¯ä»¥é€é Docker overlay æ¨¡å¼å°‡ Container1 å’Œ Container2 é€£æ¥åšæºé€šã€‚å¦å¤–é‚„éœ€è¦ä¸€å€‹ Consol ä¾†å­˜é€£ç·šçš„è³‡æ–™åº«ï¼Œåœ¨ä½¿ç”¨ overlay æ™‚è¦å…ˆåœ¨ Docker åšè¨­å®šï¼Œé€™æ¨£æ‰èƒ½å­˜æ”¾ overlay ç¶²è·¯æ¨¡å¼çš„é€£ç·šè³‡è¨Šã€‚\noverlay ç¶²è·¯æ¨¡å¼\nmacvlan macvlan çš„åŸç†å°±æ˜¯åœ¨æœ¬æ©Ÿçš„ç¶²å¡ä¸Šè™›æ“¬å‡ºå¾ˆå¤šå€‹å­ç¶²å¡ï¼Œé€šéä¸åŒçš„ MAC ä½ç½®åœ¨æ•¸æ“šéˆè·¯å±¤é€²è¡Œç¶²è·¯è³‡æ–™çš„è½‰ç™¼ã€‚\nmacvlan ç¶²è·¯æ¨¡å¼\nDocker-compose æˆ‘å€‘åœ¨åŸ·è¡Œå¤šå€‹å®¹å™¨æ™‚ï¼Œéœ€è¦é‡è¤‡çš„ä¸‹ run æŒ‡ä»¤ä¾†åŸ·è¡Œï¼Œä»¥åŠå®¹å™¨èˆ‡å®¹å™¨ä¹‹é–“è¦åšé—œè¯ä¹Ÿè¦è¨˜å¾—æ¯ä¸€å€‹ä¹‹é–“è¦æ€éº¼é€£çµï¼Œæœƒè®Šå¾—å¾ˆéº»ç…©ä¸”ä¸æ˜“ç®¡ç†ï¼Œæ‰€ä»¥æœ‰äº† docker-compose å¯ä»¥å°‡å¤šå€‹å®¹å™¨çµ„åˆèµ·ä¾†ï¼Œè®Šæˆä¸€å€‹å¼·å¤§çš„åŠŸèƒ½ã€‚\nåªè¦å¯«ä¸€å€‹ docker-compose.yml æŠŠæ‰€æœ‰æœƒä½¿ç”¨åˆ°çš„ Docker image ä»¥åŠæ¯ä¸€å€‹å®¹å™¨ä¹‹é–“çš„é—œè¯æˆ–æ˜¯ç¶²è·¯çš„è¨­å®šéƒ½å¯«ä¸Šå»ï¼Œæœ€å¾Œå†ä½¿ç”¨ docker-compose up æŒ‡ä»¤ï¼Œå°±å¯ä»¥æŠŠæ‰€æœ‰çš„å®¹å™¨éƒ½åŸ·è¡Œèµ·ä¾†å›‰ï¼\næˆ‘å€‘å°±ç›´æ¥ä¾†å¯¦ä½œæˆ‘å€‘é€™æ¬¡çš„æ¨™é¡Œï¼Œè¦ä½¿ç”¨ docker-compose ä¾†æ•´åˆ PHP MySQL Nginx ç’°å¢ƒã€‚\næˆ‘å€‘å…ˆé–‹å•Ÿä¸€å€‹è³‡æ–™å¤¾ï¼Œå–åå« docker-compose ï¼Œä¾†æ”¾ç½®æˆ‘å€‘çš„ docker-compose æª”æ¡ˆ æ¥è‘—æ–°å¢ docker-compose.yml æª”æ¡ˆï¼Œè¦æº–å‚™ä¾†æ’°å¯«æˆ‘å€‘çš„è¨­å®šæª”å›‰ï¼ ç”±æ–¼å…§å®¹æœ‰é»é•·ï¼Œæ‰€ä»¥æˆ‘åˆ†æ®µèªªæ˜ï¼Œ(é€™é‚Šæœ‰æ”¾å·²ç¶“å¯«å¥½çš„æª”æ¡ˆæ­) æª”æ¡ˆç›®éŒ„\nDocker-compose.yml docker-volume html index.php info.php nginx Dockerfile default.conf php Dockerfile version: \"3.8\" services: ... çœç•¥ .... å¯ä»¥çœ‹åˆ°ä¸€é–‹é ­ï¼Œæœƒå…ˆå¯«ç‰ˆæœ¬ï¼Œé€™é‚Šä»£è¡¨çš„æ˜¯æœƒä½¿ç”¨ 3.8 ç‰ˆæœ¬çš„è¨­å®šæª”ï¼Œè©³ç´°ç‰ˆæœ¬å°ç…§å¯ä»¥åƒè€ƒ Compose file versions and upgrading\nservices å¯ä»¥è¨­å®šç”¨ä¾†å•Ÿå‹•å¤šçš„å®¹å™¨ï¼Œè£¡é¢æˆ‘å€‘ç¸½å…±æ”¾äº†ä¸‰å€‹å®¹å™¨ï¼Œåˆ†åˆ¥æ˜¯ nginxã€phpã€mysql ã€‚\né‚£æˆ‘å€‘ä¾†çœ‹çœ‹ nginx è£¡é¢æ”¾äº†ä»€éº¼å§ï¼æˆ‘æœƒä¾ç…§ç¨‹å¼ç¢¼å¾€ä¸‹èªªæ˜ï¼Œæœ‰ä¸æ¸…æ¥šçš„å¯ä»¥åº•ä¸‹ç•™è¨€ï¼\nnginx nginx: build: ./nginx/ container_name: nginx ports: - 7777:80 volumes: - ./docker-volume/log/:/var/log/nginx/ nginx çš„ build å°±æ˜¯è¦åŸ·è¡Œé€™å€‹ nginx å®¹å™¨çš„æ˜ åƒæª”ï¼Œé‚„è¨˜å¾—æˆ‘å€‘ä¹Ÿå¯ä»¥ä½¿ç”¨ Dockerfile ä¾†æ’°å¯«æ˜ åƒæª”æ¡ˆå—ï¼?\nç”±æ–¼æˆ‘å€‘é‚„è¦è¨­å®šå…¶ä»–å…§å®¹ï¼Œæ‰€ä»¥ç‰¹åˆ¥å¦å¤–æ‹‰ä¸€å€‹ nginx è³‡æ–™å¤¾ä¾†æ”¾ç½®ï¼Œè£¡é¢æ”¾äº†å…©å€‹æª”æ¡ˆï¼Œåˆ†åˆ¥æ˜¯ Dockerfileã€default.confã€‚\nDockerfile æª”æ¡ˆè£¡é¢æœƒä½¿ç”¨ nginx ç‰ˆæœ¬ 1.20 ï¼Œä¸¦å°‡ default.conf è¤‡è£½åˆ°å®¹å™¨çš„ /etc/nginx/conf.d/default.conf ä¾†å–ä»£è¨­å®šã€‚\nä»¥åŠæˆ‘å€‘ä½¿ç”¨ ports å°‡å®¹å™¨ 80 Port æŒ‡å‘æœ¬æ©Ÿ 7777 Port ï¼Œæ ¼å¼æ˜¯ æœ¬æ©Ÿ Port : å®¹å™¨ Portï¼Œ\nå†ä½¿ç”¨ volumes ä¾†è¨­å®šæˆ‘å€‘ nginx å®¹å™¨ log è³‡æ–™å¤¾æ˜ å°„åˆ°æœ¬æ©Ÿçš„ ./docker-volume/log/ è³‡æ–™å¤¾ã€‚\nphp php: build: ./php/ container_name: php expose: - 9000 volumes: - ./docker-volume/html/:/var/www/html/ php çš„ build æ˜¯è¦åŸ·è¡Œé€™å€‹ php å®¹å™¨çš„æ˜ åƒæª”ï¼Œç”±æ–¼æˆ‘å€‘é‚„è¦è¨­å®šå…¶ä»–å…§å®¹ï¼Œæ‰€ä»¥ç‰¹åˆ¥å¦å¤–æ‹‰ä¸€å€‹ php è³‡æ–™å¤¾ä¾†æ”¾ç½® Dokcerfileã€‚\nDockerfile æª”æ¡ˆè£¡é¢æœƒä½¿ç”¨ php ç‰ˆæœ¬ 7.4-fpmï¼Œä¸¦ä¸”åœ¨å®¹å™¨åŸ·è¡Œ docker-php-ext-installã€mysqliã€‚\nä¸¦å°‡ Port 9000 ç™¼ä½ˆæ–¼æœ¬æ©Ÿï¼Œå†ä½¿ç”¨ volumes ä¾†è¨­å®š /var/www/html ç¶²ç«™æ ¹ç›®éŒ„æ˜ å°„åˆ°æœ¬æ©Ÿçš„ ./docker-volume/html/ è³‡æ–™å¤¾ã€‚\nmysql mysql: image: mysql:8.0.28 container_name: mysql volumes: - ./docker-volume/mysql/:/var/lib/mysql environment: MYSQL_ROOT_PASSWORD: secret MYSQL_DATABASE: mydb MYSQL_USER: myuser MYSQL_PASSWORD: password mysql ä½¿ç”¨çš„æ˜ åƒæª”æ˜¯ mysql ç‰ˆæœ¬æ˜¯ 8.0.28ï¼Œæˆ‘å€‘ç‚ºäº†è¦ä¿ç•™è³‡æ–™åº«çš„è³‡æ–™ï¼Œæ‰€ä»¥å°‡å®¹å™¨çš„ /var/lib/mysql æ˜ å°„åˆ°æœ¬åœ°ç«¯ ./docker-volume/mysql è³‡æ–™å¤¾ã€‚\næœ€å¾Œçš„ç’°å¢ƒè®Šæ•¸ï¼Œè¨­å®š root å¸³è™Ÿçš„ç™»å…¥å¯†ç¢¼ï¼Œä»¥åŠè¦ä½¿ç”¨çš„è³‡æ–™åº«ã€ä½¿ç”¨è€…çš„å¸³è™Ÿã€ä½¿ç”¨è€…çš„å¯†ç¢¼ã€‚\næœ€å¾Œåœ¨ä¸Šé¢çš„ (é€™é‚Šæœ‰æ”¾å·²ç¶“å¯«å¥½çš„æª”æ¡ˆæ­) è£¡é¢é‚„æœ‰å¤šä¸€å€‹ docker-volume/html çš„è³‡æ–™å¤¾ï¼Œå°±æ˜¯æˆ‘å€‘å‰›å‰›æ˜ å°„åˆ°æœ¬åœ°ç«¯çš„è³‡æ–™å¤¾ï¼Œè³‡æ–™å¤¾å…§å·²ç¶“æ”¾æœ‰é€£ç·šæ¸¬è©¦çš„æª”æ¡ˆï¼Œè¼¸å…¥ç¶²å€ http://127.0.0.1:7777/index.phpï¼Œå¦‚æœé–‹å•Ÿå¾Œæœ‰é¡¯ç¤ºä¸‹æ–¹ç•«é¢ï¼Œå°±ä»£è¡¨æˆ‘å€‘æˆåŠŸç”¨ docker-compose å°‡ PHP MySQL Nginx æ•´åˆå†ä¸€èµ·å›‰ï¼\næ¸¬è©¦æ˜¯å¦æˆåŠŸç”¨ docker-compose æ•´åˆ PHP MySQL Nginx","ä»€éº¼æ˜¯-docker-#ä»€éº¼æ˜¯ Docker ?":"Docker æ˜¯ä¸€ç¨®è»Ÿé«”å¹³å°ï¼Œå®ƒå¯ä»¥å¿«é€Ÿå»ºç«‹ã€æ¸¬è©¦å’Œéƒ¨ç½²æ‡‰ç”¨ç¨‹å¼ã€‚ç‚ºä»€éº¼å¯ä»¥å¿«é€Ÿå»ºç«‹å‘¢ï¼Ÿå› ç‚º Docker æœƒå°‡è»Ÿé«”å°è£åˆ°åç‚ºã€å®¹å™¨ã€çš„æ¨™æº–å–®ä½ã€‚å…¶ä¸­æœƒåŒ…å«ç¨‹å¼åº«ã€ç³»çµ±å·¥å…·ã€ç¨‹å¼ç¢¼ã€åŸ·è¡Œè»Ÿé«”æ‰€éœ€çš„æ‰€æœ‰é …ç›®ã€‚ å‰›å‰›æœ‰æåˆ°å®¹å™¨ (Container)ï¼Œæ˜¯ä¸€ç¨®è™›æ“¬åŒ–æŠ€è¡“ï¼Œå®ƒé«˜æ•ˆç‡è™›æ“¬åŒ–åŠæ˜“æ–¼é·ç§»å’Œæ“´å±•çš„ç‰¹æ€§ï¼Œéå¸¸é©åˆç¾ä»£é›²ç«¯çš„é–‹ç™¼åŠä½ˆç½²ã€‚é‚£ Container èˆ‡å‚³çµ±çš„è™›æ“¬æ©Ÿæœ‰ä»€éº¼å·®åˆ¥å‘¢ï¼Ÿæˆ‘å€‘ä¾†çœ‹çœ‹ä¸‹é¢é€™å¼µåœ–\nContainer èˆ‡ VM çš„å·®ç•°\nå¯ä»¥çœ‹åˆ° Container æ˜¯ä»¥æ‡‰ç”¨ç¨‹å¼ç‚ºå–®ä½ï¼Œè€Œ VM å‰‡æ˜¯ä»¥ä½œæ¥­ç³»çµ±ç‚ºå–®ä½ã€‚Container æ˜¯ä¸€å€‹å°è£äº†ç›¸ä¾æ€§è³‡æºèˆ‡æ‡‰ç”¨ç¨‹å¼çš„åŸ·è¡Œç’°å¢ƒ ; VM å‰‡æ˜¯ä¸€å€‹é…ç½®å¥½ CPUã€RAM èˆ‡ Storage çš„ä½œæ¥­ç³»çµ±ï¼Œç‚ºäº†æ›´å¥½çš„åšå€åˆ¥ï¼Œæˆ‘æŠŠ Containerã€VM å…©å€‹å·®åˆ¥ç”¨è¡¨æ ¼ä¾†èªªæ˜ï½\nå€åˆ¥æ¯”è¼ƒ Container VM å–®ä½ æ‡‰ç”¨ç¨‹å¼ ä½œæ¥­ç³»çµ± é©ç”¨æœå‹™ å¤šä½¿ç”¨æ–¼å¾®æœå‹™ ä½¿ç”¨è¼ƒå¤§å‹çš„æœå‹™ ç¡¬é«”è³‡æº æ˜¯ä»¥ç¨‹å¼ç‚ºå–®ä½ï¼Œéœ€è¦çš„ç¡¬é«”è³‡æºå¾ˆå°‘ VM æœƒå…ˆä½”ç”¨ CPUã€RAM ç­‰ç­‰ç¡¬é«”è³‡æºï¼Œä¸ç®¡æœ‰æ²’æœ‰ä½¿ç”¨éƒ½æœƒå…ˆä½”ç”¨ é€ æˆè¡çª Container é–“æ˜¯å½¼æ­¤éš”é›¢çš„ï¼Œå› æ­¤åœ¨åŒä¸€å°æ©Ÿå™¨å¯ä»¥åŸ·è¡Œä¸åŒç‰ˆæœ¬çš„æœå‹™ æœƒå› ç‚ºç‰ˆæœ¬ä¸åŒé€ æˆç’°å¢ƒè¡çª ç³»çµ±æ”¯æ´æ•¸é‡ å–®æ©Ÿæ”¯æ´ä¸Šåƒå€‹å®¹å™¨ ä¸€èˆ¬æœ€å¤šå¹¾åå€‹ å„ªé» 1 . Image è¼ƒå°ï¼Œé€šå¸¸éƒ½å¹¾ MB\n2 . å•Ÿå‹•é€Ÿåº¦å¿«ï¼Œé€šå¸¸å¹¾ç§’å°±å¯ä»¥ç”Ÿæˆä¸€å€‹ Container\n3 . æ›´æ–°è¼ƒç‚ºå®¹æ˜“ï¼Œåªéœ€è¦åˆ©ç”¨æ–°çš„ Image é‡æ–°å•Ÿå‹•å°±æœƒæ›´æ–°äº† 1 . å› ç‚ºç¡¬é«”å±¤ä»¥ä¸Šéƒ½è™›æ“¬åŒ–ï¼Œå› æ­¤å®‰å…¨æ€§ç›¸å°è¼ƒé«˜\n2 . ç³»çµ±é¸æ“‡è¼ƒå¤šï¼Œåœ¨ VM å¯ä»¥é¸æ“‡ä¸åŒçš„ OS\n3 . ä¸éœ€è¦é™ä½æ‡‰ç”¨ç¨‹å¼å…§æœå‹™çš„è€¦åˆæ€§ï¼Œä¸éœ€è¦å°‡ç¨‹å¼å…§çš„æœå‹™å€‹åˆ¥æ‹†é–‹ä¾†éƒ¨ç½² ç¼ºé» 1 . å®‰å…¨æ€§è¼ƒ VM å·®ï¼Œå› ç‚ºç’°å¢ƒèˆ‡ç¡¬é«”éƒ½èˆ‡æœ¬æ©Ÿå…±ç”¨\n2 . åœ¨åŒä¸€å°æ©Ÿå™¨ä¸­ï¼Œæ¯ä¸€å€‹ Container çš„ OS éƒ½æ˜¯ç›¸åŒçš„ï¼Œç„¡æ³•ä¸€å€‹ç‚º Windowsã€ä¸€å€‹ç‚º Linuxï¼Œé‚„æ˜¯ä¾è³´ Host OS\n3 . Container é€šå¸¸æœƒåˆ‡æˆå¾®æœå‹™çš„æ–¹å¼ä½œéƒ¨ç½²ï¼Œåœ¨å„å…ƒä»¶ä¸­çš„ç¶²è·¯é€£çµæœƒæ¯”è¼ƒè¤‡é›œ 1 . Image çš„å¤§å°é€šå¸¸ GB ä»¥ä¸Šï¼Œæ¯” Container å¤§å¾ˆå¤š\n2 . å•Ÿå‹•é€Ÿåº¦é€šå¸¸è¦èŠ±å¹¾åˆ†é˜ï¼Œå› æ­¤æœå‹™é‡å•Ÿé€Ÿåº¦è¼ƒæ…¢\n3 . è³‡æºä½¿ç”¨è¼ƒå¤šï¼Œå› ç‚ºä¸åªç¨‹å¼æœ¬èº«ï¼Œé‚„è¦å°‡ä¸€éƒ¨åˆ†è³‡æºåˆ†çµ¦ VM çš„ä½œæ¥­ç³»çµ± ç¸½çµ\næ›´å¿«é€Ÿçš„äº¤ä»˜å’Œéƒ¨ç½²ï¼šå°æ–¼é–‹ç™¼å’Œç¶­é‹äººå“¡ä¾†èªªï¼Œæœ€å¸Œæœ›å°±æ˜¯ä¸€æ¬¡å»ºç«‹æˆ–è¨­å®šï¼Œå¯ä»¥å†ä»»æ„åœ°æ–¹æ­£å¸¸é‹è¡Œã€‚é–‹ç™¼è€…å¯ä»¥ä½¿ç”¨ä¸€å€‹æ¨™æº–çš„æ˜ åƒæª”ä¾†å»ºç«‹ä¸€å¥—é–‹ç™¼å®¹å™¨ï¼Œé–‹ç™¼å®Œæˆä¹‹å¾Œï¼Œç¶­é‹äººå“¡å¯ä»¥ç›´æ¥ä½¿ç”¨é€™å€‹å®¹å™¨ä¾†éƒ¨ç½²ç¨‹å¼ã€‚Docker å®¹å™¨å¾ˆè¼•å¾ˆå¿«ï¼å®¹å™¨çš„å•Ÿå‹•æ™‚é–“éƒ½æ˜¯å¹¾ç§’ä¸­çš„äº‹æƒ…ï¼Œå¤§é‡åœ°ç¯€ç´„é–‹ç™¼ã€æ¸¬è©¦ã€éƒ¨ç½²çš„æ™‚é–“ã€‚\næ›´æœ‰æ•ˆç‡çš„è™›æ“¬åŒ–ï¼šDocker å®¹å™¨çš„åŸ·è¡Œä¸éœ€è¦é¡å¤–çš„è™›æ“¬åŒ–æ”¯æ´ï¼Œå®ƒæ˜¯æ ¸å¿ƒå±¤ç´šçš„è™›æ“¬åŒ–ï¼Œå› æ­¤å¯ä»¥å¯¦ä½œæ›´é«˜çš„æ•ˆèƒ½å’Œæ•ˆç‡ã€‚\næ›´è¼•é¬†çš„é·ç§»å’Œæ“´å±•ï¼šDocker å®¹å™¨å¹¾ä¹å¯ä»¥åœ¨ä»»æ„çš„å¹³å°ä¸ŠåŸ·è¡Œï¼ŒåŒ…æ‹¬å¯¦é«”æ©Ÿå™¨ã€è™›æ“¬æ©Ÿã€å…¬æœ‰é›²ã€ç§æœ‰é›²ã€å€‹äººé›»è…¦ã€ä¼ºæœå™¨ç­‰ã€‚ é€™ç¨®å…¼å®¹æ€§å¯ä»¥è®“ä½¿ç”¨è€…æŠŠä¸€å€‹æœå‹™å¾ä¸€å€‹å¹³å°ç›´æ¥é·ç§»åˆ°å¦å¤–ä¸€å€‹ã€‚\næ›´ç°¡å–®çš„ç®¡ç†ï¼šä½¿ç”¨ Dockerï¼Œåªéœ€è¦å°å°çš„ä¿®æ”¹ï¼Œå°±å¯ä»¥æ›¿ä»£ä»¥å¾€å¤§é‡çš„æ›´æ–°å·¥ä½œã€‚æ‰€æœ‰çš„ä¿®æ”¹éƒ½ä»¥å¢é‡çš„æ–¹å¼è¢«åˆ†ç™¼å’Œæ›´æ–°ï¼Œå¾è€Œå¯¦ä½œè‡ªå‹•åŒ–ä¸¦ä¸”æœ‰æ•ˆç‡çš„ç®¡ç†ã€‚","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"Docker å®˜ç¶²ï¼šhttps://docs.docker.com/get-started/\nä»€éº¼æ˜¯ Dockerï¼Ÿï¼šhttps://aws.amazon.com/tw/docker/\nDockerï¼ï¼å¾å…¥é–€åˆ°å¯¦è¸ï¼šhttps://philipzheng.gitbook.io/docker_practice/#yuan-chu-chu-ji-can-kao-zi-liao\nDockerfile å»ºç«‹è‡ªè¨‚æ˜ åƒæª” â€” æ¶èµ·ç¶²ç«™å¿«é€Ÿåˆç°¡å–®ï¼ˆä¸€ï¼‰ï¼šhttps://medium.com/@jackercleaninglab/dockerfile-%E5%BB%BA%E7%AB%8B%E8%87%AA%E8%A8%82%E6%98%A0%E5%83%8F%E6%AA%94-%E6%9E%B6%E8%B5%B7%E7%B6%B2%E7%AB%99%E5%BF%AB%E9%80%9F%E5%8F%88%E7%B0%A1%E5%96%AE-%E4%B8%80-22b2743f97b9\nç”¨ 30 å¤©ä¾†ä»‹ç´¹å’Œä½¿ç”¨ Dockerï¼šhttps://ithelp.ithome.com.tw/users/20103456/ironman/1320\nDocker ç¶²è·¯ç°¡ä»‹ï¼šhttps://godleon.github.io/blog/Docker/docker-network-overview/\nDocker-compose Giving static IP in network mode : bridgeï¼šhttps://stackoverflow.com/questions/61949319/docker-compose-giving-static-ip-in-network-mode-bridge"},"title":"Docker ä»‹ç´¹ (å¦‚ä½•ä½¿ç”¨ Docker-compose å»ºç½® PHP+MySQl+Nginx ç’°å¢ƒ)"},"/blog/docker/prometheus-grafana-docker/":{"data":{"":"é‚„è¨˜å¾—æˆ‘å€‘ä¸Šæ¬¡æ¶è¨­ EFK ä¾†ç²å¾—å®¹å™¨çš„æ—¥èªŒå—!? èº«ç‚ºä¸€å€‹ SRE é™¤äº†æ”¶é›†æ—¥èªŒå¤–ï¼Œé‚„éœ€è¦ç›£æ§æ¯å€‹ç³»çµ±æˆ–æ˜¯æœå‹™çš„é‹è¡Œç‹€æ³ï¼Œä¸¦åœ¨è­¦æ€¥æƒ…æ³å³æ™‚é€šçŸ¥ç›¸é—œäººå“¡ä½œç‚ºæ‡‰å°è™•ç†ã€‚æ‰€ä»¥é€éå¥½çš„ Monitoring/Alert System äº†è§£ç›®å‰ Server ç¡¬é«”ç³»çµ±ç‹€æ³å’Œæ•´å€‹ Service çš„ç¶²è·¯ç‹€æ³æ˜¯ä¸€ä»¶éå¸¸é‡è¦çš„ä¸€ä»¶äº‹æƒ…ã€‚\nåœ¨çœ¾å¤šçš„ Monitor å·¥å…·ä¸­ï¼ŒPrometheus æ˜¯ä¸€å€‹å¾ˆæ–¹ä¾¿ä¸”å®Œå–„çš„ç›£æ§é è­¦æ¡†æ¶ TSDB (Time Series Database) æ™‚é–“åºåˆ—è³‡æ–™åº«ï¼Œå¯ä»¥å¿«é€Ÿä¸”å®¹æ˜“çš„å»ºç«‹ä¸åŒç¶­åº¦çš„æŒ‡æ¨™ (Metrics) å’Œæ•´åˆä¸åŒçš„ Alert Tool ä»¥åŠè³‡è¨Šè¦–è¦ºåŒ–åœ–è¡¨çš„ç›£æ§å·¥å…·ä¸¦æä¾›è‡ªå¸¶çš„ PromQL é€²è¡Œ query æŸ¥è©¢ã€‚\nPrometheus Logo\næˆ‘å€‘å…ˆä¾†çœ‹çœ‹ Prometheus çš„æ¶æ§‹åœ–ï¼Œå¯ä»¥æ›´äº†è§£ Prometheus æ•´é«”çš„å®šä½ï¼š\nPrometheus æ¶æ§‹åœ– (åœ–ç‰‡ä¾†æºï¼šä½¿ç”¨ Prometheus å’Œ Grafana æ‰“é€  Flask Web App ç›£æ§é è­¦ç³»çµ±)\næœ‰ä¸€å€‹ Prometheus server ä¸»é«”ï¼Œæœƒå» Prometheus Client Pull ç›¸é—œçš„æŒ‡æ¨™ (Metrics)ï¼Œè‹¥æ˜¯çŸ­æœŸçš„ Job ä¾‹å¦‚ CronJob åœ¨é‚„ä¾†ä¸åŠ Pull è³‡æ–™å›ä¾†å¯èƒ½å°±å·²ç¶“å®Œæˆä»»å‹™äº†ã€æ¸…æ´—æ‰è³‡æ–™ã€‚æ‰€ä»¥æœƒæœ‰ä¸€å€‹ pushgateway æ¥æ”¶ Job Push éä¾†çš„ç›¸é—œè³‡è¨Šï¼ŒPrometheus Server å†å¾å…¶ä¸­æ‹‰å–è³‡æ–™ã€‚ (åœ–ç‰‡å·¦åŠéƒ¨)\nService Discovery å¯ä»¥æ›´å¥½çš„è’é›† Kubernetes ç›¸é—œçš„è³‡è¨Šã€‚ (åœ–ç‰‡ä¸ŠåŠéƒ¨)\nPrometheus Server ä¸»é«”æœƒå°‡è³‡æ–™å„²å­˜åœ¨ Local On-Disk Time Series Database æˆ–æ˜¯å¯ä»¥ä¸²æ¥ Remote Storage Systemsã€‚(åœ–ç‰‡ä¸‹åŠéƒ¨)\nPrometheus Server è³‡æ–™æ‹‰å›ä¾†å¾Œå¯ä»¥ä½¿ç”¨æœ¬èº«è‡ªå¸¶çš„ Web UI æˆ–æ˜¯ Grafana ç­‰å…¶ä»–çš„ Client ä¾†å‘ˆç¾ã€‚(åœ–ç‰‡å³ä¸‹åŠéƒ¨)\nç•¶æŠ“å–è³‡æ–™çš„å€¼è¶…é Alert Rule æ‰€è¨­å®šçš„é–¥å€¼ (threshold) æ™‚ï¼ŒAlertmanager å°±æœƒå°‡è¨Šæ¯é€å‡ºï¼Œå¯ä»¥é€é Emailã€Slack ç­‰è¨Šæ¯é€šçŸ¥ï¼Œæé†’ç›¸é—œäººå“¡é€²è¡Œè™•ç†ã€‚(åœ–ç‰‡å³ä¸ŠåŠéƒ¨)\nPrometheus å¯èƒ½åœ¨å„²å­˜æ“´å±•ä¸Šæ¯”ä¸ä¸Šå…¶ä»– Time Series Databaseï¼Œä½†åœ¨æ•´åˆå„ç¨®ç¬¬ä¸‰æ–¹çš„ Data Source ä¸Šååˆ†æ–¹ä¾¿ï¼Œä¸”åœ¨æ”¯æ´é›²ç«¯æœå‹™å’Œ Container å®¹å™¨ç›¸é—œå·¥å…·ä¹Ÿååˆ†å‹å¥½ã€‚ä½†åœ¨åœ–ç‰‡çš„è¡¨ç¾ä¸Šå°±ç›¸è¼ƒæ–¼å–®è–„ï¼Œæ‰€ä»¥æœƒæ­é…æˆ‘å€‘æ¥ä¸‹ä¾†è¦ä»‹ç´¹çš„ Grafanac ç²¾ç¾å„€è¡¨æ¿å·¥å…·ä¾†é€²è¡Œè³‡è¨Šè¦–è¦ºåŒ–å’Œåœ–è¡¨çš„å‘ˆç¾ã€‚\nGrafana Logo\nGrafana æ˜¯ç”± Grafana Lab ç¶“ç‡Ÿçš„ä¸€å€‹éå¸¸ç²¾ç¾çš„å„€è¡¨æ¿ç³»çµ±ï¼Œå¯ä»¥æ•´åˆå„ç¨®ä¸åŒçš„ Data Sourceï¼Œä¾‹å¦‚ï¼šPrometheusã€Elasticsearchã€MySQLã€PostgreSQL ç­‰ã€‚é€éä¸åŒç¨®æŒ‡æ¨™ (Metrics) å‘ˆç¾åœ¨ Dashboard ä¸Šã€‚å¦‚æœé‚„æ˜¯ä¸å¤ªæ¸…æ¥šï¼Œå¯ä»¥æŠŠ Prometheus Grafana åˆ†åˆ¥æƒ³æˆ Prometheus æ˜¯ EFK çš„ Elasticsearchï¼ŒGrafana æƒ³æˆæ˜¯ EFK çš„ Kibanaã€‚\nä»Šå¤©æˆ‘å€‘è¦é€é Docker-Compose æ­é… Nginx å¯¦ä½œä¸€å€‹ç°¡å–®çš„ Web Service ç¯„ä¾‹ï¼Œä¸¦æ•´åˆ Prometheus å’Œ Grafana ä¾†å»ºç«‹ä¸€å€‹ Web Service ç›£æ§é è­¦ç³»çµ±ã€‚\næ­¤æ–‡ç« ç¨‹å¼ç¢¼ä¹ŸæœƒåŒæ­¥åˆ° Github ï¼Œéœ€è¦çš„ä¹Ÿå¯ä»¥å»æŸ¥çœ‹æ­ï¼è¦è¨˜å¾—å…ˆç¢ºå®šä¸€ä¸‹è‡ªå·±çš„ç‰ˆæœ¬ Github ç¨‹å¼ç¢¼é€£çµ ğŸ˜†","nginx-æŒ‡æ¨™-metrics-æè¿°#Nginx æŒ‡æ¨™ (Metrics) æè¿°":"æˆ‘å€‘åœ¨ http://localhost:9113/metrics ä¸­å¯ä»¥çœ‹åˆ°è¨±å¤šæŒ‡æ¨™ (Metrics) é‚£ä»–å€‘å„ä»£è¡¨ä»€éº¼æ„æ€å‘¢ï¼Ÿæˆ‘æŠŠå®ƒæ•´ç†æˆè¡¨æ ¼è®“å¤§å®¶å¯ä»¥é¸æ“‡è¦ä½¿ç”¨çš„æŒ‡æ¨™ (Metrics)ï¼š\næŒ‡æ¨™ æè¿° nginx_connections_accepted æ¥å—ç”¨æˆ¶ç«¯çš„é€£æ¥ç¸½æ•¸é‡ nginx_connections_active ç•¶å‰ç”¨æˆ¶ç«¯é€£æ¥æ•¸é‡ nginx_connections_handled Handled ç‹€æ…‹çš„é€£æ¥æ•¸é‡ nginx_connections_reading æ­£åœ¨è®€å–çš„ç”¨æˆ¶ç«¯é€£æ¥æ•¸é‡ nginx_connections_waiting æ­£åœ¨ç­‰å¾…ä¸­çš„ç”¨æˆ¶ç«¯é€£æ¥æ•¸é‡ nginx_connections_writing æ­£åœ¨å¯«å…¥çš„ç”¨æˆ¶ç«¯é€£æ¥æ•¸é‡ nginx_http_requests_total å®¢æˆ¶ç«¯ç¸½è«‹æ±‚æ•¸é‡ nginx_up Nginx Exporter æ˜¯å¦æ­£å¸¸é‹è¡Œ nginxexporter_build_info Nginx Exporter çš„æ§‹å»ºè³‡è¨Š ","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"ä½¿ç”¨ Prometheus å’Œ Grafana æ‰“é€  Flask Web App ç›£æ§é è­¦ç³»çµ±ï¼šhttps://blog.techbridge.cc/2019/08/26/how-to-use-prometheus-grafana-in-flask-app/\nNginx Exporter æ¥å…¥ï¼šhttps://cloud.tencent.com/document/product/1416/56039\né€šé nginx-prometheus-exporter ç›£æ§ nginx æŒ‡æ¨™ï¼šhttps://maxidea.gitbook.io/k8s-testing/prometheus-he-grafana-de-dan-ji-bian-pai/tong-guo-nginxprometheusexporter-jian-kong-nginx\nä½¿ç”¨ nginx-prometheus-exporter ç›£æ§ nginxï¼šhttps://www.cnblogs.com/rongfengliang/p/13580534.html\nä½¿ç”¨é˜¿é‡Œé›² Prometheus ç›£æ§ Nginxï¼ˆæ–°ç‰ˆï¼‰ï¼šhttps://help.aliyun.com/document_detail/171819.html?spm=5176.22414175.sslink.29.6c9e1df9DdpLPP\nGrafana Image Rendererï¼šhttps://grafana.com/grafana/plugins/grafana-image-renderer/\ngrafana çš„ image render è®¾ç½®ï¼šhttps://blog.csdn.net/dandanfengyun/article/details/115346594","å¯¦ä½œ#å¯¦ä½œ":"æ¥ä¸‹ä¾†æœƒä¾ç…§åŸ·è¡Œçš„æµç¨‹ä¾†è·Ÿå¤§å®¶èªªæ˜æ­ï¼é‚£è¦é–‹å§‹å›‰ ğŸ˜\næˆ‘å€‘è¦å»ºç«‹ä¸€å€‹ Nginx ä¾†æ¨¡æ“¬å—ç›£æ§çš„æœå‹™ï¼Œæˆ‘å€‘è¦é€é nginx-prometheus-exporter ä¾†è®“ Prometheus æŠ“åˆ°è³‡æ–™æœ€å¾Œå‚³çµ¦ Grafanaï¼Œæ‰€ä»¥æˆ‘å€‘åœ¨ Docker-compose è£¡é¢æœƒæœ‰ nginxã€nginx-prometheus-exporterã€prometheusã€grafanaã€grafana-image-renderer å¹¾å€‹å®¹å™¨ï¼Œæˆ‘å€‘å…ˆçœ‹ä¸€ä¸‹ç¨‹å¼ç¢¼ï¼Œå†ä¾†èªªæ˜ç¨‹å¼ç¢¼è¨­å®šäº†å“ªäº›æ±è¥¿å§ï¼\nDocker-compose.yamlversion: \"3.8\" services: nginx: build: ./nginx/ container_name: nginx ports: - 8080:8080 nginx-prometheus-exporter: image: nginx/nginx-prometheus-exporter:0.10 container_name: nginx-prometheus-exporter command: -nginx.scrape-uri http://nginx:8080/stub_status ports: - 9113:9113 depends_on: - nginx prometheus: image: prom/prometheus:v2.35.0 container_name: prometheus volumes: - ./prometheus.yaml:/etc/prometheus/prometheus.yaml - ./prometheus_data:/prometheus command: - \"--config.file=/etc/prometheus/prometheus.yaml\" ports: - \"9090:9090\" renderer: image: grafana/grafana-image-renderer:3.4.2 environment: BROWSER_TZ: Asia/Taipei ports: - \"8081:8081\" grafana: image: grafana/grafana:8.2.5 container_name: grafana volumes: - ./grafana_data:/var/lib/grafana environment: GF_SECURITY_ADMIN_PASSWORD: pass GF_RENDERING_SERVER_URL: http://renderer:8081/render GF_RENDERING_CALLBACK_URL: http://grafana:3000/ GF_LOG_FILTERS: rendering:debug depends_on: - prometheus - renderer ports: - \"3000:3000\" nginxï¼šå› ç‚º Nginx æœƒé€šé stub_status é é¢ä¾†é–‹æ”¾å°å¤–çš„ç›£æ§æŒ‡æ¨™ã€‚æ‰€ä»¥æˆ‘å€‘è¦å¦å¤–å¯«ä¸€å€‹ Dockerfile è¨­å®šæª”ï¼Œå…ˆå°‡ conf æ”¾å…¥ Nginx ä¸­ã€‚ nginx-prometheus-exporterï¼šé€™è£¡è¦æ³¨æ„çš„æ˜¯éœ€è¦ä½¿ç”¨ command ä¾†è¨­å®š nginx.scrapt-urlï¼Œæˆ‘å€‘è¨­å®š http://nginx:8080/stub_statusï¼Œä»–çš„é è¨­ Port æ˜¯ 9113ï¼Œä¸¦è¨­å®šä¾è³´ depends_noï¼Œè¦ nginx å…ˆå•Ÿå‹•å¾Œæ‰æœƒåŸ·è¡Œ nginx-prometheus-exporterã€‚ prometheusï¼šå°‡ prometheus.yaml è¨­å®šæª”æ”¾å…¥ /etc/prometheus/prometheus.yamlï¼Œä»¥åŠæ›è¼‰ä¸€å€‹ /prometheus_data ä¾†æ°¸ä¹…ä¿å­˜ prometheus çš„è³‡æ–™ï¼Œæœ€å¾Œ command åŠ å…¥ --config.file è¨­å®šã€‚ rendererï¼šé€™æ˜¯ grafana é¡¯ç¤ºåœ–ç‰‡çš„å¥—ä»¶ï¼Œæˆ‘å€‘ä½¿ç”¨ 3.4.2 ç‰ˆæœ¬ï¼Œè¨˜å¾—è¦è¨­å®šç’°å¢ƒè®Šæ•¸ï¼Œç…§ç‰‡é¡¯ç¤ºçš„æ™‚é–“æ‰æœƒæ­£ç¢ºï¼Œä¸¦é–‹å•Ÿ 8081 Port è®“ grafana è¨ªå•ã€‚ grafanaï¼šä¸€æ¨£æˆ‘å€‘å…ˆæ›è¼‰ä¸€å€‹ /grafana_data ä¾†æ°¸ä¹…ä¿å­˜ grafana çš„è¨­å®šï¼Œåœ¨ç’°å¢ƒè®Šæ•¸ä¸­è¨­å®šé è¨­å¸³è™Ÿ admin çš„å¯†ç¢¼æ˜¯ passï¼Œè¨­å®š renderer å¥—ä»¶çš„æœå‹™ä½ç½®æ˜¯ http://renderer:8081/render ä»¥åŠå›å‚³åˆ° http://grafana:3000/ï¼Œä¸¦è¨­å®šä¾è³´ depends_on prometheus è·Ÿ rendererï¼Œæœ€å¾Œè¨­å®š grafana è¦å‘ˆç¾çš„ç•«é¢ 3000 Portã€‚ nginx/DockerfileFROM nginx:1.21.6 COPY ./status.conf /etc/nginx/conf.d/status.conf é¸æ“‡æˆ‘å€‘è¦ä½¿ç”¨çš„ nginx image ç‰ˆæœ¬ï¼Œä¸¦å°‡æˆ‘å€‘çš„è¨­å®šæª”ï¼Œè¤‡è£½åˆ°å®¹å™¨å…§ã€‚\nnginx/status.confserver { listen 8080; server_name localhost; location /stub_status { stub_status on; access_log off; } } é€™é‚Šæœ€é‡è¦çš„å°±æ˜¯è¦è¨­å®š /stub_status è·¯å¾‘ï¼Œä¸¦é–‹å•Ÿ stub_status ï¼Œé€™æ¨£æ‰å¯ä»¥è®“ nginx-prometheus-exporter æŠ“åˆ°è³‡æ–™ï¼(è¦æ€éº¼çŸ¥é“ Nginx æ˜¯å¦é–‹å•Ÿ stub_statusï¼Œå¯ä»¥ä½¿ç”¨ nginx -V 2\u003e\u00261 | grep -o with-http_stub_status_module æŒ‡ä»¤æª¢æŸ¥ï¼Œæˆ‘å€‘é€™æ¬¡è£çš„ Image å·²ç¶“æœ‰å¹«æˆ‘å€‘å•Ÿå‹•)\nprometheus.yamlglobal: scrape_interval: 5s # Server æŠ“å–é »ç‡ external_labels: monitor: \"my-monitor\" scrape_configs: - job_name: \"prometheus\" static_configs: - targets: [\"localhost:9090\"] - job_name: \"nginx_exporter\" static_configs: - targets: [\"nginx-prometheus-exporter:9113\"] é€™é‚Šæ˜¯ prometheus çš„è¨­å®šæª”ï¼Œä¾‹å¦‚æœ‰ scrape_interval ä»£è¡¨ Server æ¯æ¬¡æŠ“å–è³‡æ–™çš„é »ç‡ï¼Œæˆ–æ˜¯è¨­å®š monitor çš„ labelsï¼Œä¸‹é¢çš„ configsï¼Œåˆ†åˆ¥è¨­å®šäº† prometheus å®ƒçš„ targets æ˜¯ [\"localhost:9090\"] ä»¥åŠ nginx_exporter å®ƒçš„ targets æ˜¯ [\"nginx-prometheus-exporter:9113\"]ã€‚\ntest.sh#!/bin/bash docker=\"docker exec nginx\" for i in {1..10} do $docker curl http://nginx:8080/stub_status -s done é€™å€‹æ˜¯æˆ‘è‡ªå·±å¦å¤–å¯«çš„æ¸¬è©¦ç¨‹å¼ï¼Œåœ¨æœ¬æ©ŸåŸ·è¡Œå¾Œä»–æœƒè¨ªå• nginx å®¹å™¨å…§éƒ¨ï¼Œä¸¦æ¨¡æ“¬ nginx æµé‡ï¼Œè®“æˆ‘å€‘åœ¨ Grafana å¯ä»¥æ¸…æ¥šçœ‹åˆ°è³‡æ–™ã€‚\nåŸ·è¡Œ/æ¸¬è©¦ ç•¶æˆ‘å€‘éƒ½å¯«å¥½è¨­å®šæª”å¾Œï¼Œåœ¨å°ˆæ¡ˆç›®éŒ„ä¸‹ï¼Œä¹Ÿå°±æ˜¯æœ‰ Docker-compose è·¯å¾‘ä¸‹ï¼Œä½¿ç”¨ docker-compose up -d ä¾†å•Ÿå‹•å®¹å™¨ï¼š\nå•Ÿå‹•å®¹å™¨\næ¥ä¸‹ä¾†æˆ‘å€‘ä¾åºæª¢æŸ¥å®¹å™¨æ˜¯å¦éƒ½æœ‰æ­£å¸¸é‹ä½œï¼Œé–‹å•Ÿç€è¦½å™¨ç€è¦½ http://localhost:9113/metrics æŸ¥çœ‹æ˜¯å¦æœ‰å‡ºç¾è·Ÿä¸‹é¢åœ–ç‰‡å·®ä¸å¤šçš„å…§å®¹ï¼š\næª¢æŸ¥ Nginx ä»¥åŠ nginx-prometheus-exporter çš„è¨­å®š\nå¦‚æœæœ‰å‡ºç¾ï¼Œæ­å–œä½ å®Œæˆäº† Nginx ä»¥åŠ nginx-prometheus-exporter çš„è¨­å®šï¼Œæˆ‘å€‘å°‡ Nginx çš„ stub_status æœå‹™ï¼Œé€é http://nginx:8080/stub_status è®“ nginx-prometheus-exporter å¯ä»¥æŠ“åˆ°åœ–ç‰‡ä¸­çš„é€™äº›æŒ‡æ¨™ (Metrics)ã€‚\nPrometheus æ¥è‘—æˆ‘å€‘ç€è¦½ http://localhost:9090/targetsï¼Œçœ‹çœ‹æˆ‘å€‘çš„ Prometheus æœ‰æ²’æœ‰è¨­å®šæ­£ç¢ºï¼ŒæŠ“åˆ°æˆ‘å€‘è¨­å®šå¥½çš„ targetsï¼š\næª¢æŸ¥ Prometheus targets\nå¦‚æœå…©å€‹å‡ºç¾çš„éƒ½æ˜¯ ç¶ è‰²çš„ UP å°±ä»£è¡¨æ­£å¸¸æœ‰æŠ“åˆ°è³‡æ–™å›‰ï¼\né‚£è¦æ€éº¼æ¸¬è©¦æ‰çŸ¥é“æœ‰æŠ“åˆ°è³‡æ–™å‘¢ï¼Ÿæˆ‘å€‘å¯ä»¥å…ˆç”¨ Prometheus å…§å»ºçš„åœ–å½¢åŒ–ä»‹é¢ä¾†æª¢æŸ¥ï¼Œåœ¨ç€è¦½å™¨ç€è¦½ http://localhost:9090/graph å°±å¯ä»¥çœ‹åˆ°ä¸‹é¢çš„ç•«é¢ï¼š\nPrometheus å…§å»ºçš„åœ–å½¢åŒ–ä»‹é¢\næˆ‘å€‘é¸æ“‡ Graphï¼Œä¸¦åœ¨ä¸Šé¢çš„æœå°‹æ¬„ï¼Œæ‰“ä¸Š nginx_connections_accepted æŒ‰ä¸‹å³é‚Šçš„ Execute å°±æœƒç”¢ç”Ÿä¸€å¼µåœ–è¡¨ï¼Œåœ–è¡¨è£¡é¢åªæœ‰ä¸€æ¢ç¶ è‰²çš„ç·šï¼Œé‚£é€™å€‹ç·šæ˜¯ä»€éº¼å‘¢ï¼Ÿå®ƒå°±æ˜¯æˆ‘å€‘å‰›å‰›åœ¨ http://localhost:9113/metrics å…¶ä¸­ä¸€å€‹æŒ‡æ¨™ (Metrics)ï¼Œå®ƒä»£è¡¨ Nginx æ¥å—ç”¨æˆ¶ç«¯é€£æ¥ç¸½æ•¸é‡ï¼š\nPrometheus å…§å»ºçš„åœ–å½¢åŒ–ä»‹é¢\né€™å€‹åŠŸèƒ½å°±æ˜¯æŠŠæˆ‘å€‘æ‰€æ”¶åˆ°çš„ Nginx æŒ‡æ¨™ (Metrics)ï¼Œè½‰æ›æˆåœ–è¡¨è®“æˆ‘å€‘å¯ä»¥çŸ¥é“ä»–çš„è®ŠåŒ–ã€‚\nç‚ºäº†æ›´æ˜é¡¯çš„çœ‹å‡ºè®ŠåŒ–ï¼Œé€™æ™‚å€™å°±è¦ä½¿ç”¨æˆ‘æ‰€å¯«å¥½çš„ test.sh è…³æœ¬ï¼Œä½¿ç”¨ sh test.sh ä¾†åŸ·è¡Œï¼Œå†å›ä¾†è§€å¯Ÿåœ–å‹æ˜¯å¦è®ŠåŒ–ï¼š\nç¶“éæ¸¬è©¦é¡¯ç¤ºçš„ nginx_connections_accepted åœ–å½¢\nå¯ä»¥ç™¼ç¾å‰›å‰›åŸæœ¬åªæœ‰ 1 å€‹çš„é€£æ¥æ•¸å› ç‚ºæˆ‘å€‘æ¨¡æ“¬ç¸½å…±è·‘äº† 10 æ¬¡ï¼Œæ‰€ä»¥é€£æ¥æ•¸è®Šæˆ 11 äº†ï¼\nGrafana Prometheus çš„åœ–å½¢åŒ–æ¯”è¼ƒå–®èª¿ï¼Œæ‰€ä»¥æˆ‘å€‘ä½¿ç”¨ Grafana ä¾†ç¾åŒ–æˆ‘å€‘çš„å„€è¡¨æ¿ï¼Œç€è¦½å™¨ç€è¦½ http://localhost:3000/ ï¼Œå¯ä»¥çœ‹åˆ°ä¸€å€‹ç™»å…¥é é¢ï¼šå¸³è™Ÿæ˜¯ adminï¼Œå¯†ç¢¼æ˜¯æˆ‘å€‘åœ¨ç’°å¢ƒè®Šæ•¸ä¸­æ‰€è¨­å®šçš„ passï¼š\nGrafana ç™»å…¥é é¢\nç™»å…¥å¾Œæˆ‘å€‘çœ‹åˆ°é¦–é ï¼Œé¸æ“‡ Add your first data source ä¾†æ–°å¢è³‡æ–™ä¾†æºï¼š\nGrafana æ–°å¢è³‡æ–™ä¾†æº\né¸æ“‡ç¬¬ä¸€å€‹ Prometheusï¼Œæˆ‘å€‘åˆ° HTTP çš„ URL è¨­å®š http://prometheus:9090 å…¶ä»–è¨­å®šåœ¨æˆ‘å€‘æ¸¬è©¦ç’°å¢ƒä¸­ï¼Œä¸éœ€è¦å»èª¿æ•´ï¼Œæ»‘åˆ°æœ€ä¸‹é¢æŒ‰ä¸‹ Save \u0026 testï¼š\nGrafana æ–°å¢è³‡æ–™ä¾†æº\næ¥è‘—æˆ‘å€‘è¦ä¾†è¨­è¨ˆæˆ‘å€‘çš„å„€è¡¨æ¿ï¼Œåœ¨ Grafana é™¤äº†è‡ªå·±è¨­è¨ˆä»¥å¤–ï¼Œé‚„å¯ä»¥ Import åˆ¥äººåšå¥½çš„å„€è¡¨æ¿ã€‚\næˆ‘å€‘é»é¸å·¦å´æ¬„ä½çš„ ï¼‹ ç¬¦è™Ÿ \u003e è£¡é¢çš„ Importï¼Œå¯ä»¥åœ¨é€™é‚Š Import åˆ¥äººåšå¥½çš„å„€è¡¨æ¿ï¼Œä½¿ç”¨æ–¹å¼ä¹Ÿå¾ˆç°¡å–®ï¼Œåªéœ€è¦å…ˆå» Grafana Labs dashboard è£¡é¢æ‰¾åˆ°è‡ªå·±è¦ä½¿ç”¨çš„å„€è¡¨æ¿ï¼Œå³å´æœƒæœ‰ä¸€å€‹ IDï¼ŒæŠŠ ID è²¼ä¸Šæˆ‘å€‘çš„ Grafana å°± Import æˆåŠŸå›‰ï¼å¾ˆç¥å¥‡å§ XD\næˆ‘å€‘è¦ä½¿ç”¨çš„å„€è¡¨æ¿æ˜¯åˆ¥äººå·²ç¶“åšå¥½çš„ NGINX exporterï¼Œå®ƒçš„ ID æ˜¯ 12708ï¼ŒæŠŠ ID è²¼å…¥å¾Œï¼ŒæŒ‰ä¸‹ Loadï¼Œå°±æœƒæœ‰ NGINX exporter çš„åŸºæœ¬è³‡è¨Šï¼Œæˆ‘å€‘åœ¨æœ€ä¸‹é¢çš„ Prometheus é¸æ“‡æˆ‘å€‘è¦ä½¿ç”¨çš„ data sourceï¼Œå°±æ˜¯æˆ‘å€‘å‰›å‰›å…ˆè¨­å®šå¥½çš„ Prometheusï¼Œæœ€å¾ŒæŒ‰ä¸‹ Importï¼Œå°±å®Œæˆæ‹‰ã€‚\nGrafana è¼‰å…¥åˆ¥äººåšå¥½çš„å„€è¡¨æ¿\nå¦‚æœè¨­å®šéƒ½æ²’æœ‰éŒ¯èª¤çš„è©±ï¼Œæ‡‰è©²å¯ä»¥çœ‹åˆ°ä¸‹é¢é€™å€‹ç•«é¢ï¼Œæœ€ä¸Šé¢æ˜¯ç›£æ¸¬ Nginx æœå‹™çš„ç‹€æ…‹ï¼Œä»¥åŠä¸‹æ–¹æœ‰ä¸åŒçš„æŒ‡æ¨™åœ¨é¡¯ç¤ºï¼š\nGrafana å„€è¡¨æ¿\næ¥ä¸‹ä¾†æˆ‘å€‘ä¸€æ¬¡ç”¨ test.sh ä¾†æ¸¬è©¦ä¸€ä¸‹æ˜¯å¦æœ‰æˆåŠŸæŠ“åˆ°è³‡æ–™ï¼š\næ¸¬è©¦ Grafana æ˜¯å¦æˆåŠŸæŠ“åˆ°è³‡æ–™\nå¯ä»¥çœ‹åˆ°åœ¨æˆ‘å€‘ä½¿ç”¨å®Œæ¸¬è©¦è…³æœ¬å¾Œï¼Œåœ¨è©²æ™‚æ®µçš„è³‡æ–™æœ‰æ˜é¡¯çš„ä¸ä¸€æ¨£ï¼Œä»£è¡¨æˆ‘å€‘æœ‰æˆåŠŸæŠ“åˆ°è³‡æ–™ ğŸ˜„\næ­¤å¤–ä¹Ÿå¯ä»¥å°‡ Nginx æœå‹™æš«åœï¼Œçœ‹çœ‹å„€è¡¨æ¿ä¸Šæ–¹çš„ NGINX Status ç‹€æ…‹æ˜¯å¦æ”¹è®Šï¼š\næ¸¬è©¦æš«åœ Nginx æŸ¥çœ‹ Grafana å„€è¡¨æ¿ NGINX Status\nAlerting è­¦å ± ç•¶ç„¶é™¤äº†ç›£æ§ä»¥å¤–ï¼Œæˆ‘å€‘é‚„éœ€è¦æœ‰è­¦å ±ç³»çµ±ï¼Œå› ç‚ºæˆ‘å€‘ä¸å¯èƒ½æ¯å¤©éƒ½ä¸€ç›´ç›¯è‘—å„€è¡¨æ¿çœ‹å“ªè£¡æœ‰éŒ¯èª¤ï¼Œæ‰€ä»¥æˆ‘å€‘è¦è¨­å®šè­¦å ±çš„è¦å‰‡ï¼Œä»¥åŠè­¦å ±è¦ç™¼é€åˆ°å“ªè£¡ï¼Œæ¥è‘—æˆ‘å€‘ä¸€èµ·çœ‹ä¸‹å»å§ï¼š\næˆ‘å€‘å…ˆé»å·¦å´çš„ Alerting ğŸ”” \u003e é»é¸ Notification channels ä¾†æ–°å¢æˆ‘å€‘è¦ç™¼é€åˆ°å“ªè£¡ã€‚é€™æ¬¡æˆ‘å€‘ä¸€æ¨£ä½¿ç”¨ Telegramï¼Œæˆ‘å€‘åœ¨ type ä¸‹æ‹‰å¼é¸å–®é¸æ“‡ Telegramï¼Œè¼¸å…¥æˆ‘å€‘çš„ BOT API Token ä»¥åŠ Chat IDï¼Œå„²å­˜ä¹‹å‰å¯ä»¥é»é¸ test ä¾†æ¸¬è©¦ï¼\næ€éº¼ä½¿ç”¨ Telegram Botï¼šè«‹åƒè€ƒé€™ä¸€ç¯‡ Ansible ä»‹ç´¹èˆ‡å¯¦ä½œ (Inventoryã€Playbooksã€Moduleã€Templateã€Handlers) ä¾†å–å¾— BOT API Token ä»¥åŠ Chat IDã€‚ Alerting è¨­å®š\nAlerting æ¸¬è©¦çµæœ\næ¥è‘—æˆ‘å€‘ä¾†è¨­è¨ˆä¸€å€‹å±¬æ–¼æˆ‘å€‘çš„æ§åˆ¶æ¿ (Panel)ï¼Œé †ä¾¿å¹«ä»–åŠ ä¸Š Alertingï¼Œç¨å¾Œä¹Ÿç”¨ test.shï¼Œçœ‹çœ‹ä»–æœƒä¸æœƒè‡ªå‹•ç™¼å‡ºæé†’åˆ° Telegram Bot ğŸ˜¬\né¦–å…ˆé»é¸å·¦å´æ¬„ä½çš„ ï¼‹ ç¬¦è™Ÿ \u003e è£¡é¢çš„ Createï¼Œåœ¨é¸æ“‡ Add an empty panelï¼š\nCreate Panel\nå† Query çš„ A Metrics browser è¼¸å…¥ nginx_connections_accepted ä¸€æ¨£ä¾†å–å¾— Nginx æ¥å—ç”¨æˆ¶ç«¯é€£æ¥ç¸½æ•¸é‡çš„åœ–è¡¨ï¼Œåˆ°å³ä¸Šè§’é¸æ“‡ Last 5 minutesï¼Œæ—é‚Šçš„åœ–å‹æˆ‘å€‘é¸æ“‡ Graph (old)ï¼Œä¸‹é¢çš„ Title å¯ä»¥ä¿®æ”¹ä¸€ä¸‹é€™å€‹åœ–è¡¨çš„åç¨±ï¼Œæœ€å¾ŒæŒ‰ä¸‹ Saveï¼Œå°±å¯ä»¥çœ‹åˆ°æˆ‘å€‘å»ºå¥½ä¸€å€‹æ§åˆ¶æ¿å›‰ ğŸ¥³\nè¨­å®š Panel\næ¥è‘—æˆ‘å€‘ä¾†è¨­å®š Alertï¼Œå¯ä»¥çœ‹åˆ°å‰›å‰›åœ¨ Query æ—é‚Šæœ‰ä¸€å€‹ Alertï¼Œé»é€²å»å¾ŒæŒ‰ Create Alertï¼Œæˆ‘å€‘å…ˆä¿®æ”¹ Evaluate every å¾Œé¢çš„ For æ”¹ç‚º 1m (ä»£è¡¨ç•¶æ•¸å€¼è¶…éæˆ‘å€‘æ‰€è¨­å®šçš„é–¥å€¼å¾Œï¼Œç‹€æ…‹æœƒå¾ OK è®Šæˆ Pendingï¼Œé€™æ™‚å€™é‚„ä¸æœƒç™¼é€è­¦å ±ï¼Œæœƒç­‰å¾…æˆ‘å€‘ç¾åœ¨è¨­å®šçš„ 1m åˆ†é˜å¾Œï¼Œæƒ…æ³é‚„æ˜¯æ²’æœ‰å¥½è½‰ï¼Œæ‰æœƒç™¼é€é€šçŸ¥)ï¼Œå† Conditions å¾Œé¢æ¬„ä½åŠ å…¥ 10 (æˆ‘å€‘æ‰€è¨­å®šçš„é–¥å€¼ï¼Œä»£è¡¨ nginx_connections_accepted è¶…é 10 å°±æœƒé€²å…¥ Pending ç‹€æ…‹)ï¼Œå¾€ä¸‹æ»‘ Notifications çš„ Send to é¸æ“‡æˆ‘å€‘ä¸Šé¢æ‰€å»ºç«‹çš„ channels åç¨±ï¼ŒæŒ‰ä¸‹ Saveã€‚\nè¨­å®šå¥½ Alert çš„æ§åˆ¶æ¿\næ¥è‘—åŸ·è¡Œ test.sh å…©æ¬¡ï¼Œè®“ nginx_connections_accepted è¶…éæˆ‘å€‘æ‰€è¨­å®šçš„é–¥å€¼ï¼Œå¯ä»¥çœ‹åˆ°æ§åˆ¶æ¿è¶…é 10 ä»¥ä¸Šè®Šæˆç´…è‰²ï¼š\nè¶…éé–¥å€¼ï¼Œæ§åˆ¶æ¿è®Šæˆç´…è‰²\næ¥è‘—ç­‰å¾…å¹¾åˆ†é˜å¾Œï¼Œç‹€æ…‹æœƒå¾ OK ç¶ è‰²è®Šæˆé»ƒè‰²çš„ Pendingï¼Œæœ€å¾Œè½‰æˆç´…è‰²çš„ Alertï¼Œé€™æ™‚å€™ Telegram å°±æœƒæ”¶åˆ°é€šçŸ¥å›‰ âŒ\nè‡ªå‹•ç™¼é€é€šçŸ¥åˆ° Telegram Botï¼Œä¸¦é™„ä¸Šæ§åˆ¶æ¿åœ–ç‰‡","æª”æ¡ˆçµæ§‹#æª”æ¡ˆçµæ§‹":" docker-compose.yaml nginx Dockerfile status.conf prometheus.yaml test.sh é€™æ˜¯ä¸»è¦çš„çµæ§‹ï¼Œç°¡å–®èªªæ˜ä¸€ä¸‹ï¼š\ndocker-compose.yamlï¼šæœƒæ”¾ç½®è¦ç”¢ç”Ÿçš„ nginxã€nginx-prometheus-exporterã€prometheusã€grafanaã€grafana-image-renderer å®¹å™¨è¨­å®šæª”ã€‚ nginx/Dockerfileï¼šå› ç‚ºåœ¨ nginx è¦ä½¿ç”¨ stub_status éœ€è¦å¤šå®‰è£ä¸€äº›è¨­å®šï¼Œæ‰€ä»¥ç”¨ Dockerfile å¦å¤–å¯« nginx çš„æ˜ åƒæª”ã€‚ nginx/status.confï¼šnginx çš„è¨­å®šæª”ã€‚ prometheus.yamlï¼šprometheus çš„è¨­å®šæª”ã€‚ test.shï¼šæ¸¬è©¦ç”¨æª”æ¡ˆ(å¾ŒçºŒæœƒæ•™å¤§å®¶å¦‚ä½•ä½¿ç”¨)ã€‚ ","ç‰ˆæœ¬è³‡è¨Š#ç‰ˆæœ¬è³‡è¨Š":" macOSï¼š11.6 Dockerï¼šDocker version 20.10.14, build a224086 Nginxï¼š1.21.6 Prometheusï¼šv.2.35.0 nginx-prometheus-exporterï¼š0.10 Grafanaï¼š8.2.5 (æœ€æ–°ç‰ˆæœ¬æ˜¯ 8.5.2ï¼Œä½†é¸æ“‡ 8.2.5ï¼Œæ˜¯å› ç‚º 8.3.0 å¾Œ Alerting æ²’æœ‰è¾¦æ³•é™„ä¸Šåœ–ç‰‡ï¼Œè©³ç´°åŸå› å¯ä»¥åƒè€ƒ Add â€œinclude imageâ€ option into Grafana Alerting ) grafana/grafana-image-rendererï¼š3.4.2 "},"title":"ä½¿ç”¨ Prometheus å’Œ Grafana æ‰“é€ ç›£æ§é è­¦ç³»çµ± (Docker ç¯‡)"},"/blog/gcp/":{"data":{"":"æ­¤åˆ†é¡åŒ…å« Google Cloud Platform ç›¸é—œçš„æ–‡ç« ã€‚\nå¦‚ä½•éæ¿¾ GCP LOGï¼Œæ¸›å°‘ Cloud Logging API çš„èŠ±è²» Google Kubernetes Engine CronJob æœƒæœ‰çŸ­æš«æ™‚é–“æ²’æœ‰åŸ·è¡Œ Job Google Cloud Platform (GCP) - IAM èˆ‡ç®¡ç† Google Cloud Platform (GCP) - Compute Engine Google Cloud Platform (GCP) - Cloud Source Repositories Google Cloud Platform (GCP) - Container Registry Google Cloud Platform (GCP) - Cloud Build "},"title":"Google Cloud Platform"},"/blog/gcp/cloud-build/":{"data":{"":"è·Ÿå¤§å®¶ä»‹ç´¹ä¸€ä¸‹ä»Šå¤©çš„ä¸»é¡Œ Cloud Buildï¼ŒCloud Build å¯ä»¥å¹«æˆ‘å€‘åšæŒçºŒå»ºæ§‹ã€æ¸¬è©¦å’Œéƒ¨ç½²ï¼Œæˆ‘å€‘å¯ä»¥æŠŠå®ƒæƒ³æˆç°¡æ˜“ç‰ˆçš„ Jenkinsï¼Œå¾æ•´å€‹æ˜ åƒæª”æ¡ˆæ‰“åŒ…åˆ°éƒ¨ç½²ï¼Œä¹Ÿå°±å¹¾åˆ†é˜çš„äº‹æƒ…ï¼Œä¸”å…§å»ºè¨±å¤šæŒ‡ä»¤ã€‚\næˆ‘å€‘ä»Šå¤©æ–‡ç« ï¼Œéœ€è¦ä½¿ç”¨å‰å¹¾å¤©æåˆ°çš„ Cloud Source Repositories ã€Compute Engineã€Container Registryï¼Œæˆ‘å€‘éœ€è¦å…ˆé€é GitLab å°‡ç¨‹å¼é¡åƒåˆ° Cloud Source Repositoriesï¼Œå†é€é Cloud Build è§¸ç™¼å°‡ GitLab ä¸Šé¢çš„ Dockerfile å»ºç½®åˆ° Container Registry ä¸­ï¼Œå†éƒ¨ç½²åˆ° Compute Engine VM ä¸Šã€‚å¤§å®¶å¯ä»¥åƒè€ƒæµç¨‹åœ–ï¼Œæœƒæ›´æ¸…æ¥šä»Šå¤©çš„æµç¨‹ï¼é‚£æˆ‘å€‘å°±é–‹å§‹å›‰ ğŸ¥¸\næµç¨‹åœ–","cloud-source-repositories-æ¸¬è©¦#Cloud Source Repositories æ¸¬è©¦":"å‰é¢ GitLab é¡åƒè¨­å®šï¼Œè«‹å…ˆåƒè€ƒä¸Šä¸Šç¯‡ Google Cloud Platform (GCP) - Cloud Source Repositoriesï¼Œä¸Šä¸Šç¯‡æœƒå¸¶å¤§å®¶å¾ GitLab é¡åƒåˆ° Cloud Source Repositoriesï¼Œæ‰€ä»¥æˆ‘å€‘å°±æ¥çºŒä¹‹å‰çš„å…§å®¹ï¼Œç¹¼çºŒå¾€ä¸‹é–‹å§‹å­¸ç¿’å§ï½\né–‹å•Ÿ GCPï¼Œé¸æ“‡å·¦å´çš„ menu \u003e é»æ“Š Cloud Build \u003e é¸æ“‡ è§¸ç™¼æ¢ä»¶ï¼Œé»æ“Š å»ºç«‹è§¸ç™¼æ¢ä»¶ æŒ‰éˆ•ã€‚ è¼¸å…¥è§¸ç™¼æ¢ä»¶çš„åç¨±ï¼Œäº‹ä»¶å¯ä»¥è¨­å®šæˆ‘å€‘è¦æ€éº¼é€²è¡Œè§¸ç™¼ï¼Œæˆ‘å€‘é€™é‚Šå…ˆé¸æ“‡ æ¨é€è‡³åˆ†æ”¯çš„ç‰ˆæœ¬ ä¾†è§¸ç™¼ï¼Œåœ¨ä¾†æºé¸æ“‡ä¸Šä¸Šç¯‡å»ºç«‹å¥½çš„ Cloud Source Repositories å­˜æ”¾å€ï¼Œåˆ†æ”¯ç‰ˆæœ¬æˆ‘å€‘å…ˆä½¿ç”¨é è¨­çš„ masterï¼Œä¹Ÿå°±æ˜¯æ¨ç¨‹å¼åˆ° master ä»–æœƒå°±è§¸ç™¼ Cloud Buildï¼š å»ºç«‹è§¸ç™¼æ¢ä»¶ 1\nè¨­å®šé¡å‹æˆ‘å€‘é¸æ“‡ Cloud Build è¨­å®šæª”ï¼Œä»–ä¹Ÿæ˜¯ Cloud Build å°ˆç”¨çš„è¨­å®šæª”ï¼Œå¾Œé¢æœƒå¸¶å¤§å®¶å¯«ä¸€ä»½ Cloud Buildï¼Œä½ç½®ç•¶ç„¶æ˜¯ä½¿ç”¨æˆ‘å€‘ Cloud Source Repositories å­˜æ”¾å€ï¼Œä»¥åŠå¯ä»¥ä¾ç…§å°ˆæ¡ˆä¾†ä¿®æ”¹ cloudbuild.yaml æ”¾åœ¨å°ˆæ¡ˆçš„å“ªè£¡ï¼Œæœ€å¾Œéƒ½æ²’å•é¡Œï¼Œå°±æŒ‰ä¸‹å»ºç«‹ï¼š å»ºç«‹è§¸ç™¼æ¢ä»¶ 2\næ’°å¯« cloudbuild.yaml è¨­å®šæª” åœ¨é–‹å§‹å»ºç«‹æª”æ¡ˆå‰ï¼Œå…ˆä¾†è·Ÿå¤§å®¶èªªèªªæª”æ¡ˆå…§æœ‰å“ªäº›è¨­å®šå§ï¼š\né¦–å…ˆ Cloud Build å»ºæ§‹å™¨æ˜¯è£æœ‰å¸¸ç”¨çš„ç¨‹å¼èªè¨€å’Œå·¥å…·çš„å®¹å™¨æ˜ åƒã€‚æˆ‘å€‘å¯ä»¥é…ç½® Cloud Buildï¼Œè®“å»ºæ§‹å™¨ä¸­é‹è¡Œç‰¹å®šå‘½ä»¤ï¼Œæˆ‘èˆ‰å€‹ä¾‹å­è®“å¤§å®¶äº†è§£ï¼š\nä»¥ä¸‹ç¨‹å¼ç¢¼æ˜¯ä¾†è‡ª Docker Hub çš„ ubnutu æ˜ åƒæª”ä¸­æ‰€åŸ·è¡Œçš„å‘½ä»¤ï¼š\nsteps: - name: \"ubuntu\" args: [\"echo\", \"hello world\"] å¯ä»¥çœ‹åˆ°æˆ‘å€‘é…ç½®æ–‡ä»¶ä¸­ steps åƒæ•¸æ˜¯æŒ‡æˆ‘å€‘è¦å»ºæ§‹çš„æ­¥é©Ÿï¼Œ name å­—æ®µæŒ‡å®š Docker æ˜ åƒæª”çš„ä½ç½®ï¼Œä»¥åŠ args å­—æ®µä¸­æ˜¯æŒ‡å®šæ˜ åƒæª”é‹è¡Œçš„å‘½ä»¤ã€‚\næˆ‘å€‘çš„ Cloud Build ä¸€æ¨£æœƒéœ€è¦ç”¨ name ä¾†æŒ‡å®šå»ºæ§‹å®¹å™¨çš„æ˜ åƒæª”ï¼Œä»¥åŠä½¿ç”¨ args ä¾†åŸ·è¡Œæˆ‘å€‘æ˜ åƒæª”æ‰€è¦é‹è¡Œçš„å‘½ä»¤ã€‚\næˆ‘å€‘çš„ Cloud Build è¨­å®šæª”ä¸­çš„ name å¸¸ç”¨çš„å»ºæ§‹å™¨æ˜ åƒæª”å¦‚ä¸‹ï¼š\nBuilder åç¨± bazel gcr.io/cloud-builders/bazel docker gcr.io/cloud-builders/docker git gcr.io/cloud-builders/git gcloud gcr.io/cloud-builders/gcloud gke-deploy gcr.io/cloud-builders/gke-deploy æ¥è‘—æˆ‘å€‘ä¾†è©¦è‘—å¯«ä¸€å€‹ cloudbuild.yaml ä¾†å»ºæ§‹æˆ‘å€‘çš„ nginx æœå‹™ï¼Œä¸¦éƒ¨ç½²åˆ° Compute Engine ä¸Šã€‚\næˆ‘å€‘å…ˆå›åˆ° Gitlab è©²å°ˆæ¡ˆä¸‹çš„ç›®éŒ„ï¼Œæ–°å¢ cloudbuild.yaml æª”æ¡ˆï¼Œå°‡è¤‡è£½ä»¥ä¸‹å…§å®¹ï¼š\nsteps: # Docker Build - name: \"gcr.io/cloud-builders/docker\" args: [\"build\", \"-t\", \"gcr.io/$PROJECT_ID/ian-test:ian-nginx-test\", \".\"] # Docker Push - name: \"gcr.io/cloud-builders/docker\" args: [\"push\", \"gcr.io/$PROJECT_ID/ian-test:ian-nginx-test\"] # Build VM - name: \"gcr.io/google.com/cloudsdktool/cloud-sdk\" entrypoint: \"gcloud\" args: [ \"compute\", \"instances\", \"create-with-container\", \"ian-test-vm\", \"--container-image\", \"gcr.io/$PROJECT_ID/ian-test:ian-nginx-test\", ] env: - \"CLOUDSDK_COMPUTE_REGION=asia-east1\" - \"CLOUDSDK_COMPUTE_ZONE=asia-east1-b\" æˆ‘å€‘ä¸€å€‹ä¸€å€‹ä¾†èªªèªªçš„é€™å€‹ cloudbuild.yaml è£¡é¢çš„è¨­å®šå§ï¼(æˆ‘ä»¥å‰é¢çš„è¨»è§£ä¾†å€åˆ†)\nDocker Buildï¼šé€™é‚Šçš„ name æˆ‘å€‘ç”¨ gcr.io/cloud-builders/dockerï¼Œä»£è¡¨æˆ‘å€‘å°‡ä½¿ç”¨ docker å»ºæ§‹å™¨ï¼Œargs é€™é‚Šä¸‹çš„æ„æ€æ˜¯è¦æŠŠèˆ‡ cloudbuild.yaml æ”¾åœ¨ä¸€èµ·çš„ Dokcerfile çµ¦ build èµ·ä¾†ï¼Œä¸¦æ”¹åç‚º gcr.io/$PROJECT_ID/ian-test:ian-nginx-testã€‚ Docker Pushï¼šé€™é‚Šä¸€æ¨£ä½¿ç”¨ gcr.io/cloud-builders/dockerï¼Œargs æŒ‡ä»¤éƒ¨åˆ†è®Šæˆæˆ‘å€‘è¦æŠŠä»– push åˆ° gcr.io/$PROJECT_ID/ian-test é€™å€‹ Cloud Source Repositoriesï¼Œå…¶ä¸­é€™å€‹æ˜ åƒæª”æ¡ˆçš„ tag ç‚º ian-nginx-testã€‚ Build VMï¼šé€™é‚Šæˆ‘å€‘ä½¿ç”¨ gcr.io/google.com/cloudsdktool/cloud-sdkï¼Œå¯ä»¥é€éå®ƒä¾†å»ºç«‹ VMï¼Œä¸¦ä¸”åŸ·è¡Œ tag åç‚º ian-nginx-test çš„æ˜ åƒæª”ï¼Œå¾Œé¢ç’°å¢ƒè®Šæ•¸æ˜¯ä¾†è¨­å®š VM çš„å€åŸŸç­‰ç­‰ã€‚ ian-test æ˜¯ Container Registry è³‡æ–™å¤¾åç¨±ï¼Œian-nginx-test æ˜¯ Container Registry æ˜ åƒæª”çš„ tagï¼Œian-test-vm æ˜¯æˆ‘å€‘å»ºç«‹ VM çš„åå­—ï¼Œæ‰€ä»¥è¦è¨˜å¾—æ”¹æˆè‡ªå·±çš„å‘½åæ­ï¼ æ’°å¯« Dockerfile æ¥ä¸‹ä¾†å‰›å‰›æœ‰æåˆ° Docker Build æœƒå°‡æˆ‘å€‘æ”¾åœ¨ä¸€èµ·çš„ Dockerfile çµ¦ build èµ·ä¾†ï¼Œæ‰€ä»¥æˆ‘å€‘ä¹Ÿè¦å…ˆå¯«å¥½è¦ç”¨çš„ Dockerfileï¼š\nFROM nginx:latest COPY ./index.html /usr/share/nginx/html/ æˆ‘å€‘çš„ Dockerfile å¾ˆç°¡å–®ï¼Œç°¡å–®å¯«äº†è¦ä½¿ç”¨çš„æ˜ åƒæª”ï¼Œä»¥åŠå°‡æˆ‘å€‘ç­‰ç­‰è¦æ¸¬è©¦çš„ index è¤‡è£½åˆ°è£¡é¢\næ’°å¯«æ¸¬è©¦ index.html \u003c!DOCTYPE html\u003e \u003chtml lang=\"en\"\u003e \u003chead\u003e \u003cmeta charset=\"UTF-8\" /\u003e \u003cmeta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" /\u003e \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" /\u003e \u003ctitle\u003eæ¸¬è©¦æ¸¬è©¦æ¸¬è©¦\u003c/title\u003e \u003c/head\u003e \u003cbody\u003e æˆ‘æ˜¯æ¸¬è©¦æª”æ¡ˆ \u003c/body\u003e \u003c/html\u003e é€™å€‹æ¸¬è©¦æª”æ¡ˆï¼Œæœƒè“‹é nginx çš„é è¨­ç•«é¢ï¼Œç•¶æˆ‘å€‘æˆåŠŸå°‡ VM å»ºç«‹å¾Œï¼Œç€è¦½ 80 Port æ™‚ï¼Œæ‡‰è©²æœƒè·³å‡ºé€™å€‹æ¸¬è©¦çš„ç¶²é ã€‚\nCommit åˆ° GitLab ç•¶æˆ‘å€‘éƒ½æ–°å¢å¥½æª”æ¡ˆå¾Œï¼Œæˆ‘å€‘å°±å°‡ç¨‹å¼æ¨åˆ°æˆ‘å€‘å‰å¹¾ç¯‡çš„ Cloud Source Repositories å·²ç¶“é¡åƒçš„ GitLab ä¸­ï¼Œæ¥è‘—å°±æ˜¯ç­‰å¾…è¦‹è­‰å¥‡è¹Ÿçš„æ™‚å€™äº†ï¼¸ï¼¤\nç•¶æˆ‘å€‘æ¨é€å¾Œï¼Œæˆ‘å€‘å…ˆæª¢æŸ¥ Cloud Source Repositories æ˜¯å¦æœ‰æˆåŠŸå¾ GitLab é¡åƒéä¾†ï¼š Cloud Source Repositories\næª¢æŸ¥çœ‹çœ‹ Container Registry æ˜¯å¦å¤šäº†åç‚º ian-test çš„è³‡æ–™å¤¾ï¼Œä¸”è£¡é¢æœ‰ä¸€å€‹ tag ç‚º ian-nginx-test çš„æ˜ åƒæª”ï¼š Container Registry\næª¢æŸ¥ä¸€ä¸‹ Cloud Build çš„è§¸ç™¼æ¢ä»¶æ˜¯ä¸æ˜¯åœ¨é‹ä½œï¼Œæœ€å¾ŒæˆåŠŸå¯ä»¥çœ‹åˆ°é¡ä¼¼ä¸‹æ–¹åœ–ç‰‡å…§å®¹ï¼š Cloud Build çš„è§¸ç™¼æ¢ä»¶\næª¢æŸ¥ Compute Engine çš„ VM æ˜¯å¦æœ‰æˆåŠŸè¢«å»ºç«‹ï¼š Compute Engine\næœ€å¾Œå°±æ˜¯æ¸¬è©¦é€™å€‹æ˜ åƒæª”æ¡ˆï¼Œæ˜¯ä¸æ˜¯æˆ‘å€‘æ‰€ Build çš„ï¼Œæ¸¬è©¦æ–¹æ³•å¾ˆç°¡å–®ï¼Œæˆ‘å€‘å‰›å‰›åœ¨ Dockerfile æœ‰è¤‡è£½æˆ‘å€‘è‡ªå·±å¯«çš„ index.html æª”æ¡ˆï¼Œå»è“‹æ‰åŸæœ¬ nginx çš„é è¨­æª”ï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥ç€è¦½ä¸Šé¢åœ–ç‰‡çš„å¤–éƒ¨ IPï¼Œå°±å¯ä»¥çœ‹åˆ°æˆ‘å€‘æ‰€æ”¹çš„é é¢å›‰ï¼ æ¸¬è©¦ç”¨ index.html","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"Cloud Builderï¼šhttps://cloud.google.com/build/docs/cloud-builders\nDay27 - ç”¨ Cloud Build å¯¦ä½œ CI éƒ¨åˆ†ï¼šhttps://ithelp.ithome.com.tw/articles/10224727"},"title":"Google Cloud Platform (GCP) - Cloud Build"},"/blog/gcp/cloud-source-repositories/":{"data":{"":"è·Ÿå¤§å®¶ä»‹ç´¹ä¸€ä¸‹ä»Šå¤©çš„ä¸»é¡Œ Cloud Source Repositoriesï¼Œè½åˆ° Source Repositories æ˜¯ä¸æ˜¯æ„Ÿè¦ºè·Ÿä»€éº¼æ±è¥¿å¾ˆåƒå‘€ï¼Œæ²’éŒ¯ï¼Œå°±è·Ÿæˆ‘å€‘çš„ GitHub or GitLab ä¸€æ¨£ï¼Œå¯ä»¥ç”¨ä¾†å­˜æ”¾æˆ‘å€‘çš„ç¨‹å¼ç¢¼çš„å„²å­˜åº«ï¼Œæˆ‘å€‘ä¾†çœ‹çœ‹å®˜æ–¹æ€éº¼ä»‹ç´¹ä»–å§ï¼š\nå®˜æ–¹ä»‹ç´¹ Cloud Source Repositories\nå¾ˆå¥½æ­ï¼Œéå¸¸ç°¡å–®æ˜ç­ ğŸ¤£ï¼Œæ²’éŒ¯ï¼ŒCloud Source Repositories å°±æ˜¯è¨—ç®¡åœ¨ Google Cloud ä¸ŠåŠŸèƒ½é½Šå…¨(ï¼Ÿ)çš„ç§æœ‰ Git å„²å­˜åº«ã€‚ç‚ºä»€éº¼æœƒæ‰“ä¸€å€‹å•è™Ÿå‘¢ï¼Ÿæ˜¯å› ç‚ºä»–å…¶å¯¦æ²’æœ‰é‚£éº¼å¥½ç”¨ï¼Œæ‰€ä»¥æˆ‘å€‘é€šå¸¸çš„åšæ³•ï¼Œé‚„æ˜¯æœƒä¾é  GitHab æˆ–æ˜¯ GitLab ä¾†å­˜æ”¾ç¨‹å¼ç¢¼ï¼Œå†é€éé¡åƒ (mirror) çš„æ–¹å¼åˆ° Google Cloud Source Repositoriesã€‚ é‚£æˆ‘å€‘å°±é–‹å§‹å›‰ï½","cloud-source-repositories-æ¸¬è©¦#Cloud Source Repositories æ¸¬è©¦":"å»ºç«‹ GitLab Project é¦–å…ˆï¼Œæˆ‘å€‘ç”¨ GitLab ä¾†ç•¶ç¤ºç¯„ï¼Œå¦‚ä½•é€éé¡åƒ (mirror) åˆ° Cloud Source Repositories ä¸Šé¢ï¼Œæˆ‘å€‘å…ˆåœ¨ GitLab ä¸Šå»ºç«‹ä¸€å€‹ Projectï¼š\nå»ºç«‹ GitLab Project\nä½¿ç”¨ gcloud æŒ‡ä»¤å»ºç«‹ Source Repo é¦–å…ˆï¼Œä¸€å®šè¦å…ˆè£ gcloud æŒ‡ä»¤åˆ°æœ¬æ©Ÿï¼Œé€™å€‹æ­¥é©Ÿï¼Œå‰é¢æ–‡ç« ä¹Ÿæœ‰èªªéï¼Œé€™é‚Šå°±ä¸åœ¨èªªæ˜ï¼Œæˆ‘å€‘å…ˆä½¿ç”¨ä¸€ä¸‹æŒ‡ä»¤ä¾†æŸ¥çœ‹ç›®å‰æ‰€åœ¨çš„ GCP å°ˆæ¡ˆï¼š gcloud config get-value project æ­£å¸¸ä¾†èªªï¼Œå¦‚æœæœ‰å…ˆç”¨ config è¨­å®šå¥½ï¼Œæœƒç›´æ¥è·³å‡ºä½ ç›®å‰çš„å°ˆæ¡ˆ IDï¼Œå¦‚æœæ²’æœ‰è·³å‡ºä¾†ï¼Œè«‹ä½¿ç”¨ä¸‹é¢æŒ‡ä»¤ä¾†è¨­å®šï¼š\ngcloud config set project \u003cproject id\u003e æ¥è‘—æˆ‘å€‘è¦å•Ÿå‹•è©²å°ˆæ¡ˆçš„ Cloud Source Repositories APIï¼š gcloud services enable sourcerepo.googleapis.com å‰µå»º Cloud Source Repositories gcloud source repos create \u003crepo name\u003e å®Œæˆå¾Œï¼Œé–‹å•Ÿ GCP æª¢æŸ¥ä¸€ä¸‹æ˜¯å¦æœ‰å»ºç«‹æˆåŠŸï½é»æ“Šå·¦å´ menu \u003e Source Repositoriesï¼Œ é–‹å•Ÿ Source Repositories\næˆåŠŸå»ºç«‹ Source Repositories\nå°‡ç¨‹å¼ç¢¼æ–°å¢è‡³å­˜æ”¾å€ä¸­ æˆ‘å€‘è¦åœ¨é€™ä¸€æ­¥ä¾†è¨­å®šé¡åƒ (mirror)ï¼Œé¦–å…ˆæˆ‘å€‘çœ‹å‰›å‰›ä¸Šé¢å»ºç«‹å¥½çš„ Source Repositoriesï¼Œå…¶ä¸­æœ‰ä¸€å€‹æ‰‹å‹•ç”¢ç”Ÿçš„æ†‘è­‰ï¼Œé»é¸ ç”¢ç”ŸåŠå„²å­˜ Git æ†‘è­‰ ç”¢ç”ŸåŠå„²å­˜ Git æ†‘è­‰\né»å®Œå¾Œæœƒéœ€è¦å…ˆç™»å…¥ä½ çš„ GCP å¸³è™Ÿï¼Œç™»å…¥å®Œå¾Œæœƒå‡ºç¾ä»¥ä¸‹å…§å®¹ï¼š Configure Git\næ¥è‘—æŠŠè—è‰²æ¡†æ¡†å…§çš„è¼¸å…¥åˆ°çµ‚ç«¯æ©Ÿå…§ Configure Git\næ¥è‘—è«‹è¤‡è£½ä»¥ä¸‹æŒ‡ä»¤è²¼åˆ°çµ‚ç«¯æ©Ÿå…§ï¼Œæœƒç”Ÿæˆæ†‘è­‰å¯†ç¢¼ï¼š grep 'source.developers.google.com' ~/.gitcookies | tail -1 | cut -d= -f2 ç”Ÿæˆæ†‘è­‰å¯†ç¢¼\næ¥è‘—è«‹è¤‡è£½ä»¥ä¸‹æŒ‡ä»¤è²¼åˆ°çµ‚ç«¯æ©Ÿå…§ï¼Œå°‡ç”¨æˆ¶åå­˜å„²åœ¨ CSR_USER ç’°å¢ƒè®Šé‡ä¸­ï¼š CSR_USER=$(grep 'source.developers.google.com' ~/.gitcookies | \\ tail -1 | cut -d$'\\t' -f7 | cut -d= -f1) ç”¨æˆ¶åå­˜å„²åœ¨ CSR_USER ç’°å¢ƒè®Šé‡ä¸­\næ¥è‘—è«‹è¤‡è£½ä»¥ä¸‹æŒ‡ä»¤è²¼åˆ°çµ‚ç«¯æ©Ÿå…§ï¼Œå°‡ GCP å­˜å„²åº«çš„ URL å­˜å„²åœ¨ CSR_REPO ç’°å¢ƒè®Šé‡ä¸­ (repo name è¦æ”¹æˆä½ åœ¨ gcp ä¸Šé¢çš„ repo)ï¼š CSR_REPO=$(gcloud source repos describe \u003crepo name\u003e --format=\"value(url)\") å°‡ GCP å­˜å„²åº«çš„ URL å­˜å„²åœ¨ CSR_REPO ç’°å¢ƒè®Šé‡ä¸­\næ¥è‘—è«‹è¤‡è£½ä»¥ä¸‹æŒ‡ä»¤è²¼åˆ°çµ‚ç«¯æ©Ÿå…§ï¼Œå°‡å­˜å„²åº«çš„ URLï¼ˆåŒ…æ‹¬ç”¨æˆ¶åï¼‰å°åˆ°çµ‚ç«¯æ©Ÿä¸Šï¼š echo $CSR_REPO | sed \"s/:\\/\\//:\\/\\/${CSR_USER}@/\" å­˜å„²åº«çš„ URLï¼ˆåŒ…æ‹¬ç”¨æˆ¶åï¼‰å°åˆ°çµ‚ç«¯æ©Ÿä¸Š\nç¶“éä¸Šé¢æ“ä½œï¼Œæˆ‘å€‘å¯ä»¥åœ¨ç¬¬ 4 æ­¥é©Ÿæ‹¿åˆ°å¯†ç¢¼ï¼Œä»¥åŠåœ¨ç¬¬ 7 æ­¥é©Ÿæ‹¿åˆ°å®Œæ•´çš„ GCP URLï¼Œæ¥è‘—æˆ‘å€‘è¦åˆ° GItLab Mirror ä¾†è¨­å®šé¡åƒã€‚\nåˆ° GitLab Mirror è¨­å®šé¡åƒ å…ˆå¾å³å´ muen \u003e é¸æ“‡ Settings \u003e é»é¸ Repositoryï¼Œæ‰¾åˆ° Mirroring repositories GitLab Mirror è¨­å®šé¡åƒ\nå°‡å‰›å‰›æ‹¿åˆ°çš„ URL ä»¥åŠå¯†ç¢¼å„åˆ¥è¼¸å…¥ Git repository URL ä»¥åŠ Passwordï¼Œè¨˜å¾—è¦é¸æ“‡ Mirror directionï¼Œå› ç‚ºæˆ‘å€‘æ˜¯è¦å°‡ gitlab çš„é¡åƒåˆ° GCP çš„ Cloud Source Repositoriesï¼Œæ‰€ä»¥æˆ‘å€‘è¦é¸æ“‡ PUSHï¼Œæœ€å¾ŒæŒ‰ä¸‹ Mirror repositoryï¼š GitLab Mirror è¨­å®šé¡åƒ\nå¦‚æœæ²’æœ‰è·³å‡ºéŒ¯èª¤ï¼ŒåŸºæœ¬ä¸Šæ˜¯æ²’æœ‰å•é¡Œäº†ï¼\nGitLab Mirror æª¢æŸ¥\nå°±å¯ä»¥è©¦è‘—åœ¨ gitlab ä¸Šé¢æ¨ç¨‹å¼ï¼Œçœ‹çœ‹æœ‰æ²’æœ‰è·‘åˆ° Cloud Source Repositories ä¸Šé¢å›‰ï¼ GitLab æ¨ç¨‹å¼æ¸¬è©¦","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"Cloud Source Repositories documentation\nMirroring GitLab repositories to Cloud Source Repositories"},"title":"Google Cloud Platform (GCP) - Cloud Source Repositories"},"/blog/gcp/compute-engine/":{"data":{"":"è·Ÿå¤§å®¶ä»‹ç´¹ä¸€ä¸‹ä»Šå¤©çš„ä¸»é¡Œ Google Compute Engine(GCE)ï¼ŒGCE æ˜¯ Google Cloud ä¸Šçš„åŸºç¤æ¶æ§‹æœå‹™ (IaaS)ï¼Œè©²å¹³å°å¯ä»¥æä¾›å¤§è¦æ¨¡çš„è™›æ“¬æ©Ÿå™¨ä»¥åŠç›¸é—œçš„åŸºç¤å»ºè¨­ (åŒ…å«ç¡¬ç¢Ÿã€ç¶²è·¯ã€é™„è¼‰å¹³è¡¡å™¨â€¦ ç­‰ç­‰)ä¾†å»ºç½®åŠé‹ä½œæ‚¨çš„æœå‹™ï¼Œé‚£æˆ‘å€‘å¯ä»¥å°‡ GCE æœå‹™çš„ä¸»è¦åŠŸèƒ½åŠƒåˆ†æˆä»¥ä¸‹å¹¾é»ï¼š","google-compute-engine-æ¸¬è©¦#Google Compute Engine æ¸¬è©¦":"é¦–å…ˆæˆ‘å€‘ä½¿ç”¨ cloudskillsboost æä¾›çš„ Creating a Virtual Machine ä¾†åšç·´ç¿’ï¼Œæ‰“é–‹å¾Œï¼Œè«‹å…ˆç™»å…¥è‡ªå·±çš„ Google å¸³è™Ÿï¼Œæ¥è‘—é»é¸å·¦ä¸Šè§’çš„ Start Labï¼Œæœƒè·³å‡ºèˆ‡ä¸‹é¢åœ–ç‰‡é¡ä¼¼çš„å…§å®¹ï¼š\næ¸¬è©¦ç”¨çš„å¸³è™Ÿå¯†ç¢¼\næ–°å¢æ–°çš„ VM å¯¦ä¾‹ é»é¸ Open Google Console æŒ‰éˆ•ä¾†é–‹å•Ÿ GCP ä¸»æ§å° ç™»å…¥å¸³è™Ÿå°±ä½¿ç”¨ä¸Šé¢åœ–ç‰‡æ‰€æä¾›çš„å¸³è™Ÿå¯†ç¢¼ä¾†é€²è¡Œç™»å…¥ ç™»å…¥æˆåŠŸæœƒé€²å…¥ GCP ä¸»æ§å°ï¼Œé»é¸å·¦å´çš„ menu \u003e Compute Engine \u003e VM Instancesï¼Œå¯ä»¥åƒè€ƒä¸‹æ–¹åœ–ç‰‡ æ–°å¢ VM å¯¦ä¾‹\né»é¸ CREATE INSTANCEï¼Œè«‹ä¾ç…§ä¸‹æ–¹è¡¨æ ¼ä¾†é€²è¡Œè¨­å®šï¼š æ¨™é¡Œ è¨­å®šå€¼ èªªæ˜ Name gcelab è™›æ“¬æ©Ÿå¯¦ä¾‹çš„åç¨± Region us-central1ï¼ˆæ„›è·è¯å·ï¼‰ æœ‰é—œå€åŸŸçš„æ›´å¤šä¿¡æ¯ï¼Œè«‹åƒé–± Compute Engine æŒ‡å— Regions and zones Zone us-central1-f Series N1 Machine type n1-standard-2 é€™æ˜¯ä¸€å€‹ 2 vCPUã€7.5 GB RAM å¯¦ä¾‹ Boot disk New balanced persistent disk/10 GB/Debian GNU/Linux 10 Firewall Allow HTTP taffic VM å¯¦ä¾‹ (Nameã€Regionã€Zoneã€Series)\nVM å¯¦ä¾‹ (Machine typeã€Boot diskã€Firewall)\næ–°å¢å®Œå¾Œï¼Œå¤§ç´„éœ€è¦ç­‰å¾…ä¸€åˆ†é˜ï¼Œæ–°çš„è™›æ“¬æ©Ÿå°±æœƒåˆ—åœ¨ VM Instances é é¢ä¸Šã€‚ VM å¯¦ä¾‹\nå®‰è£ NGINX Web æœå‹™å™¨ é»æ“Š VM instances å¯¦ä¾‹æœ€å¾Œçš„ SSHï¼Œæœƒé–‹å•Ÿ SSH ç”¨æˆ¶ç«¯ åœ¨ SSH çµ‚ç«¯ï¼Œè¦å…ˆç²å¾— root è¨ªå•æ¬Šé™ï¼Œæ‰æ›´æ–¹ä¾¿çš„é€²è¡Œå¾ŒçºŒçš„å‹•ä½œï¼Œè«‹å…ˆä½¿ç”¨ä¸€ä¸‹æŒ‡ä»¤ï¼š sudo su - åˆ©ç”¨ root ç”¨æˆ¶ï¼Œä¾†æ›´æ–°æ“ä½œç³»çµ±ï¼š apt-get update æ›´æ–°æ“ä½œç³»çµ±\nå®‰è£ NGINXï¼š apt-get nginx -y å®‰è£ NGINX\næœ€å¾Œç¢ºèª NGINX æ˜¯å¦é‹è¡Œï¼š ps auwx | grep nginx ç¢ºèª NGINX æ˜¯å¦é‹è¡Œ\nå¯ä»¥æ‰“é–‹ç€è¦½å™¨ç€è¦½ http://å¤–éƒ¨ IP/ æˆ–æ˜¯ä½¿ç”¨ curl å¤–éƒ¨IPï¼Œå¤–éƒ¨ IP æœƒåœ¨è·Ÿå‰›å‰› VM å¯¦ä¾‹çš„ External IP æ¬„ä½å‘¦ï½ curl å¤–éƒ¨ IP\nå®Œæˆå¾Œï¼Œè¨˜å¾—å¯ä»¥é»é¸ Check my progress ä¾†æª¢æŸ¥é€²åº¦å§ï¼ Check my progress\nä½¿ç”¨ gcloud å‰µå»ºä¸€å€‹æ–°å¯¦ä¾‹ æˆ‘å€‘å‰›å‰›æ˜¯ä½¿ç”¨ç¶²é ç‰ˆä¾†æ–°å¢ï¼Œç•¶ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ gcloud æŒ‡ä»¤ä¾†æ–°å¢ï¼Œé€™å€‹å·¥å…·æœ‰é å…ˆè£åœ¨ Google Cloud Shell ä¸­ã€‚Cloud Shell æ˜¯ä¸€å€‹åŸºæ–¼ Debian çš„è™›æ“¬æ©Ÿï¼ŒåŒ…å«äº†å¸¸ç”¨çš„é–‹ç™¼å·¥å…· (gcloudã€git ç­‰å·¥å…·)ï¼Œå¦å¤–ä½ ä¹Ÿå¯ä»¥å°‡ gcloud ä¸‹è¼‰è‡³æœ¬æ©Ÿä¸Šä¾†åšä½¿ç”¨ï¼Œè«‹é–±è®€ gcloud å‘½ä»¤è¡Œå·¥å…·æŒ‡å—\nåœ¨ Cloud Shell ä¸­ï¼Œä½¿ç”¨ gcloud ä¾†æ–°å¢æ–°çš„è™›æ“¬æ©Ÿå¯¦ä¾‹ï¼š gcloud compute instances create gcelab2 --machine-type n1-standard-2 --zone us-central1-f å°±æœƒè·³å‡ºä»¥ä¸‹åœ–ç‰‡çš„å…§å®¹ï¼Œéä¸€é™£å­å»æŸ¥çœ‹ VM Instances ä¹Ÿå¯ä»¥çœ‹åˆ°æˆ‘å€‘æ‰€æ–°å¢çš„è™›æ“¬æ©Ÿå¯¦ä¾‹æ­ï½\nCheck my progress\nåˆ°é€™é‚Šå°±å®Œæˆäº†æˆ‘å€‘ Google Compute Engine æ¸¬è©¦å›‰ï½æˆ‘å€‘çŸ¥é“å¯ä»¥æ–°å¢ GCE å°‡å¯¦é«”ä¸»æ©Ÿçš„å…§å®¹ï¼Œç§»æ¤åˆ°é›²ç«¯ä¸Šå›‰ï¼å¸Œæœ›å¤§å®¶æœƒå–œæ­¡ä»Šå¤©çš„æ–‡ç«  ğŸ¥°","google-compute-engine-ç‰¹è‰²#Google Compute Engine ç‰¹è‰²":"ç©©å¥çš„ç¶²è·¯åŠŸèƒ½ æä¾›ä½¿ç”¨è€…æ“æœ‰ç©©å¥çš„ç¶²è·¯åŠŸèƒ½ï¼Œä»¥é‹è¡Œå„é …æ‡‰ç”¨ç¨‹å¼åŠæœå‹™ã€‚\nè‡ªè¨‚ç¶²è·¯èˆ‡é è¨­ç¶²è·¯ GCE åŒ…å«å…§éƒ¨èˆ‡å¤–éƒ¨çš„ç¶²è·¯é€£ç·šèƒ½åŠ›ï¼Œè®“ä½¿ç”¨è€…å¯ä»¥é€éè‡ªè¨‚è¦åŠƒä¾†å»ºç½®å±¬æ–¼è‡ªå·±æœå‹™é©ç”¨çš„ç¶²è·¯ï¼Œè€Œåœ¨ GCE æœå‹™é–‹é€šç•¶ä¸‹ï¼Œä¹Ÿæä¾›é è¨­çš„ default networkï¼Œå…§å»ºå¸¸ç”¨çš„è·¯ç”±èˆ‡é˜²ç«ç‰†è¨­å®š (ä¾‹å¦‚ï¼šSSHã€RDPã€ICMPâ€¦ ç­‰)ï¼Œä¾›å…¥é–€ä½¿ç”¨è€…ç›´æ¥ä½¿ç”¨ã€‚\né˜²ç«ç‰†è¦å‰‡ é™¤äº†é è¨­é˜²ç«ç‰†è¦å‰‡å¤–ï¼Œä½¿ç”¨è€…ä¹Ÿå¯ä»¥é€éè‡ªå»ºé˜²ç«ç‰†ä¾†é–‹æ”¾å¯ä»¥é€£å…¥çš„ IPã€‚\nå„å€åŸŸçš„ HTTP(S) çš„è² è¼‰å¹³è¡¡ ç‚º Layer 7 çš„è² è¼‰å¹³è¡¡è¨­å‚™ï¼Œé€éè¨­å®šå¯ä»¥ä¸²é€£å¤šå°ä¸»æ©Ÿæˆ–æ˜¯ä¸»æ©Ÿç¾¤çµ„ï¼Œè®“æœå‹™ä¸å†åªæ˜¯ä¾è³´æ–¼å–®é»å­˜åœ¨çš„ä¼ºæœå™¨ã€‚Layer 7 çš„è² è¼‰å¹³è¡¡æ›´å¯ä»¥è­˜åˆ¥è·¯ç”±è¦åŠƒï¼Œé€²ä¸€æ­¥å¯ä»¥æä¾›ä¸åŒè·¯ç”±çš„é‡å°è¦å‰‡è¨­å®šï¼Œä¹Ÿå¯ä»¥æä¾› CDN çš„ Cache åŠŸèƒ½ã€‚\nç¶²è·¯çš„è² è¼‰å¹³è¡¡ ç‚º Layer4 çš„è² è¼‰å¹³è¡¡è¨­å‚™ï¼Œå¯ä»¥é€é Protocol èˆ‡ Port çš„æ–¹å¼ä¾†é‡å°å¤–éƒ¨æµé‡åˆ° GCE ä¸»æ©Ÿæˆ–ä¸»æ©Ÿç¾¤ï¼Œä¸¦å¯ä»¥é€é Health Check çš„æ–¹å¼ï¼Œè®“æµé‡åƒ…é€šéå¥åº·çš„ä¸»æ©Ÿï¼Œé¿å…æœå‹™ä¸­æ–·ã€‚\nå­ç¶²è·¯ é€é CIDR çš„æ–¹å¼è¨­å®š GCE Network ä¸­çš„å„å­ç¶²è·¯ç¯„åœï¼Œä¸¦å¯ä»¥é€éè·¯ç”±çš„æ–¹å¼ä¸²æ¥å„å­ç¶²è·¯ä¸­é–“çš„é€šè¨Šï¼Œè®“ GCE ç¶²è·¯çš„è¨­è¨ˆè¦åŠƒå¯ä»¥æ›´æœ‰å½ˆæ€§ï¼Œä¹Ÿå¯ä»¥è®“å­ç¶²è·¯çš„è¦åŠƒä¾†å¯¦ä½œæ›´å®‰å…¨çš„é›²ç«¯ç¶²è·¯æ¶æ§‹ã€‚","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"Compute Engine åŸºæœ¬ä»‹ç´¹ï¼šhttps://gdgcloud-taipei.gitbook.io/google-cloud-platform-in-practice/google-cloud-shang-de-yun-suan-fu-wu/compute-engine/compute-engine-ji-ben-jie-shao\nCreating a Virtual Machineï¼šhttps://www.cloudskillsboost.google/focuses/3563?locale=zh_TW\u0026parent=catalog"},"title":"Google Cloud Platform (GCP) - Compute Engine"},"/blog/gcp/container-registry/":{"data":{"":"è·Ÿå¤§å®¶ä»‹ç´¹ä¸€ä¸‹ä»Šå¤©çš„ä¸»é¡Œ Container Registryï¼ŒContainer Registry æ˜¯å„²å­˜ã€ç®¡ç†å’Œä¿è­· Docker å®¹å™¨æ˜ åƒæª”çš„å­˜æ”¾å€ï¼Œå¯ä»¥è®“åœ˜éšŠé€éåŒä¸€é …æœå‹™æœå‹™é›†ä¸­ç®¡ç† Docker æ˜ åƒæª”ã€ä¹Ÿå¯ä»¥åŸ·è¡Œå®‰å…¨æ¼æ´åˆ†æï¼Œé‚„èƒ½é€éç²¾å¯†çš„å­˜å–æ¬Šç®¡ç†æ©Ÿåˆ¶ï¼Œä¾†æ±ºå®šèª°å¯ä»¥å­˜å–å“ªäº›å…§å®¹ã€‚ç°¡å–®ä¾†èªªä»–å°±æ˜¯ä¸€å€‹è®“æˆ‘å€‘å­˜æ”¾ Docker æ˜ åƒæª”çš„åœ°æ–¹ï¼Œä»–æœ‰ä»¥ä¸‹å¹¾å€‹ç‰¹é»ï¼š","container-registry-ç‰¹é»#Container Registry ç‰¹é»":" å®‰å…¨çš„ç§äºº Docker è¨»å†Šè³‡æ–™åº«ï¼šåªéœ€è¦å¹¾åˆ†é˜çš„æ™‚é–“ï¼Œå³å¯é–‹å§‹åœ¨ Google Cloud Platform ä¸­ä½¿ç”¨å®‰å…¨çš„ç§äºº Docker æ˜ åƒæª”å„²å­˜ç©ºé–“ï¼Œæ§ç®¡èƒ½å¤ å­˜å–ã€æª¢è¦–æˆ–ä¸‹è¼‰æ˜ åƒæª”çš„äººå“¡ï¼Œä¸¦åœ¨å—åˆ° Google å®‰å…¨é˜²è­·æ©Ÿåˆ¶ä¿è­·çš„åŸºç¤æ¶æ§‹ä¸Šç©©å®šåŸ·è¡Œã€‚ è‡ªå‹•å»ºç«‹åŠéƒ¨ç½²æ˜ åƒæª”ï¼šåœ¨æ‚¨ä¿®è¨‚ Cloud Source Repositories ä¸­çš„ç¨‹å¼ç¢¼æ™‚ï¼Œç³»çµ±æœƒè‡ªå‹•å»ºç«‹æ˜ åƒæª”ä¸¦æ¨é€è‡³ç§äººè¨»å†Šè³‡æ–™åº«ã€‚æ‚¨å¯ä»¥è¼•é¬†è¨­å®šæŒçºŒæ•´åˆ/æŒçºŒæ¨é€è»Ÿé«”æ›´æ–°ç®¡é“ï¼Œä¸¦æ•´åˆè‡³ Cloud Buildï¼Œæˆ–æ˜¯ç›´æ¥å°‡ç®¡é“éƒ¨ç½²è‡³ Google Kubernetes Engineã€App Engineã€Cloud Functions æˆ– Firebaseã€‚(é€™å€‹å°±æ˜¯æˆ‘å€‘åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« æœƒä½¿ç”¨åˆ°çš„åŠŸèƒ½) æ·±åº¦å®‰å…¨æ¼æ´æƒæï¼šåœ¨è»Ÿé«”éƒ¨ç½²é€±æœŸçš„æ—©æœŸéšæ®µæ‰¾å‡ºå®‰å…¨æ¼æ´ï¼Œè—‰æ­¤ç¢ºä¿æ‚¨å¯ä»¥å®‰å…¨åœ°éƒ¨ç½²å®¹å™¨æ˜ åƒæª”ã€‚è³‡æ–™åº«æœƒæŒçºŒé‡æ–°æ•´ç†ï¼Œè®“æ‚¨çš„å®‰å…¨æ¼æ´æƒæä½œæ¥­å–å¾—æœ€æ–°å‹æƒ¡æ„è»Ÿé«”çš„ç›¸é—œè³‡è¨Šã€‚ é–å®šæœ‰é¢¨éšªçš„æ˜ åƒæª”ï¼šé‹ç”¨äºŒé€²ä½æˆæ¬Šçš„åŸç”Ÿæ•´åˆåŠŸèƒ½ä¾†å®šç¾©æ”¿ç­–ï¼Œé¿å…éƒ¨ç½²èˆ‡æ‰€è¨­å®šæ”¿ç­–ç›¸è¡çªçš„æ˜ åƒæª”ã€‚æ‚¨å¯ä»¥è§¸ç™¼å®¹å™¨æ˜ åƒæª”çš„è‡ªå‹•é–å®šåŠŸèƒ½ï¼Œç¦æ­¢å°‡æœ‰é¢¨éšªçš„æ˜ åƒæª”éƒ¨ç½²è‡³ Google Kubernetes Engineã€‚ åŸç”Ÿæ”¯æ´ Dockerï¼šæ‚¨ä¸åƒ…å¯ä»¥è¦–éœ€æ±‚å®šç¾©å¤šå€‹è¨»å†Šè³‡æ–™åº«ï¼Œä¹Ÿèƒ½ä½¿ç”¨æ¨™æº–çš„ Docker æŒ‡ä»¤åˆ—ä»‹é¢ï¼Œå°‡ Docker æ˜ åƒæª”æ¨é€å’Œæå–åˆ°æ‚¨çš„ç§äºº Container Registryã€‚Docker æä¾›ä¾æ“šåç¨±å’Œæ¨™è¨˜æœå°‹æ˜ åƒæª”çš„åŠŸèƒ½ï¼Œè®“æ‚¨å¯ä»¥é †æš¢ä½¿ç”¨ã€‚ å¿«é€Ÿçš„é«˜å¯ç”¨æ€§å­˜å–èƒ½åŠ›ï¼šæ‚¨å¯ä½¿ç”¨æˆ‘å€‘éå¸ƒå…¨çƒçš„å€åŸŸæ€§ç§äººå­˜æ”¾å€ï¼Œæ–¼å…¨ä¸–ç•Œçš†èƒ½äº«æœ‰æœ€å¿«é€Ÿçš„å›æ‡‰æ™‚é–“ã€‚æ‚¨å¯ä»¥å°±è¿‘å°‡æ˜ åƒæª”å„²å­˜åœ¨ä½æ–¼æ­æ´²ã€äºæ´²æˆ–ç¾åœ‹çš„é‹ç®—åŸ·è¡Œå€‹é«”ä¸­ï¼Œä¸¦é€é Google çš„é«˜æ•ˆèƒ½å…¨çƒç¶²è·¯å¿«é€Ÿå®Œæˆéƒ¨ç½²ä½œæ¥­ã€‚ ä¸Šé¢æœ‰æåˆ° Container Registry å…¶ä¸­ä¸€å€‹ç‰¹é»å°±æ˜¯æƒææ˜ åƒæª”ï¼Œæœƒæª¢æŸ¥æœ‰æ²’æœ‰å¥‡æ€ªçš„å…§å®¹æˆ–æ˜¯éŒ¯èª¤ï¼Œè®“æˆ‘å€‘åœ¨éƒ¨ç½²å‰å¯ä»¥å…ˆåšæª¢æŸ¥ï¼Œåº•ä¸‹æ˜¯æ•´å€‹çš„æµç¨‹åœ–ï¼š\nContainer Registry æƒææµç¨‹åœ–\næˆ‘å€‘å¯ä»¥å»¶çºŒä¸Šä¸€ç¯‡æ–‡ç«  Cloud Source Repositories ä¾†èªªæ˜ä¸Šé¢åœ–ç‰‡ï¼Œä¸€é–‹å§‹å…ˆ commit åˆ° GCP ä¸Šï¼Œä¹Ÿå¯ä»¥æŠŠå®ƒç•¶æˆ Cloud Source Repositoriesï¼Œå°±è‘—é€éæœƒé€éä¸‹ä¸€ç¯‡è¦è¬›çš„ Cloud Build ä¾†å»ºç½®ï¼Œä¸¦ä¸”æƒæï¼Œå¦‚æœæ²’æœ‰å•é¡Œå°±æœƒ Pubish åˆ° Container Registry å­˜æ”¾å›‰ï½\næˆ‘å€‘å°±ç°¡å–®èªªæ˜è¦æ€éº¼æŸ¥çœ‹æˆ‘å€‘çš„ Container Registryï¼Œé»é¸å‰‡å·¦å´çš„ menu \u003e é¸æ“‡ Container Registry \u003e é»æ“Š æ˜ åƒæª”ï¼š\nContainer Registry\nä¸€é–‹å§‹å¯èƒ½æ²’æœ‰ä»»ä½•çš„è³‡æ–™å¤¾ï¼Œä¹‹å¾Œç•¶æˆ‘å€‘ Build æ™‚ï¼Œå¯ä»¥æ–°å¢ç‰¹å®šçš„è³‡æ–™å¤¾ä¾†æ”¾æˆ‘å€‘çš„æ˜ åƒæª”ï¼Œå¯ä»¥åƒè€ƒä¸‹æ–¹åœ–ç‰‡ï¼š\nContainer Registry è³‡æ–™å¤¾\né€²å…¥è©²è³‡æ–™å¤¾å¾Œï¼Œå°±å¯ä»¥çœ‹åˆ°è£¡é¢çš„æ˜ åƒæª”æ¡ˆï¼š\nContainer Registry æ˜ åƒæª”"},"title":"Google Cloud Platform (GCP) - Container Registry"},"/blog/gcp/gcp-log-reduce-cloud-logging-api/":{"data":{"":"ç•¶æˆ‘å€‘ä½¿ç”¨ GCP çš„ Cloud Logging æœå‹™ä¾†æŸ¥çœ‹ Log æ™‚ï¼Œæœ‰æ™‚å€™æœƒæœ‰ä¸€äº›æˆ‘å€‘ä¸éœ€è¦é¡¯ç¤ºå‡ºä¾†çš„ï¼Œæˆ–æ˜¯å¾ä¾†éƒ½ä¸æœƒå»æŸ¥è©¢çš„ Logï¼Œå†è€…æ˜¯ GCP æœ¬èº«çš„éŒ¯èª¤å°è‡´å¤§é‡å™´éŒ¯çš„ Log ï¼Œé€™äº› Log éƒ½æœƒå°è‡´ Cloud Logging çš„è²»ç”¨å¢åŠ ã€‚","ä»‹ç´¹-cloud-logging#ä»‹ç´¹ Cloud Logging":"å…ˆä¾†ç°¡å–®èªªä¸€ä¸‹ Cloud Logging é€™é …æœå‹™çš„åŸºæœ¬æ¶æ§‹ï¼Œè«‹çœ‹åœ–ï¼š\nCloud Logging åŸºæœ¬æ¶æ§‹\nå¯ä»¥çœ‹åˆ° Logs Data æœƒé€é API å†ç¶“é _Default log sink (router) å­˜åˆ°ç›¸æ‡‰å‘½åçš„ log bucket (é è¨­é…ç½®)ï¼Œåœ–ä¸­ _Required ä»¥åŠ _Default çš„ log sink éƒ½æ˜¯ GCP è‡ªå‹•å‰µå»ºçš„æ¥æ”¶å™¨ï¼Œä¸‹é¢ç°¡è¿°ä¸€ä¸‹å®ƒå€‘çš„å€åˆ¥ï¼š\n_Required æ—¥èªŒå„²å­˜æ¡¶ Cloud Logging æœƒå°‡ä»¥ä¸‹é¡å‹çš„ Log å­˜åˆ° _Required å„²å­˜æ¡¶\nç®¡ç†å“¡æ´»å‹•å¯©æ ¸ Log\nç³»çµ±äº‹ä»¶å¯©æ ¸ Log\nAccess Transparency Log\nCloud Logging æœƒå°‡ _Required å„²å­˜æ¡¶ Log ä¿ç•™ 400 å¤©ï¼Œç„¡æ³•èª¿æ•´è©²æœŸé™ï¼Œä¸”ç„¡æ³•ä¿®æ”¹æˆ–åˆªé™¤ _Required å„²å­˜æ¡¶ï¼Œä¹Ÿæ²’è¾¦æ³•åœç”¨ _Required log sink æ¥å—å™¨è·¯ç”±åˆ° _Required å„²å­˜æ¡¶çš„è¨­å®šã€‚\n_Default æ—¥èªŒå„²å­˜æ¡¶ åªè¦ä¸æ˜¯å­˜åœ¨ _Required æ—¥èªŒå„²å­˜æ¡¶çš„ Log å°±æœƒé€é _Default log sink æ¥å—å™¨è·¯ç”±åˆ° _Default å„²å­˜æ¡¶ã€‚\né™¤éæœ‰å¦å¤–é…ç½®è‡ªå®šç¾©è¨­å®šï¼Œ å¦å‰‡ _Default æ—¥èªŒå„²å­˜æ¡¶ Log åªæœƒä¿ç•™ 30 å¤©ï¼Œä¹Ÿä¸€æ¨£ç„¡æ³•åˆªé™¤ _Default æ—¥èªŒå„²å­˜æ¡¶ã€‚æ­¤å¤– Cloud Logging çš„è²»ç”¨æ˜¯ä»¥å­˜åœ¨ _Default æ—¥èªŒå„²å­˜æ¡¶ä¾†è¨ˆç®—ã€‚\nåŠŸèƒ½ åƒ¹æ ¼ æ¯æœˆå…è²»é¡åº¦ Logging æå– æå–çš„ Log $0.5/GiB æ¯å€‹é …ç›®å‰ 50 GiB Logging å„²å­˜ ä¿ç•™è¶…é 30 å¤©çš„ Logï¼Œæ¯æœˆæ¯ GiB $0.01 åœ¨é»˜èªä¿ç•™æœŸé™çš„ Log ä¸æœƒæœ‰é¡å¤–å„²å­˜è²»ç”¨ æŸ¥çœ‹è©²å°ˆæ¡ˆä½¿ç”¨çš„ Cloud Logging API è²»ç”¨ï¼šhttps://console.cloud.google.com/apis/api/logging.googleapis.com/cost","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"Routing and storage overview https://cloud.google.com/logging/docs/routing/overview","éæ¿¾-log#éæ¿¾ Log":"é‚£ç¾åœ¨çŸ¥é“ Cloud Logging çš„æ¶æ§‹ï¼Œé‚£ç•¶æˆ‘å€‘é‡åˆ°éœ€è¦éæ¿¾ Log æ™‚ï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ­¥é©Ÿä¾†éæ¿¾ä»¥ç¯€çœ Cloud Logging API è²»ç”¨ï¼š\nç¯„ä¾‹èªªæ˜ é€™æ¬¡ç¯„ä¾‹æ˜¯ google åœ¨ 2023/07/06 æ‰€ç™¼ä½ˆçš„ Service Healthï¼Œç•¶ GKE ç‰ˆæœ¬å¤§æ–¼ 1.24 ä»¥ä¸Šï¼Œå°±æœƒå™´\nFailed to get record: decoder: failed to decode payload: EOF\ncannot parse â€˜0609 05:31:59.491654â€™ after %L\ninvalid time format %m%d %H:%M:%S.%L%z for â€˜0609 05:31:59.490647â€™\né€™ä¸‰ç¨®é¡å‹çš„éŒ¯èª¤ Logï¼Œåœ¨ç­‰å¾…å®˜æ–¹ä¿®å¾©å‰ï¼Œå®˜æ–¹çš„å»ºè­°æ˜¯å…ˆå°‡ä»–çµ¦éæ¿¾æ‰ï¼Œé¿å…ä¸€ç›´åˆ·å™´éŒ¢ â”(Â´Ğ´`)â”Œ\né™„ä¸Šç•¶æ™‚çš„ Service Health é€£çµï¼šhttps://status.cloud.google.com/incidents/y5XvpyBXFhsphSt4DfiE\næˆ‘å€‘åœ¨ä¸Šé¢æ¶æ§‹åœ–æœ‰èªªåˆ°ï¼ŒLog æœƒé€é log sink è·¯ç”±åˆ° bucketï¼Œæ‰€ä»¥æˆ‘å€‘è¦å°‡éæ¿¾æ¢ä»¶åŠ åœ¨ log router ä¸Šï¼š\né¸æ“‡ Log Router é¸æ“‡ Log Router\né¸æ“‡ Log Router Sinks é¸æ“‡ _Default çš„ Log Router Sinksï¼Œé»é¸å³é‚ŠæŒ‰éˆ•çš„ Edit Sink\né¸æ“‡ _Default çš„ Log Router Sinks\nè¨­å®š Sink details ç¬¬ä¸€å€‹æ˜¯ detailsï¼Œå¯ä»¥è¼¸å…¥èªªæ˜ï¼Œé€™é‚Šè¼¸å…¥ï¼šgoogle æœ‰ bug æœƒå™´å¤§é‡çš„æ„å¤– LOGï¼Œæ€•è²»ç”¨é£†é«˜ï¼Œå…ˆç”¨å®˜æ–¹å»ºè­°çš„ä¾†éæ¿¾ LOGï¼Œè©³ç´°å¯ä»¥çœ‹ï¼š https://status.cloud.google.com/incidents/y5XvpyBXFhsphSt4DfiE\nè¼¸å…¥ Sink details èªªæ˜\né¸æ“‡ Sink Service è·Ÿ Bucket æ¥è‘— sink æœå‹™é¸æ“‡ Logging bucketï¼Œä»¥åŠå°æ‡‰å„²å­˜çš„ log bucket (é€™é‚ŠåŸºæœ¬ä¸Šéƒ½æ˜¯é è¨­)\né¸æ“‡ Logging bucket\nè¨­å®š include Log é¸æ“‡é‚£äº›å¯ä»¥è¢« include åˆ° sink æ¥æ”¶å™¨çš„ LOG æ ¼å¼ (é€™é‚ŠåŸºæœ¬ä¸Šéƒ½æ˜¯é è¨­)\né è¨­çš„ LOG æ ¼å¼\nè¨­å®š filter Log é€™é‚Šå°±æ˜¯æˆ‘å€‘è¦è¼¸å…¥éæ¿¾çš„åœ°æ–¹ï¼Œå…ˆé»æ“Š ADD EXCLUSIONï¼Œè¼¸å…¥éæ¿¾çš„åç¨±ï¼Œä»¥åŠéæ¿¾çš„å…§å®¹æ ¼å¼ï¼Œæˆ‘å€‘è¼¸å…¥ google åœ¨ Service Health æ‰€æä¾›çš„æ ¼å¼ï¼Œæœ€å¾ŒæŒ‰ä¸‹ UPDATE SINK\næ–°å¢è¦éæ¿¾çš„ LOG æ ¼å¼\nè¨­å®šå®Œæˆ ç­‰å¾…æ›´æ–°å®Œæˆï¼Œå°±å¯ä»¥çœ‹åˆ°æˆ‘å€‘å·²ç¶“åœ¨æ¥æ”¶å™¨ä¸Šè¨­å®šå¥½éæ¿¾æ¢ä»¶å›‰ï½\næŸ¥çœ‹è©³ç´°æ¥æ”¶å™¨è¨­å®š\næª¢æŸ¥ Log æ˜¯å¦éæ¿¾æˆåŠŸ æœ€å¾Œå†æª¢æŸ¥ä¸€ä¸‹ Log æ˜¯ä¸æ˜¯æ²’æœ‰æ”¶åˆ°è©²éŒ¯èª¤çš„ Log å…§å®¹\næª¢æŸ¥ LOG æ˜¯å¦ä¸æœƒå†å‡ºç¾"},"title":"å¦‚ä½•éæ¿¾ GCP LOGï¼Œæ¸›å°‘ Cloud Logging API çš„èŠ±è²»"},"/blog/gcp/gke-cronjob-not-working/":{"data":{"":"å‰é™£å­å…¬å¸å»ºç«‹åœ¨ Google Kubernetes Engine å¢é›†ä¸Šçš„ CronJob æœå‹™æœƒæœ‰çŸ­æš«æ™‚é–“æ²’æœ‰åŸ·è¡Œ Jobã€‚å…ˆå‰æƒ…æè¦ä¸€ä¸‹ï¼Œæ­¤ CronJob çš„è¨­å®šæ˜¯æ¯åˆ†é˜éƒ½æœƒåŸ·è¡Œ (åœ–ä¸€)ï¼Œæ‰€ä»¥ç†ç•¶ä¾†èªª Log æ‡‰è©²è¦å¯ä»¥çœ‹åˆ°æ¯åˆ†é˜éƒ½æœ‰æ­¤ CronJob çš„ç´€éŒ„ï¼Œä½†æœ‰æ™‚å€™æœƒç™¼ç”Ÿ CronJob çŸ­æš«æ™‚é–“éƒ½æ²’æœ‰åŸ·è¡Œçš„ç‹€æ³ï¼Œæ‰¾äº†ä¸€é™£å­éƒ½æ²’æœ‰æ‰¾åˆ°åŸå› ï¼Œæœ€å¾Œé–‹æ”¯æ´å–®è«‹ Google é‚£é‚Šå”åŠ©æŸ¥çœ‹ï¼Œçµ‚æ–¼æ‰¾åˆ°åŸå› æ‹‰ ğŸ˜ã€‚é‚£å°±è·Ÿæˆ‘ä¸€èµ·çœ‹ä¸€ä¸‹ç™¼ç”Ÿçš„éç¨‹ï¼Œä»¥åŠ Google å¹«æˆ‘å€‘æ‰¾åˆ°çš„åŸå› ï¼Œä»¥åŠè¦å¦‚ä½•è§£æ±ºç­‰ç­‰ï½\n(åœ–ä¸€) CronJob schedule æ™‚é–“ç‚ºæ¯åˆ†é˜åŸ·è¡Œ","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"[1] Standard cluster upgradesï¼šhttps://cloud.google.com/kubernetes-engine/docs/concepts/cluster-upgrades\n[2] maintenance-windows-and-exclusionsï¼šhttps://cloud.google.com/kubernetes-engine/docs/concepts/maintenance-windows-and-exclusions","å•é¡Œç™¼ç”Ÿä»¥åŠå•é¡ŒåŸå› #å•é¡Œç™¼ç”Ÿä»¥åŠå•é¡ŒåŸå› ":"æˆ‘å€‘ä½¿ç”¨ Google Cloud Platform è£¡é¢çš„è¨˜éŒ„åŠŸèƒ½ï¼Œå¯ä»¥çœ‹åˆ° (åœ–äºŒ)ï¼Œåœ¨æ¯åˆ†é˜åŸ·è¡Œçš„ Log ä¸­ï¼Œæœ‰çŸ­æš«æ™‚é–“æ²’æœ‰åŸ·è¡Œ Jobï¼Œä½†é€™å€‹æ™‚é–“é™¤äº† CronJob ä»¥å¤–ï¼Œå…¶ä»–çš„æœå‹™éƒ½æ˜¯å¥½çš„ã€‚\n(åœ–äºŒ) Google Cloud Platform è¨˜éŒ„æœ‰çŸ­æš«æ²’æœ‰åŸ·è¡Œ\næ‰¾äº†ä¸€é™£å­éƒ½æ²’æœ‰æ‰¾åˆ°åŸå› ï¼Œæ–¼æ˜¯æˆ‘å€‘é–‹æ”¯æ´å–®è«‹ Google é‚£é‚Šå”åŠ©æŸ¥çœ‹ï¼ŒGoogle é‚£é‚Šæ‰¾äº†ä¸€é™£å­å¾Œçµ‚æ–¼æ‰¾åˆ°åŸå› æ‹‰ï¼ï¼ï¼æˆ‘å€‘ä¸€èµ·ä¾†çœ‹çœ‹å§ (åœ–ä¸‰)\n(åœ–ä¸‰) Google æ”¯æ´å–®å›è¦†\nå°±å¦‚åŒ Google æ‰€èªªï¼Œä½¿ç”¨æä¾›çš„æŒ‡ä»¤åƒæ•¸ä¾†æŸ¥è©¢ï¼Œå¢é›†åœ¨è©²æ™‚æ®µæœ‰ç™¼ç”Ÿ master control plane çš„å‡ç´šï¼Œå¦‚ (åœ–å››)ï¼Œå†åŠ ä¸Šæˆ‘å€‘å»ºçš„é€™å€‹ cluster æ˜¯ä½¿ç”¨ zonal cluster (åœ–äº”)ï¼Œæ‰€ä»¥å¢é›†åªæœ‰ä¸€å€‹ control planeï¼Œç•¶ control plane åœ¨æ›´æ–°æ™‚ï¼Œæœƒç„¡æ³•éƒ¨ç½²æ–°çš„ workloadï¼Œå°è‡´è©² CronJob æ²’æœ‰åŸ·è¡Œ Jobã€‚åƒè€ƒè³‡æ–™ [1]\n(åœ–å››) ç™¼ç”Ÿ master control plane çš„å‡ç´š\n(åœ–äº”) æœ‰å•é¡Œçš„å¢é›†ä½ç½®é¡å‹\nGoogle çš„å»ºè­°æ˜¯å¯ä»¥è€ƒæ…®ä½¿ç”¨å¦ä¸€å€‹ regional clusterï¼Œè®“ master node åœ¨æ›´æ–°æ™‚ä¸æœƒåªåœ¨å–®ä¸€åœ°å€ï¼Œæˆ–æ˜¯ä¸€æ¨£ä½¿ç”¨èˆŠçš„ zonal clusterï¼Œé€éè¨­å®š Maintenance window æˆ–è€… Maintenance exclusions ä¾†é™ä½æœå‹™å—åˆ° workload çš„å½±éŸ¿ã€‚åƒè€ƒè³‡æ–™ [2]\nå°±ç®—æŠŠ node_pool è£¡é¢çš„è‡ªå‹•å‡ç´šçµ¦åœæ‰ï¼Œä¹Ÿæ²’æœ‰è¾¦æ³•è§£æ±ºæ­¤å•é¡Œï¼å› ç‚ºæ­¤ master control plane (ä¹Ÿå°±æ˜¯ master node) çš„å‡ç´šï¼Œä¸æ˜¯ worker node çš„ node pool å‡ç´šï¼Œæ˜¯ç”± GKE è² è²¬ç¶­è­·çš„ï¼Œæ‰€ä»¥ä»–å€‘æœƒå®šæœŸå‡ç´š control planeï¼Œä¹Ÿæ²’è¾¦æ³•åœæ­¢æ­¤é¡çš„å‡ç´šã€‚\nè‹¥å·²ç¶“å»ºç«‹å¥½ zonal cluster å¾Œï¼Œæƒ³è¦æ”¹æˆ regional cluster ï¼Œæ˜¯æ²’æœ‰è¾¦æ³•ä½¿ç”¨ä¿®æ”¹çš„æ–¹å¼ï¼Œä¸€å®šåªèƒ½é‡å»º clusterï¼Œæ‰€ä»¥å¤§å®¶åœ¨å»ºç«‹æ™‚è¦æ³¨æ„ï½","è§£æ±ºå•é¡Œ#è§£æ±ºå•é¡Œ":"æœ€å¾Œæˆ‘å€‘é¸æ“‡å°‡å¢é›†çµ¦æ•´å€‹é‡å»ºï¼Œä¾†ç¢ºä¿ CronJob ä¸æœƒæœ‰æ²’æœ‰åŸ·è¡Œåˆ°çš„ç‹€æ³ç™¼ç”Ÿï¼Œé‡å»ºå¢é›†è·Ÿæ¬æœå‹™çš„éç¨‹å¾ˆè¾›è‹¦çš„ ğŸ˜° å¸Œæœ›å¤§å®¶ä¸è¦ç™¼ç”Ÿ QQï¼Œæœ€å¾Œæˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹é‡å»ºå®Œå¾Œï¼Œåœ¨ master control plane æ›´æ–°çš„æ™‚å€™ï¼Œé‚„æœƒä¸æœƒæœ‰ CronJob æ²’æœ‰åŸ·è¡Œçš„æƒ…æ³ç™¼ç”Ÿã€‚\næ–°å¢é›†ä½¿ç”¨ regional cluster ä¾†å»ºç«‹ï¼Œåœ¨ 2/1 ä¹Ÿæœ‰ master control plane çš„å‡ç´šã€‚ (åœ–å…­)\n(åœ–å…­) ç™¼ç”Ÿ master control plane çš„å‡ç´š\næŸ¥çœ‹ CronJob åŸ·è¡Œçš„ç´€éŒ„å¯ä»¥ç™¼ç¾ä¸¦æ²’æœ‰ Job æ²’æœ‰åŸ·è¡Œçš„æƒ…æ³ç™¼ç”Ÿã€‚ (åœ–ä¸ƒ)\n(åœ–ä¸ƒ) å¢é›†ä½ç½®é¡å‹\n(åœ–å…«) æ–°å¢é›†ä½ç½®é¡å‹"},"title":"Google Kubernetes Engine CronJob æœƒæœ‰çŸ­æš«æ™‚é–“æ²’æœ‰åŸ·è¡Œ Job"},"/blog/gcp/iam/":{"data":{"":"IAM çš„å…¨åæ˜¯ Identity and Access Managementï¼Œç•¶æˆ‘å€‘è—‰ç”± IAMï¼Œå¯ä»¥æˆèˆ‡ç‰¹å®š Google Cloud è³‡æºçš„ ç²¾ç´° è¨ªå•æ¬Šé™ï¼Œä¸¦é˜²æ­¢å°å…¶ä»–è³‡æºçš„è¨ªå•ã€‚ç–‘ï¼ï¼Ÿç‚ºä»€éº¼æ˜¯ç²¾ç´°ï¼Ÿæˆ‘å€‘æ¥è‘—çœ‹ä¸‹å»ï¼Œæˆ‘å€‘å¯ä»¥æ¡ç”¨æœ€å°æ¬Šé™å®‰å…¨åŸå‰‡ï¼Œè©²åŸå‰‡è¦æ±‚ä»»ä½•äººéƒ½ä¸æ‡‰æ“æœ‰è¶…å‡ºå¯¦éš›æ‰€éœ€çš„æ¬Šé™ã€‚","iam-æ¸¬è©¦#IAM æ¸¬è©¦":"æ¥ä¸‹ä¾†ï¼Œæˆ‘å€‘ä¾†æ¸¬è©¦çœ‹çœ‹ IAM å¯¦éš›è¨­å®šä»¥åŠç”¨é€”å§ï¼ æˆ‘å€‘æœƒä½¿ç”¨ GCP æ‰€ä»¥æä¾›çš„ [Qwiklabs] Cloud IAMï¼šQwik Start ä¾†é€²è¡Œæ¸¬è©¦ï¼Œä¹‹å¾Œçš„æ­¥é©Ÿæœƒè·Ÿ Cloud IAMï¼šQwik Start å…§å®¹ä¸€æ¨£ï¼Œæ‰€ä»¥å¤§å®¶å¯ä»¥é‚Šæ“ä½œé‚Šåƒè€ƒå‘¦ï¼é‚£æˆ‘å€‘é–‹å§‹å›‰ ğŸ™ƒ\né€²å…¥ç¶²é å¾Œï¼Œè«‹å…ˆç™»å…¥è‡ªå·±çš„ Google å¸³è™Ÿï¼Œæ¥è‘—é»é¸å·¦ä¸Šè§’çš„ Start Labï¼Œæœƒè·³å‡ºèˆ‡ä¸‹é¢åœ–ç‰‡é¡ä¼¼çš„å…§å®¹ï¼š\næ¸¬è©¦ç”¨çš„å¸³è™Ÿå¯†ç¢¼\né€™é‚Šæœƒæä¾›å…©çµ„çš„å¸³è™ŸåŠå¯†ç¢¼ï¼Œåˆ†åˆ¥æ˜¯ Username1 ä»¥åŠ Username2 (å¾Œé¢æœƒä»¥ Username 1 è·Ÿ 2 ä¾†èªªæ˜)ï¼Œå¯†ç¢¼æœƒç”¨å…±ç”¨ï¼Œä¸”æœƒåœ¨åŒä¸€å€‹å°ˆæ¡ˆä¸‹ã€‚\nç”¨ç¬¬ä¸€å€‹ Username1 ç™»å…¥ GCP é»é¸ Open Google Console æŒ‰éˆ•ä¾†é–‹å•Ÿ GCP ä¸»æ§å° ç™»å…¥çš„å¸³è™Ÿå°±è¼¸å…¥ç¬¬ä¸€å€‹ Username1 ï¼Œå¯†ç¢¼è¼¸å…¥å…±ç”¨å¯†ç¢¼ ï¼Œæœ€å¾Œç™»å…¥ ç™»å…¥æˆåŠŸæœƒé€²å…¥ GCP ä¸»æ§å°ï¼Œæœƒè·³å‡ºä¸‹æ–¹åœ–ç‰‡å…§å®¹ï¼Œåœ‹å®¶é¸æ“‡å°ç£ï¼Œé»é¸åŒæ„ Terms of Serviceï¼Œæœ€å¾ŒæŒ‰ AGREE AND CONTINUE ç™»å…¥ Username 1 GCP ä¸»æ§å°\nç”¨ç¬¬äºŒå€‹ Username2 ç™»å…¥ GCP æ­¥é©Ÿèˆ‡ç¬¬ä¸€å€‹ç›¸åŒï¼Œé€™é‚Šå°±ä¸åœ¨é‡è¤‡ï¼Œä½†å»ºè­°ä½¿ç”¨ç„¡ç—•ï¼Œé¿å… Username1 è·Ÿ Username2 æ¶ä¾†æ¶å»ï¼Œä»¥åŠç™»å…¥å¸³è™Ÿè¦é¸ Username2ï¼Œæ‡‰è©²ä¸æœƒé¸éŒ¯å§ ğŸ¤£ Username1 IAM ä¸»æ§å° åˆ° Username1 çš„ GCP ä¸»æ§å°é¦–é  é»é¸å·¦å´çš„ menu \u003e IAM èˆ‡ç®¡ç† é»æ“Šé é¢ä¸Šæ–¹çš„ +ADD æŒ‰éˆ•ï¼Œå¯ä»¥å¾ä¸‹æ‹‰é¸å–®å»æŸ¥çœ‹å„å¼å„é …çš„å°ˆæ¡ˆç›¸é—œè§’è‰²ï¼Œå¯ä»¥çœ‹åˆ°è¶…ç´šå¤šçš„è§’è‰²è¨­å®šï¼Œæ‰€ä»¥æˆ‘å€‘ä¸€é–‹å§‹æ‰æœƒèªªä»–æ˜¯å¯ä»¥è¨­å®š ** ç²¾ç´°** çš„è¨ªå•æ¬Šé™ æˆ‘å€‘é¸æ“‡ Baseï¼Œå³å´æœ‰ 4 ç¨®è§’è‰²ï¼Œåˆ†åˆ¥æ˜¯ç€è¦½è€… (Browser)ã€ç·¨è¼¯è€… (Editor)ã€æ‰€æœ‰è€… (Owner)ã€æª¢è¦–è€… (Viewer)ï¼Œè©³ç´°å€åˆ¥è«‹çœ‹ä¸‹é¢ ğŸ‘‡ğŸ‘‡ ADD IAM\næ­¤è¡¨æ˜¯å– Google Cloud IAM æ–‡ç« åŸºæœ¬è§’è‰²ä¸­çš„å®šç¾©ï¼Œç°¡å–®èªªæ˜ 4 ç¨®è§’è‰²çš„å·®åˆ¥ï¼š\nè§’è‰²åç¨± æ¬Šé™ role/viewer (æª¢è¦–è€…) ä¸å½±éŸ¿ç‹€æ…‹çš„åªè®€æ“ä½œæ¬Šé™ï¼Œä¾‹å¦‚ï¼šæŸ¥çœ‹ (ä½†ä¸ä¿®æ”¹) ç¾æœ‰è³‡æºæˆ–æ˜¯è³‡æ–™ role/editor (ç·¨è¼¯è€…) æ‰€æœ‰æŸ¥çœ‹è€…æ¬Šé™ï¼Œä»¥åŠä¿®æ”¹ç‹€æ…‹çš„æ“ä½œæ¬Šé™ï¼Œä¾‹å¦‚ï¼šæ›´æ”¹ç¾æœ‰è³‡æº role/owner (æ“æœ‰è€…) ä»¥ä¸‹æ“ä½œçš„æ‰€æœ‰ç·¨è¼¯æ¬Šé™ï¼š 1. ç®¡ç†é …ç›®å’Œé …ç›®å…§çš„æ‰€æœ‰è³‡æºè§’è‰²åŠæ¬Šé™ 2. ç‚ºé …ç›®è¨­ç½®å¸³å–® role/browser (ç€è¦½è€…) è®€å–æ¬Šé™ä»¥åŠç€è¦½é …ç›®çš„å±¤æ¬¡çµæ§‹ï¼ŒåŒ…å«è³‡æ–™å¤¾ã€çµ„ç¹”å’Œ IAM æ”¿ç­–ã€‚ä½†æ­¤è§’è‰²ä¸åŒ…å«æŸ¥çœ‹é …ç›®ä¸­è³‡æºçš„æ¬Šé™ æˆ‘å€‘çš„ Username1 ç‚º ownerï¼ŒUsername2 ç‚º viewer\nGoogle å»ºè­°ï¼šBase è§’è‰²åŒ…å«æ‰€æœ‰ Google Cloud æœå‹™çš„æ•¸åƒå€‹æ¬Šé™ã€‚é™¤éåˆ¥ç„¡é¸æ“‡ï¼Œå¦å‰‡ä¸è¦æˆèˆ‡ç”¨æˆ¶ Base è§’è‰²ï¼Œè«‹è¨­å®šæœ€æœ‰é™çš„è‡ªè¨‚ç¾©è§’è‰²æˆ–æ˜¯å¯ä»¥æ»¿è¶³è©²éœ€æ±‚çš„è§’è‰²å³å¯ åˆ‡æ›åˆ° Username2 IAM ä¸»æ§å° æˆ‘å€‘å¯ä»¥åœ¨è¡¨æ ¼è£¡é¢æ”¶å°‹ Username1 è·Ÿ Username2 çš„å¸³è™Ÿï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ä»–å€‘æˆèˆ‡çš„è§’è‰²æ˜¯å¦èˆ‡ä¸Šé¢èªªçš„ä¸€è‡´ï¼Œå¤§æ¦‚å¯ä»¥åƒè€ƒä»¥ä¸‹åœ–ç‰‡ï¼š\nUsername1 è·Ÿ Username2 æ¬Šé™\nåœ¨ Username2 å› ç‚ºæ˜¯ Viewer æ¬Šé™ï¼Œæ‰€ä»¥é»æ“Šä¸Šé¢çš„ + ADDï¼Œä¸æœƒåæ‡‰ï¼Œæœƒè·³å‡ºä»¥ä¸‹ç…§ç‰‡å…§å®¹ï¼š\nUsername2 æ¬Šé™ä¸è¶³\nå†åˆ‡å› Username1 Cloud Storage æ¥ä¸‹ä¾†æˆ‘å€‘è¦å»ºç«‹ä¸€å€‹ GCS å„²å­˜ç©ºé–“ï¼Œé»é¸ menu \u003e Cloud Storage \u003e Browser é»é¸ Create a bucket çµ¦äºˆä»–ä¸€å€‹ç¨ç‰¹çš„åç¨±ï¼Œä»¥åŠåœ¨ Choose where to store your data é¸æ“‡ Multi-Region æœ€å¾Œé»é¸ CREATE Create a bucket\nä¸Šå‚³ç¯„ä¾‹æª”æ¡ˆ é€²å…¥æ–°å»ºç«‹çš„ Cloud Storageï¼Œé»é¸ Upload fiiles æŒ‰éˆ• ä¸Šå‚³ä¸€å€‹ txt æª”æ¡ˆï¼Œå¯ä»¥å…ˆå–åç‚º sample.txtï¼Œæˆ–æ˜¯ä¸Šå‚³å¾Œä½¿ç”¨æœ€å¾Œä¸‰å€‹å°é»åœ–æ¡ˆå…§çš„ Rename ä¾†ä¿®æ”¹åç¨± Upload sample.txt fiiles\né©—è­‰å°ˆæ¡ˆæª¢è¦–è€…å­˜å–æ¬Šé™ æˆ‘å€‘å†åˆ‡æ›å› Username2 çš„ä¸»æ§å°ï¼Œé¸æ“‡ menu \u003e Cloud Storage \u003e Browser å°±å¯ä»¥çœ‹åˆ°è·Ÿä¸Šé¢ä¸€æ¨£çš„å„²å­˜å€ Username2 è¢«æˆèˆ‡ â€œæª¢è¦–è€… Viewerâ€ è§’è‰²ï¼Œé€™å€‹è§’è‰²æœ‰ä¸å½±éŸ¿ç‹€æ…‹çš„åªè®€æ¬Šé™ã€‚é€™å€‹ç¯„ä¾‹ä¸­èªªæ˜é€™å€‹åŠŸèƒ½ï¼Œä»–åƒ…èƒ½æª¢è¦–ï¼Œæ²’æœ‰è¾¦æ³•ä¸Šå‚³\nç§»é™¤å°ˆæ¡ˆå­˜å–æ¬Šé™ æˆ‘å€‘å†æ¬¡åˆ‡å› Username ä¸»æ§å°ï¼Œé¸æ“‡ menu \u003e IAM èˆ‡ç®¡ç† ï¼Œæ‰¾åˆ° Username2 æ—é‚Šçš„é‰›ç­†åœ–æ¡ˆ ä¿®æ”¹ Username2 æ¬Šé™\né»æ“Šè§’è‰²åç¨±çš„åƒåœ¾æ¡¶ä¾†ç§»é™¤ Username2 çš„æª¢è¦–è€…æ¬Šé™ï¼Œé»æ“Š Save ç§»é™¤ Username2 æ¬Šé™\né€™å€‹å‹•ä½œè¦å®Œæˆç”Ÿæ•ˆåˆ°æ‰€æœ‰æœå‹™ä¸Šï¼Œæ‰€ä»¥æœƒéœ€è¦ä¸€é»æ™‚é–“ï¼Œè©³ç´°å¯ä»¥åƒè€ƒé»æˆ‘ æª¢æŸ¥ Username2 æ˜¯å¦æœ‰å­˜å–æ¬Šé™ åˆ‡æ›åˆ° Username2 ä¸»æ§å°ï¼Œé¸æ“‡ menu \u003e Cloud Storage \u003e Browser æœƒç™¼ç¾å‡ºç¾ä»¥ä¸‹çš„éŒ¯èª¤è¨Šæ¯ï¼Œä»£è¡¨æˆ‘å€‘ç§»é™¤æ¬Šé™æˆåŠŸ Username2 æ²’æœ‰æ¬Šé™\næ–°å¢å„²å­˜è§’è‰² æˆ‘å€‘å†æ¬¡åˆ‡æ›åˆ° Username1 ä¸»æ§ç‰ˆï¼Œé¸æ“‡ menu \u003e \u003e IAM èˆ‡ç®¡ç†ï¼Œé»é¸ä¸Šæ–¹ + ADDï¼Œåœ¨ New principals ä¸Šè²¼ä¸Š Username2 çš„å¸³è™Ÿï¼ŒRole é¸æ“‡ Storage Object Viewer æ–°å¢ Username2 è§’è‰²\næŸ¥çœ‹ Username2 æ¬Šé™\næª¢æŸ¥ Username2 æ˜¯å¦æœ‰å­˜å–æ¬Šé™ åˆ‡æ›åˆ° Username2 ä¸»æ§å°ï¼Œå› ç‚º Username2 æ²’æœ‰å°ˆæ¡ˆæª¢è¦–è€…çš„è§’è‰²ï¼Œæ‰€ä»¥çœ‹ä¸åˆ°å°ˆæ¡ˆä»¥åŠä»»ä½•çš„è³‡æºï¼Œä½†é€™å€‹ä½¿ç”¨è€…å°æˆ‘å€‘å‰›å‰›è¨­å®šçš„ Cloud Storage æœ‰ç‰¹åˆ¥çš„å­˜å–æ¬Š æ‰“é–‹å³ä¸Šè§’çš„ Activate Cloud Shell å‘½ä»¤åˆ—å·¥å…· ï¼Œå¦‚ä¸‹åœ–ï¼š é–‹å•Ÿ Activate Cloud Shell å‘½ä»¤åˆ—å·¥å…·\nè¼¸å…¥ä»¥ä¸‹æŒ‡ä»¤ gsutil ls gs://\u003cå‰›å‰›å»ºçš„ Cloud Storage åç¨±\u003e å¦‚æœå‡ºç¾è·Ÿä¸‹æ–¹åœ–ç‰‡ä¸€æ¨£ï¼Œå°±ä»£è¡¨æˆ‘å€‘è¨­å®šæˆåŠŸå›‰ï¼\nUsername2 Storage Object Viewer æ¬Šé™\næœ€å¾Œçš„æœ€å¾Œï¼Œå¦‚æœæœ‰è·Ÿæˆ‘å€‘ä¸€æ­¥ä¸€æ­¥ä¾†çš„æœ‹å‹ï¼Œåœ¨ [Qwiklabs] Cloud IAMï¼šQwik Start é é¢ä¸­ï¼Œæ‡‰è©²æœƒçœ‹åˆ°ä¸€å€‹å« Check my progress çš„æŒ‰éˆ•ï¼Œåšå®Œæ¯ä¸€æ­¥é©Ÿï¼Œéƒ½å¯ä»¥é»ä¸€ä¸‹ï¼Œä»–æœƒè‡ªå‹•å»åˆ¤æ–·ä½ æ˜¯å¦æœ‰å®Œæˆé€™é …å‹•ä½œæ­ï¼\nCheck my progress\nåˆ°é€™é‚Šå°±å®Œæˆäº†æˆ‘å€‘åœ¨ IAM çš„æ¸¬è©¦å›‰ï½æˆ‘å€‘çŸ¥é“ IAM å¯ä»¥è¨­å®šå¾ˆå¤šçš„è§’è‰²ï¼Œä»¥åŠæ¸¬è©¦äº†æŸ¥çœ‹ã€æ–°å¢ã€ä¿®æ”¹ã€åˆªé™¤è§’è‰²çš„åŠŸèƒ½ï¼Œå¸Œæœ›å¤§å®¶æœƒå–œæ­¡ä»Šå¤©çš„æ–‡ç«  ğŸ¥°","iam-çš„å·¥ä½œåŸç†#IAM çš„å·¥ä½œåŸç†":"é¦–å…ˆæˆ‘å€‘å…ˆä¾†äº†è§£ä¸€ä¸‹ IAM çš„å·¥ä½œåŸç†ï¼Œè—‰ç”± IAMï¼Œæˆ‘å€‘å¯ä»¥å®šç¾©èª° (å“ªä¸€å€‹èº«ä»½) å°å“ªäº›è³‡æºæœ‰å“ªç¨®çš„è¨ªå•æ¬Šé™ (è§’è‰²) ä¾†ç®¡ç†è¨ªå•æ¬Šé™æ§åˆ¶ã€‚ä»€éº¼æ˜¯è³‡æºï¼Ÿä¾‹å¦‚ï¼Œ Compute Engine è™›æ“¬æ©Ÿ (GCE)ã€Google Kubernetes Engine (GKE) é›†ç¾¤å’Œ Cloud Storage å­˜å„²åˆ†å€éƒ½æ˜¯ Google Cloud è³‡æºï¼Œæˆ‘å€‘ç”¨æ–¼æ•´ç†è³‡æºçš„çµ„ç¹”æˆ–è³‡æ–™å¤¾ã€é …ç›®ç­‰ä¹Ÿéƒ½æ˜¯è³‡æº\nGCP IAM Logo\næˆ‘å€‘å¯ä»¥æŠŠå®ƒç†è§£æˆ\nä»€éº¼ ã€ äºº ã€ï¼Œå¯ä»¥å°ä»€éº¼ã€ è³‡æº ã€ï¼Œåšä»€éº¼ã€ äº‹æƒ… ã€ IAM ä¸æœƒç›´æ¥å‘ç”¨æˆ¶æˆèˆ‡è³‡æºçš„è¨ªå•æ¬Šé™ï¼Œè€Œæ˜¯å°‡æ¬Šé™åˆ†æˆå¤šå€‹è§’è‰²ï¼Œç„¶å¾Œå°‡é€™äº›è§’è‰²æˆèˆ‡ç¶“éèº«ä»½é©—è­‰çš„ä¸»å¸³è™Ÿã€‚(ä»¥å‰ IAM æœƒå°‡ä¸»å¸³è™Ÿç¨±ç‚ºæˆå“¡ï¼Œç›®å‰éƒ¨åˆ† API ä»ç„¶ä½¿ç”¨æ­¤è¡“èªã€‚)\nIAM ä¸­çš„æ¬Šé™ç®¡ç†\nå¯ä»¥çœ‹åˆ°é€™å¼µåœ–ç‰‡ï¼Œè¨ªå•æ¬Šé™ç®¡ç†ä¸»è¦åŒ…å«ä¸‰å€‹éƒ¨åˆ†ï¼š\nä¸»å¸³è™Ÿ (Principal)ï¼šä¸»å¸³è™Ÿå¯ä»¥æ˜¯ Google å¸³è™Ÿ (é‡å°ç”¨æˆ¶)ã€æœå‹™å¸³è™Ÿ (é‡å°æ‡‰ç”¨å’Œè¨ˆç®—å·¥ä½œè² è¼‰)ã€Google ç¾¤çµ„æˆ– Workspace å¸³è™Ÿæˆ–å¯ä»¥è¨ªå•è³‡æºçš„ Cloud Identity ç¶²åŸŸç­‰ç­‰ è§’è‰² (Role)ï¼šä¸€å€‹è§’è‰²å°æ‡‰ä¸€çµ„æ¬Šé™ï¼Œæ¬Šé™æ±ºå®šäº†å¯ä»¥å°è³‡æºåŸ·è¡Œçš„æ“ä½œã€‚å‘ä¸»å¸³è™Ÿæˆèˆ‡æŸå€‹è…³è‰²ï¼Œ ä»£è¡¨æˆèˆ‡è©²è§’è‰²åŒ…å«çš„æ‰€æœ‰æ¬Šé™çµ¦ä¸»å¸³è™Ÿ æ”¿ç­– (Policy)ï¼šå…è¨±æ”¿ç­– (Allow Policy) æ˜¯å°‡ä¸€å€‹æˆ–å¤šå€‹ä¸»é«”ç¶å®šåœ¨å„å€‹è§’è‰²ï¼Œç•¶æƒ³è¦å®šç¾©èª° (ä¸»é«”) å°è³‡æºæ“æœ‰ä½•ç¨®é¡å‹çš„è¨ªå• (è§’è‰²) æ™‚ï¼Œå¯ä»¥å‰µå»ºå…è¨±æ”¿ç­–ä¸¦å°‡å…¶é™„åŠ åˆ°è³‡æºã€‚ ","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"IAM æ¦‚è¦½ï¼šhttps://cloud.google.com/iam/docs/overview\nä»€éº¼æ˜¯ Cloud IAMï¼ŸGCP æ¬Šé™ç®¡ç†æœå‹™ä»‹ç´¹ï¼šhttps://blog.cloud-ace.tw/identity-security/what-is-cloud-iam/"},"title":"Google Cloud Platform (GCP) - IAM èˆ‡ç®¡ç†"},"/blog/git-or-cicd/":{"data":{"":"æ­¤åˆ†é¡åŒ…å« Git æˆ– CICD ç›¸é—œçš„æ–‡ç« ã€‚\nå¦‚ä½•å•Ÿç”¨ GitLab çš„ Package Registry ä»¥åŠå°‡å„²å­˜ä½ç½®å¾ä¼ºæœå™¨æ”¹åˆ° GCS ä¸Š å¦‚ä½•åˆä½µå¤šå€‹ commitï¼Œä¸”æ¨åˆ°é ç«¯å‘¢ï¼Ÿ éƒ¨ç½² Laravel æ–¼ Heroku æ­é… GitLab CI/CD å¦‚ä½•å¾é ­æ‰“é€ å°ˆå±¬çš„ GitLab CI/CD Ansible ä»‹ç´¹èˆ‡å¯¦ä½œ (Inventoryã€Playbooksã€Moduleã€Templateã€Handlers) "},"title":"Git æˆ– CICD ç›¸é—œ"},"/blog/git-or-cicd/ansible/":{"data":{"":"æœ¬ç¯‡æ–‡ç« æ˜¯æ¥çºŒå‰é¢å…©ç¯‡ Jenkins åŠ Ansible IT è‡ªå‹•åŒ– CI/CD ä»‹ç´¹ è·Ÿ ä½¿ç”¨ Jenkins è¨­å®š GitHub è§¸ç™¼ç¨‹åºä¸¦é€šçŸ¥ Telegram Bot æ–‡ç« ï¼Œæ­¡è¿å¤§å®¶å…ˆå»è§€çœ‹å‰é¢å…©ç¯‡æ–‡ç«  ğŸ¤ª\næœ¬ç¯‡æ‰€ä½¿ç”¨åˆ°çš„ç¨‹å¼ç¢¼éƒ½æœƒæ•´ç†æ–¼ GitHub é€£çµï¼Œå¤§å®¶æœ‰èˆˆè¶£å¯ä»¥å»ç€è¦½çœ‹çœ‹æ­ï¼","ansible-å®‰è£èˆ‡å¯¦ä½œ#Ansible å®‰è£èˆ‡å¯¦ä½œ":"å®‰è£ä¹‹å‰å…ˆè®“å¤§å®¶çœ‹ä¸€ä¸‹ç‰ˆæœ¬å§ï¼å¤§å®¶è¦è¨˜å¾—æª¢æŸ¥è‡ªå·±çš„ç‰ˆæœ¬èˆ‡æ•™å­¸æ˜¯å¦ç›¸åŒï¼Œå¦‚æœä¸åŒï¼Œè¨˜å¾—è¦å…ˆæŸ¥çœ‹å®˜ç¶²æ˜¯å¦æœ‰ä¿®æ”¹å…§å®¹ã€‚\nç‰ˆæœ¬ macOSï¼š11.6 Dockerï¼šDocker version 20.10.14, build a224086 Aansibleï¼šansible [core 2.12.5] å¦‚ä½•å®‰è£ Ansible åœ¨æ§åˆ¶ä¸»æ©Ÿ ç”±æ–¼ Ansible æ˜¯ä¸€å¥—é–‹æºçš„è»Ÿé«”ï¼Œæ‰€ä»¥åœ¨ç›®å‰å¤§éƒ¨åˆ†ä¸»æµä½œæ¥­ç³»çµ±ä¸Šéƒ½å¯ä»¥é€éå°æ‡‰çš„å¥—ä»¶ç®¡ç† (package manager) é€²è¡Œå®‰è£ã€‚\næœ¬äººä½¿ç”¨ macOS ï¼Œæ‰€ä»¥é€™é‚Šåƒ…åˆ—å‡º masOS å®‰è£æ–¹å¼ï¼Œå…¶ä»–çš„å¯ä»¥åƒè€ƒå®˜æ–¹çš„å®‰è£æŒ‡å—ã€‚\nmacOS å®‰è£å¯ä»¥ä½¿ç”¨å…©ç¨®æ–¹å¼ï¼Œå®˜æ–¹è¼ƒæ¨è–¦ä½¿ç”¨ pip ä¾†åšå®‰è£ï¼š\nPip Install Packages (pip å®˜æ–¹è¼ƒæ¨è–¦) $ sudo pip install ansible Homebrew (brew) $ sudo brew install ansible å®‰è£å®Œå¾Œï¼Œå¯ä»¥ä½¿ç”¨ --version æŒ‡ä»¤ä¾†æª¢æŸ¥æ˜¯å¦å®‰è£å®Œæˆï¼š\n$ ansible --version ansible [core 2.12.5] config file = None configured module search path = ['/Users/ian_zhuang/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules'] ansible python module location = /usr/local/Cellar/ansible/5.7.1/libexec/lib/python3.10/site-packages/ansible ansible collection location = /Users/ian_zhuang/.ansible/collections:/usr/share/ansible/collections executable location = /usr/local/bin/ansible python version = 3.10.4 (main, Apr 26 2022, 19:43:24) [Clang 13.0.0 (clang-1300.0.29.30)] jinja version = 3.1.2 libyaml = True å¦‚ä½•å®‰è£ Ansible åœ¨è¢«æ§ç¯€é» ä¸éœ€è¦ï¼ï¼ï¼ é€é Ansible é€²è¡Œç®¡ç†çš„è¢«æ§ç¯€é»å®Œå…¨ä¸éœ€è¦å®‰è£ Ansibleã€‚æˆ‘å€‘åªéœ€è¦ç¢ºä¿é€™å€‹ç¯€é»å¯ä»¥é€é SSH èˆ‡æ§åˆ¶ä¸»æ©Ÿåšæºé€šï¼Œä¸¦å®‰è£ Python 2.6 ä»¥ä¸Šç‰ˆæœ¬å°±å¯ä»¥é€éæ§åˆ¶ä¸»æ©Ÿä¾†é€²è¡Œéƒ¨ç½²åŠç®¡ç†äº†ã€‚\né‚£æˆ‘å€‘ç‚ºäº†è¦æ¨¡æ“¬ï¼Œæ‰€ä»¥æˆ‘å€‘ä½¿ç”¨ Docker ä¾†æ¨¡æ“¬ Managed Nodeï¼Œé¦–å…ˆè€æ¨£å­ï¼Œä¸€æ¨£å…ˆå¯«ä¸€å€‹ Dockerfile ä¾†å»ºç«‹æˆ‘å€‘çš„æ˜ åƒæª”ï¼Œæ­¤æ˜ åƒæª”æ˜¯å¾®èª¿ chusiang/ansible-managed-node.dockerfile çš„å…§å®¹ï¼Œä¿®æ”¹ ubuntu ç‰ˆæœ¬ä»¥åŠå…§å®¹ä½œèª¿æ•´ï¼Œæˆ‘æœƒæŠŠç¨‹å¼ç¢¼æ”¾åœ¨ GitHub é€£çµ ï¼Œä»¥åŠ DockerHub é€£çµï¼Œæ­¡è¿å¤§å®¶å‰å»ä¸‹è¼‰ä½¿ç”¨ã€‚\nFROM ubuntu:22.10 LABEL maintainer=\"880831ian@gmail.com\" # Update the index of available packages. RUN apt-get update # Install the requires package. RUN apt-get install -y openssh-server sudo curl wget bash-completion openssl \u0026\u0026 apt-get clean # Setting the sshd. RUN mkdir /var/run/sshd RUN echo 'root:root' | chpasswd RUN sed -i 's/PermitRootLogin without-password/PermitRootLogin yes/' /etc/ssh/sshd_config # SSH login fix. Otherwise user is kicked off after login RUN sed 's@session\\s*required\\s*pam_loginuid.so@session optional pam_loginuid.so@g' -i /etc/pam.d/sshd ENV NOTVISIBLE \"in users profile\" RUN echo \"export VISIBLE=now\" \u003e\u003e /etc/profile # Create a new user. # # - username: docker # - password: docker RUN useradd --create-home --shell /bin/bash \\ --password $(openssl passwd -1 docker) docker # Add sudo permission. RUN echo 'docker ALL=(ALL) NOPASSWD: ALL' \u003e\u003e /etc/sudoers # Setting ssh public key. RUN wget https://raw.githubusercontent.com/chusiang/ansible-jupyter.dockerfile/master/files/ssh/id_rsa.pub \\ -O /tmp/authorized_keys \u0026\u0026 \\ mkdir /home/docker/.ssh \u0026\u0026 \\ mv /tmp/authorized_keys /home/docker/.ssh/ \u0026\u0026 \\ chown -R docker:docker /home/docker/.ssh/ \u0026\u0026 \\ chmod 644 /home/docker/.ssh/authorized_keys \u0026\u0026 \\ chmod 700 /home/docker/.ssh EXPOSE 22 # Run ssh server daemon. CMD [\"/usr/sbin/sshd\", \"-D\"] æ¥ä¸‹ä¾†å°‡å®ƒåŒ…æˆ Image ä¸¦å•Ÿå‹•ä»–ï¼š\n$ docker build -t ansible-ubuntu-server . \u0026\u0026 docker run --name server1 -d -p 8888:22 ansible-ubuntu-server 64c51235e34a7ba42c0c45e690201dd80248c9aac76c3b855c99cf63f7f0af7c å¯ä»¥ç”¨ exec é€²å…¥å®¹å™¨ï¼š\ndocker exec -it server1 /bin/bash å¦‚ä½•è®“ Ansible æ“æ§ Docker å®¹å™¨ï¼Ÿ æˆ‘å€‘åœ¨å·¥ä½œç›®éŒ„ä¸‹ï¼Œæ–°å¢ä¸€å€‹ ansible.cfgï¼š\n[defaults] inventory = hosts remote_user = docker host_key_checking = False è¨­å®š inventory hostsï¼š\n[local] server1 ansible_ssh_host=127.0.0.1 ansible_ssh_port=8888 ansible_ssh_pass=docker å…¶ä¸­ 8888 æ˜¯æˆ‘å€‘åœ¨å•Ÿå‹•æ™‚æ‰€é–‹æ”¾çš„ Portï¼Œä¹Ÿå¯ä»¥è‡ªè¡Œæ›´æ”¹ã€‚\nansible_ssh_hostï¼šè¨­ç‚ºæœ¬æ©Ÿçš„ IPã€‚ ansible_ssh_portï¼šè¨­ç‚º docker ps å–å¾—çš„ SSH Port ä¹Ÿå°±æ˜¯æˆ‘å€‘çš„ 8888ã€‚ ansible_ssh_passï¼šå› ç‚ºæˆ‘å€‘æ²’æœ‰é€£ç·šç”¨çš„é‡‘é‘°ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨å¯†ç¢¼æ–¹å¼åšé€£çµã€‚(å»ºè­°åªç”¨æ–¼ç·´ç¿’ç’°å¢ƒä½¿ç”¨) Hello World On Managed Node ç•¶æˆ‘å€‘éƒ½è¨­ç½®å®Œæˆå¾Œï¼Œå°±å¯ä»¥ä½¿ç”¨ Terminal ç”¨ Docker å»ºç«‹å¥½çš„ Ansible ä¾†ç·´ç¿’äº†ï¼\n$ ansible all -m command -a 'echo Hello World on Docker.' server1 | CHANGED | rc=0 \u003e\u003e Hello World on Docker. ansible å®‰è£æ™‚å¸¸è¦‹å•é¡Œ\nQ1. server1 | FAILED | rc=-1 Â» to use the â€˜sshâ€™ connection type with passwords or pkcs11_provider, you must install the sshpass program\nAns1. æœƒé‡åˆ°é€™å€‹å•é¡Œæ˜¯å› ç‚ºéœ€è¦å¤šå®‰è£ sshpassï¼Œä¸€èˆ¬ç³»çµ±å®‰è£ sshpass å¾ˆç°¡å–®ï¼Œä½†åœ¨ macOS ä¸Šç¨å¾®éº»ç…©ï¼Œè©³ç´°å¯ä»¥åƒè€ƒé€™ç¯‡æ–‡ç« ã€‚\nQ2. ~paramiko/transport.py:236: CryptographyDeprecationWarning: Blowfish has been deprecated\nAns2. åœ¨æˆ‘å®‰è£éç¨‹ä¸­ï¼Œç™¼ç¾ä¸Šå‰å¹¾å¤©æ‰å‡ºç¾é€™å€‹ Bug è©³ç´°æƒ…å½¢å¯ä»¥åƒè€ƒ GitHub issuesï¼Œç›®å‰è§£æ±ºè¾¦æ³•æœ‰é™æ¿æˆ–æ˜¯å…ˆå°‡éŒ¯èª¤è¨Šæ¯çµ¦è¨»è§£æ‰ï¼Œä¹‹å¾Œå†ç­‰æ–°çš„ç‰ˆæœ¬å‡ºä¾†å†æ›´æ–°ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œé¸æ“‡ï¼Œæˆ‘é€™é‚Šæ˜¯ç›´æ¥æŠŠå‡ºç¾å•é¡Œçš„ transport.py å…§å®¹è¨»è§£æ‰ï¼Œå¤§æ¦‚ä½æ–¼ 236 è¡Œï¼Œå¯ä»¥çœ‹ä¸‹æ–¹åœ–ç‰‡ã€‚\nCryptographyDeprecationWarning éŒ¯èª¤è¨Šæ¯ä¿®æ­£","ansible-æ˜¯å¦‚ä½•é‹ä½œçš„#Ansible æ˜¯å¦‚ä½•é‹ä½œçš„ï¼Ÿ":"åœ¨ Ansible ä¸–ç•Œè£¡ï¼Œæˆ‘å€‘æœƒé€é Inventory æª”æ¡ˆ ä¾†å®šç¾©æœ‰å“ªäº›çš„ Managed Nodeï¼Œä¸¦è—‰ç”± SSH èˆ‡ Python ä¾†é€²è¡Œæºé€šã€‚é‚£æˆ‘å€‘å…ˆä¾†çœ‹ä¸€å¼µåœ–ï¼š\nAnsible é‹ä½œåŸç† (åœ–ç‰‡ä¾†æºï¼šä¸ƒåˆ†é˜æŒæ¡ Ansible æ ¸å¿ƒè§€å¿µ)\nèª’ ğŸ˜± çªç„¶å¤šäº†å¾ˆå¤šæ–°åè©ï¼Œæ²’é—œä¿‚æˆ‘ä¾†ä¸€ä¸€è§£é‡‹ï¼Œé¦–å…ˆæˆ‘å€‘å…ˆå¾ Managed Node æ˜¯ä»€éº¼ï¼Œä»¥åŠåœ–ç‰‡ä¸­çš„ Control machine é–‹å§‹èªªèµ·å§ï¼\nä»€éº¼æ˜¯æ§åˆ¶ä¸»æ©ŸåŠè¢«æ§ç¯€é»ï¼Ÿ åœ¨ Ansible è£¡ï¼Œæˆ‘å€‘æœƒæŠŠæ‰€æœ‰æ©Ÿå™¨çš„è§’è‰²åšä»¥ä¸‹çš„å€åˆ†ï¼š\næ§åˆ¶ä¸»æ©Ÿ (Control Machine)ï¼šé¡§åæ€ç¾©ï¼Œé€™é¡ä¸»æ©Ÿå¯ä»¥é€éé‹è¡Œ Ansible çš„åŠ‡æœ¬ (Playbooks) å°è¢«æ§ç¯€é»é€²è¡Œéƒ¨ç½²ã€‚ è¢«æ§ç¯€é» (Managed Node)ï¼šä¹Ÿç¨±ç‚ºé™æ§ç¯€é» (Remote Node)ã€‚ç›¸å°æ–¼æ§åˆ¶ä¸»æ©Ÿï¼Œé€™é¡ç¯€é»å°±æ˜¯æˆ‘å€‘é€é Ansible é€²è¡Œéƒ¨ç½²çš„å°è±¡ã€‚ æ‰€ä»¥ä»£è¡¨æˆ‘å€‘åœ¨æ“ä½œé€™é‚Šå°±æ˜¯ Control Machineï¼Œè¦éƒ¨ç½²çš„æ©Ÿå™¨å°±æ˜¯ Managed Nodeï¼Œé€é SSH ä¾†åšé€£ç·šã€‚ä½†ä»€éº½æ˜¯ Inventory è·Ÿ Playbooks å‘¢ï¼Ÿ\nä»€éº¼æ˜¯ Ansible Inventory Inventory é€™å€‹å–®å­—æœ¬èº«æœ‰è©³ç´°ç›®éŒ„ã€æ¸…å–®å’Œåˆ—è¡¨çš„æ„æ€ã€‚åœ¨é€™è£¡æˆ‘å€‘å¯ä»¥æŠŠå®ƒç†è§£æˆä¸€ä»½ä¸»æ©Ÿåˆ—è¡¨ï¼Œå¯ä»¥é€éå®ƒä¾†å®šç¾©æ¯å€‹ Managed Node çš„ä»£è™Ÿã€IP ä½å€ã€é€£ç·šè¨­å®šå’Œç¾¤çµ„ã€‚\n$ vim hosts # ansible_ssh_hostï¼šé ç«¯ SSH ä¸»æ©Ÿä½å€ # ansible_ssh_portï¼šé ç«¯ SSH Port # ansible_ssh_userï¼šé ç«¯ SSH ä½¿ç”¨è€…åç¨± # ansible_ssh_private_key_fileï¼šæœ¬æ©Ÿ SSH ç§é‘°æª”æ¡ˆè·¯å¾‘ # ansible_ssh_passï¼šé ç«¯ SSH å¯†ç¢¼ (å»ºè­°ä½¿ç”¨ç§é‘°) [local] server1 ansible_ssh_host=127.0.0.1 ansible_ssh_port=55000 ansible_ssh_pass=docker æ‰€ä»¥æˆ‘å€‘å¯ä»¥åœ¨é€™é‚Šè¼¸å…¥å¾ˆå¤šå€‹ä¸»æ©Ÿä¾†åšç®¡ç†ï¼Œå¯ä»¥æŠŠå®ƒæƒ³æˆä¸€å€‹è¨­å®šæª”ã€‚\nä»€éº¼æ˜¯ Ansible Playbooks å†è«‡ Ansible Playbooks ä¹‹å‰ï¼Œå…ˆèªªæ˜æˆ‘å€‘è¦æ€éº¼å»æ“ä½œ Ansibleï¼Ÿä¸€èˆ¬ä¾†èªªï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨ Ad-Hoc Commands å’Œ Playbooks å…©ç¨®æ–¹å¼ä¾†æ“ä½œ Ansibleã€‚\nAd-Hoc Commands æ˜¯ä»€éº¼ï¼Ÿ Ad hoc å¯ä»¥ç¿»è­¯æˆç°¡çŸ­åœ°æŒ‡ä»¤ï¼Œä¹Ÿå°±æ˜¯æˆ‘å€‘å¸¸ç”¨çš„æŒ‡ä»¤æ¨¡å¼ï¼Œæœ€å¸¸è¦‹çš„ pingå’Œecho ç‚ºä¾‹ã€‚\nping $ ansible all -m ping server1 | SUCCESS =\u003e { \"ansible_facts\": { \"discovered_interpreter_python\": \"/usr/bin/python\" }, \"changed\": false, \"ping\": \"pong\" } echo $ ansible all -m command -a \"echo Hello World\" server1 | CHANGED | rc=0 \u003e\u003e Hello World å¾ä¸Šé¢çš„ä¾‹å­ä¸­å¯ä»¥çœ‹åˆ° Ad-Hoc Commands ä¸€æ¬¡åªèƒ½è™•ç†ä¸€ä»¶äº‹æƒ…ï¼Œé€™æ˜¯å®ƒèˆ‡ Playbooks æœ€å¤§çš„å·®ç•°ã€‚\nPlaybooks æ˜¯ä»€éº¼ï¼Ÿ Playbooks å°±æ˜¯å­—é¢ä¸Šçš„æ„æ€ç‚ºåŠ‡æœ¬ï¼Œæˆ‘å€‘å¯ä»¥å…ˆé€éå¯«å¥½çš„åŠ‡æœ¬ (Playbooks) ä¾†è®“å„å€‹ Managed Node é€²è¡ŒæŒ‡å®šçš„å‹•ä½œ (Plays) å’Œä»»å‹™ (Tasks)ã€‚\nç°¡è€Œè¨€ä¹‹ï¼ŒPlaybooks å°±æ˜¯ Ansible çš„è…³æœ¬ (Script)ï¼Œè€Œä¸”æ¯”å‚³çµ± Shell Script é‚„è¦å¼·å¤§å¥½å¹¾ç™¾å€çš„è…³æœ¬ï¼æ­¤å¤–å®ƒæ˜¯ä½¿ç”¨ YAML æ ¼å¼ï¼Œå¯« Code å°±å¦‚åŒå¯«æ–‡ä»¶ä¸€æ¨£ï¼Œç°¡å–®æ˜“è®€ã€‚\næœ‰é—œè©³ç´°çš„å‹•ä½œ (Plays) å’Œä»»å‹™ (Tasks)ï¼Œç­‰æˆ‘å€‘å¯¦éš›å®‰è£å¥½å†ä¾†èªªæ˜ ğŸ˜†","ansible-ç™¼é€é€šçŸ¥åˆ°-telegram-bot#Ansible ç™¼é€é€šçŸ¥åˆ° Telegram Bot":"å‰›å‰›çœ‹äº†å¾ˆå¤šå…§å»ºçš„æ¨¡çµ„ï¼Œç•¶ç„¶ Ansible é‚„æœ‰å¾ˆå¤šå¥½ç©çš„æ¨¡çµ„å¯ä»¥ä½¿ç”¨ï¼Œæˆ‘å€‘å°±è·Ÿ ä½¿ç”¨ Jenkins è¨­å®š GitHub è§¸ç™¼ç¨‹åºä¸¦é€šçŸ¥ Telegram Bot æ–‡ç«  ä¸€æ¨£ï¼Œå°‡æˆ‘å€‘å–å¾—çš„å…§å®¹å‚³é€åˆ° Telegram Bot å§ï¼é‚£é¦–å…ˆæˆ‘å€‘è¦å…ˆå‰µé€ ä¸€å€‹ Telegram Botï¼Œåœ¨ Telegram æ‰¾åˆ°ä¸€å€‹æ©Ÿå™¨äººå« BotFather çš„å®˜æ–¹æ©Ÿå™¨äººå¸³è™Ÿã€‚ä¸¦ä½¿ç”¨æŒ‡ä»¤ /newbotï¼Œæœƒçœ‹åˆ°ä¸€ä¸‹ç•«é¢ï¼š\nTelegram å‰µå»ºæ©Ÿå™¨äºº\nä»–è©¢å•ä½ è¦å¹«æ©Ÿå™¨äººå–å«ä»€éº¼åç¨±ï¼Œå¯ä»¥ç›´æ¥åœ¨è¼¸å…¥æ¬„ä½è¼¸å…¥æƒ³è¦å–çš„åç¨±ï¼Œç•¶ç„¶ä¸èƒ½æ˜¯åˆ¥äººå·²ç¶“å–éçš„ï¼š\nTelegram å‰µå»ºæ©Ÿå™¨äºº\nçœ‹åˆ°å®ƒå›è¦†ä½  Done! ä»£è¡¨æˆåŠŸäº†ï¼Œæ¥ä¸‹ä¾†ä½ æœƒæ‹¿åˆ°ä¸€çµ„ API Tokenï¼Œåƒæˆ‘çš„æ˜¯ 5335968936:AAEDO_Tudhy0t577jtbF9TpgrzqOsL99h9c (å·²æ›´æ›ï¼Œå¤§å®¶æ”¾å¿ƒ ğŸ˜‚ )ï¼Œæ¥ä¸‹ä¾†é–‹å•Ÿç€è¦½å™¨è¼¸å…¥ä»¥ä¸‹ç¶²å€ https://api.telegram.org/bot{API Token}/getupdatesï¼Œå…¶ä¸­çš„ {API Token} è«‹å¸¶å…¥è‡ªå·±çš„ Tokenï¼Œç›´åˆ°å‡ºç¾ {\"ok\":true,\"result\":[]} ä»£è¡¨å®Œæˆã€‚\næ¥ä¸‹ä¾†é–‹å•Ÿä½ è‡ªå·±çš„ Bot ï¼Œæ‰“ä¸Š /start æŒ‡ä»¤ï¼Œé‡æ–°æ•´ç†å‰›å‰›çš„ç¶²é å°±å¯ä»¥çœ‹åˆ°ä»¥ä¸‹é€™æ¨£çš„æ–‡å­—ï¼š\n{\"ok\":true,\"result\":[{\"update_id\":606594112,\"message\":{\"message_id\":1,\"from\":{\"id\":493995679,\"is_bot\":false,\"first_name\":\"\\u54c1\\u6bc5\",\"last_name\":\"Ian\",\"username\":\"pinyichuchu\",\"language_code\":\"zh-hans\"},\"chat\":{\"id\":493995679,\"first_name\":\"\\u54c1\\u6bc5\",\"last_name\":\"Ian\",\"username\":\"pinyichuchu\",\"type\":\"private\"},\"date\":1652695148,\"text\":\"/start\",\"entities\":[{\"offset\":0,\"length\":6,\"type\":\"bot_command\"}]}} é€™æ˜¯ä½ å‚³è¨Šæ¯çµ¦ Bot å®ƒæ‰€æ”¶åˆ°çš„ APIï¼Œè³‡æ–™å¾ˆå¤šæ²’é—œä¿‚ï¼Œæˆ‘å€‘æ‰¾åˆ° idï¼Œåƒæˆ‘çš„æ˜¯ 493995679ï¼Œé€™å€‹å°±æ˜¯æˆ‘è·Ÿæ©Ÿå™¨äººçš„èŠå¤©å®¤ï¼Œæˆ‘å€‘å°±å…ˆå›åˆ° Ansible é€™é‚Šå§ï¼\né–‹å•Ÿä¸€å€‹æ–°çš„æª”æ¡ˆå« send_notify_tg.yamlï¼Œæ‰“ä»¥ä¸‹å…§å®¹ï¼š\n--- - name: Send notify hosts: all tasks: - name: Send notify to Telegram community.general.telegram: token: \"9999999:XXXXXXXXXXXXXXXXXXXXXXX\" api_args: chat_id: 000000 parse_mode: \"markdown\" text: \"Your precious application has been deployed: https://example.com\" disable_web_page_preview: True disable_notification: True å¯ä»¥çœ‹åˆ°æˆ‘å€‘ä½¿ç”¨çš„æ¨¡çµ„ä¸æ˜¯ Ansible å…§å»ºçš„ï¼Œè€Œæ˜¯ç¤¾ç¾¤åˆ¥äººå¯«çš„ï¼Œè©³ç´°å¯ä»¥åƒè€ƒ community.general.telegram module â€“ module for sending notifications via telegramï¼š\nå…¶ä¸­ token å°±æ˜¯æˆ‘å€‘å‰›å‰›åœ¨ BotFather é‚£é‚Šæ‰€æ‹¿åˆ°çš„ Tokenï¼Œchat_id å°±æ˜¯æˆ‘å€‘å‰›å‰›åœ¨ç¶²é ä¸Šçœ‹åˆ°çš„ idï¼ŒæŠŠè³‡æ–™éƒ½è¼¸å…¥é€²å»å¾Œï¼Œæˆ‘å€‘å¯ä»¥ä¿®æ”¹ text å…§å®¹ï¼Œæ”¹æˆ â€œSend notify to Telegram æ¸¬è©¦å‚³é€é€šçŸ¥â€ï¼Œæ¥è‘—åŸ·è¡Œ ansible-ploybook send_notify_tg.yaml ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½æ­£å¸¸æ”¶åˆ°é€šçŸ¥ï¼\nç™¼é€é€šçŸ¥è‡³ Telegram Bot\né€™æ¨£å­å°±æˆåŠŸé€é Ansible Module å‚³é€é€šçŸ¥çµ¦ Telegram å›‰ï¼\næˆ‘å€‘å¯èƒ½éœ€è¦å°‡æ©Ÿå™¨äººåŠ å…¥ç¾¤çµ„å…§ï¼Œé€™æ™‚å€™éœ€è¦æ›´æ›ä¸€ä¸‹ chat_idï¼Œå…ˆå°‡æ©Ÿå™¨äººåŠ å…¥ç¾¤çµ„ï¼Œå†æ¬¡åˆ°å‰›å‰›ç€è¦½å™¨çš„ç¶²é åˆ·æ–°ï¼ŒæŸ¥çœ‹ chat å¾Œé¢çš„ id å¸¶æœ‰ -ï¼Œåƒæ˜¯ -540226836 é€™æ¨£ï¼Œé€™å€‹å°±æ˜¯è©²ç¾¤çµ„çš„ IDï¼Œå°‡ send_notify_tg.yaml çš„ chat_id ä¿®æ”¹æˆ -540226836 åœ¨æ¸¬è©¦çœ‹çœ‹ï¼Œä»–å°±æœƒåœ¨ç¾¤çµ„ä¸­ç™¼é€é€šçŸ¥å›‰ï¼\n{\"update_id\":606594124,\"message\":{\"message_id\":14,\"from\":{\"id\":493995679,\"is_bot\":false,\"first_name\":\"\\u54c1\\u6bc5\",\"last_name\":\"Ian\",\"username\":\"pinyichuchu\",\"language_code\":\"zh-hans\"},\"chat\":{\"id\":-540226836,\"title\":\"\\u54c1\\u6bc5 \u0026 AnsibleSendMessageBot\",\"type\":\"group\",\"all_members_are_administrators\":true},\"date\":1652696181,\"group_chat_created\":true}} ç™¼é€é€šçŸ¥è‡³ Telegram ç¾¤çµ„ Bot","ä½¿ç”¨-ansible-çš„-template-ç³»çµ±#ä½¿ç”¨ Ansible çš„ Template ç³»çµ±":"Template module æ˜¯å¸¸ä½¿ç”¨çš„æª”æ¡ˆæ¨¡çµ„ä¹‹ä¸€ï¼Œæˆ‘å€‘åœ¨ å¸¸ç”¨çš„ Ansible Module æœ‰å“ªäº›ï¼Ÿ æ–‡ç« ä¸­æœ‰æåˆ°ï¼Œå¯ä»¥ç”¨å®ƒå’Œè®Šæ•¸ (Variables) ä¾†æ“ä½œæª”æ¡ˆã€‚\næˆ‘å€‘åªéœ€è¦äº‹å…ˆå®šç¾©è®Šæ•¸å’Œæ¨¡æ¿ (Templates)ï¼Œå³å¯ç”¨å®ƒå‹•æ…‹ç”¢ç”Ÿé ç«¯çš„ Shell Scriptã€è¨­å®šæª” (Configure)ç­‰ã€‚æ›å¥è©±èªªï¼Œæˆ‘å€‘å¯ä»¥ç”¨ä¸€ä»½ template ä¾†é–‹ç™¼ (Development)ã€æ¸¬è©¦ (Test)ã€æ­£å¼ç’°å¢ƒ (Production) ç­‰ä¸åŒç’°å¢ƒè¨­å®šã€‚\nèˆ‰ä¾‹èªªæ˜ï¼š\nå»ºç«‹ template æª”æ¡ˆ $ vim hello_world.txt.j2 Hello \"{{ dynamic_word }}\" ç”±æ–¼ Ansible æ˜¯å°±ç”± Jinja2 ä¾†å¯¦ä½œ template ç³»çµ±ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ *.j2 çš„å‰¯æª”åã€‚ ä¸Šé¢çš„ \"{{ dynamic_word }}\"\" ä»£è¡¨æˆ‘å€‘åœ¨ template è£¡ä½¿ç”¨äº†åç‚º dynameic_word çš„è®Šæ•¸ã€‚ å»ºç«‹ playbookï¼Œä¸¦åŠ å…¥è®Šæ•¸ vim template_demo.yaml --- - name: Play the template module hosts: localhost vars: dynamic_word: \"World\" tasks: - name: generation the hello_world.txt file ansible.builtin.template: src: hello_world.txt.j2 dest: /tmp/hello_world.txt - name: show file context command: cat /tmp/hello_world.txt register: result - name: print stdout debug: msg: \"{{ result.stdout_lines }}\" åœ¨ç¬¬ 5 è¡Œï¼Œæˆ‘å€‘å¹« dynamic_word è®Šæ•¸è¨­äº†ä¸€å€‹é è¨­å€¼ Worldã€‚ åœ¨ 8 è¡Œçš„ç¬¬ 1 å€‹ task è£¡ï¼Œæˆ‘å€‘ä½¿ç”¨ template moduleï¼Œä¸¦æŒ‡å®šäº†æª”æ¡ˆçš„ä¾†æº (src) å’Œç›®çš„åœ° (dest)ã€‚ ä¹‹å¾Œçš„ 2 å€‹ task å‰‡æ˜¯æŠŠ template module ç”¢ç”Ÿçš„æª”æ¡ˆçµ¦å°å‡ºä¾†ã€‚ ç›´æ¥ä½¿ç”¨ ansible-playbook template_demo.yaml åŸ·è¡Œ Playbookã€‚ Template Module ç¯„ä¾‹\nä¹Ÿå¯ä»¥é€é -e åƒæ•¸å°‡ dynamic_word è¦†å¯«æˆ â€œansibleâ€\n$ ansible-playbook template_demo.yaml -e \"dynamic_word=ansible\" Template Module ä½¿ç”¨ -e è¦†å¯«åƒæ•¸\nå¦‚ä½•åˆ‡æ›ä¸åŒç’°å¢ƒ é™¤äº†æˆ‘å€‘å‰›å‰›ç”¨ vars ä¾†å®£å‘Šè®Šä»¥å¤–ï¼Œé‚„å¯ä»¥ä½¿ç”¨ vars_files ä¾† include å…¶ä»–çš„è®Šæ•¸æª”ï¼š$ vim template_demo2.yaml --- - name: Play the template module hosts: localhost vars: env: \"development\" vars_files: - vars/{{ env }}.yml tasks: - name: generation the hello_world.txt file ansible.builtin.template: src: hello_world.txt.j2 dest: /tmp/hello_world.txt - name: show file context command: cat /tmp/hello_world.txt register: result - name: print stdout debug: msg: \"{{ result.stdout_lines }}\" å¯ä»¥çœ‹åˆ°ä¸Šé¢ä¾‹å­ä¸­ç¬¬ 7 è¡Œï¼Œå°±æ˜¯æˆ‘å€‘ä½¿ç”¨ vars_files ä¾† include å…¶ä»–çš„è®Šæ•¸æª”ã€‚\nå»ºç«‹ vars/development.yamlã€vars/test.yamlã€vars/production.yaml æª”æ¡ˆï¼Œæ¥ä¸‹ä¾†å°‡ä¾ä¸åŒå¾—ç’°å¢ƒ include ä¸åŒçš„æª”æ¡ˆè®Šæ•¸æª”æ¡ˆ (vars files)ï¼Œé€™æ¨£å°±å¯ä»¥ç”¨ä¸€ä»½ Playbook åˆ‡æ›ç’°å¢ƒäº†ï¼ Development $ vim vars/development.yaml dynamic_word: \"development\" Test $ vim vars/test.yaml dynamic_word: \"test\" Production $ vim vars/production.yaml dynamic_word: \"production\" åŸ·è¡Œ ansible-playbook template_demo2.yaml -e \"dynamic_word=Test\"ï¼Œä¸¦æœ‰ -e å»ä¿®æ”¹å„å€‹ç’°å¢ƒã€‚ Template Module ç¯„ä¾‹\nTemplate ç³»çµ±æ˜¯å¯¦å‹™ä¸Šå¾ˆå¸¸è¦‹çš„æ‰‹æ³•ä¹‹ä¸€ï¼Œè—‰ç”±å®ƒæˆ‘å€‘å¯ä»¥å¾ˆè¼•é¬†åœ°è®“é–‹ç™¼ã€æ¸¬è©¦ã€æ­£å¼ç’°å¢ƒç„¡ç¸«æ¥è»Œã€‚ä½†è‹¥æ˜¯åœ¨å¤§å‹çš„ Playbook è£¡åˆ‡æ›ç’°å¢ƒï¼Œå»ºè­°ä½¿ç”¨è¼ƒç‚ºé€²éšçš„ group_vars è·Ÿ host_varsã€‚","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"ç¾ä»£ IT äººä¸€å®šè¦çŸ¥é“çš„ Ansible è‡ªå‹•åŒ–çµ„æ…‹æŠ€å·§ï¼šhttps://chusiang.gitbooks.io/automate-with-ansible/content/\nAnsible å®‰è£ï¼šhttps://tso-liang-wu.gitbook.io/learn-ansible-and-jenkins-in-30-days/ansible/ansible/ansible-installation\næ€éº¼ç”¨ Docker ç·´ç¿’ Ansibleï¼Ÿï¼šhttps://chusiang.gitbooks.io/automate-with-ansible/content/05.how-to-practive-the-ansible-with-docker.html\ncommunity.general.telegram module â€“ module for sending notifications via telegramï¼šhttps://docs.ansible.com/ansible/latest/collections/community/general/telegram_module.html#ansible-collections-community-general-telegram-module","å–å¾—-managed-node-çš„-facts#å–å¾— Managed node çš„ facts":"é‚„è¨˜å¾—æˆ‘å€‘åœ¨åŸ·è¡Œä»»å‹™ (Tasks) æ™‚ï¼Œæ˜æ˜åªæœ‰å…©å€‹ï¼Œä½†æœ€å¾Œçµæœé¡¯ç¤ºä¸‰å€‹å—ï¼Ÿæ˜¯å› ç‚ºåœ¨ä½¿ç”¨ Playbooks æ™‚ï¼ŒAnsible æœƒè‡ªå‹•åŸ·è¡Œ Setup module ä»¥è’é›†å„å€‹ Managed node çš„ factsã€‚ é€™å€‹ facts å°±å¥½æ¯”æ˜¯ç³»çµ±è®Šæ•¸ä¸€æ¨£ï¼Œå¾ IP ä½å€ã€ä½œæ¥­ç³»çµ±ã€CPU ç­‰è³‡è¨Šæ‡‰æœ‰ç›¡æœ‰ã€‚\nAd-Hoc Commands é€šå¸¸æˆ‘å€‘éƒ½æœƒå…ˆä½¿ç”¨ Ad-Hoc Commands ä¾†å‘¼å« setup çœ‹çœ‹æœ‰å“ªäº›å¯ç”¨çš„è³‡è¨Šï¼Œé€™å°æ–¼æˆ‘å€‘ç¨å¾Œæ’°å¯«è¼ƒç‚ºè¤‡é›œçš„ Playbooks æœƒå¾ˆæœ‰å¹«åŠ©ã€‚\nå¯ä»¥è—‰ç”± less å¿«é€Ÿæœå°‹æ‰€æœ‰çš„è®Šæ•¸ $ ansible all -m setup | less server1 | SUCCESS =\u003e { \"ansible_facts\": { \"ansible_apparmor\": { \"status\": \"disabled\" }, \"ansible_architecture\": \"x86_64\", \"ansible_bios_date\": \"03/14/2014\", \"ansible_bios_vendor\": \"BHYVE\", \"ansible_bios_version\": \"1.00\", \"ansible_board_asset_tag\": \"NA\", \"ansible_board_name\": \"NA\", \"ansible_board_serial\": \"NA\", \"ansible_board_vendor\": \"NA\", \"ansible_board_version\": \"NA\", æ­é… filter å°‡ç™¼è¡Œç‰ˆæœ¬ (distribution) è³‡è¨Šçµ¦éæ¿¾å‡ºä¾† $ ansible all -m setup -a \"filter=ansible_distribution*\" server1 | SUCCESS =\u003e { \"ansible_facts\": { \"ansible_distribution\": \"Ubuntu\", \"ansible_distribution_file_parsed\": true, \"ansible_distribution_file_path\": \"/etc/os-release\", \"ansible_distribution_file_variety\": \"Debian\", \"ansible_distribution_major_version\": \"22\", \"ansible_distribution_release\": \"kinetic\", \"ansible_distribution_version\": \"22.10\", \"discovered_interpreter_python\": \"/usr/bin/python3\" }, \"changed\": false } å–å¾—å¥—ä»¶ç®¡ç†å“¡çš„ç¨®é¡è³‡è¨Šï¼Œä¾‹å­ä¸­å–å¾—çš„å€¼æ˜¯ apt $ ansible all -m setup -a \"filter=ansible_pkg_mgr\" server1 | SUCCESS =\u003e { \"ansible_facts\": { \"ansible_pkg_mgr\": \"apt\", \"discovered_interpreter_python\": \"/usr/bin/python3\" }, \"changed\": false } è½‰å¯« Playbooks æˆ‘ä¾†å‡ºå€‹é¡Œç›®ï¼Œæˆ‘æƒ³è¦çŸ¥é“ Ansible æ‰€ä½¿ç”¨çš„å…¬é‘°ï¼Œä¸¦é€é Telegram Bot ç™¼é€åˆ°ç¾¤çµ„ï¼Œè¦æ€éº¼åšå‘¢ï¼ï¼Ÿ\né¦–å…ˆè¦åˆ©ç”¨å‰›å‰›çš„ Ad-Hoc Commands filterï¼Œæ‰¾åˆ°å…¬é‘°ï¼Œå†å°‡å…¬é‘°é€é Telegram Bot å‚³é€ï¼Œæ‰€ä»¥æˆ‘å€‘æœƒæœ‰å…©å€‹ Tasksï¼Œé‚£æˆ‘å€‘é–‹å§‹å¯¦ä½œå›‰ ğŸ¤“\n1.æ‰¾åˆ°å…¬é‘°\n--- - name: Filter rsa_public \u0026 Send notify hosts: all tasks: - name: Filter setup rsa_public key ansible.builtin.setup: filter: - \"ansible_ssh_host_key_rsa_public\" register: result å¯ä»¥çœ‹åˆ°æˆ‘å€‘å°‡ filter setup å¾ Ad-Hoc è½‰æˆ Playbooksï¼Œä¸¦ä½¿ç”¨ result ä¾†å­˜åœ¨æ‰¾åˆ°çš„å…¬é‘°ã€‚\nç™¼é€é€šçŸ¥è‡³ Telegram Bot - name: Send notify to Telegram community.general.telegram: token: \"5335968936:AAFhxxMRJy-rucGKgSE80Xss7qPq2iOHWlc\" api_args: chat_id: -540226836 parse_mode: \"markdown\" text: \"{{ result }}\" disable_web_page_preview: True disable_notification: True è€æ¨£å­ï¼Œæˆ‘å€‘å°±ä½¿ç”¨ä¸Šæ¬¡ send_notify_tg.yaml å…§çš„ Send notify to Telegram ä»»å‹™ä¾†å‚³é€é€šçŸ¥ã€‚\nåŸ·è¡Œå¾Œï¼Œçœ‹çœ‹ç¾¤çµ„æ˜¯å¦æœ‰æ”¶åˆ°æˆ‘å€‘æ‰¾åˆ°çš„ ansible_ssh_host_key_rsa_public é€šçŸ¥ã€‚\nç™¼é€é€šçŸ¥è‡³ Telegram ç¾¤çµ„ Bot","åœ¨-playbooks-ä½¿ç”¨-handlers#åœ¨ Playbooks ä½¿ç”¨ Handlers":"Handlers æ˜¯æˆ‘å€‘åœ¨ Ansible Playbooks è£¡å¾ˆå¸¸ç”¨ä¾†é‡é–‹ç³»çµ±æœå‹™ (Service) çš„æ‰‹æ³•ï¼Œæˆ‘å€‘é€™é‚Šé€éå®‰è£ Nginx ä¾†ä»‹ç´¹å®ƒã€‚\né‚£ä»€éº¼æ˜¯ Handlers å‘¢ï¼ŸHandler æœ¬èº«æ˜¯ä¸€ç¨®éåŒæ­¥çš„ callback function ; åœ¨é€™è£¡å‰‡æ˜¯æŒ‡é—œè¯æ–¼ç‰¹å®š tasks çš„äº‹ä»¶ (event) è§¸ç™¼æ©Ÿåˆ¶ã€‚ç•¶é€™äº›ç‰¹å®šçš„ tasks ç‹€æ…‹ç‚º è¢«æ”¹è®Š (changed) ä¸”éƒ½å·²è¢«åŸ·è¡Œï¼Œæ‰æœƒè§¸ç™¼ä¸€æ¬¡çš„ eventã€‚\næˆ‘å€‘å»ºç«‹ setup_nginx.yaml --- - name: setup the nginx hosts: all become: true vars: username: \"PinYi\" mail: \"880831ian@gmail.com\" blog: \"https://pin-yi.me\" tasks: # åŸ·è¡Œ 'apt-get update' æŒ‡ä»¤ã€‚ - name: update apt repo cache apt: name=nginx update_cache=yes # åŸ·è¡Œ 'apt-get install nginx' æŒ‡ä»¤ã€‚ - name: install nginx with apt apt: name=nginx state=present # æ–¼ç¶²é æ ¹ç›®éŒ„ (DocumentRoot) ç·¨è¼¯ index.htmlã€‚ - name: modify index.html ansible.builtin.template: src=templates/index.html.j2 dest=/var/www/html/index.html owner=www-data group=www-data mode=\"644\" backup=yes notify: restart nginx # handlers # # * ç•¶ç¢ºèªäº‹ä»¶æœ‰è¢«è§¸ç™¼æ‰æœƒå‹•ä½œã€‚ # * ä¸€å€‹ handler å¯è¢«å¤šå€‹ task é€šçŸ¥ (notify)ï¼Œä¸¦æ–¼ tasks è·‘å®Œæ‰æœƒåŸ·è¡Œã€‚ handlers: # åŸ·è¡Œ 'sudo service nginx restart' æŒ‡ä»¤ã€‚ - name: restart nginx service: name=nginx enabled=yes state=restarted # post_tasks: # # åœ¨ tasks ä¹‹å¾ŒåŸ·è¡Œçš„ tasksã€‚ post_tasks: # æª¢æŸ¥ç¶²é å…§å®¹ã€‚ - name: review http state command: \"curl -s http://localhost\" register: web_context # å°å‡ºæª¢æŸ¥çµæœã€‚ - name: print http state debug: msg={{ web_context.stdout_lines }} ä¾†èªªæ˜ä¸€ä¸‹ä¸Šé¢é€™å€‹ yaml æª”æ¡ˆï¼š\né¦–å…ˆæˆ‘å€‘æƒ³è¦å®‰è£ Nginxï¼Œæˆ‘å€‘çµ¦äº†ä¸‰å€‹åƒæ•¸ï¼Œåˆ†åˆ¥æ˜¯ usernameã€mailã€blogï¼Œç­‰ç­‰æœƒå¸¶å…¥æˆ‘å€‘çš„ templateã€‚ æˆ‘å€‘ä¸€é–‹å§‹æœ‰ 3 å€‹ taskï¼Œåˆ†åˆ¥ä»£è¡¨åŸ·è¡Œæ›´æ–°ã€å®‰è£ã€ç·¨è¼¯ index.html æª”æ¡ˆã€‚ ä»¥åŠ 1 å€‹ handlers ä»–æœƒç­‰ modify index.html æœ‰æ”¹è®Šä¸”åŸ·è¡Œå¾Œæ‰æœƒå‹•ä½œã€‚ æœ€å¾Œæ˜¯ post_tasks ä»–æ˜¯ç­‰ tasks ä¹‹å¾ŒåŸ·è¡Œçš„ tasksã€‚ æ¥ä¸‹å»ºç«‹ Nginx html çš„ templateï¼švim templates/index.html.j2 _____________________________________ / This is a ansible-playbook demo for \\ \\ automate-with-ansible at 2022/05/17./ ------------------------------------- \\ ^__^ \\ (oo)\\_______ (__)\\ )\\/\\ ||----w | || || [ {{ username }}@automate-with-ansible ~ ]$ [ {{ username }}@automate-with-ansible ~ ]$ [ {{ username }}@automate-with-ansible ~ ]$ cat .profile - {{ mail }} - {{ blog }} åŸ·è¡Œ Playbook å¯ä»¥çœ‹åˆ°å› ç‚ºæˆ‘å€‘ modify index.html æ²’æœ‰è¢«æ”¹è®Šï¼Œnotify æ²’æœ‰é€šçŸ¥ handlersï¼Œæ‰€ä»¥ä»–ä¸æœƒåŸ·è¡Œ handlers è©²æ®µç¨‹å¼ã€‚(æ­£å¸¸ä¾†èªªï¼Œä¿®æ”¹ html ä¸éœ€è¦é‡å•Ÿï¼Œæ­¤ç‚ºç¯„ä¾‹ ğŸ¤£ )\nHandlers ç¯„ä¾‹\né‚£æˆ‘å€‘ä¿®æ”¹ä¸€ä¸‹ index.html ä¾†æ¸¬è©¦ä¸€ä¸‹æœƒä¸æœƒæŠŠ index.html çš„ç‹€æ…‹è¢«æ”¹è®Šï¼Œè€Œè®“ handlers åŸ·è¡Œå‘¢ï¼æˆ‘å€‘éš¨æ„ä¿®æ”¹ index.html å…§å®¹ï¼Œä¿®æ”¹æ—¥æœŸæ”¹æˆ 05/17ï¼š Handlers ç¯„ä¾‹\nå¯ä»¥çœ‹åˆ°æˆ‘å€‘çš„ modify index.html è¢«æ”¹è®Šäº†ï¼Œæ‰€ä»¥ notify é€šçŸ¥ handlers åŸ·è¡Œé‡æ–°å•Ÿå‹•ã€‚","åœ¨-playbooks-ä½¿ç”¨-loops#åœ¨ Playbooks ä½¿ç”¨ loops":"åœ¨ Shell Script ä¸­ï¼Œæˆ‘å€‘æœƒä½¿ç”¨ for å’Œ while ç­‰è¿´åœˆ (loop) ä¾†ç°¡åŒ–é‡è¤‡çš„ç¨‹å¼ç¢¼ï¼Œè€Œåœ¨ Ansible æˆ‘å€‘ä¹Ÿå¯ä»¥ä½¿ç”¨ loop ä¾†ç°¡åŒ–é‡è¤‡çš„ä»»å‹™ (Tasks)ã€‚\næ¨™æº–è¿´åœˆ é¦–å…ˆæˆ‘å€‘å…ˆä»¥ç°¡å–®çš„æ–¹å¼é‡è¤‡å°å‡ºä¸‰ç­†è³‡æ–™ã€‚\nShell Script å»ºç«‹ for loop çš„ Script $ vim bash_loop.sh #!/bin/bash for x in 0 1 2; do echo Loop $x done åœ¨ç¬¬ 4 è¡Œï¼Œæˆ‘å€‘ç”¨ forï¼Œä¸¦ \b ä»£å…¥ 0,1,2 ä¸‰å€‹å€¼åˆ° $x è®Šæ•¸ åœ¨ç¬¬ 5 è¡Œï¼Œå‰‡ç”¨äº† echoï¼Œå°å‡ºè¨Šæ¯å’Œ $x è®Šæ•¸ åŸ·è¡Œ Scriptï¼šå¯ä»¥çœ‹åˆ°åº•ä¸‹è·‘äº† 3 æ¬¡çš„ loop $ chmod a+x bash_loop.sh $ ./bash_loop.sh Loop 0 Loop 1 Loop 2 Ansible Playbooks æˆ‘å€‘éœ€è¦é€é item å’Œ with_items ä¾†ä½¿ç”¨ Ansible çš„ loopï¼Œå…¶ item ç‚ºé è¨­åã€‚åœ¨ Ansible 2.5 ä¸­æ·»åŠ äº† loopï¼Œæ‰€ä»¥æˆ‘å€‘å¾ŒçºŒå…©è€…éƒ½æœƒæåˆ° (ç›®å‰å…©è€…éƒ½å¯ä»¥ä½¿ç”¨ï¼)\nå»ºç«‹ loop çš„ playbook vim playbook_with_items.yaml --- - name: a basic loop with playbook hosts: localhost tasks: - name: print loop message ansible.builtin.debug: msg: \"Loop {{ item }}\" with_items: - 0 - 1 - 2 åœ¨ç¬¬ 6ã€7 è¡Œè£¡ï¼Œæˆ‘å€‘ç”¨ debug module ä¾†å°å‡ºè¨Šæ¯ï¼Œä¸¦å®šç¾© item åœ¨ç¬¬ 8 ~ 11 è¡Œï¼Œå‰‡ç”¨äº† with_item å°‡ 0,1,2 çš„å€¼å‚³å…¥ item åŸ·è¡Œ ansible-playbook playbook_with_items.yaml å¾Œæœƒå¾—åˆ°ï¼š TASK [print loop message] ************************************************************************************************************* ok: [server1] =\u003e (item=0) =\u003e { \"msg\": \"Loop 0\" } ok: [server1] =\u003e (item=1) =\u003e { \"msg\": \"Loop 1\" } ok: [server1] =\u003e (item=2) =\u003e { \"msg\": \"Loop 2\" } å¦ä¸€ç¨® åœ¨ Ansible æ–°å¢çš„ loop\nå»ºç«‹ loop çš„ playbook vim playbook_loop.yaml --- - name: a basic loop with playbook hosts: all tasks: - name: print loop message ansible.builtin.debug: msg: \"{{ item }} {{ my_idx }}\" loop: - Loop - Loop - Loop loop_control: index_var: my_idx åŸ·è¡Œ ansible-playbook playbook_loop.yaml å¾Œæœƒå¾—åˆ°ï¼š TASK [print loop message] ************************************************************************************************************* ok: [server1] =\u003e (item=0) =\u003e { \"msg\": \"Loop 0\" } ok: [server1] =\u003e (item=1) =\u003e { \"msg\": \"Loop 1\" } ok: [server1] =\u003e (item=2) =\u003e { \"msg\": \"Loop 2\" } æœƒä½¿ç”¨ Loop å°±å¯ä»¥æ¸›å°‘æˆ‘å€‘åœ¨å¯«é‡è¤‡çš„ç¨‹å¼ç¢¼ï¼Œç•¶ç„¶ä¸Šé¢çš„åªæ˜¯ç°¡å–®çš„ç¯„ä¾‹ï¼Œè©³ç´°è«‹åƒè€ƒ Loops - Ansible Documentationã€‚","å¸¸ç”¨çš„-ansible-module-æœ‰å“ªäº›#å¸¸ç”¨çš„ Ansible Module æœ‰å“ªäº›ï¼Ÿ":"æ¥ä¸‹ä¾†ç°¡å–®ä»‹ç´¹ä¸€ä¸‹æ¯”è¼ƒå¸¸ç”¨åˆ°çš„ 8 å€‹ Moduleï¼š\nansible.builtin.apt apt module æ˜¯çµ¦ Debian, Ubuntu ç­‰ä½œæ¥­ç³»çµ±ä½¿ç”¨çš„å¥—ä»¶æ¨¡çµ„ (Packing Modules)ï¼Œæˆ‘å€‘å¯ä»¥é€éå®ƒç®¡ç† apt å¥—ä»¶ã€‚é¡ä¼¼çš„æœ‰ apt-getã€dpkgç­‰ã€‚\næ›´æ–°å¥—ä»¶ç´¢å¼•(å¿«å–)ï¼Œç­‰åŒæ–¼ apt-get update æŒ‡ä»¤ - name: Update repositories cache ansible.builtin.apt: update_cache: yes å®‰è£ vim å¥—ä»¶ - name: Install the package \"vim\" ansible.builtin.apt: name: vim state: present ç§»é™¤ nano å¥—ä»¶ - name: Remove \"nano\" package ansible.builtin.apt: name: nano state: absent ansible.builtin.command command module æ˜¯å¯ä»¥åœ¨é ç«¯ä¸ŠåŸ·è¡ŒæŒ‡ä»¤çš„æŒ‡ä»¤æ¨¡çµ„ï¼Œä½†å®ƒä¸æ”¯æ´è®Šæ•¸ (variables) å’Œ \u003cã€\u003eã€|ã€;ã€\u0026ï¼Œè‹¥æœ‰é€™é¡éœ€æ±‚è¦æ”¹ç”¨ shell moduleã€‚\né‡æ–°é–‹æ©Ÿ - name: Reboot at now ansible.builtin.command: /sbin/shutdown -r now ç•¶æŸå€‹æª”æ¡ˆä¸å­˜åœ¨æ™‚æ‰åŸ·è¡ŒæŒ‡ä»¤ - name: create .ssh directory ansible.builtin.command: mkdir .ssh creates=.ssh/ å…ˆåˆ‡æ›ç›®éŒ„å†åŸ·è¡ŒæŒ‡ä»¤ - name: cat /etc/passwd ansible.builtin.command: cat passwd args: chdir: /etc ansible.builtin.copy copy moudule æ˜¯å¾æœ¬åœ°è¤‡è£½æª”æ¡ˆåˆ°é ç«¯çš„æª”æ¡ˆæ¨¡çµ„ï¼Œè‹¥æœ‰ä½¿ç”¨è®Šæ•¸éœ€æ±‚ï¼Œå¯ä»¥æ”¹ç”¨ templateã€‚å®ƒé¡ä¼¼ Linux æŒ‡ä»¤çš„ scpã€‚\nè¤‡è£½ ssh public key åˆ°é ç«¯ (chmod 644 /target/file) - name: copy ssh public key to remote node ansible.builtin.copy: src: files/id_rsa.pub dest: /home/docker/.ssh/authorized_keys owner: docker group: docker mode: 0644 è¤‡è£½ ssh public key åˆ°é ç«¯ (chmod u=rw,g=r,o=r /target/file) - name: copy ssh public key to remote node ansible.builtin.copy: src: files/id_rsa.pub dest: /home/docker/.ssh/authorized_keys owner: docker group: docker mode: \"u=rw,g=r,o=r\" è¤‡è£½ nginx vhost è¨­å®šæª”åˆ°é ç«¯ï¼Œä¸¦å‚™ä»½åŸæœ‰çš„æª”æ¡ˆ - name: copy nginx vhost and backup the original ansible.builtin.copy: src: files/ironman.conf dest: /etc/nginx/sites-available/default owner: root group: root mode: 0644 backup: yes ansible.builtin.file file module æ˜¯åœ¨é ç«¯å»ºç«‹å’Œåˆªé™¤æª”æ¡ˆ (file)ã€ç›®éŒ„ (directory) å’Œè»Ÿé€£çµ (symlinks) çš„æª”æ¡ˆæ¨¡çµ„ã€‚å®ƒé¡ä¼¼çš„ Linux æŒ‡ä»¤ç‚º chownã€mkdir å’Œ touchã€‚\nå»ºç«‹æª”æ¡ˆ (touch)ï¼Œä¸¦è¨­å®šæ¬Šé™ç‚º 644 - name: touch a file, and set the permissions ansible.builtin.file: path: /etc/motd state: touch mode: \"u=rw,g=r,o=r\" å»ºç«‹ç›®éŒ„ (mkdir)ï¼Œä¸¦è¨­å®šæª”æ¡ˆæ“æœ‰è€…ç‚º docker - name: create a directory, and set the permissions ansible.builtin.file: path: /home/docker/.ssh/ state: directory owner: docker mode: \"700\" å»ºç«‹è»Ÿé€£çµ (ln) - name: create a symlink file ansible.builtin.file: src: /tmp dest: /home/docker/tmp state: link ansible.builtin.lineinfile lineinfile module æ˜¯å€‹å¯ç”¨æ­£è¦è¡¨ç¤ºæ³•å°æª”æ¡ˆé€²è¡Œæ’å…¥æˆ–å–ä»£æ–‡å­—çš„æª”æ¡ˆæ¨¡çµ„ã€‚å®ƒé¡ä¼¼çš„ Linux æŒ‡ä»¤æ˜¯ sedã€‚\nç§»é™¤ docker ä½¿ç”¨è€…çš„ sudo æ¬Šé™ - name: remove sudo permission of docker ansible.builtin.lineinfile: dest: /etc/sudoers state: absent regexp: \"^docker\" åœ¨ /etc/hosts æª”æ¡ˆè£¡ç”¨ 127.0.0.1 localhost å–ä»£é–‹é ­ç‚º 127.0.0.1 çš„ä¸€è¡Œ - name: set localhost as 127.0.0.1 ansible.builtin.lineinfile: dest: /etc/hosts regexp: '^127\\.0\\.0\\.1' line: \"127.0.0.1 localhost\" owner: root group: root mode: 0644 ansible.builtin.service service module æ˜¯ç”¨ä¾†ç®¡ç†é ç«¯ç³»çµ±æœå‹™çš„ç³»çµ±æ¨¡çµ„ã€‚å®ƒé¡ä¼¼çš„ Linux æŒ‡ä»¤ç‚º serviceã€‚\nå•Ÿå‹• Nginx - name: start nginx service ansible.builtin.service: name: nginx state: started åœæ­¢ Nginx - name: stop nginx service ansible.builtin.service: name: nginx state: stopped é‡é–‹ç¶²è·¯æœå‹™ - name: restart network service ansible.builtin.service: name: network state: restarted args: eth0 ansible.builtin.shell shell module æ˜¯å¯ä»¥åœ¨é ç«¯ç”¨ /bin/sh åŸ·è¡ŒæŒ‡ä»¤çš„æŒ‡ä»¤æ¨¡çµ„ï¼Œæ”¯æ´è®Šæ•¸ (variables) å’Œ \u003cã€\u003eã€|ã€; å’Œ \u0026 ç­‰é‹ç®—ã€‚\nè—‰ç”± ls å’Œ wc æª¢æŸ¥æª”æ¡ˆæ•¸é‡ - name: check files number ansible.builtin.shell: ls /home/docker/ | wc -l æŠŠæ‰€æœ‰çš„ Python è¡Œç¨‹çµ¦ç æ‰ - name: kill all python process ansible.builtin.shell: kill -9 $(ps aux | grep python | awk '{ print $2 }') ansible.builtin.stat stat module æ˜¯ç”¨ä¾†æª¢æŸ¥æª”æ¡ˆç‹€æ…‹çš„æª”æ¡ˆæ¨¡çµ„ã€‚å…¶é¡ä¼¼çš„ Linux æŒ‡ä»¤ç‚º statã€‚\næª¢æŸ¥æª”æ¡ˆæ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨å‰‡å»ºç«‹ä»–ã€‚ - name: check the 'vimrc' target exists ansible.builtin.stat: path: /home/docker/.vimrc register: stat_vimrc - name: touch vimrc file: path: /home/docker/.vimrc ansible.builtin.state: touch mode: \"u=rw,g=r,o=r\" when: stat_vimrc.stat.exists == false å–çš„æŸæª”æ¡ˆçš„ md5sum - name: Use md5sum to calculate checksum ansible.builtin.stat: path: /path/to/something checksum_algorithm: md5sum å…¶ä»– å…¶ä»–é‚„æœ‰å¾ˆå¤šå¯ä»¥ä½¿ç”¨çš„ Module ï¼Œè©³æƒ…å¯ä»¥æŸ¥çœ‹ Ansible.Builtinã€‚","ç¬¬ä¸€å€‹-playbook#ç¬¬ä¸€å€‹ Playbook":"åœ¨æˆ‘å€‘éƒ½å®‰è£å¥½å¾Œï¼Œè¦ä¾†èªªèªªæˆ‘å€‘å‰›å‰›æœ‰å·å·æåˆ°çš„ Playbooks çš„å‹•ä½œ (Plays) å’Œä»»å‹™ (Tasks)ã€‚åœ¨ä¸€ä»½ Playbooks è£¡é¢ï¼Œå¯ä»¥æœ‰å¤šå€‹ Playã€å¤šå€‹ Task å’Œå¤šå€‹ Moduleï¼š\nPlayï¼šé€šå¸¸ç‚ºæŸå€‹ç‰¹å®šçš„ç›®çš„ï¼Œä¾‹å¦‚ï¼š Setup a official website with Drupal è—‰ç”± Drupal å»ºç½®å®˜ç¶² Restart the API Service é‡é–‹ API æœå‹™ Taskï¼šè¦å¯¦è¡Œ Play é€™å€‹ç›®çš„æ‰€éœ€åšçš„æ¯å€‹æ­¥é©Ÿï¼Œä¾‹å¦‚ï¼š Install the Nginx å®‰è£ Nginx Kill the djnago process å¼·åˆ¶åœæ­¢ django çš„è¡Œç¨‹ Moduleï¼šAnsible æ‰€æä¾›çš„å„ç¨®æ“ä½œæ–¹å¼ï¼Œä¾‹å¦‚ï¼š apt: name=vim state=present ä½¿ç”¨ apt å¥—ä»¶å®‰è£ vim command: /sbin/shutdown -r now ä½¿ç”¨ shutdown çš„æŒ‡ä»¤é—œæ©Ÿ æœ‰é»è½ä¸æ‡‚å§ï¼æˆ‘ä¾†èˆ‰å€‹ä¾‹å­ï¼Œæˆ‘å€‘æœ€ç†Ÿæ‚‰çš„ Hello Worldï¼Œå…ˆå»ºç«‹ä¸€å€‹ helloworld.yaml çš„æª”æ¡ˆï¼š\nhelloworld.yaml--- - name: say 'hello world' hosts: all tasks: - name: echo 'hello world' command: echo 'hello world' register: result - name: print stdout debug: msg: \"{{ result.stdout }}\" å¯ä»¥çœ‹åˆ°é€™æ•´å€‹å°±æ˜¯ Playï¼Œæˆ‘å€‘æƒ³è¦é”åˆ° say â€˜hello worldâ€™ çš„ç›®çš„ï¼Œå…¶ä¸­æœ‰å…©å€‹ name åˆ†åˆ¥ä»£è¡¨å…©å€‹ Taskï¼Œä¹Ÿå°±æ˜¯é”æˆ Play ç›®çš„æ‰€éœ€å¾—æ­¥é©Ÿã€‚æœ€å¾Œ command èˆ‡ debug å°±æ˜¯æˆ‘å€‘çš„ Module è¦æ€éº¼é”æˆé€™å…©å€‹æ­¥é©Ÿçš„æ“ä½œæ–¹å¼ã€‚\nPlaybooks çµ„æˆçµæ§‹\næˆ‘å€‘ä½¿ç”¨ ansible-playbook åŸ·è¡Œ Playbookï¼Œåœ¨é€™å€‹ç¯„ä¾‹ä¸­ï¼Œæˆ‘å€‘åŸ·è¡Œäº†ï¼‘å€‹ Playã€3 å€‹ Tasks å’Œ 2 å€‹ Modulesï¼š\n$ ansible-playbook helloworld.yaml åŸ·è¡Œ Playbooks\næˆ‘å€‘å‰›å‰›æ˜æ˜åªå¯«å…©å€‹ tasksï¼Œç‚ºä»€éº¼åŸ·è¡Œå°±è®Šæˆä¸‰å€‹ tasksï¼Ÿ\né€™æ˜¯å› ç‚º Ansible é è¨­æœƒä½¿ç”¨ Setup task ä¾†å–å¾— Managed node çš„ factsã€‚é—œæ–¼ facts çš„è©³ç´°èªªæ˜ï¼Œè«‹æ»‘åˆ°å¾Œé¢ å–å¾—-managed-node-çš„-facts è§€çœ‹ ğŸ˜¬\né‚£å¦‚æœæ²’æœ‰ Ansible æ™‚ï¼Œæˆ‘å€‘æ˜¯æ€éº¼æ“ä½œçš„ï¼Ÿæˆ‘æœƒé™„ä¸Š Shell Script çš„åšæ³•ï¼Œæˆ‘å€‘ä¾†æ¯”è¼ƒçœ‹çœ‹å§ï¼\nShell Script å»ºç«‹ helloworld.sh æª”æ¡ˆ helloworld.sh#! /bin/bash echo \"Hello World\" åŸ·è¡Œ helloworld.sh ./ helloworld.sh Hello World çœ‹èµ·ä¾† Shell Script å·²ç¶“å¤ ç”¨äº†ï¼Œç‚ºä»€éº¼é‚„è¦å¯« Playbook å‘¢ï¼Ÿé€™é‚Šæ•´ç†å¹¾å€‹ç†ç”±çµ¦å¤§å®¶åƒè€ƒï¼š\nç”¨ Ansible çš„ Module å¯ä»¥æŠŠå¾ˆå¤šè¤‡é›œçš„æŒ‡ä»¤çµ¦æ¨™æº–åŒ–ï¼Œä¾‹å¦‚ä¸åŒçš„ Linux ç™¼è¡Œç‰ˆæœ¬åœ¨å®‰è£å¥—ä»¶æ™‚éœ€ä»£å„ç¨®ä¸åŒçš„åƒæ•¸ã€‚ åœ¨ç¾æœ‰çš„é›²åŸç”Ÿ (cloud native) çš„æ¶æ§‹ä¸‹ï¼Œå‚³çµ±çš„ Shell Script å·²ç¶“ä¸æ•·ä½¿ç”¨ï¼Œä¸€èˆ¬è€Œè¨€ Shell Script åªèƒ½å°ä¸€å°æ©Ÿå™¨ (instance) é€²è¡Œæ“ä½œã€‚ "},"title":"Ansible ä»‹ç´¹èˆ‡å¯¦ä½œ (Inventoryã€Playbooksã€Moduleã€Templateã€Handlers)"},"/blog/git-or-cicd/git-merge-multiple-commit/":{"data":{"":"ç•¶æˆ‘å€‘åœ¨ä½¿ç”¨ Git æ™‚ï¼Œå¸¸å¸¸ä¿®æ”¹å®Œå…§å®¹å¾Œï¼Œæœƒæ¨ commit åˆ° github or gitlabï¼Œåœ¨ä¸€å€‹åˆ†æ”¯ä¸Šé–‹ç™¼ä¹…äº†ï¼Œ commit æœƒç´¯ç©å¾ˆå¤šï¼Œå¾ˆé›œä¸”å¾ˆäº‚ï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥è©¦è‘—å°‡ commit çµ¦åˆä½µã€‚\nå¤§å®¶å¯ä»¥ä½¿ç”¨é€™å€‹æª”æ¡ˆä¾†åšç·´ç¿’ï¼šé»æˆ‘ GoGo ğŸ˜‰\ngit commit\nå¯ä»¥çœ‹åˆ°ä¸Šé¢é€™å¼µåœ–ï¼Œé€™å€‹èˆ‡ç¯„ä¾‹æª”æ¡ˆçš„ commit ç›¸ä¼¼(ä¸åŒå°ˆæ¡ˆï¼Œæ‰€ä»¥ SHA-1 ä¹Ÿæœƒä¸åŒï¼Œç‚ºäº†æ¨¡æ“¬æ‰€ä»¥ commit ç›¸åŒè€Œå·²)ï¼Œæˆ‘å€‘æ¨¡æ“¬åœ¨åŒä¸€å€‹åˆ†æ”¯åº•ä¸‹ï¼Œæœ‰å¾ˆå¤šçš„ commitï¼Œé‚£æˆ‘å€‘è©¦è‘—æŠŠä»–çµ¦åˆä½µèµ·ä¾†ã€‚å…ˆèªªæ˜ä¸€ä¸‹ç›®å‰çš„ commit ç‹€æ³ï¼Œæˆ‘å€‘åœ¨ master åˆ†æ”¯ä¸Šæœ‰ 3 å€‹ commitï¼Œä¸”å·²ç¶“æ¨åˆ°é ç«¯ä¸Šã€‚æ‰€ä»¥æˆ‘å€‘æœ¬åœ°ä¿®æ”¹å¾Œï¼Œé‚„è¦è®“é ç«¯çš„ä¹Ÿåˆä½µï¼Œé€™å€‹æ­¥é©Ÿè¦æ€éº¼åšå‘¢ï¼Ÿå¤§å®¶å¯ä»¥å…ˆæƒ³æƒ³çœ‹ï¼Œå¾Œé¢æœƒå‘Šè¨´å¤§å®¶ç­”æ¡ˆ ğŸ¥°","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"å¦‚ä½•åˆä½µå¤šå€‹ commitsï¼šhttps://zerodie.github.io/blog/2012/01/19/git-rebase-i/\nã€ç‹€æ³é¡Œã€‘è½èªª git push -f é€™å€‹æŒ‡ä»¤å¾ˆå¯æ€•ï¼Œä»€éº¼æƒ…æ³å¯ä»¥ä½¿ç”¨å®ƒå‘¢ï¼Ÿï¼šhttps://gitbook.tw/chapters/github/using-force-push","åˆä½µæœ¬åœ°ç«¯-commit#åˆä½µæœ¬åœ°ç«¯ commit":"é¦–å…ˆæˆ‘å€‘ç›®çš„æ˜¯æƒ³è¦è®“ add 2.txt èˆ‡ add 3.txt çš„ commit åˆä½µæˆ add txtï¼Œå¯ä»¥å…ˆä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤ä¾†æ‰¾åˆ°ä»–çš„ commit çš„ SHA-1ï¼š\ngit log git log æŸ¥çœ‹ commit çš„ SHA-1\nè¦æ€éº¼åˆä½µå‘¢ï¼Ÿæˆ‘å€‘å…ˆä½¿ç”¨ rebase åˆ°ä¸æœƒè®Šå‹•çš„ commitï¼Œä¹Ÿå°±æ˜¯ add 1.txt é€™å€‹ commitï¼š\ngit rebase -i 3b5bab9d5fb65b965ae55236734103b178f9daf2 git rebase\nä¸‹å®Œå¾Œï¼Œæœƒè·³å‡ºä¸Šé¢åœ–ç‰‡å…§å®¹ï¼Œå¯ä»¥çœ‹åˆ°ä¸Šé¢æ˜¯ rebase interactive (-i) è¦åŸ·è¡Œçš„æŒ‡ä»¤ï¼Œä¸‹é¢æ˜¯æ¯å€‹æŒ‡ä»¤çš„ç°¡å–®èªªæ˜ï¼Œæˆ‘å€‘æœ¬æ¬¡æœƒä½¿ç”¨çš„åªæœ‰ pick ä»¥åŠ squashï¼Œåˆ†åˆ¥çš„æ„æ€æ˜¯ï¼š\npickï¼šæœƒåŸ·è¡Œè©² commitã€‚ squashï¼šæœƒæŠŠé€™å€‹ç‰ˆæœ¬çš„ commit åˆä½µåˆ°å‰ä¸€å€‹ commitã€‚ æ‰€ä»¥æˆ‘å€‘è¦å°‡å®ƒæ”¹æˆä»¥ä¸‹ï¼š\npick f8e5882 add 2.txt squash 3eb0ef4 add 3.txt ä¹Ÿå°±æ˜¯å°‡ 3eb0ef4 é€™å€‹ç‰ˆæœ¬çš„ commit åˆä½µåˆ° f8e5882 çš„ commitï¼Œå°æ‡‰æˆ‘å€‘çš„ä¾‹å­ï¼Œå°‡ add 3.txt åˆä½µåˆ° add 2.txt é€™å€‹ commitã€‚\nå„²å­˜é›¢é–‹å¾Œï¼Œæœƒè·³å‡ºä»¥ä¸‹çš„ç•«é¢ï¼Œä»–æœƒå‘Šè¨´ä½ åŸæœ¬å…©å€‹çš„ commit message åˆ†åˆ¥æ˜¯ add 2.txt ä»¥åŠ add 3.txtï¼Œé€™æ™‚å€™æˆ‘å€‘è¦è¼¸å…¥æ–°çš„ commit messageï¼Œä¹Ÿå°±æ˜¯ add txtï¼Œå»ºè­°å¯ä»¥æŠŠåŸæœ¬çš„è¨Šæ¯è¨»è§£æ‰ã€‚\nè¼¸å…¥æ–°çš„ commit\nå„²å­˜å¾Œï¼Œæˆ‘å€‘æŸ¥çœ‹ git logï¼Œå°±å¯ä»¥çœ‹åˆ°æˆ‘å€‘å°‡ add 2.txt è·Ÿ add 3.txt åˆä½µæˆ add txt ğŸ˜\næŸ¥çœ‹ç›®å‰åˆä½µç‹€æ…‹çš„ git log","åˆä½µé ç«¯-commit#åˆä½µé ç«¯ commit":"å¯ä»¥çœ‹åˆ°ä¸‹æ–¹æ˜¯æˆ‘å€‘å·²ç¶“å°‡æœ¬æ©Ÿç«¯çš„ commit çµ¦åˆä½µï¼Œä½†é ç«¯é‚„æ˜¯ä¸€æ¨£æœ‰ 3 å€‹ commitï¼Œå¦‚æœæˆ‘å€‘å°±é€™æ¨£ç›´æ¥æ¨ä¸Šå»ï¼Œåªæœƒå¤šä¸€æ¬¡çš„ commitï¼Œæ‰€ä»¥æˆ‘å€‘è©²æ€è¾¦å‘¢ ?\né ç«¯èˆ‡æœ¬åœ°ç«¯çš„ commit ä¸åŒ\næˆ‘å€‘å°±æ˜¯è¦ä½¿ç”¨å¤§å®¶éƒ½å®³æ€•çš„ï¼š\ngit push -f å¼·åˆ¶è¦†è“‹æ‰åˆ†æ”¯ä¸Šçš„å…§å®¹ï¼Œä½†åˆ‡è¨˜åˆ‡è¨˜ï¼Œé€™å€‹åªé©ç”¨æ–¼è‡ªå·±çš„åˆ†æ”¯ä¸Šæ­ï½ä¸ç„¶æœƒç›´æ¥å¤§çˆ†ç‚¸ ğŸ’£\nä½¿ç”¨ git push -f å¾Œçš„ commit"},"title":"å¦‚ä½•åˆä½µå¤šå€‹ commitï¼Œä¸”æ¨åˆ°é ç«¯å‘¢ï¼Ÿ"},"/blog/git-or-cicd/gitlab-cicd/":{"data":{"":"è‡ªå¾ä¸Šæ¬¡å­¸å®Œ Jenkins åŠ Ansible CI/CDï¼Œå°±è¦ºå¾— CI/CD å¯¦åœ¨å¤ªé…·äº†ï¼èƒ½å¤ è‡ªå‹•åŒ–çš„å»æŒçºŒæ•´åˆ (Continuous Integration, CI) ä»¥åŠæŒçºŒä½ˆç½² (Continuous Deployment,CD) å°ˆæ¡ˆï¼Œå†åŠ ä¸Šé€™å¹¾å¤©è¤‡ç¿’äº† Git çš„ä½¿ç”¨æ–¹æ³•ï¼Œçªç„¶æƒ³åˆ°ï¼Œè¦æ€éº¼è¨­å®šæˆ‘å€‘å°‡ç¨‹å¼æ¨åˆ°é ç«¯çš„ Git Repoï¼Œèƒ½å¤ å†æ­é… CI/CD å»åšæ¸¬è©¦ï¼Œä¸¦ä¸”æŠŠç¨‹å¼ç¢¼è‡ªå‹•éƒ¨ç½²åˆ°æ­£å¼çš„æœå‹™æ©Ÿå™¨è¨­å‚™ä¸Šå‘¢ï¼Ÿ\né‚£æˆ‘å€‘å°±é–‹å§‹å›‰ï¼æ­¤ç¯‡æœƒè¤‡ç¿’ä¸€ä¸‹ CI/CD ä¸¦ä¸”èªªæ˜ GitLab CI/CD é‹ä½œçš„åŸç†ï¼Œé—œæ–¼å¯¦ä½œéƒ¨åˆ†æœƒæ”¾åˆ°ä¸‹ä¸€ç¯‡æ–‡ç«  éƒ¨ç½² Laravel æ–¼ Heroku æ­é… GitLab CI/CD\nå°äº†å·¥å•†ä¸€ä¸‹ï¼Œå‰›å‰›æœ‰æåˆ°çš„ Jenkins åŠ Ansible CI/CD ç¸½å…±æœ‰ 3 ç¯‡æ–‡ç« ï¼Œé‚„æ²’çœ‹éçš„å¯ä»¥å…ˆé£›éå»çœ‹ä¸€ä¸‹æ­ ğŸ‘‡ğŸ‘‡ğŸ‘‡\nJenkins åŠ Ansible IT è‡ªå‹•åŒ– CI/CD ä»‹ç´¹\nä½¿ç”¨ Jenkins è¨­å®š GitHub è§¸ç™¼ç¨‹åºä¸¦é€šçŸ¥ Telegram Bot\nAnsible ä»‹ç´¹èˆ‡å¯¦ä½œ (Inventoryã€Playbooksã€Moduleã€Templateã€Handlers)\nè€æ¨£å­æ–‡ç« ä¹ŸæœƒåŒæ­¥åˆ° Githubï¼Œæœƒé™„ä¸Šç¯„ä¾‹ä¸­çš„ç¨‹å¼ç¢¼ï¼Œæœ‰éœ€è¦çš„ä¹Ÿå¯ä»¥å»æŸ¥çœ‹æ­ï¼ Github ç¨‹å¼ç¢¼é€£çµ ğŸ’“","gitlab-cicd#GitLab CI/CD":"GitLab CI/CD æ˜¯ GitLab å…§å»ºå¼·å¤§çš„å·¥å…·ï¼Œåœ¨ GitHub è¢«ç¨±ç‚º Github Actionsï¼Œé€™å€‹ä¹‹å¾Œæœ‰ç©ºå†ä¾†ä»‹ç´¹ XDï¼Œå›æ­¸æ­£é¡Œï¼ŒGitLab CI/CD å¯ä»¥è®“æˆ‘å€‘æŒçºŒæ•´åˆå’Œéƒ¨ç½²ï¼Œä¸”ä¸éœ€è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„æ‡‰ç”¨ç¨‹å¼ä¾†æ•´åˆã€‚æˆ‘å€‘ä¾†è¤‡ç¿’ä¸€ä¸‹ æŒçºŒæ•´åˆ CIã€æŒçºŒéƒ¨ç½² CD ä»–å€‘æ˜¯ä»€éº¼å§ï¼š\næŒçºŒæ•´åˆ CI ä¸€å€‹è™•æ–¼é–‹ç™¼éšæ®µçš„å°ˆæ¡ˆæˆ–æ˜¯è»Ÿé«”ï¼Œå®ƒè¢«æˆ‘å€‘æ”¾åœ¨ GitLab çš„ Repository è£¡ï¼Œé–‹ç™¼äººå“¡æ¯å¤©æœƒæ¨é€ä¸åŒçš„ç¨‹å¼ç¢¼åˆ° GitLab ä¸Šï¼ŒGitLab æŒçºŒæ•´åˆ CI æœƒåœ¨é–‹ç™¼äººå“¡æ¯æ¬¡æ¨é€å¾Œï¼Œè‡ªå‹•åŒ–çš„ä¾ç…§æˆ‘å€‘è¨­å®šå¥½çš„è…³æœ¬é€²è¡Œå»ºæ§‹èˆ‡æ¸¬è©¦ï¼Œå¾è€Œæ¸›å°‘é–‹ç™¼ä¸­çš„å°ˆæ¡ˆç™¼ç”ŸéŒ¯èª¤çš„å¯èƒ½æ€§ã€‚\né€™ç¨®åšæ³•å°±è¢«ç¨±ä½œæŒçºŒæ•´åˆï¼Œå°æ–¼æˆ‘å€‘æäº¤çµ¦å°ˆæ¡ˆçš„æ¯ä¸€å€‹æ›´æ”¹ã€ç”šè‡³æ˜¯é–‹ç™¼åˆ†æ”¯ï¼Œå®ƒéƒ½æ˜¯è‡ªå‹•ä¸”æŒçºŒåœ°å»ºæ§‹å’Œæ¸¬è©¦ï¼Œç¢ºä¿æ–°åŠ å…¥çš„è®Šå‹•ï¼Œç¬¦åˆæˆ‘å€‘åœ¨å°ˆæ¡ˆä¸­æ‰€è¨­è¨ˆçš„æ‰€æœ‰æ¸¬è©¦ã€‚\næŒçºŒéƒ¨ç½² CD æŒçºŒéƒ¨ç½²ï¼Œè®“æˆ‘å€‘ä¸å¤ªéœ€è¦æ‰‹å‹•çš„å»éƒ¨ç½²å°ˆæ¡ˆæœå‹™ï¼Œè€Œæ˜¯å°‡å…¶è¨­ç½®ç‚ºè‡ªå‹•åŒ–éƒ¨ç½²ï¼Œå®Œå…¨ä¸éœ€è¦æœ‰äººå·¥å»å¹²æ¶‰ï¼Œæ¸›å°‘äº†äººç‚ºçš„éƒ¨ç½²éŒ¯èª¤ã€‚\nGitLab CI/CD (åœ–ç‰‡ä¾†æºï¼šGitLab Agile Planning)\nå¤§è‡´äº†è§£æ˜¯å¦‚ä½•é‹ä½œä¹‹å¾Œï¼Œæˆ‘å€‘æ¥è‘—èŠèŠä¸Šé¢æœ‰æåˆ°çš„ è¨­å®šå¥½çš„è…³æœ¬ï¼š\n.gitlab-ci.yml GitLab CI/CD çš„å·¥ä½œåŸç†æ˜¯ï¼Œè¦åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„æ–°å¢ä¸€å€‹åç‚º .gitlab-ci.yml çš„æ–‡ä»¶ (è¨˜å¾—æ–‡ä»¶åç¨±é–‹é ­æœ‰ . ï¼Œæˆ‘ä¸€é–‹å§‹å¿˜è¨˜è¦åŠ ï¼Œæƒ³èªªæ€éº¼éƒ½æ²’æœ‰åæ‡‰ ğŸ˜… )ï¼Œä¹Ÿå°±æ˜¯æˆ‘å€‘ä¸Šé¢èªªçš„ è¨­å®šå¥½çš„è…³æœ¬ï¼Œå¯ä»¥å…ˆå°‡æ‰€éœ€å»ºæ§‹ã€æ¸¬è©¦å’Œéƒ¨ç½²çš„è…³æœ¬ç·¨å¯«å®Œæˆï¼Œä»¥åŠå®šç¾©å¾ˆå¤šè¦å‰‡ï¼Œä¾‹å¦‚åŸ·è¡Œå‘½ä»¤çš„å…ˆå¾Œé †åºã€éƒ¨ç½²æ‡‰ç”¨ç¨‹å¼çš„ä½ç½®ä»¥åŠæŒ‡å®šæ˜¯å¦è‡ªå‹•é‹è¡Œæˆ–æ˜¯æ‰‹å‹•è§¸ç™¼è…³æœ¬ç­‰ã€‚\nå°‡ .gitlab-ci.yml æ–‡ä»¶æ”¾å…¥ Repository è£¡ï¼Œå°±æœƒè§¸ç™¼ CIï¼Œè² è²¬ç®¡ç†çš„ GitLab-CI å°±æœƒä¾ç…§ .gitlab-ci.yml è¨­å®šæª”ä¾†å•Ÿå‹•åç‚º GitLab Runner çš„å·¥å…·ä¾†é‹è¡Œè…³æœ¬ï¼Œé€™å€‹ GitLab Runner æˆ‘å€‘æ”¾åˆ°å¾Œé¢ä¾†èªªï¼Œæˆ‘å€‘å…ˆä¾†èªªèªª .gitlab-ci.yml é€™å€‹è¨­å®šæª”è¦æ€éº¼ç·¨å¯«ï¼Œä»¥åŠç·¨å¯«å¾Œçš„æµç¨‹ã€‚\né€™æ˜¯ä¸€å€‹ç¤ºç¯„çš„ .gitlab-ci.ymlï¼Œé¸è‡ªå„ªè‰¯çš„ GitLab XDï¼Œç‚ºäº†èªªæ˜æœ‰å°ä¿®æ”¹ç¨‹å¼ç¢¼ï¼Œç¨‹å¼ç¢¼ä¹Ÿæœƒæ”¾åœ¨ GitHub ä¸Šæ­ï¼š\n.gitlab-ci.yml stages: - build - test - deploy cache: paths: - config/ build-job: stage: build script: - echo \"Hello, $GITLAB_USER_LOGIN!\" test-job1: stage: test script: - echo \"This job tests something\" test-job2: stage: test before_script: - echo \"This job tests something, but takes more time than test-job1.\" script: - echo \"After the echo commands complete, it runs the sleep command for 20 seconds\" - echo \"which simulates a test that runs 20 seconds longer than test-job1\" - sleep 20 deploy-prod: stage: deploy script: - echo \"This job deploys something from the $CI_COMMIT_BRANCH branch.\" é‚£æˆ‘ä¾†ç°¡å–®èªªæ˜ä¸€ä¸‹ä¸Šé¢é€™äº›è¨­å®šæª”æ¡ˆçš„åŠŸèƒ½ï¼š\nstagesï¼šä»£è¡¨é€™å€‹ CI è¨­å®šæª”æœ‰ä¸‰å€‹ stage è¦è·‘ï¼Œä¸€å€‹æ˜¯ buildã€ä¸€å€‹ testã€ä¸€å€‹ deployï¼Œä»–å€‘çš„é †åºä¹Ÿæ±ºå®š CI é‹ä½œçš„é †åºï¼Œç”± build â†’ test â†’ deployï¼Œå‡å¦‚ test æ²’æœ‰é€šéï¼Œå°±ä¸æœƒåŸ·è¡Œ deployã€‚ cacheï¼šæˆ‘å€‘åœ¨å¯« CI æ™‚ï¼Œå¸¸å¸¸éœ€è¦è£ packageï¼Œä½†æˆ‘ä¸æƒ³æ¯æ¬¡éƒ½é‡æ–°è·‘ä¸€æ¬¡ï¼Œæ‰€ä»¥å¯ä»¥å¯«ä¸€å€‹ cacheï¼Œä¸è¦è®“ GitLab æ¯æ¬¡éƒ½é‡æ–°æ‹‰æ–°çš„ packageã€‚ build-jobã€test-job1ã€test-job2ã€deploy-prodï¼šä»£è¡¨æˆ‘æœ‰ 4 å€‹ job è¦åŸ·è¡Œï¼Œæ¯å€‹ job è£¡é¢æœ‰ä¸åŒçš„ä»»å‹™ï¼Œä¹Ÿæ˜¯é¡¯ç¤ºåœ¨ Pipeline çš„åç¨±ã€‚ stageï¼šä»–ç¾åœ¨è¦åŸ·è¡Œçš„éšæ®µï¼Œå°æ‡‰åˆ° stagesã€‚ before_scriptï¼šå¯ä»¥æŠŠå®ƒç•¶å…ˆéœ€è¦å…ˆåŸ·è¡Œçš„æŒ‡ä»¤ï¼Œå¾Œé¢æ‰æœƒåŸ·è¡Œä¸»è¦çš„ script æŒ‡ä»¤ã€‚æ‰€ä»¥éœ€è¦å®‰è£çš„å¯ä»¥å…ˆå¯«åœ¨é€™è£¡é¢ã€‚ scriptï¼šä¸»æŒ‡ä»¤ï¼Œåœ¨å¯¦éš›é‹è¡Œçš„è…³æœ¬ä¸­ï¼Œé€šå¸¸æœƒè¦‹åˆ°å¤šè¡Œçš„æŒ‡ä»¤è¢«ä¾åºåŸ·è¡Œã€‚ $CI_COMMIT_BRANCï¼šç•¶ç„¶ .gitlab-ci.yml æª”æ¡ˆä¹Ÿå¯ä»¥å¸¶å…¥åƒæ•¸ï¼Œé€™å€‹éƒ¨åˆ†æˆ‘å€‘ç•™åˆ° éƒ¨ç½² Laravel æ–¼ Heroku æ­é… GitLab CI/CD æ­é…å¯¦éš›æ“ä½œä¾†èªªæ˜ã€‚ ç•¶ç„¶ .gitlab-ci.yml æœ‰å¾ˆå¤šåŠŸèƒ½ï¼Œä¸Šé¢åªæ˜¯ç°¡å–®èªªæ˜æ¯”è¼ƒå¸¸ç”¨çš„ï¼Œç•¶ä½ ä¸ç¢ºå®šè‡ªå·±å¯«çš„ CI è¨­å®šæª”æœ‰æ²’æœ‰å•é¡Œï¼Œæ²’é—œä¿‚å°±ç›´æ¥æ¨ä¸Šå»ï¼ŒGitLab é‚„æœƒå…ˆæª¢æŸ¥ä¸€ä¸‹è¨­å®šæª”æ˜¯ä¸æ˜¯æ­£ç¢ºï¼š\nGitLab CI/CD æª¢æŸ¥æ ¼å¼æœ‰éŒ¯\nç•¶æˆ‘å€‘å°‡ .gitlab-ci.yml é€£åŒå°ˆæ¡ˆä¸€èµ·æ¨åˆ° GitLab ä¸Šå¾Œï¼Œæˆ‘å€‘å¯ä»¥çœ‹åˆ°å®ƒæœƒé–‹å§‹åŸ·è¡Œæˆ‘å€‘æ‰€å¯«çš„è…³æœ¬ï¼Œæœƒé¡¯ç¤ºæ•´å€‹åŸ·è¡Œéç¨‹ï¼š\nGitLab CI/CD åŸ·è¡Œéç¨‹\næŸ¥çœ‹åŸ·è¡Œçš„ç‹€æ…‹ï¼š\nGitLab CI/CD ç‹€æ…‹\nä¹Ÿå¯ä»¥åœ¨ GitLab Pipeline çœ‹åˆ°åŸ·è¡Œçš„æµç¨‹ï¼š\nGitLab CI/CD Pipeline\nGitLab CI Runner æˆ‘å€‘ä¸Šé¢æœ‰æåˆ°ï¼Œæˆ‘å€‘åœ¨ CI è·‘è…³æœ¬ï¼Œéœ€è¦ä¸€å€‹ Server ä¾†ä»£æ›¿ GitLab ä¾†è®“æˆ‘å€‘åŸ·è¡Œï¼Œé€™å€‹ Server æˆ‘å€‘ç¨±ç‚º Runnerã€‚æˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹æ•´å€‹åŸ·è¡Œçš„åœ–ç‰‡ï¼š\nGitlab CI/CD å¯¦éš›åŸ·è¡Œæµç¨‹ (åœ–ç‰‡ä¾†æºï¼šGitlab-CI å…¥é–€å¯¦ä½œæ•™å­¸ - å–®å…ƒæ¸¬è©¦ç¯‡)\né‚£é€™å€‹ Runner æœ‰åˆ†æˆå…©ç¨®ï¼š\nå…±äº« Runner (Shared Runners) è‡ªæ¶ Runner (Specific Runners) å…±äº« Runner (Shared Runners) å› ç‚ºæœ¬æ–‡ç« ä»¥åŠå¾ŒçºŒ éƒ¨ç½² Laravel æ–¼ Heroku æ­é… GitLab CI/CD æ–‡ç« æ‰€ä½¿ç”¨çš„å¹³å°æ˜¯ gitlab.comï¼Œç”±å®˜æ–¹æ‰€æä¾›ï¼Œæ‰€ä»¥æˆ‘å€‘ç›´æ¥ä½¿ç”¨å…±äº« Runnerï¼Œå¯ä»¥åœ¨ repository Settings â†’ CI / CD â†’ Runners ä¸­æ‰¾åˆ°ï¼Œæœ‰ä¸å°‘å®˜æ–¹æä¾›çš„å…±äº« Runner å¯ä»¥ä½¿ç”¨ï¼Œä¹Ÿä¸éœ€è¦åšä»»ä½•è¨­å®šã€‚\nGitLab CI/CD å…±äº« Runner\nä½†ä¹Ÿæœ‰å¹¾å€‹ç¼ºé»ï¼š\nå› ç‚ºæ˜¯å…±äº«ï¼Œæ‰€ä»¥ Server è³‡æºä¹Ÿæœƒå…±äº«ï¼Œç†è«–ä¸Šå¤šäººä½¿ç”¨çš„é€Ÿåº¦é‚„æ˜¯æœƒæ¯”è¼ƒæ…¢ã€‚ ä»¥åŠå¦‚æœæ˜¯é–‹æºå°ˆæ¡ˆï¼Œæ˜¯å®Œå…¨å…è²»ã€‚ä½†å¦‚æœæ˜¯ç§äººå°ˆæ¡ˆï¼Œä¸€å€‹æœˆæœ‰ 400 åˆ†é˜çš„ CI åŸ·è¡Œæ™‚é–“é™åˆ¶ã€‚ è‡ªæ¶ Runner (Specific Runners) GitLab CI/CD è‡ªæ¶ Runner (åœ–ç‰‡ä¾†æºï¼šBest Practice for DevOps on GitLab and GCP : GitLab Runner ç°¡ä»‹èˆ‡å®‰è£ - Day 7)\nGitLab Server å’Œ GitLab Runner æ˜¯ GitLab CI/CD ä¸­ä¸å¯æˆ–ç¼ºçš„å…©è€…ï¼Œä½†å¦‚æœåƒå…¬å¸æ˜¯è‡ªæ¶ GitLabï¼Œé¦–å…ˆè¦å…ˆæ‰¾ä¸€å°é›»è…¦æˆ–æ˜¯ Server åšç‚º Runnerï¼Œé‚£æˆ‘å€‘é€™é‚Šä»¥ Docker ä½œç¤ºç¯„ã€‚\nGitLab Runner çš„å»ºè­°å»ºç½®æ­¥é©Ÿå¦‚ä¸‹ï¼š\næº–å‚™/å®‰è£ä¸€å€‹ GitLab Server (é€™é‚Šæˆ‘å€‘ç›´æ¥ä½¿ç”¨ gitlab.com) å®‰è£ä¸€å€‹èˆ‡ GitLab Server å°æ‡‰ç‰ˆæœ¬çš„ GitLab Runner åœ¨å®‰è£ GitLab Runner çš„è¨­å‚™ä¸Šè¨­å®š Executor ä»€éº¼æ˜¯ Executor ?\nå¦‚æœæŠŠ GitLab Runner ç•¶æˆä¸€å€‹å·¥å» ä¾†çœ‹ï¼Œé‚£ Executor å°±æ˜¯å·¥å» å…§ä¸€å€‹åˆä¸€å€‹çš„ç”¢ç·šï¼ŒåŒä¸€å€‹å·¥å» å…§å¯ä»¥æ“æœ‰ä¸åŒç¨®é¡çš„ç”¢ç·šï¼ŒRunner èˆ‡ Executor ä¹‹é–“çš„é—œä¿‚å°±æ˜¯å¦‚æ­¤ï¼Œé€™äº›ç”¢ç·šæœƒæ ¹æ“šå°ˆæ¡ˆä¸­ .gitlab-ci.yml çš„å…§å®¹ï¼Œæ±ºå®šç”¢ç·šä»¥åŠå¦‚ä½•ç”¢å‡ºé–‹ç™¼è€…æœŸæœ›çš„ç”¢å“ã€‚\nå¦å¤– Executor çš„ç¨®é¡éå¸¸å¤šï¼Œå¯ä»¥çœ‹ä¸‹æ–¹é€™äº›åœ–ç‰‡ï¼Œå› ç‚ºæˆ‘å€‘æœ€å¸¸ä½¿ç”¨çš„å°±æ˜¯ Dockerï¼Œæ‰€ä»¥æˆ‘å€‘ç­‰ç­‰çš„ç¯„ä¾‹ï¼Œä¹Ÿæ˜¯å»ºç½®åœ¨ Docker ä¹‹ä¸Šï¼\nGitLab Runner Executors\né‚£æˆ‘å€‘å°±é–‹å§‹ä¾†å¯¦ä½œæˆ‘å€‘çš„ GitLab Runner å§ï¼š\né¦–å…ˆï¼Œæˆ‘å€‘å›å»å‰›å‰›åœ¨ repository Settings â†’ CI / CD â†’ Runners å·¦å´çš„ Specific runners GitLab Runner Executors\nå¯ä»¥çœ‹åˆ°ä¸€å€‹è¨»å†Šçš„ URL ä»¥åŠ Tokenï¼Œé€™å€‹æˆ‘å€‘åœ¨è¨­å®š Executor æœƒä½¿ç”¨åˆ°ï¼\næ¥ä¸‹ä¾†é–‹å§‹å®‰è£ GitLab Runnerï¼Œæˆ‘å€‘ä½¿ç”¨ Dockerï¼Œä»¥ä¸‹æ˜¯ Docker åŸ·è¡Œçš„æŒ‡ä»¤ï¼šæœ¬æ­¤ä½¿ç”¨ gitlab-runner ç‰ˆæœ¬æ˜¯ alpine-v15.0.0 docker run -d --name gitlab-runner --restart always \\ -v ~/Shared/gitlab-runner/config:/etc/gitlab-runner \\ -v /var/run/docker.sock:/var/run/docker.sock \\ gitlab/gitlab-runner:alpine-v15.0.0 æ¥è‘—é€²å…¥å®¹å™¨è£¡é¢ï¼Œä½¿ç”¨ docker exec -it gitlab-runner gitlab-runner register ä¾†è¨»å†Šï¼Œå¯ä»¥åƒè€ƒä¸‹æ–¹åœ–ç‰‡ï¼Œè¼¸å…¥ URL ä»¥åŠ è‡ªå·±çš„ Tokenï¼š GitLab Runner è¨»å†Š Executors\nå¯ä»¥å›åˆ° gitlab.com æŸ¥çœ‹ Specific runners ä¸‹æ–¹æ˜¯å¦å¤šäº†æˆ‘å€‘å‰›å‰›æ‰€è¨»å†Šçš„ GitLab-Runner GitLab Available specific runners\nGitLab CD GitLab CD å…¶å¯¦å°±æ˜¯åœ¨ .gitlab-ci.yml å¾Œé¢åŠ ä¸Šæˆ‘å€‘è¦éƒ¨ç½²çš„è¨­å®šï¼Œé€é CI æ•´åˆå®Œï¼Œæˆ‘å€‘å¯ä»¥è¨­å®šä»–è¦éƒ¨ç½²åˆ°å“ªä¸€å°æ©Ÿå™¨æˆ–æ˜¯è¨­å‚™ä¸Šé€™éƒ¨åˆ†å°±æ”¾åˆ°ä¸‹ä¸€ç¯‡æ–‡ç« ç›´æ¥ç”¨å¯¦ä½œä¾†å‘Šè¨´å¤§å®¶è¦æ€éº¼ä½¿ç”¨å§ï¼ï¼Œè«‹å¤§å®¶æ¥çºŒçœ‹ä¸‹ä¸€ç¯‡ éƒ¨ç½² Laravel æ–¼ Heroku æ­é… GitLab CI/CD ï¼Œä¸€èµ·å­¸ç¿’å§ GoGo !","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"Get started with GitLab CI/CDï¼šhttps://docs.gitlab.com/ee/ci/quick_start/\nBest Practice for DevOps on GitLab and GCP : GitLab CI/CD - Day 6ï¼šhttps://ithelp.ithome.com.tw/articles/10214114\nGitlab-CI å…¥é–€å¯¦ä½œæ•™å­¸ - å–®å…ƒæ¸¬è©¦ç¯‡ï¼šhttps://nick-chen.medium.com/gitlab-ci-%E5%85%A5%E9%96%80%E7%AD%86%E8%A8%98-%E5%96%AE%E5%85%83%E6%B8%AC%E8%A9%A6%E7%AF%87-156455e2ad9f\nå¦‚ä½•ä½¿ç”¨ GitLab CIï¼šhttps://medium.com/@mvpdw06/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-gitlab-ci-ebf0b68ce24b"},"title":"å¦‚ä½•å¾é ­æ‰“é€ å°ˆå±¬çš„ GitLab CI/CD"},"/blog/git-or-cicd/gitlab-package-registry-to-gcs/":{"data":{"":"ä»Šå¤©æ¥åˆ°ä¸€å€‹æ¡ˆå­ï¼ŒRD éƒ¨é–€ä¹‹å¾Œæƒ³è¦ä½¿ç”¨ GitLab çš„ Package Registry åŠŸèƒ½ä¾†ç™¼å¸ƒå¥—ä»¶ï¼Œä¸”ä¸æƒ³æŠŠå®ƒå­˜åœ¨ GitLab ä¼ºæœå™¨ä¸Šï¼Œå¸Œæœ›å¯ä»¥ç›´æ¥å­˜åˆ° GCP çš„ Google Cloud Storage ä¸Šï¼Œæ‰€ä»¥æ‰æœƒæœ‰äº†æ­¤ç¯‡ç­†è¨˜ä¾†è¨˜éŒ„ä¸€ä¸‹æ•´å€‹éç¨‹ã€‚\nç‰ˆæœ¬è³‡è¨Š\nGitLab 14.10 (æœ‰éƒ¨åˆ†è¨­å®šæœƒæ–¼æ–°ç‰ˆæœ¬æ£„ç”¨ï¼Œè«‹è¨˜å¾—ç¢ºèªå¥½è‡ªå·±çš„ç‰ˆæœ¬æ˜¯å¦æ”¯æ´) å…ˆèªªä¸€ä¸‹ï¼Œæˆ‘å€‘çš„ GitLab æ˜¯ä½¿ç”¨ docker-compose ä¾†å»ºç½®ï¼Œæ‰€ä»¥å¾ŒçºŒçš„å¯¦ä½œå…§å®¹éƒ½æœƒä»¥ docker-compose çš„æ–¹å¼ä¾†ä»‹ç´¹ã€‚","å…ˆæŸ¥çœ‹å°šæœªé‡å•Ÿçš„-gitlab-package#å…ˆæŸ¥çœ‹å°šæœªé‡å•Ÿçš„ GitLab Package":"ç”±æ–¼å…¬å¸ GitLab é è¨­æœ‰å…ˆé–‹å•Ÿ packages_enabledï¼Œæ‰€ä»¥æˆ‘å°±æ‹¿åŒäº‹ç”¨ Helm å¯«çš„ CIï¼Œä¾†åšæ¸¬è©¦ã€‚ç•¶æ›´æ–° value.yaml å¾Œæœƒè‡ªå‹•æ‰“åŒ… Package æ”¾åˆ° Package Registry ä¸­ï¼Œæˆ‘å€‘ç›´æ¥é€²å…¥åˆ°é è¨­ Package Registry çš„å„²å­˜ä½ç½®ï¼Œæ˜¯åœ¨ /var/opt/gitlab/gitlab-rails/shared/packages/ï¼Œç”¨æŒ‡ä»¤ç™¼ç¾æ‰“åŒ…çš„ Package çš„ç¢ºå­˜æ”¾æ–¼æ­¤ ï¼Œå¦‚ä¸‹ï¼š\næª¢æŸ¥æ˜¯å¦é‚„æœ‰ Package åœ¨é è¨­å„²å­˜ä½ç½® (å°šæœªé·ç§»)","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"GitLab Package Registry administrationï¼šhttps://docs.gitlab.com/14.10/ee/administration/packages/","å•Ÿå‹•-gitlab-çš„-package-registry#å•Ÿå‹• GitLab çš„ Package Registry":"é¦–å…ˆï¼Œæˆ‘å€‘ç•¶ç„¶è¦å…ˆå•Ÿå‹•é€™é … Package Registry åŠŸèƒ½ï¼Œæ‰å¯ä»¥å†ä¹‹å¾Œä½¿ç”¨å®ƒï¼Œæˆ‘å€‘å…ˆçœ‹ä¸€ä¸‹ GitLab å•Ÿå‹•çš„ docker-compose.yml æª”æ¡ˆï¼š\nversion: '3' services: gitlab: image: 'gitlab/gitlab-ee:14.10.5-ee.0' restart: always container_name: gitlab hostname: gitlab-pid logging: driver: \"json-file\" options: max-size: \"100m\" max-file: \"50\" environment: GITLAB_OMNIBUS_CONFIG: | external_url '${GITLAB_DOMAIN}' letsencrypt['enable'] = false gitlab_rails['initial_root_password'] = '${GITLAB_ROOT_PASSWORD}' gitlab_rails['gitlab_shell_ssh_port'] = '${GITLAB_HOST_SSH_PORT}' gitlab_rails['backup_keep_time'] = 79200 gitlab_rails['omniauth_allow_single_sign_on'] = ['google_oauth2'] gitlab_rails['omniauth_block_auto_created_users'] = false gitlab_rails['omniauth_sync_profile_from_provider'] = ['google_oauth2'] gitlab_rails['omniauth_sync_profile_attributes'] = ['name', 'email'] gitlab_rails['omniauth_providers'] = [ { ç•¥éï¼ï¼ï¼ } ] ports: - '${GITLAB_HOST_SSH_PORT}:22' - '${GITLAB_HOST_HTTP_PORT}:80' - '${GITLAB_HOST_HTTPS_PORT}:443' volumes: - './config:/etc/gitlab' - './logs:/var/log/gitlab' - './data:/var/opt/gitlab' æœ‰äº›è¨­å®šæœ‰ç•¥éæˆ–æ˜¯çœç•¥ä¸å¯«ï¼Œå¤§å®¶å°±ä¾ç…§è‡ªå·±çš„è¨­å®šä¾†çœ‹å°±å¥½ï½","æ–°å¢-package-registry-è¨­å®š#æ–°å¢ Package Registry è¨­å®š":"æˆ‘å€‘åœ¨ä¸Šæ–¹çš„ gitlab_rails['omniauth_providers'] = [ ... ç•¥ ... ] ä¹‹å¾ŒåŠ ä¸Šæ–°å¢ Package Registry è¨­å®šå…§å®¹ï¼š\ngitlab_rails['packages_enabled'] = true gitlab_rails['packages_object_store_enabled'] = true gitlab_rails['packages_object_store_remote_directory'] = \"GCS åç¨±\" gitlab_rails['packages_object_store_direct_upload'] = true gitlab_rails['packages_object_store_background_upload'] = true gitlab_rails['packages_object_store_proxy_download'] = true gitlab_rails['packages_object_store_connection'] = { 'provider' =\u003e 'Google', 'google_project' =\u003e 'å°ˆæ¡ˆ ID', 'google_json_key_location' =\u003e '/etc/gitlab/google_key.json' } packages_enabledï¼šå•Ÿå‹• packages packages_object_store_enabledï¼šå•Ÿå‹• packages å°è±¡å­˜å„² packages_object_store_remote_directoryï¼šè¨­å®š packages å°è±¡å­˜å„²ä½ç½®ï¼Œé€™é‚Šè¦è¼¸å…¥ GCS çš„åç¨± packages_object_store_direct_uploadï¼šè¨­å®šæ˜¯å¦å¯ä»¥ç›´æ¥ä¸Šå‚³åˆ°å°è±¡å­˜å„²ä½ç½® packages_object_store_background_uploadï¼šè¨­å®šæ˜¯å¦ä»¥å¾Œå°æ–¹å¼ä¸Šå‚³åˆ°å°è±¡å­˜å„²ä½ç½® packages_object_store_proxy_downloadï¼šè¨­å®šæ˜¯å¦å¯ä»¥é€éä»£ç†ä¼ºæœå™¨é€²è¡Œå¥—ä»¶ä¸‹è¼‰ packages_object_store_connectionï¼šè¨­å®šé€£æ¥åˆ°å°è±¡å­˜å„²ï¼Œç”±æ–¼æˆ‘å€‘è¦å­˜åˆ° GCS ä¸Šé¢ï¼Œéœ€è¦æœ‰é€™ä¸‰é … providerã€google_projectã€google_json_key_location æ‰å¯ä»¥å°‡ packages å­˜åˆ° GCS ä¸Šã€‚å¦‚æœæƒ³ç”¨å…¶ä»–çš„å„²å­˜ä½ç½®ï¼Œä¾‹å¦‚ Amazon S3ã€Azure Blob storage å¯ä»¥åƒè€ƒ Object storage è©³ç´°è¨­å®š ( å…¶ä¸­çš„ google_json_key_location æ˜¯è¦æ”¾å¯ä»¥è®€å¯« GCS çš„ SA SECRET æª”æ¡ˆ ) ","é‡å•Ÿè¨­å®šå¾Œå†æ¬¡æª¢æŸ¥-gitlab-package#é‡å•Ÿè¨­å®šå¾Œå†æ¬¡æª¢æŸ¥ GitLab Package":"ç•¶æˆ‘å€‘é‡å•Ÿè¨­å®šå¾Œï¼Œä¹Ÿæœ‰å»ºç«‹å¥½å¯ä¾›æˆ‘å€‘æ¬Šé™ SA çš„ GCS å¾Œï¼Œæœƒç™¼ç¾åŸæœ¬å­˜åœ¨é è¨­ /var/opt/gitlab/gitlab-rails/shared/packages/ æ²’æœ‰è‡ªå‹•è·‘åˆ° GCS ä¸Šï¼Œæ˜¯å› ç‚ºæˆ‘å€‘é‚„éœ€è¦æ‰‹å‹•ä¸‹æŒ‡ä»¤å°‡ä»–é·ç§»éå»ï¼ŒæŒ‡ä»¤æ˜¯ gitlab-rake \"gitlab:packages:migrate\"ï¼Œæœ€å¾Œç­‰ä»–è·‘å®Œæˆ‘å€‘åœ¨æª¢æŸ¥ä¸€ä¸‹é è¨­å„²å­˜ä½ç½®å°±ç™¼ç¾å·²ç¶“æ²’æœ‰ Package äº†\næª¢æŸ¥æ˜¯å¦é‚„æœ‰ Package åœ¨é è¨­å„²å­˜ä½ç½® (å·²é·ç§»)\né–‹ GCS ç¶²ç«™ä¾†çœ‹æœƒç™¼ç¾åŸå…ˆåœ¨é è¨­å„²å­˜ä½ç½®çš„ Package éƒ½å¯ä»¥è·‘åˆ° GCS ä¸Šï¼š\næŸ¥çœ‹å·²é·ç§»åˆ° Google Cloud Storage çš„ Package"},"title":"å¦‚ä½•å•Ÿç”¨ GitLab çš„ Package Registry ä»¥åŠå°‡å„²å­˜ä½ç½®å¾ä¼ºæœå™¨æ”¹åˆ° GCS ä¸Š"},"/blog/git-or-cicd/laravel-gitlab-cicd-heroku/":{"data":{"":"ç¶“éä¸Šä¸€ç¯‡æ–‡ç«  å¦‚ä½•å¾é ­æ‰“é€ å°ˆå±¬çš„ GitLab CI/CD çš„å­¸ç¿’ï¼Œè®“æˆ‘å€‘äº†è§£åˆ° GitLab CI/CD çš„æ•´å€‹æµç¨‹ï¼Œæ¥è‘—æˆ‘å€‘æœ¬æ¬¡è¦æŠŠ Laravel çµ¦éƒ¨ç½²åˆ° Heroku é€é GitLab çš„ CI/CD å»é”æˆï¼Œä¸éœ€è¦é€éä»»ä½•äººå·¥å»æ¸¬è©¦ï¼Œä¸¦ä¸Šæ¶ç¨‹å¼åˆ° HeroKu ä¸Šï¼Œå…¨éƒ¨éƒ½ä¾è³´ GitLab CI/CDï¼Œè®“æˆ‘å€‘æ¥è‘—çœ‹ä¸‹å»å§ï¼\nç•¶ç„¶ï¼Œæ­¤æ–‡ç« ç¨‹å¼ç¢¼ä¹ŸæœƒåŒæ­¥åˆ° Github ï¼Œéœ€è¦çš„ä¹Ÿå¯ä»¥å»æŸ¥çœ‹æ­ï¼è¦è¨˜å¾—å…ˆç¢ºå®šä¸€ä¸‹è‡ªå·±çš„ç‰ˆæœ¬ Github ç¨‹å¼ç¢¼é€£çµ ğŸ˜","gitlab-cd-å»ºç½®#GitLab CD å»ºç½®":"æˆ‘å€‘ç©å®Œ CI å¾Œï¼Œæ¥è‘—è¦æŠŠç¨‹å¼éƒ¨ç½²åˆ°ä¼ºæœå™¨æˆ–æ˜¯é›²ç«¯ä¸Šï¼Œé€™æ™‚å€™æˆ‘å€‘ä¸éœ€è¦é€éäººå·¥æ‰‹å‹•çš„æ–¹å¼ï¼Œåªéœ€è¦æœ‰ CD ä¾†å¹«æˆ‘å€‘è‡ªå‹•åŒ–éƒ¨ç½²å°±å¯ä»¥æ‹‰ï¼å¦‚æœä¸å¤ªæ¸…æ¥šï¼Œå¯ä»¥åƒè€ƒé€™å¼µåœ–ç‰‡ï¼š\nGitLab CI/CD workflow (åœ–ç‰‡ä¾†æºï¼šGitLab)\nç•¶æˆ‘å€‘å‰›å‰›é€²è¡Œ CI çš„æ•´åˆæ¸¬è©¦ï¼Œæœ€å¾Œç¶“é Review and approve åˆä½µåˆ°ä¸»åˆ†æ”¯ï¼Œé€™æ™‚å€™å¦‚æœæˆ‘å€‘æœ‰è¨­å®š CDï¼ŒCD å°±æœƒå¹«æˆ‘å€‘éƒ¨ç½²åˆ°æœå‹™ä¸Šï¼Œæˆ‘æŠŠ CD æµç¨‹è½‰æˆæ–‡å­—æ­¥é©Ÿèªªæ˜ï¼š\næŠŠæ–°åŠŸèƒ½åˆ†æ”¯åˆä½µåˆ° master åˆ†æ”¯ï¼Œä»£è¡¨åŠŸèƒ½å·²ç¶“å¯ä»¥ä¸Šç·š GitLab è§¸ç™¼ Gitlab-CI åŸ·è¡Œ pipeline Gitlab-CI åŸ·è¡Œè‡ªå‹•åŒ–æ¸¬è©¦ Gitlab-CI æ¸¬è©¦æˆåŠŸå¾Œï¼ŒåŸ·è¡Œéƒ¨ç½²åˆ°æ­£å¼ä¼ºæœå™¨ å›å‚³åŸ·è¡Œçµæœè‡³ GitLab é‚£æƒ³è¦é”æˆè‡ªå‹•åŒ–éƒ¨ç½²ä¹‹å‰ï¼Œå¿…é ˆèƒ½åœ¨é ç«¯ç”¨æŒ‡ä»¤ä¸‹é”éƒ¨ç½²æ›´æ–°ï¼ç°¡å–®ä¾†èªªæœ‰å…©ä»¶äº‹æƒ…ï¼š\nè¦å…ˆæ•´ç†å†æ›´æ–°å°ˆæ¡ˆæ™‚éœ€è¦å“ªäº›æŒ‡ä»¤ï¼Œä¸¦å°‡å…¶å¯«æˆè…³æœ¬ éœ€è¦ç²å¾—ä¼ºæœå™¨çš„æˆæ¬Šï¼Œå¯ä»¥å°ä¼ºæœå™¨ä¸‹é”æ›´æ–°å°ˆæ¡ˆçš„è…³æœ¬ æˆ‘å€‘ä»¥ç¾åœ¨ Laravel å°ˆæ¡ˆä¾†èªªï¼Œå¥—ç”¨ä¸Šé¢è¬›çš„å…©ä»¶äº‹æƒ…ï¼š\nè…³æœ¬è£½ä½œï¼šä¸Šç·šæ–°ç‰ˆæœ¬å¤§æ¦‚è¦åŸ·è¡Œä»¥ä¸‹åœ–ç‰‡çš„å…§å®¹ Laravel å°ˆæ¡ˆä¸Šç·šå‰æœƒä¸‹é”çš„æŒ‡ä»¤\nå°é ç«¯ä¼ºæœå™¨ä¸‹æŒ‡ä»¤ï¼šé€šå¸¸ä½¿ç”¨ ssh èˆ‡ ä¼ºæœå™¨åšæºé€šï¼Œæ‰€ä»¥å…ˆåœ¨ä¼ºæœå™¨ç”¢ç”Ÿæˆæ¬Šé‡‘é‘°çµ¦è¦é ç«¯æ§åˆ¶çš„é›»è…¦ï¼Œå¦‚æœè¦çµ¦ Gitlab-CI æ§åˆ¶çš„è©±ï¼Œä¹Ÿéœ€è¦æŠŠé‡‘é‘°å­˜åœ¨ GitLab ä¸Šï¼Œé€šå¸¸ä½¿ç”¨ ssh user@remote.server 'git pull' ä¾†ä¸‹é”æ›´æ–°å°ˆæ¡ˆçš„æŒ‡ä»¤ æœ¬ç¯‡æˆ‘å€‘è¦éƒ¨ç½²çš„æ˜¯ PaaS çš„ HeroKuï¼Œå¯ä»¥æ¸›å°‘æ™‚é–“å»æ¶è¨­ç’°å¢ƒï¼Œå°±å¯ä»¥é”åˆ°æˆ‘å€‘æƒ³è¦çš„æ•ˆæœï¼Œé‚£æ¥è‘—æœƒå¸¶å¤§å®¶å¾ Heroku è¨­å®šé–‹å§‹æ­ï¼å…ˆç°¡å–®ä»‹ç´¹ä¸€ä¸‹ Herokuï¼š\nHeroku æ˜¯ä¸€å€‹æ”¯æ´å¤šç¨®ç¨‹å¼èªè¨€çš„é›²å¹³å°å³æ™‚æœå‹™(PaaS)ï¼Œ æ˜¯ä¸€ç¨®é›²ç«¯é‹ç®—æœå‹™ï¼Œæä¾›é‹ç®—å¹³å°èˆ‡è§£æ±ºæ–¹æ¡ˆæœå‹™ï¼ŒPaaS æä¾›ä½¿ç”¨è€…å°‡é›²ç«¯åŸºç¤è¨­æ–½éƒ¨ç½²èˆ‡å»ºç«‹è‡³ä½¿ç”¨è€…ç«¯ï¼Œæˆ–è€…è—‰æ­¤ç²å¾—ä½¿ç”¨ç¨‹å¼èªè¨€ã€ç¨‹å¼åº«èˆ‡æœå‹™ã€‚ä½¿ç”¨è€…ä¸éœ€è¦ç®¡ç†èˆ‡æ§åˆ¶é›²ç«¯åŸºç¤è¨­æ–½ï¼ˆåŒ…å«ç¶²è·¯ã€ä¼ºæœå™¨ã€ä½œæ¥­ç³»çµ±æˆ–å„²å­˜ï¼‰ï¼Œä½†éœ€è¦æ§åˆ¶ä¸Šå±¤çš„æ‡‰ç”¨ç¨‹å¼éƒ¨ç½²èˆ‡æ‡‰ç”¨ä»£ç®¡çš„ç’°å¢ƒã€‚\nå‰µå»º Heroku å°ˆæ¡ˆ é‚£è¦ä½¿ç”¨ Heroku ç•¶ç„¶éœ€è¦ä¸€çµ„å¸³è™Ÿæ‹‰ï¼Œå»ºç«‹å¸³è™Ÿæˆ‘æ‡‰è©²ä¸ç”¨å†å¤šä»‹ç´¹äº†å§ ğŸ¤¡ æˆ‘å€‘ç›´æ¥åˆ° Heroku é é¢ï¼Œå³ä¸Šè§’ Newï¼Œé»é¸ Create new appï¼Œè¼¸å…¥æœ¬æ¬¡å°ˆæ¡ˆåç¨±ï¼Œæˆ‘å°±å–å« laravel-gitlab-cicd-heroku (é€™å€‹ä¸èƒ½èˆ‡åˆ¥äººé‡è¤‡ï¼Œå› ç‚ºä»–æœƒç”Ÿæˆå°ˆå±¬ç¶²é )ï¼Œ é€²å»å¾Œï¼Œé»é¸å³ä¸Šè§’æœ‰ä¸€å€‹ Open appï¼Œå°±æœƒè·³å‡ºé€™å€‹å°ˆæ¡ˆå°ˆå±¬çš„ç¶²é ï¼š\nHeroku å°ˆå±¬ç¶²é \nè¨­å®š HeroKu èˆ‡ GitLab é€£ç·š å…ˆé»é¸å³ä¸Šè§’å€‹äººé ­åƒ â†’ Account setrtings â†’ åœ¨ Account å¾€ä¸‹æ»‘ â†’ API Keyï¼Œé»é¸ Reveal ä¸¦å°‡è©² API è¨˜ä½ï¼Œé€™æ˜¯ç­‰ç­‰é€é GitLab éƒ¨ç½²æ™‚æœƒç”¨åˆ°çš„ API Tokenï¼š\nå–å¾—éƒ¨ç½²çš„ API Token\nå›åˆ° GitLab å°ˆæ¡ˆåº•ä¸‹ï¼ŒSettings â†’ CI/CD â†’ Variablesï¼Œä»–å¯ä»¥å°‡è®Šæ•¸è¨­å®šåœ¨é€™é‚Šï¼Œå†è®“ .gitlab-ci.yml ä¾†æŠ“å–è®Šæ•¸ï¼Œè¨­å®šä»¥ä¸‹å…©å€‹è®Šæ•¸ï¼š(è©³ç´°å¯ä»¥åƒè€ƒå®˜ç¶²)\nKey åç¨±(HEROKU_PRODUCTION_PROJECT_NAME)ï¼ŒValue å€¼(è¨­å®šæˆ‘å€‘å‰›å‰›åœ¨ Heroku éƒ¨ç½²çš„å°ˆæ¡ˆåç¨±ï¼Œæˆ‘çš„æ˜¯ laravel-gitlab-cicd-heroku) Key åç¨±(HEROKU_PRODUCTION_API_KEY)ï¼ŒValue å€¼(é€™å€‹å°±æ˜¯æˆ‘å€‘ä¸Šé¢çš„ API Keyï¼Œæ¯å€‹äººéƒ½è¦ç”¨è‡ªå·±çš„æ­ï¼ä¸Šé¢çš„æˆ‘å·²ç¶“é‡è¨­äº† ğŸ˜ ) gitLab è¨­å®š Variables\né€™é‚Šè¦æ³¨æ„å…ˆæŠŠé è¨­çš„ Protect variable çµ¦é—œé–‰ï¼Œä»–é è¨­æœƒåªèƒ½åœ¨å—ä¿è­·çš„åˆ†æ”¯æˆ–æ¨™ç±¤é‹è¡Œï¼Œä½†æˆ‘å€‘é€™æ­¤ä»¥ç°¡å–®ç‚ºä¸»ï¼Œæ‰€ä»¥é€™äº›è¨­å®šéƒ½å…ˆé—œæ‰ã€‚ æ–°å¢ Heroku è­˜åˆ¥æª”æ¡ˆ æ¥ä¸‹ä¾†æˆ‘å€‘è¦æ–°å¢ä¸€å€‹æª”æ¡ˆåç‚º Procfileï¼Œå®ƒæ˜¯ Heroku éƒ¨ç½²æ›´æ–°æ™‚æœƒå•Ÿå‹•çš„å°è±¡ï¼Œæ³¨æ„ä»–æ²’æœ‰å‰¯æª”åï¼Œæˆ‘å€‘åœ¨è£¡é¢è¼¸å…¥ä»¥ä¸‹ï¼š(æˆ‘å€‘ä½¿ç”¨åˆä½µå¾Œçš„ master)\næ–°å¢ HeroKu è­˜åˆ¥æª”æ¡ˆ\nå®ƒä»£è¡¨æˆ‘å€‘ç¶²é æœå‹™ä½¿ç”¨ apache2 æŒ‡ä»¤é‹è¡Œä¸¦æŠŠå…¥å£æŒ‡å‘å°ˆæ¡ˆè³‡æ–™å¤¾ä¸­çš„ laravel å°ˆæ¡ˆçš„å…¥å£è³‡æ–™å¤¾ã€‚\nä¿®æ”¹ .gitlab-ci.yml æˆ‘å€‘ä¿®æ”¹åŸæœ¬ç”¨ä¾† CI çš„è…³æœ¬ï¼Œä¾†è¨­å®šè‡ªå‹•åŒ–éƒ¨ç½²çš„ä»»å‹™ Job åŠè…³æœ¬\n.gitlab-ci.ymlimage: lorisleiva/laravel-docker:latest Production_Deploy: stage: Production_Deploy before_script: - apk add ruby ruby-dev ruby-irb ruby-rake ruby-io-console ruby-bigdecimal ruby-json ruby-bundler yarn ruby-rdoc \u003e\u003e /dev/null - apk update - gem install dpl \u003e\u003e /dev/null script: - dpl --provider=heroku --app=$HEROKU_PRODUCTION_PROJECT_NAME --api-key=$HEROKU_PRODUCTION_API_KEY æœ€å¾Œä¸Šå‚³ GitLab ä¾†è§¸ç™¼ Gitlab-CI åŸ·è¡Œè‡ªå‹•åŒ–éƒ¨ç½² (ä¸Šå‚³æŒ‡ä»¤å°±ä¸å¤šèªªå›‰ï¼Œæƒ³å¿…å¤§å®¶éƒ½æœƒäº†å§ï¼ï¼Œä¸æœƒçš„è©±å¯ä»¥å»çœ‹ Git ä»‹ç´¹ï¼Œè£¡é¢æœ‰è©³ç´°çš„ä»‹ç´¹ ğŸ˜ )\nè§¸ç™¼ Gitlab-CI åŸ·è¡Œè‡ªå‹•åŒ–éƒ¨ç½²\nå¯ä»¥çœ‹åˆ°éƒ¨ç½²æˆåŠŸï¼Œæˆ‘å€‘ä¹Ÿä¾†çœ‹çœ‹ Runner é‹ä½œç‹€æ³ï¼š\nRunner é‹ä½œç‹€æ³\nçœ‹åˆ°ä»–æˆåŠŸå°‡æœå‹™çµ¦éƒ¨ç½²åˆ° https://laravel-gitlab-cicd-heroku.herokuapp.com/ã€‚\næ—¢ç„¶å·²ç¶“éƒ¨ç½²å¥½äº†ï¼Œç•¶ç„¶è¦å»çœ‹ä¸€ä¸‹æˆ‘å€‘çš„ç¶²é å•Šï¼Œä½†ç•¶æˆ‘å€‘æ‰“é–‹éƒ¨ç½²å¥½çš„ç¶²é ï¼Œæœƒç™¼ç¾è·³å‡º 500 Errorï¼Œé›–ç„¶ä»–èˆ‡æˆ‘å€‘ CI/CD æ²’æœ‰é—œä¿‚ï¼Œä½†æˆ‘å€‘é‚„æ˜¯è©¦è‘—è§£æ±ºï¼Œé‚£é€™å€‹å•é¡Œæœƒç™¼ç”Ÿæ˜¯å› ç‚ºæˆ‘å€‘æ²’æœ‰çµ¦ç’°å¢ƒè®Šæ•¸çš„ APP_KEYï¼Œé€™å€‹ Key å¯ä»¥åœ¨å°ˆæ¡ˆçš„ .env å–å¾—ï¼Œæ‹¿åˆ°å¾Œé–‹å•Ÿ Heroku â†’ Setting â†’ Config vars å°‡ APP_KEY è¨­å®šä¸Šå»ã€‚\nRunner é‹ä½œç‹€æ³\næœ€å¾Œé‡æ–°æ•´ç† https://laravel-gitlab-cicd-heroku.herokuapp.com/ï¼Œå°±å¯ä»¥çœ‹åˆ°æˆ‘å€‘éƒ¨ç½²ä¸Šå»çš„ç¶²ç«™å›‰ï¼\né€é CD éƒ¨ç½²åˆ° Heroku çš„ Laravel é¦–é ","gitlab-ci-å»ºç½®#GitLab CI å»ºç½®":"ä¸Šå‚³ Laravel å°ˆæ¡ˆ æ¥ä¸‹ä¾†æˆ‘å€‘è¦ä¸Šå‚³å«æœ‰ Unit Test å°ˆæ¡ˆåˆ° GitLab ä¸Šï¼Œæ­¥é©Ÿå¦‚ä¸‹ï¼Œå¦‚æœå·²ç¶“ç†Ÿæ‚‰å¦‚ä½•å°‡å°ˆæ¡ˆæ¨åˆ° GitLabï¼Œå¯ä»¥ç›´æ¥è·³åˆ° åœ¨ GitLab ä¸ŠåŸ·è¡Œå–®å…ƒæ¸¬è©¦\nåœ¨ gitlab.com ä¸Šé»é¸å»ºç«‹å°ˆæ¡ˆï¼Œé¸æ“‡ Create blank projectï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç€è¦½è©²ç¶²å€ https://gitlab.com/projects/new#blank_projectã€‚ è¼¸å…¥å°ˆæ¡ˆåç¨±å¯ä»¥é¸æ“‡ Project deployment target ç‚º Herokoï¼Œé¸æ“‡ Publicï¼Œæœ€å¾ŒæŒ‰ä¸‹ Create project åœ¨ GitLab ä¸Šå»ºç«‹æ–°å°ˆæ¡ˆ\næ–¼å°ˆæ¡ˆè³‡æ–™å¤¾ä¸‹åŠ å…¥ remote é ç«¯ GitLabï¼Œä¸¦ Push å°‡å°ˆæ¡ˆæ¨ä¸Šå»ã€‚ å°‡ Laravel å°ˆæ¡ˆæ¨åˆ° GitLab ä¸Š\næˆåŠŸæ¨ä¸Šå»ï¼Œå¯ä»¥åˆ° GitLab ä¸Šï¼Œçœ‹åˆ°æˆ‘å€‘å‰›å‰›çš„å°ˆæ¡ˆï¼\næˆåŠŸæ¨åˆ° GitLab ä¸Š\nåœ¨ GitLab ä¸ŠåŸ·è¡Œå–®å…ƒæ¸¬è©¦ è¦åœ¨ GitLab ä¸ŠåŸ·è¡Œ CI/CD å°±éœ€è¦æœ‰ Runnerï¼Œé€™æ¬¡æˆ‘å€‘é¸æ“‡ä½¿ç”¨ gitlab.com çš„ Shared runnersï¼Œæƒ³è¦ä½¿ç”¨ Specific runnersï¼Œå¯ä»¥æŸ¥çœ‹ä¸Šä¸€ç¯‡ å¦‚ä½•å¾é ­æ‰“é€ å°ˆå±¬çš„ GitLab CI/CD æ–‡ç« \næœ¬æ¬¡ä½¿ç”¨ Share runners\næ¥ä¸‹ä¾†åœ¨å°ˆæ¡ˆçš„æ ¹ç›®éŒ„æ’°å¯«æˆ‘å€‘çš„ .gitlab-ci.yml æª”æ¡ˆï¼Œä¹‹å¾Œå†æ¬¡ä¸Šå‚³ GitLabï¼Œç•¶æˆ‘å€‘æ ¹ç›®éŒ„æœ‰æ­¤æª”æ¡ˆï¼ŒGitLab-CI å°±æœƒè®€å–ä¸¦ä¾ç…§å…§å®¹å•Ÿå‹• Runner ä¾†åŸ·è¡Œå·¥ä½œï¼š\n.gitlab-ci.ymlimage: lorisleiva/laravel-docker:latest Unit_test: before_script: - composer install --prefer-dist --no-ansi --no-interaction --no-progress --no-scripts script: - ./vendor/bin/phpunit --testsuit Unit --coverage-text --colors=never èªªæ˜ä¸€ä¸‹é€™å€‹ yml æª”å…§çš„è¨­å®šæ˜¯åœ¨åšä»€éº¼ï¼š\nimageï¼šå› ç‚ºæˆ‘å€‘åŸ·è¡Œ CI/CD éç¨‹ä¸­ï¼Œéœ€è¦æœ‰ PHPã€Composeã€NPM ç­‰å·¥å…·ï¼Œæœ‰é€™äº›å¥—ä»¶ç®¡ç†å·¥å…·å°±å¯ä»¥å»¶ä¼¸å»å®‰è£æ›´å¤šå¥—ä»¶ï¼Œå¦‚æœä¸€é–‹å§‹æ²’æœ‰å®‰è£ï¼Œå°±æœƒå¾ˆéº»ç…©ï¼Œå…¶ä¸­ä¸€å€‹è¾¦æ³•å°±æ˜¯å» Runner ç’°å¢ƒä¿®æ”¹ä¸¦å®‰è£ï¼Œä½†å› ç‚ºæ–¹ä¾¿ä»¥åŠæˆ‘å€‘é€™æ¬¡ä½¿ç”¨ Share runnersï¼Œæ‰€ä»¥ä¸èƒ½ä¿®æ”¹åˆ¥äººçš„ Runnerï¼Œå¦ä¸€å€‹è¾¦æ³•æ˜¯å¯ä»¥ä½¿ç”¨ image é—œéµå­—ï¼Œå¯ä»¥è®“ Runner åˆ‡æ›åˆ°å¦ä¸€å€‹ç’°å¢ƒå»åŸ·è¡Œå·¥ä½œ (Job)ï¼Œæˆ‘å€‘é€™é‚Šä½¿ç”¨ lorisleiva/laravel-docker:latest ï¼Œä»–è£¡é¢å·²ç¶“å¹«æˆ‘å€‘å®‰è£å¥½ä¸Šè¿°çš„å·¥å…·äº†ï¼ Unit_testï¼šé€™é‚Šä¹Ÿæ˜¯æˆ‘å€‘çš„ Jobï¼Œé‚£è£¡é¢ä¸»è¦æ˜¯å…ˆç”¨ composer install å»å®‰è£æˆ‘å€‘éœ€è¦çš„å¥—ä»¶ï¼Œæœ€å¾Œåœ¨åŸ·è¡Œ phpunit ä¾†åšå–®å…ƒæ¸¬è©¦ã€‚ ä¸Šå‚³ .gitlab-ci.yml æ¥è‘—æˆ‘å€‘ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤å°‡å«æœ‰ .gitlab-ci.yml çš„å°ˆæ¡ˆä¸Šå‚³åˆ° GitLabï¼Œä¸¦å›åˆ° GitLab é¸æ“‡ CI/CDï¼Œå¯ä»¥æŸ¥çœ‹ç›®å‰çš„ Pipelinesï¼Œæœƒæœ‰æˆ‘å€‘å‰›å‰›æ‰€æ–°å¢çš„ Runnerã€‚\nå°‡ .gitlab-ci.yml æ¨åˆ° GitLab\næŸ¥çœ‹ Runner å·²ç¶“é€²è¡ŒåŸ·è¡Œå–®å…ƒæ¸¬è©¦æª¢æ¸¬\nå¯ä»¥çœ‹åˆ° Runner å…ˆå®‰è£æˆ‘å€‘çš„ç’°å¢ƒï¼Œå†åŸ·è¡Œå–®å…ƒæ¸¬è©¦çš„è…³æœ¬\nè¨­ç½®é ˆé€šéæ¸¬è©¦æ‰å¯ä»¥åˆä½µ ç•¶æˆ‘å€‘æœ‰äº†æ¸¬è©¦é‚„ä¸å¤ ï¼Œè¦æ€éº¼ç¢ºä¿æ¯éš»è¦ä¸Šç·š (åˆä½µåˆ°ä¸»åˆ†æ”¯) çš„ç¨‹å¼éƒ½æœ‰ç¶“éæ¸¬è©¦æ‰ä¸Šç·šå‘¢ï¼Ÿ\næ¥ä¸‹ä¾†æˆ‘å€‘å¯ä»¥åœ¨ GitLab è£¡é¢åšé€™äº›è¨­å®šï¼Œå…ˆåˆ°å°ˆæ¡ˆçš„ Setting â†’ General â†’ Merge requests â†’ Merge checks é»é¸ Pipelines must succeedï¼š\né»é¸ Pipelines must succeed ä¾†ç¢ºä¿ç¨‹å¼åˆä½µå‰éƒ½å¿…é ˆç¶“éæ¸¬è©¦\næ¸¬è©¦æ˜¯å¦å¯ä»¥é˜»æ“‹æœªæˆåŠŸæƒ…æ³ æˆ‘å€‘å…ˆæ¨¡æ“¬è¦é–‹ç™¼æ–°åŠŸèƒ½ï¼Œæ‰€ä»¥åœ¨ master æœ€æ–° commit ä¸‹ï¼Œå»ºç«‹ä¸€å€‹æ–°åˆ†æ”¯ new\ngit checkout -b \"new\" æ¥è‘—ä¿®æ”¹å–®å…ƒæ¸¬è©¦ï¼Œæ•…æ„æ–°å¢éŒ¯èª¤çš„æ¸¬è©¦ï¼Œé–‹å•Ÿå°ˆæ¡ˆçš„ tests/Unit/ExampleTest.phpï¼Œæœ€ä¸‹é¢åŠ ä¸Šç´…è‰²æ¡†æ¡†ç¨‹å¼ç¢¼ï¼š\næ–°å¢éŒ¯èª¤æ¸¬è©¦ï¼Œé‚„æ¨¡æ“¬çœ‹çœ‹æ˜¯å¦èƒ½æˆåŠŸæ“‹ä½\nassertEquals æœƒæª¢æŸ¥é€™å…©å€‹å€¼æ˜¯å¦ç›¸åŒï¼Œä¸åŒçš„è©±ï¼Œå°±æœƒè·³å‡ºéŒ¯èª¤ï¼Œæ‰€ä»¥æˆ‘å€‘æ•…æ„è¼¸å…¥ 1 å’Œ 2ã€‚\nä¸¦å°‡å®ƒä¸Šå‚³åˆ° GitLabï¼Œä¸¦ç™¼å‡º Merge Request çœ‹çœ‹æœƒæœ‰ä»€éº¼çµæœï¼\nå°‡æ–°å¢éŒ¯èª¤çš„ ExampleTest åŠ å…¥æš«å­˜ï¼Œæ¨åˆ° GitLab\nä¸¦å°‡ new åˆ†æ”¯é€é Merge Request ä¾†åˆä½µåˆ° master\nå¯ä»¥çœ‹åˆ°æˆ‘å€‘åˆä½µåœ¨ Pipeline æ¸¬è©¦æ™‚ï¼Œå› ç‚º new æ²’æœ‰é€šéæ¸¬è©¦ï¼Œæ‰€ä»¥ä¹Ÿæ²’æœ‰è¾¦æ³•é€²è¡Œåˆä½µï¼\nåˆ†æ”¯ new æ²’æœ‰é€šéæ¸¬è©¦ï¼Œæ‰€ä»¥æ²’æœ‰é€²è¡Œ Merge","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"Gitlab-CI å…¥é–€å¯¦ä½œæ•™å­¸ - å–®å…ƒæ¸¬è©¦ç¯‡ï¼šhttps://nick-chen.medium.com/gitlab-ci-%E5%85%A5%E9%96%80%E7%AD%86%E8%A8%98-%E5%96%AE%E5%85%83%E6%B8%AC%E8%A9%A6%E7%AF%87-156455e2ad9f\nGitlab-CI è‡ªå‹•åŒ–éƒ¨å±¬éƒ¨ç½²ï¼šhttps://medium.com/@nick03008/%E6%95%99%E5%AD%B8-gitlab-ci-%E5%85%A5%E9%96%80%E5%AF%A6%E4%BD%9C-%E8%87%AA%E5%8B%95%E5%8C%96%E9%83%A8%E7%BD%B2%E7%AF%87-ci-cd-%E7%B3%BB%E5%88%97%E5%88%86%E4%BA%AB%E6%96%87-cbb5100a73d4\néƒ¨ç½² Laravel æ–¼ Heroku æ­é… Gitlab CI/CDï¼šhttps://medium.com/@vip131430g/%E9%83%A8%E7%BD%B2-laravel-%E6%96%BC-heroku-%E6%90%AD%E9%85%8D-gitlab-ci-cd-6d59a66aebdb","å»ºç«‹-laravel-å°ˆæ¡ˆ#å»ºç«‹ Laravel å°ˆæ¡ˆ":"è«‹å¤§å®¶ä¾ç…§ Laravel å®˜æ–¹æ–‡ä»¶ä¾†å»ºç«‹ Laravel ç’°å¢ƒï¼Œä¹Ÿå¯ä»¥çœ‹å°å¼Ÿæˆ‘çš„æ–‡ç« æ‹‰ ğŸ‘†ğŸ‘†ğŸ‘†ï¼Œè«‹è¨˜å¾—è¦å…ˆå®‰è£å¥½ php ä»¥åŠ composerï¼Œæ¥è‘—æŒ‰ç…§ä»¥ä¸‹æ­¥é©Ÿä¾†å»ºç«‹ã€‚\næ–°å»ºä¸€å€‹ Laravel æ–°å°ˆæ¡ˆ\né€™æ™‚å€™ç€è¦½ http://127.0.0.1:8000ï¼Œå¦‚æœéƒ½æ­£ç¢ºï¼Œæ‡‰è©²æœƒçœ‹åˆ° Laravel çš„é¦–é \nLaravel é¦–é ","æ¸¬è©¦æœ¬åœ°-unit-test#æ¸¬è©¦æœ¬åœ° Unit Test":"æ¥è‘—æˆ‘å€‘å‰›å‰›æœ‰æåˆ°é¸ç”¨ Laravel çš„åŸå› æ˜¯ Laravel æœ‰ PHPUnit å–®å…ƒæ¸¬è©¦å¯ä»¥ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘å€‘ç¾åœ¨å…ˆåœ¨æœ¬åœ°ç«¯ä¾†æ¸¬è©¦ Unit Testï¼Œå°ˆæ¡ˆé è¨­æœ‰æ”¾ä¸€å€‹å–®å…ƒæ¸¬è©¦åœ¨ tests/Unit/ExampleTest.phpã€‚æˆ‘å€‘å…ˆå†æ¬¡ç¢ºèªç’°å¢ƒæ˜¯å¦æœ‰å®‰è£å¥½ï¼Œå†ä¾†åŸ·è¡Œå–®å…ƒæ¸¬è©¦ã€‚\nåœ¨æœ¬åœ°ç«¯åŸ·è¡Œå–®å…ƒæ¸¬è©¦\nåŸ·è¡Œå¾Œï¼Œæ‡‰è©²éƒ½æœƒæ˜¯é€šéçš„ç•«é¢ï¼Œå¦‚ä¸‹åœ–ï¼š\nåŸ·è¡Œå–®å…ƒæ¸¬è©¦çµæœ","ç‰ˆæœ¬è³‡è¨Š#ç‰ˆæœ¬è³‡è¨Š":" macOSï¼š11.6 Dockerï¼šDocker version 20.10.14, build a224086 Laravel Installerï¼š2.3.0 Laravel Frameworkï¼š9.14.1 gitlab.comï¼šGitLab Enterprise Edition 15.1.0-pre é¦–å…ˆï¼Œæˆ‘å€‘ç¬¬ä¸€æ­¥é©Ÿå°±æ˜¯å…ˆå»ºç«‹ä¸€å€‹ Laravel å°ˆæ¡ˆï¼Œè‡³æ–¼ç‚ºä»€éº¼è¦é¸æ“‡ç”¨ Laravel ä¾†ç•¶ä½œ GitLab CI/CD çš„ç¯„ä¾‹å‘¢ï¼Ÿå› ç‚º Laravel å…§å»ºæœ‰ PHPUnit çš„æ¸¬è©¦è…³æœ¬ï¼Œå¯ä»¥è®“æˆ‘å€‘åœ¨ CI æ¸¬è©¦æ™‚ï¼Œæ›´å¥½çš„å±•ç¾ CI çš„åŠŸèƒ½ï¼ï¼Œæœ‰é—œæ–¼ Laravel ç›¸é—œå…§å®¹ï¼Œé€™é‚Šä¸€æ¨£æ¨è–¦å…©ç¯‡æ–‡ç« çµ¦å¤§å®¶é–±è®€ï¼šğŸ¤£\nLaravel ä»‹ç´¹ (ä½¿ç”¨ Laravel å¾é›¶åˆ°æœ‰é–‹ç™¼å‡ºä¸€å€‹ç•™è¨€æ¿åŠŸèƒ½ä¸¦æ­é… RESTful API ä¾†å¯¦ç¾ CRUD) Laravel é€²éš (å…§å»ºæœƒå“¡ç³»çµ±ã€é©—è­‰ RESTful API æ˜¯å¦ç™»å…¥ã€ä½¿ç”¨ Repository è¨­è¨ˆæ¨¡å¼) åˆå·¥å•†äº†ä¸€æ³¢ XD"},"title":"éƒ¨ç½² Laravel æ–¼ Heroku æ­é… GitLab CI/CD"},"/blog/kubernetes/":{"data":{"":"æ­¤åˆ†é¡åŒ…å« Kubernetes ç›¸é—œçš„æ–‡ç« ã€‚\nåœ¨æ­£å¼ç’°å¢ƒä¸Šè¸©åˆ° StatefulSet çš„é›·ï¼Œæ‹¿åˆ° P1 çš„æ•™è¨“ éƒ¨ç½² Pod é‡åˆ° container veth name provided (eth0) already exists éŒ¯èª¤ Kubernetes (K8s) HorizontalPodAutoscaler (HPA) åŸç†èˆ‡å¯¦ä½œ Kubernetes (K8s) è‡ªå®šç¾© PHP HorizontalPodAutoscaler (HPA) æŒ‡æ¨™ ç”¨å¤§å‹ç¤¾å€ä¾†ä»‹ç´¹ Kubernetes å…ƒä»¶ "},"title":"Kubernetes"},"/blog/kubernetes/gcp-k8s-hpa-php-custom-metrics/":{"data":{"":"æ­¤ç¯‡è¦ä»‹ç´¹ HorizontalPodAutoscaler çš„è‡ªå®šç¾©æŒ‡æ¨™ï¼ŒK8s å…§å»ºçš„æŒ‡æ¨™ (metrics) åªæ”¯æ´ CPU ä»¥åŠ Memoryï¼Œå¦‚æœæˆ‘å€‘ä»Šå¤©æƒ³è¦ä½¿ç”¨å…¶ä»–çš„æŒ‡æ¨™ä¾†è®“ HPA æ“´ç¸®å‘¢ï¼ï¼Ÿ ä¸çŸ¥é“ä»€éº¼æ˜¯ HorizontalPodAutoscaler å—ï¼Ÿå¯ä»¥å…ˆæŸ¥çœ‹ï¼š\nKubernetes (K8s) HorizontalPodAutoscaler (HPA) åŸç†èˆ‡å¯¦ä½œ é€™æ™‚å€™æˆ‘å€‘å°±å¿…é ˆä½¿ç”¨è‡ªå®šç¾©æŒ‡æ¨™ï¼Œæˆ‘å€‘ä¸€æ¨£ä¾†èªªèªªä»–çš„å·¥ä½œåŸç†å§ï¼šHorizontalPodAutoscaler æ˜¯æ€éº¼å–å¾—è‡ªå®šç¾©æŒ‡æ¨™ï¼Œä»¥åŠæ˜¯è·Ÿèª°æ‹¿åˆ°æŒ‡æ¨™çš„å‘¢ï¼Ÿæˆ‘å€‘å¾ä¸‹åœ–å¾—çŸ¥ï¼š\nKubernetes HPA : ExternalMetrics+Prometheus\nHorizontalPodAutoscaler æœƒå…ˆè¨ªå• K8s çš„ APIï¼Œä¸¦å‘ API å–å¾—æŒ‡æ¨™è³‡æ–™ã€‚é€™é‚Šçš„ API å°±æ˜¯ custom.k8s.io/v1beta1ã€‚\nå¤§è‡´äº†è§£å¾Œï¼Œæˆ‘å€‘å°±ä¾†é€²å…¥ä»Šå¤©çš„é‡é»ï¼Œä¹Ÿå°±æ˜¯é€éè‡ªå®šç¾©åŒ– PHP çš„æŒ‡æ¨™ä¾†è®“ HorizontalPodAutoscaler é€²è¡Œæ“´ç¸®ï¼Œé€™æ¬¡ä½¿ç”¨çš„å¹³å°æ˜¯ Google Cloud Platformï¼Œå‰é¢ä»‹ç´¹ GCP æœå‹™çš„å¤§å®¶å¯ä»¥åƒè€ƒ Google Cloud Platform (GCP) ç™¾ç§‘å…¨æ›¸ - ä»‹ç´¹èˆ‡é–‹é ­ [ EP.0 ]ï¼Œæˆ‘å€‘é€™é‚Šå°±ç›´æ¥è·³åˆ°ç¨‹å¼ç¢¼èˆ‡æ“ä½œéƒ¨åˆ†ã€‚\næ­¤æ–‡ç« ç¨‹å¼ç¢¼ä¹ŸæœƒåŒæ­¥åˆ° Github ï¼Œéœ€è¦çš„ä¹Ÿå¯ä»¥å» clone ä½¿ç”¨æ­ï¼ Github ç¨‹å¼ç¢¼é€£çµ ğŸ˜†","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"Autoscaling Deployments with Cloud Monitoring metricï¼šhttps://cloud.google.com/kubernetes-engine/docs/tutorials/autoscaling-metrics#custom-prometheus_1\nGoogleCloudPlatform/k8s-stackdriverï¼šhttps://github.com/GoogleCloudPlatform/k8s-stackdriver/tree/master/custom-metrics-stackdriver-adapter\nhipages/php-fpm_exporterï¼šhttps://github.com/hipages/php-fpm_exporter\nScaling PHP-FPM with custom metrics on GKE/kubernetesï¼šhttps://www.ashsmith.io/scaling-phpfpm-with-custom-metrics-gke","å¯¦ä½œ#å¯¦ä½œ":"å®‰è£è‡ªå®šç¾©çš„ Adapter æˆ‘å€‘è¦å…ˆ Apply è‡ªå®šç¾©çš„ Adapterï¼Œé€™é‚Šæˆ‘å€‘ä½¿ç”¨ Google æä¾›çš„ Stackdriver Adapter ä¾†ä½¿ç”¨ (ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ Github ç¨‹å¼ç¢¼ä¸­çš„ adapter_new_resource_model.yaml æª”æ¡ˆæ­)ï¼š\nkubectl apply -f https://raw.githubusercontent.com/GoogleCloudPlatform/k8s-stackdriver/master/custom-metrics-stackdriver-adapter/deploy/production/adapter_new_resource_model.yaml Deployment apiVersion: apps/v1 kind: Deployment metadata: name: demo labels: app: demo spec: replicas: 1 selector: matchLabels: app: demo template: metadata: labels: app: demo spec: containers: - name: php-fpm image: php:fpm workingDir: /var/www/service ports: - containerPort: 9000 resources: requests: cpu: 100m memory: 1G limits: cpu: 100m memory: 1G volumeMounts: - name: application mountPath: /var/www/service/ - name: php-fpm-config mountPath: /usr/local/etc/php-fpm.d/www.conf subPath: www.conf - name: nginx image: nginx:alpine workingDir: /var/www/service ports: - containerPort: 80 volumeMounts: - name: application mountPath: /var/www/service/ - name: nginx-config mountPath: /etc/nginx/conf.d/ - name: phpfpm-exporter image: hipages/php-fpm_exporter:latest env: - name: PHP_FPM_SCRAPE_URI value: \"tcp://localhost:9000/status\" - name: PHP_FPM_FIX_PROCESS_COUNT value: \"true\" resources: requests: cpu: 10m limits: cpu: 10m - name: prometheus-to-sd image: gcr.io/google-containers/prometheus-to-sd:v0.9.0 ports: - containerPort: 6060 protocol: TCP command: - /monitor - --stackdriver-prefix=custom.googleapis.com - --monitored-resource-type-prefix=k8s_ - --source=:http://localhost:9253 - --pod-id=$(POD_NAME) - --namespace-id=$(POD_NAMESPACE) resources: requests: cpu: 10m limits: cpu: 10m env: - name: POD_NAME valueFrom: fieldRef: fieldPath: metadata.name - name: POD_NAMESPACE valueFrom: fieldRef: fieldPath: metadata.namespace volumes: - name: application emptyDir: {} - name: php-fpm-config configMap: name: php-fpm-conf - name: nginx-config configMap: name: nginx-conf æˆ‘ä¾†ç°¡å–®èªªæ˜ä¸€ä¸‹ï¼Œé€™æ˜¯ä¸€å€‹ Deploymentï¼Œæˆ‘å€‘åœ¨æ¯ä¸€å€‹ Pod è£¡é¢éƒ½æ”¾ 4 å€‹ Containerï¼Œåˆ†åˆ¥æ˜¯ php-fpmã€nginxã€phpfpm-exporterã€prometheus-to-sd\nphp-fpm å°±æ˜¯æˆ‘å€‘è¦ä½¿ç”¨çš„ phpï¼Œnginx æœƒæä¾› 9000 Port è®“ phpfpm-exporter å»æŠ“åˆ°ç›®å‰çš„ Process æ•¸å€¼ï¼Œæœ€å¾Œä¸Ÿçµ¦ prometheus-to-sdï¼Œè®“ä»–å»é€šçŸ¥æˆ‘å€‘å‰›å‰›æ‰€å®‰è£çš„ Adapterï¼Œå°±å¯ä»¥é€é API è®“ HPA çŸ¥é“ï¼è½ä¸å¤ªæ‡‚å—ï¼Ÿæ²’é—œä¿‚ï¼Œå¹«å¤§å®¶ç•«äº†ä¸€å¼µåœ–ï¼Œè«‹åƒè€ƒä¸‹æ–¹åœ–ç‰‡ï¼š\næ¶æ§‹åœ–\nå¯ä»¥çœ‹åˆ° Deployment è£¡é¢ï¼Œæˆ‘å€‘ä½¿ç”¨ ConfigMap ä¾†æ›è¼‰ php çš„ www.conf ä»¥åŠ nginx çš„è¨­å®šæª”ï¼Œé‚£æˆ‘å€‘æ¥ä¸‹ä¾†å°±å¯«ä¸€ä»½ ConfigMap å§ï¼\nConfigMap apiVersion: v1 kind: ConfigMap metadata: name: php-fpm-conf data: www.conf: | [www] user = 900 group = 900 listen = 9000 listen.owner = 900 listen.group = 900 listen.mode = 0660 pm = dynamic pm.max_children = 150 pm.max_requests = 300 pm.start_servers = 24 pm.min_spare_servers = 24 pm.max_spare_servers = 126 pm.status_path = /status ping.path = /ping ping.response = OK catch_workers_output = yes request_terminate_timeout = 300 clear_env = no --- apiVersion: v1 kind: ConfigMap metadata: name: nginx-conf namespace: ian data: nginx.conf: | server { listen 80; listen [::]:80; server_name _; root /var/www/service/; index index.php; location / { try_files $uri $uri/ /index.php$is_args$args; } location ~ ^/(status|ping)$ { fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; include fastcgi_params; } } é€™ä»½ ConfigMap.yaml æª”æ¡ˆè£¡é¢åˆ†æˆ php-fpm-conf ä¾†æ”¾ www.confï¼Œä»¥åŠ nginx-conf ä¾†æ”¾ nginx.conf æª”æ¡ˆï¼Œé€™é‚Šè¦æ³¨æ„çš„æ˜¯ www.conf è¨˜å¾—è¦åŠ ä¸Š pm.status_path = /statusï¼Œphpfpm-exporter æ˜¯é€éé€™å€‹é é¢ä¾†ç²å¾— Process æ•¸é‡ã€‚\nHorizontalPodAutoscaler apiVersion: autoscaling/v2beta2 kind: HorizontalPodAutoscaler metadata: name: demo-hpa spec: scaleTargetRef: apiVersion: apps/v1 kind: Deployment name: demo minReplicas: 1 maxReplicas: 10 metrics: - type: Pods pods: metric: name: phpfpm_active_processes target: averageValue: 50 type: AverageValue - type: Pods pods: metric: name: phpfpm_idle_processes target: averageValue: 50 type: AverageValue - type: Pods pods: metric: name: phpfpm_total_processes target: averageValue: 50 type: AverageValue - type: Pods pods: metric: name: phpfpm_accepted_connections target: averageValue: 50 type: AverageValue é€™ä»½ HorizontalPodAutoscaler æˆ‘å€‘ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯ autoscaling/v2beta2ï¼Œ v2beta1 è·Ÿ v2beta2 çš„è¨­å®šæª”èªæ³•æœ‰äº›ä¸åŒï¼\nå¯ä»¥çœ‹åˆ°æˆ‘å€‘ metrics.pods.metric.name åˆ†åˆ¥æ˜¯ phpfpm_active_processes (æ´»å‹•çš„é€²ç¨‹å€‹æ•¸)ã€phpfpm_idle_processes (ç©ºé–’çš„é€²ç¨‹å€‹æ•¸)ã€phpfpm_total_processes (ç¸½å…±çš„é€²ç¨‹å€‹æ•¸)ã€phpfpm_accepted_connections (ç•¶å‰çš„é€£æ¥æ•¸é‡)ï¼Œå¦‚æœè¶…éæˆ‘å€‘æ‰€è¨­å®šçš„ target å€¼ï¼ŒHPA å°±æœƒä½œå‹•ã€‚\næˆ‘å€‘ä¾åºæŠŠ Deployment \u003e ConfigMap \u003e HorizontalPodAutoscaler çš„ yaml æª”æ¡ˆçµ¦ Applyï¼Œå¯ä»¥è§€å¯Ÿä¸€ä¸‹ Pod æ˜¯å¦éƒ½æœ‰æ­£å¸¸å•Ÿå‹•ï¼š\nPod æ˜¯å¦æ­£å¸¸å•Ÿå‹•\næˆ‘å€‘åˆ° HorizontalPodAutoscaler æŸ¥çœ‹æˆ‘å€‘æ‰€è¨­å®šçš„ metrics æ˜¯å¦éƒ½æœ‰æŠ“åˆ°ç›®å‰çš„å€¼ï¼š\nmetrics æ˜¯å¦éƒ½æœ‰æŠ“åˆ°ç›®å‰çš„å€¼\næˆ‘å€‘ä¹Ÿå¯ä»¥ç”¨ Google Cloud Platform çš„ç›£æ§ä¾†æŸ¥çœ‹ï¼š\nGoogle Cloud Platform çš„ç›£æ§\nä»¥ä¸Šå°±å®Œæˆ è‡ªå®šç¾© HorizontalPodAutoscaler æŒ‡æ¨™å›‰ï½ ğŸ˜"},"title":"Kubernetes (K8s) è‡ªå®šç¾© PHP HorizontalPodAutoscaler (HPA) æŒ‡æ¨™"},"/blog/kubernetes/k8s-hpa/":{"data":{"":"æ­¤ç¯‡æ˜¯è¦ä»‹ç´¹ HorizontalPodAutoscaler (HPA) çš„åŸç†ä»¥åŠå¯¦ä½œå…§å®¹ï¼Œé‚£æˆ‘å€‘å…ˆä¾†èªªæ˜ä¸€ä¸‹ HorizontalPodAutoscaler æ˜¯ä»€éº¼å§ï¼","horizontalpodautoscaler-åŸç†#HorizontalPodAutoscaler åŸç†":"HorizontalPodAutoscaler (HPA) ä¸­æ–‡å¯ä»¥å«æ°´å¹³ Pod è‡ªå‹•æ“´ç¸®ï¼Œä»–æœƒè‡ªå‹•æ›´æ–°å·¥ä½œè² è¼‰è³‡æº (Deployment æˆ– StatefulSet)ï¼Œå…¶ç›®çš„æ˜¯é€éè‡ªå‹•æ“´ç¸®å·¥ä½œè² è¼‰ä¾†æ»¿è¶³ä½¿ç”¨éœ€æ±‚ã€‚\nç°¡å–®ä¾†èªªä»–æœƒæ ¹æ“šä½ ç¾åœ¨çš„è² è¼‰å»èª¿æ•´ä½ çš„ Pod æ•¸é‡ï¼Œç•¶ç›®å‰çš„è² è¼‰è¶…éé…ç½®çš„è¨­å®šæ™‚ï¼ŒHPA æœƒæŒ‡ç¤ºå·¥ä½œè² è¼‰è³‡æº (Deployment æˆ– StatefulSet) æ“´å¢ï¼Œä¾†é¿å…å¡çˆ†åŒä¸€å€‹è² è¼‰è³‡æºã€‚\nå¦‚æœè² è¼‰æ¸›å°‘ï¼Œä¸” Pod æ•¸é‡é«˜æ–¼é…ç½®çš„æœ€å°å€¼ï¼ŒHPA ä¹ŸæœƒæŒ‡ç¤ºå·¥ä½œè² è¼‰è³‡æº (Deployment æˆ– StatefulSet) æ…¢æ…¢ç¸®æ¸›ã€‚å…¶ä¸­æ°´å¹³ Pod è‡ªå‹•æ“´ç¸®ä¸é©ç”¨ DaemonSet å·¥ä½œè² è¼‰è³‡æºã€‚\nHPA æ˜¯å¦‚ä½•å·¥ä½œå‘¢ï¼Ÿ HorizontalPodAutoscaler å·¥ä½œæµç¨‹åœ–\nKubernetes å°‡æ°´å¹³ Pod è‡ªå‹•æ“´ç¸®å®šç¾©ç‚ºä¸€å€‹é–“æ­‡é‹è¡Œçš„æ§åˆ¶è¿´è·¯ï¼Œä»–ä¸æ˜¯é€£çºŒçš„ï¼Œå…¶é–“éš”æ˜¯ç”± kube-controller-manager çš„ --horizontal-pod-autoscaler-sync-period åƒæ•¸ä¾†é…ç½®ï¼Œé è¨­æ˜¯ 15 ç§’ï¼Œcontroller-manager æœƒä¾æ“šæ¯ä¸€å€‹ HPA å®šç¾©çš„ scaleTargetRef ä¾†æ‰¾åˆ°æ˜¯å“ªä¸€å€‹å·¥ä½œè² è¼‰è³‡æºéœ€è¦é€²è¡Œæ°´å¹³ Pod è‡ªå‹•æ“´ç¸®ï¼Œç„¶å¾Œæ ¹æ“šç›®æ¨™è³‡æºçš„ .spec.selector æ¨™ç±¤é¸æ“‡å°æ‡‰çš„ Podï¼Œä¸¦å¾è³‡æºæŒ‡æ¨™ API æˆ–è‡ªå®šç¾©æŒ‡æ¨™ç²å– APIï¼Œç›®å‰ç¸½å…±æœ‰ä¸‰ç¨®çš„è³‡æºæŒ‡æ¨™ï¼Œåˆ†åˆ¥æ˜¯ CPUã€Memoryã€è‡ªå®šç¾©æŒ‡æ¨™ã€‚\næœ‰é—œæ–¼å…¶ä»– Kubernetes è§€å¿µéƒ¨åˆ†ï¼Œå¯ä»¥å…ˆæŸ¥çœ‹ï¼š\nKubernetes : Kubernetes (K8s) ä»‹ç´¹ - åŸºæœ¬ kubernetes : Kubernetes (K8s) ä»‹ç´¹ - é€²éš (Serviceã€Ingressã€StatefulSetã€Deploymentã€ReplicaSetã€ConfigMap) æ­¤æ–‡ç« ç¨‹å¼ç¢¼ä¹ŸæœƒåŒæ­¥åˆ° Github ï¼Œéœ€è¦çš„ä¹Ÿå¯ä»¥å» clone ä½¿ç”¨æ­ï¼è¦è¨˜å¾—å…ˆç¢ºå®šä¸€ä¸‹è‡ªå·±çš„ç‰ˆæœ¬ Github ç¨‹å¼ç¢¼é€£çµ ğŸ˜†","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"Horizontal Pod Autoscalingï¼šhttps://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/\nHorizontalPodAutoscaler Walkthroughï¼šhttps://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/","å¯¦ä½œ#å¯¦ä½œ":"é€™æ¬¡å¯¦ä½œè¦ä½¿ç”¨çš„å¢é›†æ˜¯ Minikubeï¼Œæ‰€ä»¥ç…§ä»¥å‰æ–‡ç« ä¸€æ¨£ï¼Œæˆ‘å€‘å…ˆå•Ÿå‹• Minikubeã€‚æœ¬æ¬¡æœƒä½¿ç”¨ K8s çš„ç®¡ç†å·¥å…·ï¼šk8slens ä¾†åšç‚ºè¼”åŠ©ï¼Œå¤§å®¶æœ‰èˆˆè¶£ä¹Ÿå¯ä»¥å…ˆå»ä¸‹è¼‰ä¾†ä½¿ç”¨æ­ ğŸ˜˜\nå•Ÿå‹• Minikube å¢é›† å•Ÿå‹• Minikube å¢é›† minikube start --vm-driver=docker å•Ÿå‹• Minikube\nè¨­å®š Metrics Server ç”±æ–¼æˆ‘å€‘ HorizontalPodAutoscaler æœƒæ ¹æ“šç¾åœ¨çš„è² è¼‰ä¾†åˆ¤æ–·æ˜¯å¦è¦æ–°å¢æ–°çš„ Pod ä¾†è§£æ±ºè² è¼‰è³‡æºç”¨å®Œçš„å•é¡Œï¼Œæ‰€ä»¥ç¬¬ä¸€å€‹æ¢ä»¶å°±æ˜¯è¦å…ˆç²çš„ç›®å‰çš„è² è¼‰è³‡æºä½¿ç”¨é‡ï¼Œé€™æ™‚å€™æˆ‘å€‘å¿…é ˆå…ˆåœ¨ K8s å¢é›†ä¸Šå®‰è£ Metrics Serverï¼Œé€éä»–è®“æˆ‘å€‘å¯ä»¥çŸ¥é“ç›®å‰çš„è² è¼‰ä½¿ç”¨é‡ï¼\nå…ˆåˆ° kubernetes-sigs/metrics-server ä¸‹è¼‰æœ€æ–°çš„ components.yaml æª”æ¡ˆä¸‹ä¾†ï¼Œä»¥æˆ‘é€™æ¬¡ç¤ºç¯„çš„ç‰ˆæœ¬ç‚ºä¾‹ï¼Œå¤§å®¶å¯ä»¥é»æˆ‘ä¸‹è¼‰ ğŸ‘‡\nä¸‹è¼‰å®Œï¼Œéœ€è¦å…ˆä¿®æ”¹å…©å€‹åœ°æ–¹ï¼Œæ‰èƒ½ apply åˆ° Minikube å¢é›†ï¼Œç¬¬ä¸€å€‹æ˜¯ä¿®æ”¹ kubelet-preferred-address-types=InternalIPï¼Œä»¥åŠæ–°å¢ kubelet-insecure-tls=ture è®“ Metrics Server ç¦ç”¨ TLS è­‰æ›¸é©—è­‰ï¼Œè©³ç´°å¯ä»¥åƒè€ƒä»¥ä¸‹ç…§ç‰‡ï¼š\nä¿®æ”¹ components.yaml\næ¥è‘— apply é€™å€‹ yaml æª”æ¡ˆï¼š apply components.yaml\nå¯ä»¥æª¢æŸ¥ä¸€ä¸‹ deployment.apps/metrics-server æ˜¯å¦æœ‰æˆåŠŸå»ºç«‹æˆ–æ˜¯ Pod æ˜¯å¦æœ‰å•é¡Œï¼š\næª¢æŸ¥ metrics-server æ˜¯å¦æœ‰å•é¡Œ\né–‹å§‹æ’°å¯«å¯¦ä½œæª”æ¡ˆ æ¥è‘—æˆ‘å€‘å°±ä¾ç…§å®˜æ–¹çš„ HorizontalPodAutoscaler Walkthrough çš„æ–‡ç« é–‹å§‹å›‰ï¼é¦–å…ˆå…ˆå¯«ä¸€å€‹ index.phpï¼Œé€™å€‹æª”æ¡ˆæ˜¯ç”¨æ–¼å¾ŒçºŒæ¸¬è©¦ HPA è² è¼‰ä½¿ç”¨é‡çš„ç¨‹å¼ï¼š index.php\næ–°å¢ Dockerfileï¼Œæˆ‘å€‘ä½¿ç”¨ php:5-apache çš„ imageï¼Œä¸¦è¤‡è£½å‰›å‰›å¯«çš„ index.php åˆ°å®¹å™¨å…§ï¼š Dockerfile\nå°‡è©² Dockerfile Build èµ·ä¾†ï¼Œæ¨åˆ° DockerHub ä¸Šï¼Œé€™éƒ¨åˆ†å°±ä¸å¤šèªªæ˜ï¼Œæœ‰èˆˆè¶£å¯ä»¥åƒè€ƒä»¥å‰æ–‡ç« ï¼Œå¤§å®¶å¯ä»¥ç›´æ¥ä½¿ç”¨ 880831ian/php-apache æˆ‘æ¨å¥½çš„ image ä¾†ä½¿ç”¨ã€‚ æ–°å¢ Deployment.yamlï¼Œè£¡é¢æœƒä½¿ç”¨æˆ‘å€‘å‰›å‰›æ‰“åŒ…æ¨åˆ° DockerHub ä¸Šçš„ imageï¼š apiVersion: apps/v1 kind: Deployment metadata: name: php-apache spec: selector: matchLabels: run: php-apache replicas: 1 template: metadata: labels: run: php-apache spec: containers: - name: php-apache image: 880831ian/php-apache ports: - containerPort: 80 resources: limits: cpu: 500m requests: cpu: 200m --- apiVersion: v1 kind: Service metadata: name: php-apache labels: run: php-apache spec: ports: - port: 80 selector: run: php-apache é€™é‚Šå¤§å®¶å¯ä»¥å…ˆè¨˜å¾—æˆ‘å€‘åœ¨ containers.resources æœ‰è¨­å®š cpu çš„ requests ç‚º 200mã€‚å¾ŒçºŒåœ¨è¨ˆç®—å‰¯æœ¬æ•¸æ™‚æœƒå†æåˆ° ğŸ˜¬\næœ€å¾Œå°‡ Deployment.yaml çµ¦ applyï¼Œæª¢æŸ¥ä¸€ä¸‹æ˜¯å¦æœ‰æ­£å¸¸å•Ÿå‹•ï¼š k8slens æª¢æŸ¥æ˜¯å¦æ­£å¸¸\nä½¿ç”¨ kubectl autoscale ä¾†å¹«åŠ©æˆ‘å€‘å‰µå»º HorizontalPodAutoscalerï¼š kubectl autoscale deployment php-apache --cpu-percent=50 --min=1 --max=10 æˆ‘å€‘åœ¨ Deployment.yaml è£¡é¢ containers.resources æœ‰è¨­å®š cpu çš„ requests æ˜¯ 200mï¼Œä¹Ÿå°±æ˜¯ 200 milli-coresï¼Œç•¶æˆ‘å€‘ç¾åœ¨è¨­å®š HPA çš„å¹³å‡ CPU ä½¿ç”¨ç‡ç‚º 50%ï¼Œæ‰€ä»¥æˆ‘å€‘åªè¦è¶…é 200m / 2 = 100mï¼Œä¹Ÿå°±æ˜¯ requests è¶…é 100 milli-cores å°±æœƒç”¢ç”Ÿæ–°çš„ Podã€‚é€™é‚Šæœ€å°‘ Pod ç‚º 1ï¼Œæœ€å¤šç‚º 10ã€‚å¾ŒçºŒç­‰æ¸¬è©¦æ™‚ï¼Œæœƒå¸¶å¤§å®¶è¨ˆç®—ä»–æ˜¯å¦‚ä½•ç”¢ç”Ÿ Pod çš„ ğŸ˜ æŸ¥çœ‹ç›®å‰ HPA ä½¿ç”¨é‡ï¼Œå› ç‚ºæˆ‘å€‘é€™å€‹ php-apache é‚„æ²’æœ‰ä»»ä½•çš„è¨ªå•ï¼Œæ‰€ä»¥æ˜¯ 0% / 50% (æ‰¿ä¸Šé¢æ‰€èªªï¼Œæ‰€ä»¥é€™é‚Šçš„å€¼æ˜¯ 0 / 100 milli-cores)ï¼Œå¾Œé¢ä¹Ÿå¯ä»¥çœ‹åˆ°æˆ‘å€‘æ‰€è¨­å®šæœ€é«˜è·Ÿæœ€ä½çš„ Podï¼Œä»¥åŠç›®å‰çš„å‰¯æœ¬æ•¸ã€‚ æŸ¥çœ‹ç›®å‰ HPA ä½¿ç”¨é‡\nç•¶ç„¶æˆ‘å€‘é™¤äº†ç”¨å‰›å‰›çš„æŒ‡ä»¤ä»¥å¤–ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥è‡ªå·±å¯« HPA çš„ yaml æª”æ¡ˆã€‚æˆ‘é€™é‚Šå…ˆä½¿ç”¨ kubectl get hpa php-apache -o yaml \u003e hpa.yaml ä¾†å°‡å‰›å‰›ç”¨æŒ‡ä»¤ run èµ·ä¾†çš„ HPA è®Šæˆ yaml æª”ï¼Œæˆ‘å€‘ä¾†çœ‹çœ‹è£¡é¢æœ‰å“ªäº›å…§å®¹å§ï¼š apiVersion: autoscaling/v2 kind: HorizontalPodAutoscaler metadata: creationTimestamp: \"2022-07-12T03:16:11Z\" name: php-apache namespace: default resourceVersion: \"19454\" uid: dde68e68-9b6e-46a8-b50f-5525b8ec3bdf spec: maxReplicas: 10 metrics: - resource: name: cpu target: averageUtilization: 50 type: Utilization type: Resource minReplicas: 1 scaleTargetRef: apiVersion: apps/v1 kind: Deployment name: php-apache å¾Œé¢ç‹€æ…‹çœç•¥.... apiVersionï¼šè¦è¨˜å¾—ä½¿ç”¨ autoscaling/v2 kindï¼šHorizontalPodAutoscaler maxReplicasï¼šæ˜¯æˆ‘å€‘å‰›å‰›ç”¨æŒ‡ä»¤çš„æœ€å¤§ Pod å‰¯æœ¬æ•¸ metricsï¼šæˆ‘å€‘æŒ‡æ¨™è¨­å®š cpu resourceï¼Œå…¶è¨­å®šå¹³å‡ä½¿ç”¨ç‡ç‚º 50 % (ç™¾åˆ†æ¯”) minReplicasï¼šå‰›å‰›ç”¨æŒ‡ä»¤çš„æœ€å° Pod å‰¯æœ¬æ•¸ scaleTargetRefï¼šè¨­å®šæˆ‘å€‘é€™å€‹ HPA æ˜¯ä¾ç…§ php-apache é€™å€‹ Deploymentã€‚ ","å¸¸è¦‹å•é¡ŒåŠè§£æ±ºè¾¦æ³•#å¸¸è¦‹å•é¡ŒåŠè§£æ±ºè¾¦æ³•":" â„¹ï¸ Q1 . å‡ºç¾ x509: cannot validate certificate for 192.168.XXX.XXX because it doesnâ€™t contain any IP SANs éŒ¯èª¤\nAns 1ï¼šæ˜¯å› çˆ²æ²’æœ‰åŠ å…¥ kubelet-insecure-tls=ture è®“ Metrics Server ç¦ç”¨ TLS è­‰æ›¸é©—è­‰ï¼Œæ‰å°è‡´éŒ¯èª¤ç™¼ç”Ÿã€‚","æ¸¬è©¦-hpa#æ¸¬è©¦ HPA":" æ¥ä¸‹ä¾†æˆ‘å€‘éƒ½è¨­å®šå¥½å¾Œï¼Œæˆ‘å€‘è¦ä¾†æ¨¡æ“¬å¢åŠ è² è¼‰ï¼Œçœ‹çœ‹ HPA çš„å¾ŒçºŒå‹•ä½œï¼Œé¦–å…ˆæˆ‘å€‘å…ˆä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤ä¾†æŒçºŒè§€å¯Ÿ HPAï¼š kubectl get hpa php-apache --watch NAME REFERENCE TARGETS MINPODS MAXPODS REPLICAS AGE php-apache Deployment/php-apache 0%/50% 1 10 1 4h40m ä»¥åŠåŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼Œè©²æŒ‡ä»¤æ˜¯å»ºä¸€å€‹æ–°çš„ Podï¼Œç”±æ–°çš„ Pod ç„¡é™å¾ªç’°çš„å»å‘ php-apahe æœå‹™ç™¼å‡ºè«‹æ±‚ kubectl run -i --tty load-generator --rm --image=busybox:1.28 --restart=Never -- /bin/sh -c \"while sleep 0.01; do wget -q -O- http://php-apache; done\" æ¨¡æ“¬å¢åŠ è² è¼‰\næˆ‘å€‘ä½¿ç”¨ k8slens è§€å¯Ÿï¼Œæœƒç™¼ç¾ç•¶è² è¼‰ä½¿ç”¨é‡è¶…éæˆ‘å€‘å‰é¢æ‰€è¨­å®šçš„ 50%ï¼Œä¹Ÿå°±æ˜¯ 100 milli-cores æ™‚ï¼Œä»–å°±æœƒè‡ªå‹•é•·æ–°çš„ Pod å‡ºä¾†ï¼š HPA è‡ªå‹•é•· Pod\næˆ‘å€‘åˆ‡å›å»çœ‹è§€å¯Ÿ HPA æŒ‡ä»¤ kubectl get hpa php-apache --watchï¼š è§€å¯Ÿ HPA\næˆ‘å€‘å‰›å‰›æœ‰èªªè¶…é 50%ï¼Œä¹Ÿå°±æ˜¯ 100 milli-cores æ™‚ï¼Œæœƒé•·æ–°çš„ Podã€‚æˆ‘å€‘ä»¥ä¸Šé¢åœ–ç‰‡çš„ä¾†èªªæ˜ï¼Œä¾†è¨ˆç®—æœŸæœ›éœ€è¦å¹¾å€‹å‰¯æœ¬?\nå®˜æ–¹æœ‰æä¾›ä¸€å€‹å…¬å¼ï¼š æœŸæœ›å‰¯æœ¬æ•° = ceil[ç›®å‰å‰¯æœ¬æ•° * (ç›®å‰æŒ‡æ¨™ / æœŸæœ›æŒ‡æ¨™)] ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘å€‘è² è¼‰å¾ 0% å¾åˆ° 250%ï¼Œä¹Ÿå°±æ˜¯æˆ‘å€‘å¯¦éš›ä¸Šæ˜¯å¾ 0 è®Šæˆ 500 milli-cores (250 / 50 _ 100 )ã€‚æˆ‘å€‘å°‡å€¼å¸¶å…¥å…¬å¼å…§ï¼Œç›®å‰çš„å‰¯æœ¬ï¼š1 _ (ç›®å‰æŒ‡æ¨™ï¼š500 / æœŸæœ›æŒ‡æ¨™æ˜¯ï¼š100)å¾—å‡ºä¾†çš„å€¼æ˜¯ 5ï¼Œå¦‚æœæœ‰å°æ•¸ï¼Œå› ç‚ºå‰é¢æœ‰ceilï¼Œæ‰€ä»¥æœƒå–æ•´æ•¸(ä¸å¯èƒ½é–‹åŠå€‹ Pod å°å§ ğŸ™„)ï¼Œæœ€å¾Œä»¥é€™å€‹ä¾‹å­ä¾†èªªï¼Œæœ€çµ‚å¾—åˆ°çš„ æœŸæœ›å‰¯æœ¬æ•° = 5\næ ¹æ“šæˆ‘å€‘è¨ˆç®—å‡ºä¾†çš„å‰¯æœ¬æ•¸ï¼Œä»–å°±æœƒä¾ç…§è¨ˆç®—çµæœï¼Œå¹«æˆ‘å€‘è‡ªå‹•ç”Ÿæˆè©²æ•¸é‡çš„ Podï¼Œä¾†æ¸›ç·©åŒä¸€å€‹ Pod çš„è² è¼‰é‡ï¼Œæ¥è‘—æˆ‘å€‘å…ˆä¸­æ–·æ¸¬è©¦æŒ‡ä»¤ï¼Œå†ç¹¼çºŒè§€å¯Ÿ HPA ï¼š è§€å¯Ÿ HPA\nå¯ä»¥ç™¼ç¾å› ç‚ºæˆ‘å€‘å°‡æ¸¬è©¦æŒ‡ä»¤ä¸­æ–·å¾Œï¼Œè² è¼‰ä½¿ç”¨é‡æœƒæ…¢æ…¢é™ä½ï¼Œä½†è² è¼‰é™ä½å¾Œï¼Œå‰¯æœ¬æ•¸ä¸æœƒé¦¬ä¸Šè®Šå›å»ï¼Œå› ç‚ºæ€•å¦‚æœåˆæœ‰å¤§é‡çš„ä½¿ç”¨é‡æœƒå°è‡´ Pod ä¾†ä¸åŠé•·å‡ºä¾†ï¼Œæ‰€ä»¥é è¨­æ˜¯ 5 åˆ†é˜ (--horizontal-pod-autoscaler-downscale-stabilization) æ‰æœƒæ¸›è‡³åŸä¾†çš„ Pod æ•¸é‡\nPod è‡ªå‹•æ¸›å°‘","ç‰ˆæœ¬è³‡è¨Š#ç‰ˆæœ¬è³‡è¨Š":" macOSï¼š11.6 Minikubeï¼šv1.25.2 Kubectlï¼šClient Versionï¼šv1.24.1ã€Server Versionï¼šv1.23.3 Metrics Server 3.8.2 "},"title":"Kubernetes (K8s) HorizontalPodAutoscaler (HPA) åŸç†èˆ‡å¯¦ä½œ"},"/blog/kubernetes/k8s-plain/":{"data":{"":"å‰é™£å­å°æ–¼ Kubernetes éƒ¨åˆ†å…§å®¹é‚„ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œåœ¨ç¶²è·¯ä¸Šé–’é€›çš„æ™‚å€™ç™¼ç¾ä¸€ç¯‡å¾ˆæœ‰è¶£çš„æ–‡ç« ï¼Œæ¨™é¡Œæ˜¯ ã€ çµ¦è¡ŒéŠ·è·Ÿæ¥­å‹™çš„ Kubernetes 101 ä¸­ç¿»ä¸­ä»‹ç´¹ ã€ï¼Œé»é€²å»å¾Œæ‰ç™¼ç¾ï¼Œä½œè€… Phil Huang å°‡ Kubernetes å…ƒä»¶çš„å…§å®¹ç”¨å¤§å‹ä½æˆ¶ç¤¾å€ä¾†ä»‹ç´¹ï¼Œè®“æˆ‘æ›´æ¸…æ¥šæ¯ä¸€å€‹å…ƒä»¶çš„æ„æ€ï¼Œä»¥ä¸‹æˆ‘æœƒç”¨æˆ‘ç†è§£çš„ä»¥åŠä½œè€…çš„æ€è€ƒé‚è¼¯ä¾†å»å¯«é€™ç¯‡ç­†è¨˜ï¼Œå†æ¬¡æ„Ÿè¬ä½œè€…æ–‡ç«  ğŸ˜","kubernetes-å…ƒä»¶ç™½è©±æ–‡#Kubernetes å…ƒä»¶ç™½è©±æ–‡":"\nå¤§å‹ç¤¾å€ç¤ºæ„åœ– (åœ–ç‰‡ä¾†æºï¼šè˜‹æœåœ°ç”¢)\nå¯ä»¥çœ‹åˆ°ä¸Šé¢é€™å¼µåœ–ç‰‡ï¼Œä»–æ˜¯ä¸€å€‹å¾ˆå…¸å‹çš„å¤§å‹ç¤¾å€ï¼Œæˆ‘å€‘é€™æ¬¡çš„ Kubernetes å…ƒä»¶ç™½è©±æ–‡ï¼Œæœƒä»¥å¤§å‹ç¤¾å€ä¾†ç•¶ä½œç¾å¯¦ä¸­çš„å…ƒä»¶ï¼Œä»¥ç¤¾å€çš„ä¾‹å­ä¾†èªªæ˜ Kubernetes ã€‚\nç•¶ç„¶ï¼Œæˆ‘å€‘ä¹‹å‰çš„æ–‡ç« ä¹Ÿæœ‰ä»‹ç´¹é Kubernetesï¼Œæœ‰èˆˆè¶£å¯ä»¥å…ˆé£›å›å»çœ‹çœ‹ï¼\nKubernetes (K8s) ä»‹ç´¹ - åŸºæœ¬\nKubernetes (K8s) ä»‹ç´¹ - é€²éš (Serviceã€Ingressã€StatefulSetã€Deploymentã€ReplicaSetã€ConfigMap)\nKubernetes (K8s) æ­é… EFK å¯¦ä½œ (Deploymentã€StatefulSetã€DaemonSet)\næˆ‘å€‘å…ˆæƒ³åƒä¸€ä¸‹æˆ‘å€‘å»ºç«‹ Kubernetes å®Œæ•´çš„å¢é›†æœå‹™ï¼Œå°±å¥½æ¯”æ˜¯å»ºç«‹ä¸€å€‹å¤§å‹çš„ç¤¾å€ï¼Œæ‰€ä»¥ä»¥ä¸‹æœƒå°‡åè©èˆ‡ç¤¾å€ä¾†åšé€£çµï¼Œé‚£ï¼ï¼ï¼é–‹å§‹å›‰ï¼\nKubernetes å…ƒä»¶ Kubernetesï¼šå»ºç«‹é€™å€‹å¤§å‹ç¤¾å€çš„è—åœ–ï¼Œè¦åŠƒçš„ç¤¾å€å…§çš„å¤§å¤§å°å°çš„è¨­è¨ˆã€‚ è™›æ“¬åŒ–å¹³å°ã€å…¬æœ‰é›²å¹³å°ã€å¯¦é«”æ©Ÿå™¨ï¼šå°±æ˜¯æˆ‘å€‘è¦è“‹ç¤¾å€çš„åœ°çš®ã€‚(è™›æ“¬åŒ–å¹³å°ï¼švSphere/Proxmox/VMwareã€å…¬æœ‰é›²å¹³å°ï¼šAWS/GCP/Azuerã€å¯¦é«”æ©Ÿå™¨ï¼šå°±æ˜¯å¯¦é«”æ©Ÿå™¨ ğŸ˜‚) OS ä½œæ¥­ç³»çµ±ï¼šæ¯æ£Ÿå¤§æ¨“çš„éª¨æ¶å’Œåœ°åŸºã€‚ Master Nodeï¼šä½æˆ¶ç®¡å§”æœƒæ‰€å±…ä½å¤§æ¨“ (çœŸå¥½è‡ªå·±æœ‰æ‰€å±¬çš„å¤§æ¨“ï¼¸ï¼¤)ï¼Œç‚ºäº†ä¿è­‰ä»–å€‘ä¸æœƒåµæ¶ï¼Œæ‰€ä»¥å»ºè­°æœ€å°‘éœ€è¦ä¸‰æ£Ÿã€‚ Etcd Clusterï¼šç®¡å§”æœƒçš„äººï¼Œä¸€æ¨£ç‚ºäº†æ€•ä¸€é»¨ç¨å¤§(?ï¼Œæ‰€ä»¥å»ºè­°æœ€å°‘éœ€è¦æœ‰ä¸‰ä½ç®¡å§”ï¼Œä¸”äº’ç›¸æŠ•ç¥¨é¸å‡ºä¸€å€‹é ­é ­ã€‚ Worker Nodeï¼šå°±æ˜¯å¶å€‘ä½æˆ¶æ‰€å±…ä½çš„å¤§æ¨“ã€‚ Podï¼šä½æˆ¶ï¼Œæ‰€ä»¥æˆ‘å€‘ä¸€æ£Ÿ Worker Node å¤§æ¨“ï¼Œå¯ä»¥æœ‰å¾ˆå¤š Pod ä½æˆ¶ã€‚ Pod IPï¼šæ¯å€‹ä½æˆ¶çš„é–€ç‰Œï¼Œæ—¢ç„¶æ˜¯é–€ç‰Œï¼Œä»£è¡¨ä»–ä¹Ÿä¸æœƒé‡è¤‡ã€‚ Container Registryï¼šåŒ…è£¹é›†ä¸­çš„å­˜æ”¾ä¸­å¿ƒã€‚ Container Imagesï¼šé‚„æ²’æœ‰è¢«æ‰“é–‹çš„åŒ…è£¹ã€‚ Containersï¼šå·²ç¶“è¢«æ‰“é–‹ä¸”æ­£åœ¨ä½¿ç”¨çš„åŒ…è£¹ï¼Œé‚£æ¯å€‹ Pod ä½æˆ¶è£¡é¢ï¼Œå¯ä»¥æœ‰ä¸€å€‹æˆ–å¾ˆå¤šå€‹ä»¥ä¸Šçš„ Containers åŒ…è£¹ã€‚ Serviceï¼šç¤¾å€è£¡é¢çš„ç¤¾åœ˜ï¼Œä¾‹å¦‚ï¼šç¾½çƒç¤¾ã€éº»å°‡ç¤¾ç­‰ç­‰ï¼Œå¯ä»¥é›†åˆå¤§å®¶çš„åœ°æ–¹ã€‚ Service Meshï¼šç¤¾åœ˜çš„è¯çµ¡åå†Šï¼Œæœƒè¨˜ä½èª°æ˜¯å“ªä¸€å€‹ç¤¾åœ˜çš„æˆå“¡ã€‚ Ingress Controllerï¼šç¤¾å€çš„å¤§é–€ï¼Œå¯ä»¥æŒ‡å®šè®“ç¤¾å€æˆå“¡éƒ½å›ºå®šèµ°åŒä¸€å€‹æˆ–æ˜¯å¤šå€‹é–€çš„å…¥å£ç®¡æ§ã€‚ Egress Controllerï¼šç¤¾å€çš„å¾Œé–€ï¼Œå¯ä»¥æŒ‡å®šè®“ç¤¾å€æˆå“¡éƒ½å›ºå®šèµ°åŒä¸€å€‹æˆ–æ˜¯å¤šå€‹é–€çš„å‡ºå£ç®¡æ§ã€‚ Internal DNS / Service Discoveryï¼šå¤§æ¨“ä½æˆ¶çš„é›»è©±ç°¿ã€‚ External DNSï¼šæŒ‡å‘å„å¤§æ¨“çš„è·¯æ¨™ã€‚ OCI (Open Container Initiative)ï¼šåˆ¶å®šå¤§æ¨“é‹¼ç­‹æ°´æ³¥æˆ–æ˜¯è¡Œæç®±æ¨™æº–çš„çµ„ç¹”ã€‚ CRI (Container Runtime Interface)ï¼šå¤§æ¨“é‹¼ç­‹æ°´æ³¥çš„å» å•†ã€‚ CNI (Container Network Interface)ï¼šå¤§æ¨“æ°´é›»ç³»çµ±çš„å» å•†ã€‚ CSI (Container Storage Interface)ï¼šå¤§æ¨“ç©ºé–“è¦åŠƒçš„å» å•†ã€‚ Bastionï¼šå°ˆé–€ç¶­è­·ç¤¾å€çš„å·¥ç¨‹è»Šã€‚ å¸¸ç”¨å¥—ä»¶ Promethusï¼šç¤¾å€æ•´é«”çš„ç›£æ§ä¸­å¿ƒ (Meterics)ï¼Œä¸€å †æ”å½±æ©Ÿçš„ç®¡ç†å®¤ XD Grafanaï¼šç›£æ§ä¸­å¿ƒè£¡é¢å¤§å‹çš„ LED å„€è¡¨æ¿ã€‚ Elaticsearchï¼šç¤¾å€æ•´é«”çš„æƒ…è³‡ä¸­å¿ƒ (Logging)ï¼Œé€™æ‡‰è©²æ˜¯ä¸€ç¾¤æ„›å…«å¦çš„å¤§åª½å§ ğŸ˜ Kibanaï¼šæƒ…è³‡ä¸­å¿ƒè£¡é¢å¤§å‹çš„ LED è¨Šæ¯ç‰ˆã€‚ ","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"çµ¦è¡ŒéŠ·è·Ÿæ¥­å‹™çš„ Kubernetes 101 ä¸­ç¿»ä¸­ä»‹ç´¹","å¸¸è¦‹å•é¡Œ#å¸¸è¦‹å•é¡Œ":"ä½œè€…ä¹Ÿæœ‰æ•´ç†äº†ä¸€äº›å¸¸è¦‹çš„å•é¡Œï¼Œæˆ‘æŠŠå®ƒæ•´ç†ä¸€ä¸‹æŒ‘é¸å‡ºå¹¾å€‹æˆ‘è‡ªå·±ä¸€é–‹å§‹ä¹Ÿæœƒæœ‰ç–‘å•çš„å•é¡Œï¼Œæˆ‘å€‘ä¸€èµ·ä¾†çœ‹çœ‹å§ï¼ä¸€æ¨£æˆ‘æœƒç”¨æˆ‘æ‰€ç†è§£çš„æ„æ€ä¾†ä»‹ç´¹ ~\nQ1ï¼šç‚ºä»€éº¼ Kubernetes çš„æœ€å°å–®ä½æ˜¯ Pod é€™å€‹è¦æ€éº¼ç†è§£ï¼Ÿ Ans ï¼š è©¦æƒ³ä¸€ä¸‹ï¼Œé›£é“ç®¡å§”æœƒæœƒç®¡ä½ çš„åŒ…è£¹è£¡é¢å…§å®¹ç‰©æ”¾ä»€éº¼å— XD\nQ2ï¼šDocker åœ¨ Kubernetes çš„è§’è‰²æ˜¯ä»€éº¼ï¼Ÿ Ans ï¼š æ˜¯çœ¾å¤šçš„ CRI (Container Runtime Interface) é¸æ“‡ä¹‹ä¸€ï¼Œä¹Ÿå°±æ˜¯å¤§æ¨“çš„é‹¼ç­‹æ°´æ³¥å» å•†æœ‰å¾ˆå¤šé–“ï¼Œæœ‰ä¸€é–“å«åš Docker çš„å» å•†ç‰¹åˆ¥æœ‰åã€‚\nQ3ï¼šå‘ˆä¸Šï¼Œé‚£ CRI/CNI/CSI æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥æ›¿æ›æˆå…¶ä»–çš„å» å•†ï¼Ÿ Ans ï¼š ç•¶ç„¶å¯ä»¥ï¼Œç¾åœ¨å¯ä»¥çœ‹åˆ°è¶Šä¾†è¶Šå¤šå» å•†éƒ½é–‹å§‹æ”¯æ´ Kubernetes å°±æ˜¯å› ç‚ºé€™å€‹åŸå› ï¼Œå› ç‚ºä¸€èˆ¬æƒ…æ³ä¸‹ï¼ŒKubernetes ä¸¦ä¸æœƒç‰¹åˆ¥é™å®š å¤§æ¨“é‹¼ç­‹æ°´æ³¥å» å•†ã€å¤§æ¨“æ°´é›»ç³»çµ±å» å•†ã€å¤§æ¨“ç©ºé–“è¦åŠƒå» å•†ï¼Œåªè¦æœ‰ç¬¦åˆç‰¹å®šçš„æ¨™æº–å³å¯ï¼Œä½†è¦ç•™æ„ Kubernetes çš„ç‰ˆè™Ÿä¹Ÿæœƒå—åˆ°é€™ä¸‰å€‹ä»‹é¢æ”¯æ´ç™¼è¡Œçš„ç‰ˆè™Ÿæ‰€å½±éŸ¿ï¼Œè¦ç•™æ„ç›¸å®¹æ€§çš„å•é¡Œï¼\nQ4ï¼šæ•´å€‹ä½æˆ¶ç¤¾å€æœ€é‡è¦çš„è§’è‰²æ˜¯ä»€éº¼ï¼Ÿ Ans ï¼š é‚£ä¸‰æ£Ÿç®¡å§”æœƒå¤§æ¨“ï¼Œå’Œè£¡é¢çš„çš„ä¸‰ä½å§”å“¡ï¼Œä¸‰ä½æ›æ‰ä¸€ä½é‚„å¯ä»¥ç¶­æŒæ­£å¸¸é‹ä½œï¼Œæ›æ‰å…©ä½æœƒç¶­æŒå”¯ç¨é‹ä½œã€‚\nQ5ï¼šKubernetesã€VMã€Container çš„å·®ç•°æ€§ Ans ï¼š æˆ‘å€‘å¯ä»¥å»ºç«‹å¥½ä¸€å€‹å¤§æ¨“(VM)ï¼Œéš¨æ„æ”¾ç½®ä¸€å€‹æˆ–æ˜¯å¤šå€‹åŒ…è£¹(Containers)ï¼Œå¿…é ˆæ‰‹å‹•ç®¡ç†é€™äº›åŒ…è£¹ï¼Œå¦‚æœè³‡æºä¸è¶³æˆ–æ˜¯é€™æ£Ÿå¤§æ¨“å€’äº†ï¼Œå°±æ²’æœ‰è¾¦æ³•è‡ªå‹•è½‰ç§»é€™äº›åŒ…è£¹çš„å…§å®¹äº†ã€‚\nä½†å¦‚æœæ˜¯ Kubernetesï¼Œæˆ‘å€‘å°±å¯ä»¥å»ºç«‹å¤šå€‹å¤§æ¨“(VM)ï¼Œé€é Kubernetes æ‰€è¦å®šçš„æ”¾ç½®è¨ˆç•« (ä¾‹å¦‚ï¼šDeploymentã€DaemonSet)ï¼Œæˆ‘å€‘å°‡å¯ä»¥çµ±ä¸€èª¿åº¦é€™äº› Podï¼Œç•¶æŸæ£Ÿå¤§æ¨“è³‡æºä¸å¤ æˆ–æ˜¯é€™æ£Ÿå¤§æ¨“å€’æ™‚ï¼Œå¯ä»¥æ ¹æ“š Kubernetes è¦å‰‡ä¾†é€²è¡Œæ¬é·æˆ–æ˜¯æ“´å……å¤§æ¨“ã€‚\nQ6ï¼šç‚ºä»€éº¼æœ‰äººæœƒæŠŠ Container è·Ÿ Pod æ··åœ¨ä¸€èµ·è¬› Ans ï¼š å› ç‚ºå¤§éƒ¨åˆ†çš„æƒ…æ³ä¸‹ï¼Œéƒ½æ˜¯ä¸€å€‹ä½æˆ¶(Pod)æ”¾ä¸€å€‹åŒ…è£¹(Container)ï¼Œï¼Œæ‰æœƒå°è‡´é€™æ¨£çš„èª¤æœƒã€‚ä½†å¯¦éš›ä¸Šï¼Œä¸€å€‹ä½æˆ¶(Pod)æ˜¯å¯ä»¥æ”¾ä¸€å€‹æˆ–å¤šå€‹åŒ…è£¹åœ¨è£¡é¢çš„ï¼\nQ7ï¼šä»€éº¼æ˜¯ Node Scaling ? Ans ï¼š å¯ä»¥æŠŠå®ƒç†è§£æˆï¼Œç•¶ä½æˆ¶å¤ªå¤šæ™‚ï¼ŒKubernetes æœƒè‡ªå‹•æˆ–æ‰‹å‹•èˆˆå»ºå¤§æ¨“ï¼Œä¾†æŠŠå¤šå‡ºä¾†çš„ç”¨æˆ¶çµ¦å¡é€²å»ã€‚\nQ8ï¼šåœ¨ Q5 æœ‰æåˆ°æ”¾ç½®è¨ˆç•«æ˜¯ä»€éº¼æ„æ€ï¼Ÿ Ans ï¼š åªè¦ä½ æœ‰éœ€è¦å°‡åŒ…è£¹æ”¾åœ¨ç¤¾å€å…§ï¼Œéƒ½å¿…é ˆæå‡ºéƒ¨ç½²è¨ˆç•«(Deployment) çµ¦ç®¡å§”æœƒå¯©æ ¸ï¼Œåªè¦é€šéå¯©æ ¸ï¼Œä»–å€‘ä¾ç…§ä½ äº‹å…ˆè²æ˜çš„è¨ˆç•«ï¼Œç›¡æœ€å¤§å¯èƒ½æ€§ä¾†æ”¾ç½®åŒ…è£¹ã€‚\næ‰€ä»¥ç•¶æˆ‘å€‘æœ‰ä»»ä½•è®Šæ›´è¨ˆç•«æ™‚ï¼Œéƒ½éœ€è¦é‡æ–°æäº¤ä¸€ä»½æ–°çš„éƒ¨ç½²è¨ˆç•«çµ¦ç®¡å§”æœƒé‡æ–°å¯©æ ¸å’Œæ¥å—ã€‚"},"title":"ç”¨å¤§å‹ç¤¾å€ä¾†ä»‹ç´¹ Kubernetes å…ƒä»¶"},"/blog/kubernetes/k8s-statefulset-podmanagementpolicy/":{"data":{"":"æ­¤æ–‡ç« è¦ä¾†è¨˜éŒ„ä¸€ä¸‹å‰é™£å­åœ¨å…¬å¸çš„æ­£å¼ç’°å¢ƒè¸©åˆ° StatefulSet çš„é›·ï¼Œäº‹æƒ…æ˜¯é€™æ¨£çš„ï¼Œæˆ‘å€‘æœ‰äº›æœå‹™ï¼Œæ˜¯ä½¿ç”¨ StatefulSet ä¾†å»ºç½®ï¼Œè‡³æ–¼ç‚ºä»€éº¼ä¸ç”¨ Deploymentï¼Œé€™å€‹èªªä¾†è©±é•· (ä¹Ÿä¸æ˜¯å› ç‚ºéœ€è¦ç‰¹å®šçš„ Pod åç¨±ã€æˆ–æ˜¯ç¶²è·¯æ¨™è¨˜ç­‰ç­‰)ï¼Œæˆ‘å€‘é€™é‚Šå…ˆä¸è¨è«–ï¼Œé€™å€‹ StatefulSet æœå‹™æ˜¯ Nginx + PHP-FPMï¼Œç‚ºäº†é¿å…æµé‡é€²å…¥åˆ° processes å·²ç¶“è¢«ç”¨å…‰çš„ Pod ä¸­ï¼Œæˆ‘å€‘åœ¨ StatefulSet çš„ PHP Container ä¸Šæœ‰è¨­å®š readinessï¼Œreadiness çš„è¨­å®šé•·å¾—åƒä»¥ä¸‹ï¼š\nreadinessProbe: exec: command: - \"/bin/bash\" - \"-c\" - | CHECK_INFO=$(curl -s -w 'http code:\\t%{http_code}\\n' 127.0.0.1/status) HTTP_CODE=$(echo -e \"${CHECK_INFO}\" | awk '/http code:/ {print $3}') IDLE_PROCESSES=$(echo -e \"${CHECK_INFO}\" | awk '/idle processes:/ {print $3}') [[ $HTTP_CODE -eq 200 \u0026\u0026 $IDLE_PROCESSES -ge 10 ]] || exit 1 æˆ‘å€‘æœƒç”¨ curl ä¾†æ‰“ /statusï¼Œæª¢æŸ¥å›å‚³çš„ http code æ˜¯å¦ç‚º 200ï¼Œä»¥åŠ idle processes æ˜¯å¦å¤§æ–¼ç­‰æ–¼ 10ï¼Œå¦‚æœä¸ç¬¦åˆï¼Œå°±æœƒå›å‚³ 1ï¼Œè®“ä»–è¢«æ¨™è¨˜ä¸å¥åº·ï¼Œè®“ Kubernetes åœæ­¢æµé‡åˆ°ä¸å¥åº·çš„å®¹å™¨ï¼Œä»¥ç¢ºä¿æµé‡è¢«è·¯ç”±åˆ°å…¶ä»–å¥åº·çš„å‰¯æœ¬ã€‚","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"Kubernetes â€” å¥åº·æª¢æŸ¥ï¼šhttps://medium.com/learn-or-die/kubernetes-%E5%81%A5%E5%BA%B7%E6%AA%A2%E6%9F%A5-59ee2a798115\nPod Management Policiesï¼šhttps://kubernetes.io/docs/concepts/workloads/controllers/statefulset/#pod-management-policies","å•é¡Œ#å•é¡Œ":"ç•¶å¤©é‡åˆ°çš„æƒ…æ³æ˜¯ï¼Œæˆ‘å€‘ä¸Šç¨‹å¼å¾Œï¼ŒPod éƒ½ä¸€åˆ‡æ­£å¸¸ï¼Œç•¶æµé‡é–‹å§‹é€²ä¾†å¾Œï¼Œç™¼ç¾ 10 å€‹ Pod æœƒé–‹å§‹å¶ç™¼çš„å™´ Readiness probe failedï¼ŒæŸ¥çœ‹ç›£æ§ç™¼ç¾ processes è¶Šä¾†è¶Šä½ï¼Œæœ€å¾Œè¢«åæ‡‰æœå‹™æœ‰å•é¡Œï¼Œæˆ‘å€‘æŸ¥çœ‹ Hpa çš„ç´€éŒ„çš„ç¢ºæœ‰è§¸ç™¼åˆ° 40 å€‹ Podï¼Œåªæ˜¯æŸ¥çœ‹ Pod æ•¸é‚„æ˜¯ä¾æ¨£å¡åœ¨ 10 å€‹ï¼Œç•¶ä¸‹æˆ‘å€‘æœ‰å˜—è©¦ä½¿ç”¨èª¿æ•´ yaml åœ¨ applyï¼Œç™¼ç¾ StatefulSet çš„ yaml ä¹Ÿå·²ç¶“æ›´æ–°äº†ï¼Œä½† Pod é‚„æ˜¯ä¸€æ¨£å¡åœ¨ 10 å€‹ï¼Œä¹Ÿæœ‰ä½¿ç”¨ kubectl ä¸‹ kubectl scale sts [æœå‹™åç¨±] --replicas=0ï¼Œæƒ³è¦åˆ‡æ› Pod æ•¸ä¹Ÿæ²’æœ‰è¾¦æ³•ã€‚\nç•¶ä¸‹æˆ‘å€‘æœ‰å…ˆ Call Google çš„ Support ä¸€èµ·æ‰¾åŸå› ï¼ŒGoogle æ˜¯å»ºè­°æˆ‘å€‘ readiness çš„æ¢ä»¶ä¸è¦è¨­çš„å¤ªåš´æ ¼ï¼Œå¯ä»¥åŠ ä¸Š timeoutSeconds: ç§’æ•¸ï¼Œä½†å°æ–¼ Pod å¡ä½ï¼Œé‚„æ˜¯æ²’æœ‰æ‰¾åˆ°åŸå› ï¼Œå¾Œä¾†æˆ‘å€‘æŸ¥äº†ä¸€ä¸‹ StatefulSet çš„æ–‡ä»¶ç™¼ç¾ï¼ŒStatefulSet æœ‰ä¸€å€‹è¨­å®š podManagementPolicyï¼Œé è¨­æ˜¯ OrderedReadyï¼Œä»–å¿…é ˆç­‰å¾…å‰é¢çš„ Pod æ˜¯ Ready ç‹€æ…‹ï¼Œæ‰æœƒå†ç¹¼çºŒå»ºç«‹æ–°çš„ï¼Œä¹Ÿå°±æ˜¯èªªæˆ‘å€‘çš„ StatefulSet å·²ç¶“å¡ä½ï¼Œå°è‡´å°±ç®— Hpa è§¸ç™¼è¦é•·åˆ° 40 å€‹ Pod ä¹Ÿæ²’æœ‰ç”¨ã€‚","æ¸¬è©¦çµæœ#æ¸¬è©¦çµæœ":"æœ€å¾Œæˆ‘å€‘å°±ä½¿ç”¨å…©ç¨®æ¨¡å¼ä¾†æ¸¬è©¦çœ‹çœ‹ï¼Œå·²ä¸‹æ˜¯æ¸¬è©¦çµæœ(é€é P1 æ‰çŸ¥é“çš„è¨­å®šï¼±ï¼±)ï¼š\næœ‰å°‡æ¸¬è©¦çš„ StatefulSet æ”¾åœ¨ Githubï¼Œå¯ä»¥é»æˆ‘æŸ¥çœ‹ (å¯ä»¥èª¿æ•´ readinessProbe çš„ httpGet.Path æ•…æ„æŠŠä»–ç”¨å£)\nä½¿ç”¨ OrderedReady æ¨¡å¼ StatefulSet åœ¨ podManagementPolicy é è¨­ OrderedReady çš„æ¨¡å¼ï¼Œæ•…æ„è®“ readiness å¡ä½æ™‚ (Pod å¡ä½æ™‚)ï¼š\nç•¶ä¸‹çš„ StatefulSet è¨­å®šï¼š StatefulSet è¨­å®š\nPod ç‹€æ…‹ï¼š Pod ç‹€æ…‹\nä½¿ç”¨æŒ‡ä»¤èª¿æ•´ Pod æ•¸é‡ æˆ‘å€‘é€™æ™‚å€™ä¸‹æŒ‡ä»¤èª¿æ•´ Pod æ•¸é‡ï¼Œçœ‹çœ‹æœƒç™¼ç”Ÿä»€éº¼äº‹ï¼š\nkubectl scale sts my-statefulset --replicas=5 æˆ‘å€‘å…ˆçœ‹ StatefulSet çš„ yaml å¯ä»¥çœ‹åˆ° Pod replicas å·²ç¶“æ”¹è®Šï¼Œä¹Ÿå¯ä»¥çœ‹ generation æœ‰æ›´æ–°ï¼Œä»£è¡¨ StatefulSet æœ¬èº«æœ‰æ¥æ”¶åˆ°èª¿æ•´è¨­å®šçš„è«‹æ±‚ã€‚\nä¸‹æŒ‡ä»¤èª¿æ•´å¾Œçš„ StatefulSet è¨­å®š\nçœ‹äº†ä¸€ä¸‹ Pod æ•¸é‡ï¼Œä¹Ÿæ˜¯ä¸€æ¨£å¡ä½ï¼Œä¸” Pod æ•¸é‡ä¹Ÿæ²’æœ‰è®ŠåŒ–ã€‚\nä¸‹æŒ‡ä»¤èª¿æ•´å¾Œçš„ Pod ç‹€æ…‹\nä½¿ç”¨ yaml èª¿æ•´ Pod æ•¸é‡ æˆ‘å€‘ç›´æ¥èª¿æ•´ StatefulSet yaml çš„ Pod æ•¸é‡ï¼Œçœ‹çœ‹æœƒç™¼ç”Ÿä»€éº¼äº‹ï¼š\nä¸€æ¨£æˆ‘å€‘å…ˆçœ‹ StatefulSet çš„ yaml å¯ä»¥çœ‹åˆ° Pod replicas å·²ç¶“æ”¹è®Š(é€™è£¡æ‡‰è©²åˆ‡åˆ¥çš„ Pod æ•¸é‡ï¼Œåˆ‡å› 3 å€‹å¥½åƒæ²’æœ‰æ„ç¾© xD)ï¼Œä¹Ÿå¯ä»¥çœ‹ generation æœ‰æ›´æ–°ã€‚\nä½¿ç”¨ yaml èª¿æ•´å¾Œçš„ StatefulSet è¨­å®š\nçœ‹äº†ä¸€ä¸‹ Pod æ•¸é‡ï¼Œä¹Ÿæ˜¯ä¸€æ¨£å¡ä½ï¼Œä¸” Pod æ•¸é‡ä¹Ÿæ²’æœ‰è®ŠåŒ–ã€‚\nä½¿ç”¨ yaml èª¿æ•´å¾Œçš„ Pod ç‹€æ…‹\næ‰€ä»¥ä»£è¡¨åœ¨ OrderedReady çš„æ¨¡å¼ä¸‹ï¼ŒPod å¡ä½æ™‚ï¼Œç„¡æ³•å° Pod é€²è¡Œä»»ä½•æ“ä½œï¼Œå¿…é ˆè¦æ‰‹å‹•åˆªé™¤å¡ä½çš„ Pod æ‰åƒå¾—åˆ°æœ€æ–°çš„è¨­å®šã€‚\nä½¿ç”¨ Parallel æ¨¡å¼ StatefulSet åœ¨ podManagementPolicy Parallel çš„æ¨¡å¼ï¼Œæ•…æ„è®“ readiness å¡ä½æ™‚ (Pod å¡ä½æ™‚)ï¼š\nç•¶ä¸‹çš„ StatefulSet è¨­å®šï¼š StatefulSet è¨­å®š\nPod ç‹€æ…‹ï¼š Pod ç‹€æ…‹\nä½¿ç”¨æŒ‡ä»¤èª¿æ•´ Pod æ•¸é‡ æˆ‘å€‘é€™æ™‚å€™ä¸‹æŒ‡ä»¤èª¿æ•´ Pod æ•¸é‡ï¼Œçœ‹çœ‹æœƒç™¼ç”Ÿä»€éº¼äº‹ï¼š\nkubectl scale sts my-statefulset --replicas=5 æˆ‘å€‘å…ˆçœ‹ StatefulSet çš„ yaml å¯ä»¥çœ‹åˆ° Pod replicas å·²ç¶“æ”¹è®Šï¼Œä¹Ÿå¯ä»¥çœ‹ generation æœ‰æ›´æ–°ï¼Œä»£è¡¨ StatefulSet æœ¬èº«æœ‰æ¥æ”¶åˆ°èª¿æ•´è¨­å®šçš„è«‹æ±‚ã€‚\nä¸‹æŒ‡ä»¤èª¿æ•´å¾Œçš„ StatefulSet è¨­å®š\nçœ‹äº†ä¸€ä¸‹ Pod æ•¸é‡ï¼Œå°±ç®— my-statefulset-2 å¡ä½ï¼Œé‚„æ˜¯å¯ä»¥æ“´åˆ° 5 å€‹ Podã€‚\nä¸‹æŒ‡ä»¤èª¿æ•´å¾Œçš„ Pod ç‹€æ…‹\nä½¿ç”¨ yaml èª¿æ•´ Pod æ•¸é‡ æˆ‘å€‘ç›´æ¥èª¿æ•´ StatefulSet yaml çš„ Pod æ•¸é‡ï¼Œçœ‹çœ‹æœƒç™¼ç”Ÿä»€éº¼äº‹ï¼š\nä¸€æ¨£æˆ‘å€‘å…ˆçœ‹ StatefulSet çš„ yaml å¯ä»¥çœ‹åˆ° Pod replicas å·²ç¶“æ”¹è®Šï¼Œä¹Ÿå¯ä»¥çœ‹ generation æœ‰æ›´æ–°ã€‚\nä½¿ç”¨ yaml èª¿æ•´å¾Œçš„ StatefulSet è¨­å®š\nçœ‹äº†ä¸€ä¸‹ Pod æ•¸é‡ï¼Œä¹Ÿä¸æœƒç®¡å…¶ä»– Pod æ˜¯å¦ Readyï¼Œä¸€æ¨£å¯ä»¥ç¸®å°æˆ 2 å€‹ Podã€‚\nä½¿ç”¨ yaml èª¿æ•´å¾Œçš„ Pod ç‹€æ…‹","çµè«–#çµè«–":"å¾Œä¾†æˆ‘å€‘é‡æ–°æª¢æŸ¥äº†ä¸€ä¸‹ç‚ºä»€éº¼ processes æœƒç”¨å®Œï¼Œçµæœç™¼ç¾æ˜¯ RD çš„ç¨‹å¼é‚è¼¯ï¼Œå°è‡´æ¯ç­† Request å¿…é ˆç­‰å¾…å‰ä¸€ç­† Request åšå®Œï¼Œæ‰æœƒé–‹å§‹å‹•ä½œï¼Œè®“ processes ä¸€ç›´è¢«å ç”¨ï¼Œæ²’è¾¦æ³•å³æ™‚æ¶ˆåŒ–ï¼Œå°è‡´ processes ç”¨å®Œï¼ŒåˆåŠ ä¸Šæœå‹™æ˜¯ä½¿ç”¨ StatefulSetï¼Œé è¨­æ¨¡å¼çš„ OrderedReadyï¼Œå¿…é ˆç­‰å¾…å‰ä¸€å€‹ Pod æ˜¯ Ready æ‰å¯ä»¥è‡ªå‹•æ“´ç¸®ï¼Œæ‰€ä»¥ç•¶æˆ‘å€‘ Hpa æƒ³è¦æ“´ç¸®ï¼Œä¾†å¢åŠ å¯ç”¨çš„ processes æ•¸é‡ï¼Œä¹Ÿå› ç‚ºæ²’è¾¦æ³•æ“´ç¸®ï¼Œæœ€å¾Œå°è‡´é€™ä¸€é€£ä¸²çš„å•é¡Œ ğŸ˜•ã€‚\nå¦å¤–ï¼Œå¦‚æœæƒ³è¦å¾ OrderedReady æ¨¡å¼åˆ‡æˆ Parallel æ¨¡å¼ (åæ­£éä¾†ä¹Ÿæ˜¯)ï¼Œå¿…é ˆå…ˆå°‡åŸæœ¬çš„ StatefulSet çµ¦åˆªé™¤ï¼Œæ‰å¯ä»¥èª¿æ•´ï¼š\nOrderedReady æ¨¡å¼åˆ‡æˆ Parallel æ¨¡å¼","è§£æ±ºè¾¦æ³•#è§£æ±ºè¾¦æ³•":"ç•¶ä¸‹æƒ³è¶•å¿«è§£æ±º readiness é€™å€‹å•é¡Œï¼Œèª¿æ•´ timeoutSeconds å¾Œï¼Œå–®ç´” apply æ˜¯æ²’æœ‰ç”¨çš„ï¼Œè¦è¨˜å¾—åˆªæ‰å¡ä½çš„ Podï¼Œè®“ä»–é‡æ–°å»ºç«‹ï¼Œæ‰æœƒå¥—ç”¨æ–°çš„è¨­å®š (ä½†æˆ‘å€‘ç•¶ä¸‹å¤ªåœ¨æ„ç‚ºç”šéº¼ Pod æœƒå¡ä½ï¼Œæ²’æœ‰æƒ³åˆ°è¦å…ˆæŠŠ readiness å•é¡Œä¿®æ‰ xDï¼Œæˆ‘å€‘ç•¶ä¸‹çš„è§£æ³•æ˜¯å…ˆå°‡æµé‡å°åˆ°åœ°ç«¯æ­£å¸¸çš„æœå‹™ä¸Š)ã€‚\nå¦å¤– Google ä¹Ÿèªªï¼Œå‡å¦‚æˆ‘å€‘é‚„æ˜¯å¿…é ˆä½¿ç”¨ StatefulSet ä¾†å»ºç«‹æœå‹™ï¼Œå»ºè­°æˆ‘å€‘æŠŠ podManagementPolicy æ”¹æˆ Parallelï¼Œå®ƒæœƒæœ‰é»åƒæ˜¯ Deployment çš„æ„Ÿè¦ºï¼Œä¸æœƒç­‰å¾…å…¶ä»– Pod è®Šæˆ Ready ç‹€æ…‹ï¼Œæ‰€ä»¥å¯ä»¥è®“æˆ‘å€‘å°±ç®—åœ¨ readiness å¡ä½çš„æƒ…æ³ä¸‹ï¼Œä¹Ÿå¯ä»¥è‡ªå‹•æ“´ç¸®æœå‹™ã€‚\nâ„¹ï¸ StatefulSet podManagementPolicy åƒæ•¸èªªæ˜\nOrderedReady (é è¨­) Pods æœƒæŒ‰ç…§é †åºä¸€å€‹æ¥ä¸€å€‹åœ°è¢«å‰µå»ºã€‚å³ï¼Œn+1 è™Ÿ Pod ä¸æœƒåœ¨ n è™Ÿ Pod æˆåŠŸå‰µå»ºä¸” Ready ä¹‹å‰é–‹å§‹å‰µå»ºã€‚ åœ¨ç¸®å° StatefulSet çš„å¤§å°æ™‚ï¼ŒPods æœƒæŒ‰ç…§åå‘é †åºä¸€å€‹æ¥ä¸€å€‹åœ°è¢«çµ‚æ­¢ã€‚å³ï¼Œn è™Ÿ Pod ä¸æœƒåœ¨ n+1 è™Ÿ Pod å®Œå…¨çµ‚æ­¢ä¹‹å‰é–‹å§‹çµ‚æ­¢ã€‚ é€™ç¢ºä¿äº† Pods çš„å•Ÿå‹•å’Œçµ‚æ­¢çš„é †åºæ€§ã€‚\nParallel æ‰€æœ‰ Pods æœƒåŒæ™‚åœ°è¢«å‰µå»ºæˆ–çµ‚æ­¢ã€‚ ç•¶ StatefulSet æ“´å±•æ™‚ï¼Œæ–°çš„ Pods æœƒç«‹å³é–‹å§‹å‰µå»ºï¼Œä¸ç”¨ç­‰å¾…å…¶ä»– Pods æˆç‚º Ready ç‹€æ…‹ã€‚ ç•¶ç¸®å° StatefulSet çš„å¤§å°æ™‚ï¼Œè¦çµ‚æ­¢çš„ Pods æœƒç«‹å³é–‹å§‹çµ‚æ­¢ï¼Œä¸ç”¨ç­‰å¾…å…¶ä»– Pods å…ˆçµ‚æ­¢ã€‚ é€™ç¨®ç­–ç•¥æä¾›äº†å¿«é€Ÿçš„æ“´å±•å’Œç¸®å°æ“ä½œï¼Œä½†ç¼ºä¹é †åºæ€§ä¿è­‰ã€‚"},"title":"æ­£å¼ç’°å¢ƒä¸Šè¸©åˆ° StatefulSet çš„é›·ï¼Œæ‹¿åˆ° P1 çš„æ•™è¨“"},"/blog/kubernetes/pod-veth-name-provided-eth0-already-exists/":{"data":{"":"æ­¤æ–‡ç« è¦ä¾†è¨˜éŒ„ä¸€ä¸‹å…¬å¸åŒäº‹åœ¨æ­£å¼æœå‹™ä¸Šé‡åˆ°çš„å•é¡Œï¼Œæœƒè©³ç´°èªªæ˜é‡åˆ°äº‹æƒ…çš„ç¶“éï¼Œä»¥åŠé–‹å–®è©¢å• google support æœ€å¾Œè¨è«–å‡ºçš„æš«æ™‚è§£æ±ºçš„è¾¦æ³•ï¼š\nç°¡å–®åˆ—å‡ºæ­£å¼ç«™ç•¶ä¸‹æœå‹™ç’°å¢ƒï¼š\ngke master versionï¼š1.25.10-gke.2700 gke node versionï¼š1.25.8-gke.1000 è©²å•é¡Œç™¼ç”Ÿçš„ node pool æœ‰è¨­å®š taint ç™¼ç”Ÿå•é¡Œçš„ Pod æ˜¯ç”¨ Statefulset å»ºç«‹çš„æœå‹™ ","äº‹æƒ…ç™¼ç”Ÿçš„ç¶“é#äº‹æƒ…ç™¼ç”Ÿçš„ç¶“é":" RD åŒä»åæ‡‰ï¼Œç™¼ç¾ä½¿ç”¨ Statefulset å»ºç«‹çš„æ’ç¨‹æœå‹™æœ‰å•é¡Œï¼Œä¸‹ kubectl delete æŒ‡ä»¤æƒ³è¦åˆªé™¤ Podï¼Œè®“ Pod é‡æ–°é•·ï¼Œå»å¡åœ¨ Terminatingï¼Œç­‰å¾…ä¸€æ®µæ™‚é–“å¾Œï¼Œæ±ºå®šä¸‹ kubectl delete --force --grace-period=0 ä¾†å¼·åˆ¶åˆªé™¤ Podï¼Œé€™æ™‚å€™ç‹€æ…‹æœƒå¡åœ¨ ContainerCreatingï¼Œä½¿ç”¨ Describe æŸ¥çœ‹ï¼Œæœƒå‡ºç¾ä»¥ä¸‹éŒ¯èª¤ï¼š Warning (combined from similar events): Failed to create pod sandbox: rpo error: code = Unknown desc = failed to setup network for sandbox \"14fe0cd3d688aed4ffed4c36ffab1a145230449881bcbe4cac6478a63412b0c*: plugin type=*gke\" failed (add): container veth name provided (etho) already exists æˆ‘å€‘ SRE å”åŠ©æŸ¥çœ‹å¾Œï¼Œä¹Ÿæœ‰å˜—è©¦å»ä¸‹ kubectl delete --force --grace-period=0 ä¾†åˆªé™¤ Podï¼Œä½†é‚„æ˜¯ä¸€æ¨£å¡åœ¨ ContainerCreatingï¼Œæœ€å¾Œæ˜¯å…ˆé–‹ä¸€å€‹æ–°çš„ Node ä¸¦è®“è©² Pod å»ºç«‹åˆ°æ–°çš„ Node ä¸Šï¼Œæ‰è§£æ±ºå•é¡Œã€‚ç‚ºäº†æ–¹ä¾¿ google support å”åŠ©æª¢æŸ¥å‡ºå•é¡Œçš„ Nodeï¼Œå…ˆå°‡ Node è¨­å®šæˆ cordonï¼Œé¿å…å…¶ä»– Pod è¢«èª¿åº¦åˆ°è©²å•é¡Œ node ä¸Šã€‚ Node è¨­å®šæˆ cordon\nNode å¯ä»¥è¨­å®š cordonã€drain å’Œ delete ä¸‰å€‹æŒ‡å®šéƒ½æœƒä½¿ Node åœæ­¢è¢«èª¿åº¦ï¼Œåªæ˜¯æ¯å€‹çš„æ“ä½œæš´åŠ›ç¨‹åº¦ä¸åŒï¼š\ncordonï¼šå½±éŸ¿æœ€å°ï¼Œåªæœƒå°‡ Node æ¨™ç¤ºç‚º SchedulingDisabled ä¸å¯èª¿åº¦ç‹€æ…‹ï¼Œä½†ä¸æœƒå½±éŸ¿åˆ°å·²ç¶“åœ¨è©² Node ä¸Šçš„ Podï¼Œä½¿ç”¨ kubectl cordon [node name] ä¾†åœæ­¢èª¿åº¦ï¼Œä½¿ç”¨ kubectl uncordon [node name] ä¾†æ¢å¾©èª¿åº¦ã€‚\ndrainï¼šæœƒå…ˆé©…é€åœ¨ Node ä¸Šçš„ Podï¼Œå†å°‡ Node æ¨™ç¤ºç‚º SchedulingDisabled ä¸å¯èª¿åº¦ç‹€æ…‹ï¼Œä½¿ç”¨ kubectl drain [node name] --ignore-daemonsets --delete-local-data ä¾†åœæ­¢èª¿åº¦ï¼Œä½¿ç”¨ kubectl uncordon [node name] ä¾†æ¢å¾©èª¿åº¦ã€‚\ndeleteï¼šæœƒå…ˆé©…é€ Node ä¸Šçš„ Podï¼Œå†åˆªé™¤ Node ç¯€é»ï¼Œå®ƒæ˜¯ä¸€ç¨®æš´åŠ›åˆªé™¤ Node çš„ä½œæ³•ï¼Œåœ¨é©…é€ Pod æ™‚ï¼Œæœƒå¼·åˆ¶ Kill å®¹å™¨é€²ç¨‹ï¼Œæ²’è¾¦æ³•å„ªé›…çš„çµ‚æ­¢ Podã€‚\næˆ‘å€‘éš¨å¾Œé–‹å–®è©¢å• goolge supportã€‚ ","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"Node ç¯€é»ç¦æ­¢èª¿åº¦ï¼ˆå¹³æ»‘ç¶­è­·ï¼‰æ–¹å¼- cordonï¼Œdrainï¼Œdeleteï¼šhttps://www.cnblogs.com/kevingrace/p/14412254.html","èˆ‡-google-support-è¨è«–å…§å®¹#èˆ‡ Google Support è¨è«–å…§å®¹":"Google Support ç¶“éæŸ¥è©¢å¾Œï¼Œå›è¦†èªªï¼šé€™å€‹å•é¡Œæ˜¯å› ç‚º Pod è¢«å¼·åˆ¶åˆªé™¤å°è‡´ï¼Œå¼·åˆ¶åˆªé™¤æ˜¯ä¸€ç¨®å±éšªçš„æ“ä½œï¼Œä¸å»ºè­°é€™æ¨£è™•ç†ï¼Œä¸‹é¢æœ‰è©³ç´°è¨è«–ã€‚\nä¸€é–‹å§‹å¡åœ¨ Terminating ç‹€æ…‹ï¼Œæˆ‘å€‘ä¹Ÿæœ‰è«‹ RD èªªæ˜ä¸€ä¸‹ç•¶ä¸‹é‡åˆ°çš„å•é¡Œä»¥åŠè™•ç†å‹•ä½œï¼šRD ç•¶æ™‚æƒ³è¦åˆªé™¤ Pod æ˜¯å› ç‚ºè©²ç¨‹å¼ç•¶ä¸‹æœ‰ Bugï¼Œå°‡ redis èˆ‡ db é€£ç·šçµ¦é—œé–‰ï¼Œç¨‹å¼æ‰¾ä¸åˆ°å°±æœƒä¸€ç›´ retryï¼Œå°è‡´ç›¸é—œé€²ç¨‹ç„¡æ³•çµæŸï¼Œå†åŠ ä¸Š terminationGracePeriodSeconds æˆ‘å€‘è¨­å®š 14400ï¼Œä¹Ÿå°±æ˜¯ 4 å°æ™‚ï¼Œæ‰æœƒå¡åœ¨ Terminating ç‹€æ…‹ã€‚ (terminationGracePeriodSeconds è¨­å®šé€™éº¼ä¹…æ˜¯å¸Œæœ›å¦‚æœæœ‰è¢« on callï¼Œå·¥ç¨‹å¸«ä¸Šä¾†æ™‚ï¼Œå¯ä»¥æŸ¥çœ‹è©² Pod çš„éŒ¯èª¤åŸå› )\nå› ç‚ºå¡åœ¨ Terminating å¤ªä¹…ï¼ŒRD æœ‰åŸ·è¡Œ kubectl delete --forceï¼Œå°±æ˜¯å› ç‚ºä¸‹äº† --force æ‰é€ æˆç›¸é—œè³‡æºå•é¡Œ (ä¾‹å¦‚ container proccess, sandbox, ä»¥åŠç¶²è·¯è³‡æº)æ²’æœ‰åˆªä¹¾æ·¨ã€‚æ‰€ä»¥å¼•èµ·äº†æ­¤æ¬¡çš„å ±éŒ¯ â€œcontainer veth name provided (eth0) already existsâ€ã€‚ (å› ç‚ºæˆ‘å€‘æœå‹™ä½¿ç”¨ Statefulsetï¼ŒPod åç¨±ç›¸åŒï¼Œå°è‡´ eth0 é€™å€‹ç¶²è·¯è³‡æºåç¨±é‡è¤‡ï¼Œæ‰€ä»¥é€ æˆéŒ¯èª¤ï¼Œå¯ä»¥ç”¨ deployment ä¾†æ”¹å–„é€™å€‹å•é¡Œï¼Œåªæ˜¯è³‡æºå¦‚æœæ²’æœ‰æ¸…ç†ä¹¾æ·¨æœƒä½”ç”¨ IPï¼Œæ‰€ä»¥å–®ç´”èª¿æ•´æˆ deployment ä¹Ÿä¸æ˜¯æœ€ä½³è§£)\nGoogle ç”¢å“åœ˜éšŠå»ºè­°ï¼Œå¦‚æœ Pod è™•æ–¼ Running ç‹€æ…‹æ™‚ï¼Œæƒ³è¦å¿«é€Ÿåˆªé™¤ Pod æ™‚ï¼Œä¸€é–‹å§‹å°±å…ˆä½¿ç”¨ kubectl delete pod --grace-period=number[ç§’æ•¸] ä¾†åˆªé™¤ï¼Œå¦‚æœå·²ç¶“æ˜¯ Terminating ç‹€æ…‹å‰‡ç„¡æ•ˆã€‚(SRE åŒä»å·²æ¸¬è©¦éï¼Œèˆ‡ Google Support èªªæ˜ç›¸åŒ)\né‚£å¦‚æœå·²ç¶“è™•æ–¼ Terminating ç‹€æ…‹ï¼Œè¦æ€éº½è®“ Pod è¢«é †åˆ©åˆªé™¤ï¼Œé€™éƒ¨åˆ† Google Support å¾ŒçºŒæœƒåœ¨æ¸¬è©¦ä¸¦çµ¦å‡ºå»ºè­°ï¼Œç›®å‰æ¸¬è©¦æ˜¯ï¼šé€²å»å¡ä½çš„ Pod Containerï¼Œæ‰‹å‹•åˆªé™¤ä¸»é€²ç¨‹ (pkill) å°±å¯ä»¥äº†ã€‚\nGoogle Support å›è¦†"},"title":"éƒ¨ç½² Pod é‡åˆ° container veth name provided (eth0) already exists éŒ¯èª¤"},"/blog/lecture/":{"data":{"":"æ­¤åˆ†é¡åŒ…å«æ­·å¹´æ“”ä»»ä¸åŒé¡å‹è¬›å¸«çš„è¬›åº§å…§å®¹ï¼Œæ­¡è¿åƒè€ƒ\næœé™½ç§‘æŠ€å¤§å­¸ - å®‰å…¨å‰ç»ï¼šç¶²ç«™é˜²è­·èˆ‡ DevOps æŠ€è¡“è¬›åº§ (2024/05/29) "},"title":"è¬›åº§"},"/blog/lecture/20240529-devops-introduce/":{"data":{"":"","docker-å’Œ-kubernetes-æ¦‚å¿µä»‹ç´¹#Docker å’Œ Kubernetes æ¦‚å¿µä»‹ç´¹":"\nDocker ä»‹ç´¹ Docker æ˜¯ä¸€ç¨®è»Ÿé«”å¹³å°ï¼Œå®ƒå¯ä»¥å¿«é€Ÿå»ºç«‹ã€æ¸¬è©¦å’Œéƒ¨ç½²æ‡‰ç”¨ç¨‹å¼ã€‚ç‚ºä»€éº¼å¯ä»¥å¿«é€Ÿå»ºç«‹å‘¢ï¼Ÿå› ç‚º Docker æœƒå°‡è»Ÿé«”å°è£åˆ°åç‚ºã€å®¹å™¨ã€çš„æ¨™æº–å–®ä½ã€‚å…¶ä¸­æœƒåŒ…å«ç¨‹å¼åº«ã€ç³»çµ±å·¥å…·ã€ç¨‹å¼ç¢¼ã€åŸ·è¡Œè»Ÿé«”æ‰€éœ€çš„æ‰€æœ‰é …ç›®ã€‚ å‰›å‰›æœ‰æåˆ°å®¹å™¨ (Container)ï¼Œæ˜¯ä¸€ç¨®è™›æ“¬åŒ–æŠ€è¡“ï¼Œå®ƒé«˜æ•ˆç‡è™›æ“¬åŒ–åŠæ˜“æ–¼é·ç§»å’Œæ“´å±•çš„ç‰¹æ€§ï¼Œéå¸¸é©åˆç¾ä»£é›²ç«¯çš„é–‹ç™¼åŠä½ˆç½²ã€‚\né‚£ Container èˆ‡å‚³çµ±çš„è™›æ“¬æ©Ÿ (VM) æœ‰ä»€éº¼å·®åˆ¥å‘¢ï¼Ÿæˆ‘å€‘ä¾†çœ‹çœ‹ä¸‹é¢é€™å¼µåœ–\nContainer èˆ‡ VM çš„å·®ç•° åœ–ç‰‡ä¾†æº\nå¯ä»¥çœ‹åˆ° Container æ˜¯ä»¥æ‡‰ç”¨ç¨‹å¼ç‚ºå–®ä½ï¼Œè€Œ VM å‰‡æ˜¯ä»¥ä½œæ¥­ç³»çµ±ç‚ºå–®ä½ã€‚é›–ç„¶æœ¬è³ªä¾†èªªå…©è€…éƒ½æ˜¯é‹è¡Œåœ¨æœ‰å¯¦é«”çš„ç¡¬é«”æ©Ÿå™¨ä¸Šï¼Œä½† Container æ˜¯ä¸€å€‹å°è£äº†ç›¸ä¾æ€§è³‡æºèˆ‡æ‡‰ç”¨ç¨‹å¼çš„åŸ·è¡Œç’°å¢ƒã€‚VM å‰‡æ˜¯ä¸€å€‹éœ€è¦é…ç½®å¥½ CPUã€RAM èˆ‡ Storage çš„ä½œæ¥­ç’°å¢ƒï¼Œç‚ºäº†æ›´å¥½çš„åšå€åˆ¥ï¼Œæˆ‘æŠŠ Containerã€VM å…©å€‹å·®åˆ¥ç”¨è¡¨æ ¼ä¾†èªªæ˜ï¼š\næ¯”è¼ƒ å®¹å™¨ (Container) è™›æ“¬æ©Ÿ(VM) å–®ä½ æ‡‰ç”¨ç¨‹å¼ ä½œæ¥­ç³»çµ± é©ç”¨æœå‹™ å¤šä½¿ç”¨æ–¼å¾®æœå‹™ ä½¿ç”¨è¼ƒå¤§å‹çš„æœå‹™ ç¡¬é«”è³‡æº æ˜¯ä»¥ç¨‹å¼ç‚ºå–®ä½ï¼Œéœ€è¦çš„ç¡¬é«”è³‡æºå¾ˆå°‘ VM æœƒå…ˆä½”ç”¨ CPUã€RAM ç­‰ç­‰ç¡¬é«”è³‡æºï¼Œä¸ç®¡æœ‰æ²’æœ‰ä½¿ç”¨éƒ½æœƒå…ˆä½”ç”¨ é€ æˆè¡çª Container é–“æ˜¯å½¼æ­¤éš”é›¢çš„ï¼Œå› æ­¤åœ¨åŒä¸€å°æ©Ÿå™¨å¯ä»¥åŸ·è¡Œä¸åŒç‰ˆæœ¬çš„æœå‹™ æœƒå› ç‚ºç‰ˆæœ¬ä¸åŒé€ æˆç’°å¢ƒè¡çª ç³»çµ±æ”¯æ´æ•¸é‡ å–®æ©Ÿæ”¯æ´ä¸Šåƒå€‹å®¹å™¨ ä¸€èˆ¬æœ€å¤šå¹¾åå€‹ å„ªé» Image è¼ƒå°ï¼Œé€šå¸¸éƒ½å¹¾ MB\nå•Ÿå‹•é€Ÿåº¦å¿«ï¼Œé€šå¸¸å¹¾ç§’å°±å¯ä»¥ç”Ÿæˆä¸€å€‹ Container\næ›´æ–°è¼ƒç‚ºå®¹æ˜“ï¼Œåªéœ€è¦åˆ©ç”¨æ–°çš„ Image é‡æ–°å•Ÿå‹•å°±æœƒæ›´æ–°å®Œäº† å› ç‚ºç¡¬é«”å±¤ä»¥ä¸Šéƒ½è™›æ“¬åŒ–ï¼Œå› æ­¤å®‰å…¨æ€§ç›¸å°è¼ƒé«˜\nç³»çµ±é¸æ“‡è¼ƒå¤šï¼Œåœ¨ VM å¯ä»¥é¸æ“‡ä¸åŒçš„ OS\nä¸éœ€è¦é™ä½æ‡‰ç”¨ç¨‹å¼å…§æœå‹™çš„è€¦åˆæ€§ï¼Œä¸éœ€è¦å°‡ç¨‹å¼å…§çš„æœå‹™å€‹åˆ¥æ‹†é–‹ä¾†éƒ¨ç½² ç¼ºé» å®‰å…¨æ€§è¼ƒ VM å·®ï¼Œå› ç‚ºç’°å¢ƒèˆ‡ç¡¬é«”éƒ½èˆ‡æœ¬æ©Ÿå…±ç”¨\nåœ¨åŒä¸€å°æ©Ÿå™¨ä¸­ï¼Œæ¯ä¸€å€‹ Container çš„ OS éƒ½æ˜¯ç›¸åŒçš„ï¼Œç„¡æ³•ä¸€å€‹ç‚º Windowsã€ä¸€å€‹ç‚º Linuxï¼Œé‚„æ˜¯ä¾è³´ Host OS\nContainer é€šå¸¸æœƒåˆ‡æˆå¾®æœå‹™çš„æ–¹å¼ä½œéƒ¨ç½²ï¼Œåœ¨å„å…ƒä»¶ä¸­çš„ç¶²è·¯é€£çµæœƒæ¯”è¼ƒè¤‡é›œ Image çš„å¤§å°é€šå¸¸ GB ä»¥ä¸Šï¼Œæ¯” Container å¤§å¾ˆå¤š\nå•Ÿå‹•é€Ÿåº¦é€šå¸¸è¦èŠ±å¹¾åˆ†é˜ï¼Œå› æ­¤æœå‹™é‡å•Ÿé€Ÿåº¦è¼ƒæ…¢\nè³‡æºä½¿ç”¨è¼ƒå¤šï¼Œå› ç‚ºä¸åªç¨‹å¼æœ¬èº«ï¼Œé‚„è¦å°‡ä¸€éƒ¨åˆ†è³‡æºåˆ†çµ¦ VM çš„ä½œæ¥­ç³»çµ± Docker å°ç¸½çµ æ›´å¿«é€Ÿçš„äº¤ä»˜å’Œéƒ¨ç½²ï¼šå°æ–¼é–‹ç™¼å’Œç¶­é‹äººå“¡ä¾†èªªï¼Œæœ€å¸Œæœ›å°±æ˜¯ä¸€æ¬¡å»ºç«‹æˆ–è¨­å®šï¼Œå¯ä»¥å†ä»»æ„åœ°æ–¹æ­£å¸¸é‹è¡Œã€‚é–‹ç™¼è€…å¯ä»¥ä½¿ç”¨ä¸€å€‹æ¨™æº–çš„æ˜ åƒæª”ä¾†å»ºç«‹ä¸€å¥—é–‹ç™¼å®¹å™¨ï¼Œé–‹ç™¼å®Œæˆä¹‹å¾Œï¼Œç¶­é‹äººå“¡å¯ä»¥ç›´æ¥ä½¿ç”¨é€™å€‹å®¹å™¨ä¾†éƒ¨ç½²ç¨‹å¼ã€‚Docker å®¹å™¨å¾ˆè¼•å¾ˆå¿«ï¼å®¹å™¨çš„å•Ÿå‹•æ™‚é–“éƒ½æ˜¯å¹¾ç§’ä¸­çš„äº‹æƒ…ï¼Œå¤§é‡åœ°ç¯€ç´„é–‹ç™¼ã€æ¸¬è©¦ã€éƒ¨ç½²çš„æ™‚é–“ã€‚\næ›´æœ‰æ•ˆç‡çš„è™›æ“¬åŒ–ï¼šDocker å®¹å™¨çš„åŸ·è¡Œä¸éœ€è¦é¡å¤–çš„è™›æ“¬åŒ–æ”¯æ´ï¼Œå®ƒæ˜¯æ ¸å¿ƒå±¤ç´šçš„è™›æ“¬åŒ–ï¼Œå› æ­¤å¯ä»¥å¯¦ä½œæ›´é«˜çš„æ•ˆèƒ½å’Œæ•ˆç‡ã€‚\næ›´è¼•é¬†çš„é·ç§»å’Œæ“´å±•ï¼šDocker å®¹å™¨å¹¾ä¹å¯ä»¥åœ¨ä»»æ„çš„å¹³å°ä¸ŠåŸ·è¡Œï¼ŒåŒ…æ‹¬å¯¦é«”æ©Ÿå™¨ã€è™›æ“¬æ©Ÿã€å…¬æœ‰é›²ã€ç§æœ‰é›²ã€å€‹äººé›»è…¦ã€ä¼ºæœå™¨ç­‰ã€‚ é€™ç¨®å…¼å®¹æ€§å¯ä»¥è®“ä½¿ç”¨è€…æŠŠä¸€å€‹æœå‹™å¾ä¸€å€‹å¹³å°ç›´æ¥é·ç§»åˆ°å¦å¤–ä¸€å€‹ã€‚\næ›´ç°¡å–®çš„ç®¡ç†ï¼šä½¿ç”¨ Dockerï¼Œåªéœ€è¦å°å°çš„ä¿®æ”¹ï¼Œå°±å¯ä»¥æ›¿ä»£ä»¥å¾€å¤§é‡çš„æ›´æ–°å·¥ä½œã€‚æ‰€æœ‰çš„ä¿®æ”¹éƒ½ä»¥å¢é‡çš„æ–¹å¼è¢«åˆ†ç™¼å’Œæ›´æ–°ï¼Œå¾è€Œå¯¦ä½œè‡ªå‹•åŒ–ä¸¦ä¸”æœ‰æ•ˆç‡çš„ç®¡ç†ã€‚\nDocker å››å¤§å…ƒç´  Docker æ˜¯ç”±é€™å››å€‹æ±è¥¿æ‰€çµ„æˆï¼Œäº†è§£å¾Œå°±å¯ä»¥çŸ¥é“æ•´å€‹ Docker çš„ç”Ÿå‘½é€±æœŸã€‚\nDockerfile æ˜ åƒæª” (Image) å®¹å™¨ (Container) å€‰åº« (Repository) Dockerfile é–‹ç™¼äººå“¡åœ¨ä½¿ç”¨ Docker æ™‚ç™¼ç¾ï¼Œå¤§å¤šç¾æˆçš„ Docker æ˜ åƒæª”ç„¡æ³•æ»¿è¶³ä»–å€‘çš„éœ€æ±‚ï¼Œå› æ­¤éœ€è¦ä¸€ç¨®èƒ½å¤ ç”Ÿæˆæ˜ åƒæª”çš„å·¥å…·ã€‚Dockerfile æ˜¯ä¸€ç¨®ç°¡æ˜“çš„æ–‡ä»¶æª”ï¼Œè£¡é¢åŒ…å«äº†å»ºç«‹æ–°æ˜ åƒæª”æ‰€éœ€çš„æŒ‡ä»¤ã€‚\nDockerfile èªæ³•ä¸»è¦ç”± Commandï¼ˆå‘½ä»¤ï¼‰å’Œ Argument ï¼ˆåƒæ•¸é¸æ“‡ï¼‰å…©å¤§å…ƒç´ çµ„æˆã€‚ä»¥ä¸‹æ˜¯ä¸€å€‹ç°¡æ˜“çš„ Dockerfile ç¤ºæ„åœ–ï¼š\nå‘½ä»¤å¼èªæ³•ï¼‹é¸æ“‡åƒæ•¸ï¼ˆCommand + Argumentï¼‰\nDockerfile åœ–ç‰‡ä¾†æº\næ˜ åƒæª” (Image) Docker æ˜ åƒæª”æ˜¯ä¸€å€‹å”¯ç¨çš„æ¨¡æ¿ã€‚\nä¾‹å¦‚ï¼šä¸€å€‹æ˜ åƒæª”å¯ä»¥ç”¨ä¸€å€‹ Ubuntu Linux ä½œæ¥­ç³»çµ±ç•¶ä½œåŸºåº•ï¼Œè£¡é¢åªå®‰è£ Nginx æˆ–ä½¿ç”¨è€…æƒ³ç”¨çš„å¥—ä»¶ç­‰ã€‚\næˆ‘å€‘æœƒä½¿ç”¨æ˜ åƒæª”ä¾†å»ºç«‹ Docker çš„å®¹å™¨ (Container) ï¼ŒDocker ä¹Ÿæä¾›å¾ˆç°¡å–®çš„æ©Ÿåˆ¶ä¾†å»ºç«‹æ˜ åƒæª”æˆ–æ˜¯æ›´æ–°ç¾æœ‰çš„æ˜ åƒæª”ï¼Œä¹Ÿå¯ä»¥å»ä¸‹è¼‰åˆ¥äººå·²ç¶“åšå¥½çš„æ˜ åƒæª”ã€‚\nImage åœ–ç‰‡ä¾†æº\nå®¹å™¨ (Container) Docker æ˜¯åˆ©ç”¨å®¹å™¨ä¾†åŸ·è¡Œæ‡‰ç”¨ç¨‹å¼ã€‚\næ¯ä¸€å€‹å®¹å™¨éƒ½æ˜¯ç”±æ˜ åƒæª”æ‰€å»ºç«‹çš„çš„åŸ·è¡Œç¨‹å¼ã€‚å®ƒå¯ä»¥è¢«å•Ÿå‹•ã€é–‹å§‹ã€åœæ­¢ã€åˆªé™¤ã€‚ä¸”æ¯ä¸€å€‹å®¹å™¨éƒ½æ˜¯ç›¸äº’éš”é›¢çš„ï¼Œä¸æœƒç›¸äº’å½±éŸ¿ã€‚\nContainer åœ–ç‰‡ä¾†æº\nå€‰åº« (Repository) å€‰åº«æ˜¯é›†ä¸­æ”¾ç½®æ˜ åƒæª”çš„æ‰€åœ¨åœ°ï¼Œå€‰åº«åˆ†ç‚ºå…¬é–‹å€‰åº« (Public) å’Œ ç§æœ‰å€‰åº« (Private) å…©ç¨®å½¢å¼ã€‚æœ€å¤§çš„å€‰åº«è¨»å†Šä¼ºæœå™¨ç•¶ç„¶æ˜¯ Docker hubï¼Œå­˜æ”¾æ•¸é‡é¾å¤§çš„æ˜ åƒæª”ä¾›ä½¿ç”¨è€…ä¸‹è¼‰ï¼Œä½¿ç”¨è€…ä¹Ÿå¯ä»¥åœ¨æœ¬åœ°ç¶²è·¯å…§å»ºç«‹ä¸€å€‹ç§æœ‰å€‰åº«ã€‚å¯ä»¥å°‡å€‰åº«çš„æ¦‚å¿µç†è§£æˆè·Ÿ Git ç›¸ä¼¼ã€‚\nRepository åœ–ç‰‡ä¾†æº\né€™æ¨£è¬›é‚„æ˜¯æœ‰é»æŠ½è±¡ï¼Œæˆ‘å€‘ä¾†çœ‹ä¸€å€‹å¯¦éš›çš„ä¾‹å­ï¼š\né¦–å…ˆæˆ‘å€‘å…ˆçœ‹ä¸€ä¸‹ Docker çš„ Logoï¼Œä½ å€‘è¦ºå¾—é€™æ˜¯ä»€éº¼å‹•ç‰©å‘¢ï¼Ÿ\nDocekr Logo åœ–ç‰‡ä¾†æº\næ²’éŒ¯å°±æ˜¯é¯¨é­šï¼Œä½†ä½ å€‘æœ‰æ²’æœ‰æ³¨æ„åœ–ç‰‡æœ‰ä¸‰å€‹å¤§å…ƒç´ å‘¢ï¼Ÿ\næµ·æ´‹ é¯¨é­š è²¨æ«ƒ æµ·æ´‹ä»£è¡¨çš„æ˜¯ Docker çš„åŸ·è¡Œç’°å¢ƒï¼Œä¸è«–æ˜¯åœ¨å“ªå€‹æµ·æ´‹ (è¨ˆç®—ç’°å¢ƒ)ï¼Œéƒ½å¯ä»¥åŸ·è¡Œï¼Œé¯¨é­šä»£è¡¨çš„æ˜¯ Docker é€™å€‹å¹³å° (æˆ–å¯ä»¥æŒ‡ Image)ï¼Œè€Œè²¨æ«ƒä»£è¡¨çš„æ˜¯ Docker çš„å®¹å™¨ï¼Œä¹Ÿå°±æ˜¯èªªæˆ‘å€‘å¯ä»¥æœ‰å¾ˆå¤šå€‹ Container åœ¨åŒä¸€å€‹ Image ä¸ŠåŸ·è¡Œï¼Œä¸”äº’ä¸å½±éŸ¿ï¼Œèƒ½å¤ å¿«é€Ÿçš„éƒ¨ç½²å’Œé·ç§»ï¼Œä¸¦åœ¨ä¸åŒçš„ç’°å¢ƒä¸­åŸ·è¡Œã€‚\nç”±æ–¼æ™‚é–“é—œä¿‚ï¼Œå…¶ä»– Docker è©³ç´°ä»‹ç´¹ä»¥åŠè³‡æ–™å¯ä»¥åƒè€ƒæˆ‘ä¹‹å‰å¯«çš„æ–‡ç« ï¼šDocker ä»‹ç´¹ (å¦‚ä½•ä½¿ç”¨ Docker-compose å»ºç½® PHP+MySQl+Nginx ç’°å¢ƒ)\nDocker å°è©¦èº«æ‰‹ ç‚ºäº†å¤§å®¶èƒ½å¤ æ›´äº†è§£ Docker çš„ä½¿ç”¨ï¼Œæˆ‘å€‘ä¾†å¯¦éš›æ“ä½œä¸€ä¸‹ï¼š\né¦–å…ˆè«‹å¤§å®¶å…ˆåˆ° GitHub ä¸‹è¼‰ç¯„ä¾‹ç¨‹å¼ç¢¼ï¼šhttps://github.com/880831ian/20240529-devops-introduce æ¥è‘—å…ˆåŸ·è¡Œ docker build -t 0529:latest . é€™å€‹æŒ‡ä»¤ï¼Œé€™å€‹æŒ‡ä»¤æ˜¯ç”¨ä¾†å»ºç«‹ä¸€å€‹ Imageï¼Œé€™å€‹ Image æ˜¯ç”¨ä¾†åŸ·è¡Œ Nginx çš„ç¨‹å¼ç¢¼ã€‚ æ¥è‘—åŸ·è¡Œ docker run -d -p 8080:80 0529:latest é€™å€‹æŒ‡ä»¤ï¼Œé€™å€‹æŒ‡ä»¤æ˜¯ç”¨ä¾†åŸ·è¡Œä¸€å€‹ Containerï¼Œä¸¦ä¸”å°‡ Container çš„ 80 port å°æ‡‰åˆ°æœ¬æ©Ÿçš„ 8080 portã€‚ æ‰“é–‹ç€è¦½å™¨ï¼Œè¼¸å…¥ http://localhost:8080ï¼Œå°±å¯ä»¥çœ‹åˆ° Nginx çš„é¦–é äº†ã€‚ æˆ‘å€‘å…ˆå°‡é—œé–‰ Containerï¼Œè‡ªè¡Œä¿®æ”¹ index.html çš„å…§å®¹ï¼Œç„¶å¾Œå†é‡æ–°åŸ·è¡Œ docker build -t 0529:v0.0.1 . å’Œ docker run -d -p 8080:80 0529:v0.0.1ï¼Œå°±å¯ä»¥çœ‹åˆ°ä¿®æ”¹å¾Œçš„å…§å®¹äº†ã€‚ æˆ‘å€‘ä¸‹ docker tag 0529:v0.0.1 880831ian/0529:v0.0.1 é€™å€‹æŒ‡ä»¤ï¼Œå°‡ Image æ”¹æˆ Docker Hub å¸³è™Ÿè·Ÿ Image åç¨±ï¼Œä¾‹å¦‚ï¼š880831ian/0529:v0.0.1ã€‚ æœ€å¾Œæˆ‘å€‘ä¸‹ docker push 880831ian/0529:v0.0.1 é€™å€‹æŒ‡ä»¤ï¼Œé€™æ¨£å°±å¯ä»¥å°‡ Image ä¸Šå‚³åˆ° Docker Hub ä¸Šï¼Œé€™æ¨£å…¶ä»–äººå°±å¯ä»¥ä½¿ç”¨ä½ çš„ Image ä¾†éƒ¨ç½²æœå‹™äº†ã€‚ Docker é‹ä½œæµç¨‹ æ­¥é©Ÿä¸€ã€æ’°å¯« Dockerfile\næ­¥é©ŸäºŒã€å°‡ Dockerfile å»ºç«‹ç‚º Image\næ­¥é©Ÿä¸‰ã€å°‡ Image é‹è¡Œç‚ºå®¹å™¨ã€‚é€éé€™ä¸‰å€‹ç°¡å–®çš„æ­¥é©Ÿï¼Œå°±èƒ½å‰µå»ºè‡ªå·±çš„ Docker å®¹å™¨å›‰ï¼\nDocekr é‹ä½œæµç¨‹ åœ–ç‰‡ä¾†æº\nKubernetes ä»‹ç´¹ Kubernetes ä¹Ÿå¯ä»¥å« K8sï¼Œé€™å€‹åç¨±ä¾†æºå¸Œè‡˜èªï¼Œæ„æ€æ˜¯èˆµæ‰‹æˆ–æ˜¯é£›è¡Œå“¡ï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥çœ‹åˆ°å®ƒçš„ logo æ˜¯ä¸€å€‹èˆ¹èˆµçš„æ¨™èªŒï¼Œä¹‹æ‰€ä»¥å« K8s æ˜¯å› ç‚º Kubernetes çš„ k åˆ° s ä¸­é–“æœ‰ 8 çš„è‹±æ–‡å­—æ¯ï¼Œç‚ºäº†æ–¹ä¾¿ï¼Œå¤§å®¶å¸¸ä»¥é€™å€‹åç¨±ä¾†ç¨±å‘¼å®ƒï¼\nKubernetes æ˜¯ä¸€ç¨®é–‹æºå¯ç”¨ä¾†è‡ªå‹•åŒ–éƒ¨å±¬ã€æ“´å±•ä»¥åŠç®¡ç†å¤šå€‹å®¹å™¨çš„ç³»çµ±ï¼Œé©ç”¨æ–¼ç•¶å®¹å™¨æ•¸é‡å¢åŠ ï¼Œéœ€è¦ç©©å®šå®¹å™¨ç’°å¢ƒï¼Œä»¥åŠç®¡ç†è³‡æºæˆ–æ¬Šé™åˆ†é…çš„ç‹€æ³ã€‚ å¦å¤– K8s ä¹Ÿæ˜¯ Google é–‹ç™¼çš„ï¼Œä¸¦ä¸”æ˜¯ CNCF (Cloud Native Computing Foundation) çš„ä¸€å€‹å°ˆæ¡ˆï¼Œæ‰€ä»¥ K8s ä¹Ÿæ˜¯ä¸€å€‹éå¸¸å—æ­¡è¿çš„å®¹å™¨ç®¡ç†ç³»çµ±ã€‚\nK8s Logo\nKubernetes å…ƒä»¶ä»‹ç´¹ K8s å…ƒä»¶ åœ–ç‰‡ä¾†æº\nKubernetes 3 å¤§å¥½è™• æœå‹™ã€ç³»çµ±éƒ¨å±¬æ›´æ–¹ä¾¿ï¼šKubernetes å¯ä»¥è‡ªå‹•åŒ–éƒ¨å±¬ã€æ“´å±•ä»¥åŠç®¡ç†å¤šå€‹å®¹å™¨çš„ç³»çµ±ï¼Œè®“é–‹ç™¼è€…å¯ä»¥æ›´å°ˆæ³¨åœ¨é–‹ç™¼ä¸Šï¼Œè€Œä¸ç”¨æ“”å¿ƒéƒ¨å±¬çš„å•é¡Œã€‚ ","ä»€éº¼æ˜¯-cicd#ä»€éº¼æ˜¯ CICD":"","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"åœ°ç«¯æ˜¯ä»€éº¼ï¼Ÿå¯ä»¥åƒå—ï¼Ÿï¼šhttps://wanchunghuang.com/what-is-on-premises/\né›²ç«¯ VS åœ°ç«¯ï¼Œæ•¸ä½è½‰å‹æ€éº¼é¸ï¼Ÿï¼šhttps://blog.hackmd.io/zh/blog/2022/02/22/cloud-vs-on-premises\nä»€éº¼æ˜¯é›²ç«¯ï¼Ÿ | é›²ç«¯å®šç¾©ï¼š https://www.cloudflare.com/zh-tw/learning/cloud/what-is-the-cloud/\nä¼æ¥­å¦‚ä½•æŒ‘é¸åˆé©çš„é›²ç«¯æœå‹™ï¼Ÿå…¬æœ‰é›²ã€ç§æœ‰é›²å·®ç•°æ¯”è¼ƒç¸½æ•´ç†ï¼šhttps://aws.amazon.com/tw/events/taiwan/techblogs/public-cloud-private-cloud/\nçµ¦è³‡æ–™ç§‘å­¸å®¶çš„ Docker æŒ‡å—ï¼š3 ç¨®æ´»ç”¨ Docker çš„æ–¹å¼ï¼ˆä¸Šï¼‰ï¼šhttps://leemeng.tw/3-ways-you-can-leverage-the-power-of-docker-in-data-science-part-1-learn-the-basic.html\nDocker æ˜¯ä»€éº¼ï¼ŸDocker åŸºæœ¬è§€å¿µä»‹ç´¹èˆ‡å®¹å™¨å’Œè™›æ“¬æ©Ÿçš„æ¯”è¼ƒï¼šhttps://www.omniwaresoft.com.tw/product-news/docker-news/docker-introduction/","å¦‚ä½•æœ€å¿«æ¢å¾©ç¶²ç«™#å¦‚ä½•æœ€å¿«æ¢å¾©ç¶²ç«™":"å¦‚ä½•æœ€å¿«æ¢å¾©ç¶²ç«™ï¼Œé€™æ˜¯ä¸€å€‹éå¸¸é‡è¦çš„è­°é¡Œï¼Œå› ç‚ºç¶²ç«™çš„åœæ“ºæœƒé€ æˆæ¥­å‹™çš„æå¤±ï¼Œä¹Ÿæœƒè®“ä½¿ç”¨è€…å°ç¶²ç«™çš„ä¿¡ä»»åº¦ä¸‹é™ï¼Œæ‰€ä»¥æˆ‘å€‘éœ€è¦æœ‰ä¸€å€‹å¾ˆå¥½çš„æ‡‰æ€¥è¨ˆç•«ï¼Œä¾†æ‡‰å°é€™ç¨®ç‹€æ³ã€‚\nç¶²ç«™åœæ“ºçš„åŸå›  é‚£åœ¨è¨è«–å¦‚ä½•æ¢å¾©å‰ï¼Œæˆ‘å€‘è¦å…ˆäº†è§£æœƒå°è‡´ç¶²ç«™åœæ“ºçš„åŸå› æœ‰å“ªäº›ï¼Ÿ\nä¼ºæœå™¨ä¾›æ‡‰å•†æ•…éšœ é€™é‚Šçš„ä¼ºæœå™¨ä¾›æ‡‰å•†ï¼Œæˆ‘å€‘ä»¥é›²ç«¯çš„ä¾›æ‡‰å•†ç‚ºä¸»ï¼Œä¹Ÿå°±æ˜¯ GCPã€AWSã€Azure ç­‰ç­‰ï¼Œé€™äº›ä¾›æ‡‰å•†å¯èƒ½æœƒå› ç‚ºç¡¬é«”æ•…éšœã€è»Ÿé«”éŒ¯èª¤ã€ç¶²è·¯å•é¡Œç­‰åŸå› è€Œåœæ“º (ç•¶ç„¶åœ°ç«¯çš„æ©Ÿå™¨ä¹Ÿå¯èƒ½æœƒå› ç‚ºä¸»æ©Ÿçš„ä¾›æ‡‰å•†å°è‡´ç¶²ç«™ä¸­æ–·ï¼Œä¾‹å¦‚ï¼šWindows è‡ªå‹•æ›´æ–°)ã€‚\nç¶²ç«™ä¼ºæœå™¨æ•…éšœ ç¶²ç«™çš„ä¼ºæœå™¨ç•¶ç„¶ä¹Ÿå¯èƒ½æœƒå› ç‚ºç¡¬é«”æ•…éšœã€è»Ÿé«”éŒ¯èª¤ã€ç¶²è·¯å•é¡Œç­‰åŸå› è€Œåœæ“ºã€‚é€™ä¹Ÿæ˜¯æœ€å¸¸è¦‹çš„åŸå› ä¹‹ä¸€ã€‚ é€™å€‹çš„ä¼ºæœå™¨ä¹Ÿå¯ä»¥æ˜¯åœ°ç«¯çš„ä¼ºæœå™¨ï¼Œä¹Ÿå¯ä»¥æ˜¯é›²ç«¯çš„ä¼ºæœå™¨ã€‚\næˆ‘å€‘ä»¥é›²ç«¯çš„ K8s ä¾†èˆ‰ä¾‹ï¼Œå¦‚æœ K8s é…ç½®éŒ¯èª¤ï¼Œæœƒæ˜¯è³‡æºä¸è¶³ï¼Œæˆ–æ˜¯ Pod çš„æ•¸é‡ä¸å¤ ï¼Œéƒ½æœƒå°è‡´ç¶²ç«™åœæ“ºã€‚\nç¶²ç«™ç¨‹å¼ç¢¼éŒ¯èª¤ é€™é‚Šçš„ç¨‹å¼ç¢¼ï¼Œå¤§å®¶å¯ä»¥æŠŠä»–ç†è§£æˆç¶²ç«™çš„ç¨‹å¼ç¢¼ï¼Œä¾‹å¦‚ï¼šPHPã€Pythonã€JavaScript ç­‰ç­‰ï¼Œæœ‰å¯èƒ½ç¨‹å¼ç¢¼å¯«äº†ä¸€å€‹ç„¡çª®è¿´åœˆï¼Œæˆ–æ˜¯ä»€éº¼ç‰¹æ®Šçš„ Bugï¼Œå°è‡´è³‡æºè¡é«˜ï¼Œä¹Ÿæœƒå°è‡´ç¶²ç«™åœæ“ºã€‚\nç¶²ç«™è³‡æ–™åº«æ•…éšœ è³‡æ–™åº«\nç¶²ç«™è¢«é§­å®¢æ”»æ“Š ç•¶ç„¶ç¶²ç«™æœƒä¾ç…§ä½¿ç”¨éœ€æ±‚ï¼Œé–‹æ”¾çµ¦ä¸åŒçš„ä½¿ç”¨è€…ï¼Œå¦‚æœæ˜¯ä¸€èˆ¬é–‹åœ¨å…¬ç¶²ä¸Šçš„ç¶²ç«™ï¼Œå°±æœ‰å¯èƒ½æœƒè¢«é§­å®¢æ”»æ“Šï¼Œä¾‹å¦‚ï¼šDDos æ”»æ“Šã€SQL Injection ç­‰ç­‰ï¼Œé€™äº›æ”»æ“Šéƒ½æœ‰å¯èƒ½å°è‡´ç¶²ç«™åœæ“ºï¼Œé‚„æœ‰å¯èƒ½å°è‡´è³‡æ–™å¤–æ´©ã€‚\néæ³•ç¶²ç«™å…§å®¹(? é€™é‚Šçš„éæ³•ç¶²ç«™å…§å®¹ï¼Œæ˜¯æŒ‡ç¶²ç«™å…§å®¹é•åäº†æ³•å¾‹è¦å®šï¼Œä¾‹å¦‚ï¼šè‰²æƒ…ã€è³­åšã€æ¯’å“ç­‰ç­‰ï¼Œé€™äº›å…§å®¹éƒ½æœ‰å¯èƒ½å°è‡´ç¶²ç«™è¢«å°é–ï¼Œæˆ–æ˜¯è¢«æª¢èˆ‰ï¼Œé€²è€Œå°è‡´ç¶²ç«™åœæ“ºã€‚\nç¶²ç«™è§£æè¢«æ“‹ åœ–ç‰‡ä¾†æº\nç¶²ç«™æ¢å¾©çš„æ–¹æ³• ä¼ºæœå™¨ä¾›æ‡‰å•†æ•…éšœ æˆ‘å€‘å·²é›²ç«¯çš„ GCP ä¾†èˆ‰ä¾‹ï¼Œå¦‚æœ GCP çš„æœå‹™æœ‰å•é¡Œï¼Œå¯ä»¥åˆ° Google Cloud Status Dashboard ä¾†æŸ¥çœ‹ç›®å‰æœå‹™çš„ç‹€æ³ã€‚\nç•¶ç„¶ï¼Œé›²ç«¯ä¾›æ‡‰å•†æ•…éšœå°æ–¼ä¸Šé¢å¹¾å€‹åŸå› ä¾†èªªï¼Œæ‡‰è©²æ˜¯æœ€å°‘çš„ï¼Œå› ç‚ºé›²ç«¯ä¾›æ‡‰å•†æœ‰å¾ˆå¤šçš„å‚™æ´æ©Ÿåˆ¶ï¼Œä½†å¦‚æœçœŸçš„ç™¼ç”Ÿäº†ï¼Œæˆ‘å€‘å¯ä»¥é€éä»¥ä¸‹å¹¾å€‹æ–¹æ³•ä¾†æ¢å¾©ç¶²ç«™ï¼š\nhttps://status.cloud.google.com/incidents/xVSEV3kVaJBmS7SZbnre\nç¶²ç«™ä¼ºæœå™¨æ•…éšœ ç¶²ç«™ç¨‹å¼ç¢¼éŒ¯èª¤ ç¶²ç«™è³‡æ–™åº«æ•…éšœ ç¶²ç«™è¢«é§­å®¢æ”»æ“Š éæ³•ç¶²ç«™å…§å®¹ é‚£é€™é‚Šçš„éæ³•ç¶²ç«™å…§å®¹ï¼Œç•¶ç„¶æ˜¯å¸Œæœ›å¤§å®¶ä¸è¦å»æ¶è¨­ç›¸é—œçš„ç¶²ç«™ (â—•Ü«â—•)ï¼Œæˆ‘å€‘é€™é‚Šè¨è«–çš„æ˜¯ï¼Œä¹Ÿä¸ä¸€å®šçœŸçš„æ˜¯æ¶è¨­éæ³•çš„ç¶²ç«™ï¼Œæ‰æœƒè¢«å°é–ï¼Œæˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹é€™å€‹æ–°èï¼šGoogle è¢«åˆ‘äº‹å±€èªå®šã€Œæ¶‰åŠè©é¨™ã€ç¶²å‚»çœ¼ï¼å°ç£å¤§æ›çœŸç›¸ ç•¶æ™‚æ˜¯ä½¿ç”¨å°ç£å¤§å“¥å¤§ç¶²è·¯æœå‹™å»ç€è¦½ Google ç›¸é—œæœå‹™å°±æœƒè¢«å°é–ï¼Œå¾Œä¾†èª¿æŸ¥ç™¼ç¾æ˜¯å› ç‚ºç•¶æ™‚å°ç£å¤§å“¥å¤§å…¬å¸é€²è¡Œè³‡å®‰ã€é˜²è©é¨™ç›¸é—œæ¸¬è©¦æ™‚é€£ç·šå‡ºç¾å•é¡Œã€‚\né€™é‚Šè·Ÿå¤§å®¶èªªä¸€ä¸‹ç‚ºç”šéº¼æœƒæœ‰é€™å€‹å•é¡Œï¼Œæ˜¯å› ç‚ºæ”¿åºœ(åˆ‘äº‹å±€)æœƒå»è·Ÿæ¯ä¸€é–“ ISP åˆä½œï¼Œç•¶æ”¿åºœç™¼ç¾æœ‰ç¶²ç«™æ˜¯éæ³•çš„ï¼Œæˆ–æ˜¯æœ‰è©é¨™çš„ç¶²ç«™ï¼Œæ”¿åºœæœƒè¦æ±‚ ISP å°é–é€™å€‹ç¶²ç«™ï¼Œé€™æ¨£å°±æœƒå°è‡´ä½¿ç”¨è€…ç„¡æ³•é€£ç·šåˆ°é€™å€‹ç¶²ç«™ã€‚\né€™é‚Šçš„å°é–æ˜¯åªä½ ä½¿ç”¨çš„ ISP å»ç€è¦½åˆ°è¢«èªç‚ºæ˜¯éæ³•çš„ç¶²ç«™æ™‚ï¼Œæœƒè¢«å¼·åˆ¶æŠŠé€™å€‹ç¶²å€çš„è§£ææ”¹åˆ°åˆ‘äº‹å±€çš„é é¢ã€‚\nç›®å‰çš„è§£æ±ºè¾¦æ³•å°±æ˜¯å¯«ä¿¡å»è·Ÿåˆ‘äº‹å±€åæ‡‰ï¼Œæˆ–æ˜¯å…ˆèª¿æ•´æ›´æ›ç¶²å€ä¾†è®“æœå‹™èƒ½å¤ æ­£å¸¸é‹ä½œã€‚","ç¶²ç«™ç¶­é‹æ—¥å¸¸#ç¶²ç«™ç¶­é‹æ—¥å¸¸":"","è¦èµ°è»Ÿé«”å·¥ç¨‹å¸«éœ€è¦å…·å‚™å“ªäº›æŠ€èƒ½#è¦èµ°è»Ÿé«”å·¥ç¨‹å¸«éœ€è¦å…·å‚™å“ªäº›æŠ€èƒ½ï¼Ÿ":"ä¸‹é¢æ˜¯æˆ‘æº–å‚™çš„å° bonusï¼Œæ˜¯å‡ºè‡ªæˆ‘è‡ªå·±çš„ç¶“é©—ï¼Œä»¥åŠæˆ‘å·å·è§€å¯Ÿæˆ‘åˆä½œçš„ RD å¤¥ä¼´å€‘ï¼Œå¾—å‡ºçš„å°å°å¿ƒå¾—ï¼Œç•¶ç„¶é€™åªæ˜¯æˆ‘è‡ªå·±çš„çœ‹æ³•ï¼Œä¸ä¸€å®šæ˜¯å°çš„ï¼Œå¸Œæœ›èƒ½å¤ å¹«åŠ©å¤§å®¶ã€‚\nç•¶ç„¶ï¼Œæƒ³æˆç‚ºä¸€å€‹è»Ÿé«”å·¥ç¨‹å¸«ï¼Œä½ ä¸€å®šè¦æœƒç¨‹å¼èªè¨€ï¼Œä¾‹å¦‚ PHPã€Pythonã€JavaScript ç­‰ç­‰ï¼Œå‡å¦‚ä½ å°æ–¼æœªä¾†çš„ç™¼å±•æ–¹å‘é‚„ä¸ç¢ºå®šï¼Œæˆ–æ˜¯ä¸çŸ¥é“å“ªå€‹ç¨‹å¼èªè¨€æ˜¯æœªä¾†çš„è¶¨å‹¢ï¼Œå¯ä»¥çœ‹çœ‹ stackoverflow æ¯å¹´çš„èª¿æŸ¥å ±å‘Šï¼Œä¾†äº†è§£ç›®å‰æœ€æµè¡Œçš„ç¨‹å¼èªè¨€æ˜¯å“ªäº›ï¼š https://survey.stackoverflow.co/2023/#most-popular-technologies-language\nä½†é™¤äº†é€™å€‹åŸºæœ¬çš„å¯« Code æŠ€èƒ½å¤–ï¼Œæˆ‘é‚„å»ºè­°èƒ½å¤ ææ—©å­¸ç¿’åˆ°ä»¥ä¸‹å¹¾é …æŠ€èƒ½ï¼Œæœƒå°ä½ æœªä¾†çš„ç™¼å±•æœ‰å¾ˆå¤§çš„å¹«åŠ©ï¼š\nGit ç‰ˆæœ¬æ§åˆ¶ Git å¯ä»¥èªªæ˜¯ç¾ä»£è»Ÿé«”å·¥ç¨‹å¸«å¿…å‚™çš„æŠ€èƒ½ä¹‹ä¸€ï¼Œå¯ä»¥å¹«åŠ©ä½ ç®¡ç†ç¨‹å¼ç¢¼çš„ç‰ˆæœ¬ï¼Œç•¶ä½ çš„ç¨‹å¼ç¢¼å‡ºç¾å•é¡Œæ™‚ï¼Œå¯ä»¥å¾ˆå¿«çš„å›å¾©åˆ°ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œä¹Ÿæ˜¯ä½ è·Ÿå…¶ä»–å·¥ç¨‹å¸«å”ä½œçš„æœ€å¥½å·¥å…·ã€‚\nå› ç‚ºç›®å‰ï¼Œä½ å¯èƒ½éƒ½æ˜¯è‡ªå·±ä¸€å€‹äººå¯« Codeï¼Œæ‰€ä»¥ä¸æœƒç¢°åˆ°åŒæ™‚é–“æœ‰å¤šå€‹äººåœ¨èª¿æ•´ç¨‹å¼æ™‚ï¼Œå°è‡´ç¨‹å¼ç¢¼è¡çªçš„å•é¡Œï¼Œç•¶ä½ æ²’æœ‰ä½¿ç”¨ Git æ™‚ï¼Œä½ æœƒä¸çŸ¥é“é€™æ˜¯èª°æ”¹çš„ï¼Œé€™å€‹æ˜¯ä»€éº¼æ™‚å€™æ”¹çš„ï¼Œé€™å€‹æ”¹å‹•æ˜¯ç‚ºäº†ä»€éº¼ï¼Œé€™æ¨£æœƒè®“ä½ çš„ç¨‹å¼ç¢¼è®Šå¾—éå¸¸é›œäº‚ï¼Œä¹Ÿæœƒè®“ä½ çš„ç¨‹å¼ç¢¼è®Šå¾—éå¸¸é›£ä»¥ç¶­è­·ã€‚\nå¯« Blog åŸ¹é¤Šå¯« Blog çš„ç¿’æ…£ï¼Œå¯ä»¥å¹«åŠ©ä½ æ•´ç†è‡ªå·±çš„çŸ¥è­˜ï¼Œä¹Ÿå¯ä»¥å¹«åŠ©ä½ è¨˜éŒ„è‡ªå·±çš„å­¸ç¿’éç¨‹ï¼Œåƒæˆ‘ç•¶åˆæœƒå¯« Blog é‚„æœ‰ä¸€å€‹åŸå› ï¼Œæ˜¯å› ç‚ºæˆ‘è¨˜æ†¶ä¸å¥½ï¼Œå¦‚æœæˆ‘ä¸å¯«ä¸‹ä¾†ï¼Œå°±æœƒå¸¸å¸¸å¿˜è¨˜ä¸€æ¨£çš„å•é¡Œ (à¹‘â€¢Ì â‚ƒ â€¢Ì€à¹‘)ã€‚\nç•¶ç„¶åœ¨æ‰¾å·¥ä½œé¢è©¦æ™‚ï¼Œå®ƒä¹Ÿå¯ä»¥ç•¶ä½œè‡ªå·±çš„ä½œå“é›†ï¼Œè®“é¢è©¦å®˜èƒ½å¤ äº†è§£ä½ ã€ä¸¦çŸ¥é“ä½ çš„å­¸ç¿’èƒ½åŠ›ã€‚\næºé€šèƒ½åŠ› åœ¨è·å ´ä¸Šï¼Œæºé€šèƒ½åŠ›æ˜¯éå¸¸é‡è¦çš„ä¸€ç’°ï¼Œå› ç‚ºä½ ä¸å¯èƒ½ä¸€å€‹äººåœ¨å…¬å¸è£¡é¢å·¥ä½œï¼Œä½ ä¸€å®šæœƒè·Ÿå…¶ä»–äººåˆä½œï¼Œæ‰€ä»¥ä½ è¦å­¸æœƒå¦‚ä½•è·Ÿå…¶ä»–äººæºé€šï¼Œå¦‚ä½•è¡¨é”è‡ªå·±çš„æƒ³æ³•ï¼Œå¦‚ä½•è†è½åˆ¥äººçš„æ„è¦‹ï¼Œé€™äº›éƒ½æ˜¯éå¸¸é‡è¦çš„æŠ€èƒ½ã€‚\næ¯å€‹è¡Œæ¥­éƒ½æ˜¯ï¼Œä½†æˆ‘èªç‚ºè»Ÿé«”å·¥ç¨‹å¸«æ›´éœ€è¦é€™å€‹æŠ€èƒ½ï¼Œå› ç‚ºè»Ÿé«”å·¥ç¨‹å¸«çš„å·¥ä½œæ˜¯éå¸¸è¤‡é›œçš„ï¼Œä½ éœ€è¦è·Ÿ PMã€RDã€QAã€UI/UXã€SRE ç­‰ç­‰ä¸åŒçš„éƒ¨é–€åˆä½œï¼Œæ‰€ä»¥ä½ è¦å­¸æœƒå¦‚ä½•è·Ÿä¸åŒçš„äººåˆä½œï¼Œé€™æ¨£æ‰èƒ½å¤ è®“ä½ çš„å·¥ä½œæ›´é †åˆ©ã€‚","è¬›åº§è³‡è¨Š#è¬›åº§è³‡è¨Š":" æ™‚é–“ï¼š2024/05/29 19:00 - 21:00 åœ°é»ï¼šæœé™½ç§‘æŠ€å¤§å­¸ \u0026 Google Meet ç·šä¸Šé€£çµ Google Developer Student Clubs ç›¸é—œé€£çµï¼šhttps://gdsc.community.dev/events/details/developer-student-clubs-chaoyang-university-of-technology-taichung-taiwan-presents-wang-zhan-fang-hu-yu-devopsji-shu-jiang-zuo-ft-zhuang-pin-yi-gong-cheng-shi/ ","é›²ç«¯å’Œåœ°ç«¯çš„å·®åˆ¥#é›²ç«¯å’Œåœ°ç«¯çš„å·®åˆ¥":"é¦–å…ˆï¼Œæƒ³å•ä¸€ä¸‹å¤§å®¶ï¼Œä½ å€‘çŸ¥é“é›²ç«¯å’Œåœ°ç«¯çš„å·®åˆ¥å—ï¼Ÿ\nåœ°ç«¯ æˆ‘å€‘å…ˆä¾†èª¬èª¬ã€Œåœ°ç«¯ã€æ˜¯ä»€éº¼ï¼Ÿåœ°ç«¯çš„è‹±æ–‡æ˜¯ On-Premisesï¼Œç°¡ç¨± On-Premï¼Œä»£è¡¨æ‰€æœ‰å®‰è£ã€é‹è¡Œéƒ½åœ¨å€‹äººé›»è…¦æˆ–å…¬å¸è‡ªå·±å…§éƒ¨çš„ä¼ºæœå™¨ä¸Šæ‰€åŸ·è¡Œçš„é‹è¡Œæ–¹å¼ã€‚\næœ€å¥½çš„ä¾‹å­å°±æ˜¯ä½ é›»è…¦è£¡é¢è£çš„ Windows ä½œæ¥­ç³»çµ±ã€Office æ–‡æ›¸è»Ÿé«”ã€æˆ–æ˜¯å…¬å¸å…§éƒ¨çš„ ERP ç³»çµ±ç­‰ç­‰ã€‚é€™äº›è»Ÿé«”éƒ½æ˜¯å®‰è£åœ¨ä½ çš„é›»è…¦æˆ–å…¬å¸ä¼ºæœå™¨ä¸Šï¼Œä¸¦ä¸”ç”±ä½ è‡ªå·±æˆ–å…¬å¸çš„ IT åœ˜éšŠè² è²¬ç®¡ç†ï¼Œæ‰€ä»¥é€™ä¹Ÿæ˜¯ç›®å‰æœ€æ™®éçš„ã„§ç¨®è»Ÿé«”é‹è¡Œæ–¹å¼ã€‚\nåœ°ç«¯çš„å„ªé»æ˜¯ä»€éº¼ï¼Ÿ æ§åˆ¶æ¬Šï¼šä½ å¯ä»¥å®Œå…¨æ§åˆ¶ä½ çš„ä¼ºæœå™¨å’Œè»Ÿé«”ï¼Œä¸ç”¨æ“”å¿ƒç¬¬ä¸‰æ–¹æœå‹™å•†çš„æœå‹™å“è³ªï¼Œæƒ³æŠŠæ©Ÿå™¨æ“ºåœ¨å“ªè£¡å°±æ”¾å“ªè£¡ã€ç”¨ä»€éº¼å‹è™Ÿéƒ½å¯ä»¥è‡ªå·±æ±ºå®šã€‚ å®‰å…¨æ€§ï¼šä¼æ¥­æˆ–æ˜¯å€‹äººå¯ä»¥è‡ªè¡Œæ§åˆ¶è³‡æ–™çš„å­˜å–æ¬Šé™ï¼Œä¸ç”¨æ“”å¿ƒç¬¬ä¸‰æ–¹æœå‹™å•†çš„è³‡æ–™å¤–æ´©å•é¡Œã€‚ æˆæœ¬ï¼šä¸€æ¬¡æ€§è³¼è²·ä¼ºæœå™¨å’Œè»Ÿé«”ï¼Œä¸éœ€è¦æ¯å€‹æœˆæ”¯ä»˜é›²ç«¯æœå‹™è²»ç”¨ã€‚ åœ°ç«¯çš„ç¼ºé»æ˜¯ä»€éº¼ï¼Ÿ æˆæœ¬ï¼šä¸€æ¬¡æ€§è³¼è²·ä¼ºæœå™¨å’Œè»Ÿé«”ï¼Œéœ€è¦èŠ±è²»å¤§é‡çš„è³‡é‡‘ï¼Œä¸”ä¸ç¢ºå®šæ˜¯å¦ç¬¦åˆéœ€æ±‚ä½¿ç”¨ã€‚ ç¶­è­·ï¼šéœ€è¦è‡ªè¡Œç®¡ç†ä¼ºæœå™¨å’Œè»Ÿé«”ï¼ŒåŒ…æ‹¬ç¡¬é«”ç¶­è­·ã€è»Ÿé«”æ›´æ–°ã€è³‡æ–™å‚™ä»½ç­‰ç­‰ã€‚ æ“´å……æ€§ï¼šç•¶ä½¿ç”¨è€…æˆ–æ˜¯éœ€æ±‚å¢åŠ æ™‚ï¼Œéœ€è¦è‡ªè¡Œæ“´å……ä¼ºæœå™¨å’Œè»Ÿé«”ï¼Œä¸”éœ€è¦èŠ±è²»å¤§é‡çš„æ™‚é–“å’Œé‡‘éŒ¢ã€‚ é‚£ç›¸ä¿¡å¤§å®¶å·²ç¶“å¤§è‡´äº†è§£åœ°ç«¯çš„å®šç¾©äº†ï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘ä¾†çœ‹çœ‹ã€Œé›²ç«¯ã€æ˜¯ä»€éº¼ï¼Ÿ\né›²ç«¯ ã€Œé›²ç«¯ã€çš„è‹±æ–‡æ˜¯ Cloudï¼Œä¸éœ€è¦å®‰è£åœ¨å€‹äººé›»è…¦æˆ–å…¬å¸ä¼ºæœå™¨ä¸Šï¼Œè€Œæ˜¯é€éç¶²éš›ç¶²è·¯å­˜å–çš„ä¼ºæœå™¨ï¼Œä»¥åŠåœ¨é€™äº›ä¼ºæœå™¨ä¸ŠåŸ·è¡Œçš„è»Ÿé«”æˆ–æ˜¯è³‡æ–™åº«ã€‚å¸¸è¦‹çš„ä¾‹å­æœ‰ Google é›²ç«¯ç¡¬ç¢Ÿã€Dropboxã€æˆ–æ˜¯ Google Cloudã€AWSã€Azure ç­‰é›²ç«¯æœå‹™å•†ã€‚\nå¦‚ä½•ä½¿ç”¨é›²ç«¯ åœ–ç‰‡ä¾†æº\né›²ç«¯å¾—ä»¥å¯¦ç¾ï¼Œæ˜¯å› ç‚ºä¸€ç¨®ç¨±ç‚ºè™›æ“¬åŒ–çš„æŠ€è¡“ã€‚è™›æ“¬åŒ–å…è¨±åœ¨ä¸€å°å¯¦é«”çš„é›»è…¦ä¸Šå»ºç«‹è¨±å¤šæ¨¡æ“¬ã€Œè™›æ“¬ã€é›»è…¦ï¼Œå…¶è¡Œç‚ºå¦‚åŒå…·æœ‰è‡ªå·±ç¡¬é«”çš„å¯¦é«”é›»è…¦ï¼Œé€™é¡é›»è…¦çš„è¡“èªç¨±ç‚ºè™›æ“¬æ©Ÿå™¨ã€‚è™›æ“¬ä¸»æ©Ÿç°¡å–®ä»‹ç´¹åˆ°é€™é‚Šï¼Œå¾Œé¢çš„ Docker ä»‹ç´¹ æœƒåœ¨æåˆ°ã€‚\nä¸€å€‹è³‡æ–™ä¸­å¿ƒæœ‰å¤šå°çš„ä¼ºæœå™¨ï¼Œä¸€å€‹ä¼ºæœå™¨å¯ä»¥åŸ·è¡Œè¨±å¤šè™›æ“¬ã€Œä¼ºæœå™¨ã€ï¼Œèƒ½å¤ ç‚ºè¨±å¤šçµ„ç¹”æˆ–æ˜¯å®¢æˆ¶æä¾›ä¸åŒçš„æœå‹™ï¼Œå³ä½¿å€‹åˆ¥ä¼ºæœå™¨æ•…éšœï¼Œé›²ç«¯ä¾›æ‡‰å•†æœƒåœ¨å¤šå€‹æ©Ÿå™¨åŠå¤šå€‹å€åŸŸå‚™ä»½æœå‹™ã€‚Google Data Center å½±ç‰‡é€£çµ\nGoogle Data Center åœ–ç‰‡ä¾†æº\né›²ç«¯åˆå¯ä»¥åˆ†ç‚ºä»¥ä¸‹å¹¾ç¨®ï¼š\nå…¬æœ‰é›²ï¼ˆPublic Cloudï¼‰ æ•…åæ€ç¾©ï¼Œå…¬æœ‰é›²ç”±ç¬¬ä¸‰æ–¹é›²ç«¯æœå‹™å•†æä¾›ï¼Œå¦‚ Google Cloudã€AWSã€Azure ç­‰ã€‚é€™äº›æœå‹™å•†æä¾›çš„å¹³å°å…è¨±ç”¨æˆ¶ç§Ÿç”¨ä¼ºæœå™¨ã€è³‡æ–™åº«ã€å„²å­˜ç©ºé–“ç­‰è³‡æºï¼Œç”¨æˆ¶åªéœ€ä¸€çµ„å¸³è™Ÿå’Œå¯†ç¢¼å³å¯è¨ªå•ã€‚å…¬æœ‰é›²çš„ç‰¹é»åŒ…æ‹¬ï¼š\nå½ˆæ€§å’Œå¯æ“´å±•æ€§ï¼šç”¨æˆ¶å¯ä»¥æ ¹æ“šéœ€æ±‚å‹•æ…‹èª¿æ•´è³‡æºçš„è¦æ¨¡ã€‚ æˆæœ¬æ•ˆç›Šï¼šæŒ‰éœ€ä»˜è²»æ¨¡å¼ï¼Œä¼æ¥­å¯ä»¥æ ¹æ“šå¯¦éš›ä½¿ç”¨æƒ…æ³æ”¯ä»˜è²»ç”¨ã€‚Google Cloud Pricing Calculator å…¨çƒè¦†è“‹ï¼šå¯é¸æ“‡éƒ¨ç½²çš„åœ°å€ç¯„åœå»£æ³›ã€‚Goolge Cloud Service Health é™¤äº†å½ˆæ€§å’Œæˆæœ¬æ•ˆç›Šï¼Œæœ€é‡è¦çš„é‚„æœ‰å…¨çƒéƒ¨ç½²å’Œæœå‹™å•†ç®¡ç†å®‰å…¨å’Œç¶­è­·åŠ SLA çš„å„ªå‹¢ã€‚Google Cloud Platform Service Level Agreements\nTop 10 Cloud Service Providers Globally in 2024 åœ–ç‰‡ä¾†æº\nç§æœ‰é›²ï¼ˆPrivate Cloudï¼‰ ç§æœ‰é›²æ˜¯ç”±ä¼æ¥­è‡ªå»ºæˆ–ç”±ç¬¬ä¸‰æ–¹ä¾›æ‡‰å•†ç‚ºç‰¹å®šä¼æ¥­æä¾›çš„é›²ç«¯åŸºç¤è¨­æ–½ï¼Œåƒ…ä¾›ä¼æ¥­å…§éƒ¨ä½¿ç”¨ã€‚å…¶ç‰¹é»åŒ…æ‹¬ï¼š\nå°ˆå±¬ä½¿ç”¨ï¼šä¼æ¥­ç¨äº«å…¨éƒ¨è³‡æºï¼Œä¸èˆ‡å…¶ä»–ç”¨æˆ¶å…±äº«ã€‚Spot VM é«˜å¯æ§å’Œå®‰å…¨æ€§ï¼šä¼æ¥­å¯ä»¥è‡ªè¡Œç®¡ç†å’Œæ§åˆ¶æ•¸æ“šï¼Œç¢ºä¿æ•¸æ“šå®‰å…¨æ€§å’Œåˆè¦æ€§ã€‚ é«˜æˆæœ¬ï¼šéœ€è¦è‡ªè¡Œè³¼è²·å’Œç¶­è­·ç¡¬é«”å’ŒåŸºç¤è¨­æ–½ï¼ŒåˆæœŸæŠ•è³‡å’Œé‹ç‡Ÿæˆæœ¬è¼ƒé«˜ã€‚ What Is Private Cloud? åœ–ç‰‡ä¾†æº\nè½å®Œå…¬æœ‰é›²å’Œç§æœ‰é›²çš„ä»‹ç´¹ï¼Œæœ‰æ²’æœ‰å¯ä»¥çµåˆå…©ç¨®é›²ç«¯çš„å„ªé»ï¼Œä¾†é”åˆ°æ›´å¥½çš„æ•ˆæœå‘¢ï¼Ÿ\næ··åˆé›²ï¼ˆHybrid Cloudï¼‰ æ··åˆé›²æ˜¯ä¸€ç¨®çµåˆäº†å…¬æœ‰é›²å’Œç§æœ‰é›²å„ªå‹¢çš„é›²ç«¯æ¶æ§‹ï¼Œå…è¨±ä¼æ¥­åœ¨å…¬æœ‰é›²å’Œç§æœ‰é›²ä¹‹é–“éˆæ´»åœ°é…ç½®å’Œç®¡ç†è³‡æºã€‚é€™æ„å‘³è‘—ä¼æ¥­å¯ä»¥å°‡ä¸€äº›å·¥ä½œè² è¼‰å’Œæ‡‰ç”¨ç¨‹å¼éƒ¨ç½²åœ¨å…¬æœ‰é›²ä¸Šï¼Œä»¥åˆ©ç”¨å…¶å½ˆæ€§å’Œæˆæœ¬æ•ˆç›Šï¼ŒåŒæ™‚å°‡æ•æ„Ÿè³‡æ–™å’Œé—œéµæ¥­å‹™æ‡‰ç”¨éƒ¨ç½²åœ¨ç§æœ‰é›²æˆ–å…§éƒ¨è³‡æ–™ä¸­å¿ƒï¼Œä»¥ç¢ºä¿å®‰å…¨æ€§å’Œæ§åˆ¶ã€‚\nå½ˆæ€§å’Œå¯æ“´å±•æ€§ï¼šä¼æ¥­å¯ä»¥æ ¹æ“šéœ€æ±‚å‹•æ…‹èª¿æ•´å…¬æœ‰é›²å’Œç§æœ‰é›²çš„ä½¿ç”¨æ¯”ä¾‹ã€‚ä¾‹å¦‚ï¼Œç•¶å·¥ä½œè² è¼‰å¢åŠ æ™‚ï¼Œå¯ä»¥æš«æ™‚ä½¿ç”¨å…¬æœ‰é›²è³‡æºä¾†æ“´å±•é‹ç®—èƒ½åŠ›ï¼Œè€Œä¸å¿…ç«‹å³æ“´å±•å…§éƒ¨åŸºç¤è¨­æ–½ã€‚\næˆæœ¬æ•ˆç›Šï¼šé€šéåˆ©ç”¨å…¬æœ‰é›²çš„æŒ‰éœ€ä»˜è²»æ¨¡å¼ï¼Œä¼æ¥­å¯ä»¥é™ä½é‹ç‡Ÿæˆæœ¬ï¼Œé¿å…åœ¨ç§æœ‰é›²ä¸Šéåº¦æŠ•è³‡ã€‚è€Œç§æœ‰é›²å‰‡å¯ä»¥ç”¨ä¾†é‹è¡Œç©©å®šä¸”æŒä¹…çš„å·¥ä½œè² è¼‰ã€‚\nå®‰å…¨æ€§å’Œåˆè¦æ€§ï¼šæ•æ„Ÿæ•¸æ“šå’Œæ‡‰ç”¨å¯ä»¥ä¿å­˜åœ¨ç§æœ‰é›²æˆ–å…§éƒ¨è³‡æ–™ä¸­å¿ƒï¼Œä»¥æ»¿è¶³ä¼æ¥­çš„å®‰å…¨å’Œåˆè¦è¦æ±‚ã€‚åŒæ™‚ï¼Œéæ•æ„Ÿçš„å·¥ä½œè² è¼‰å¯ä»¥éƒ¨ç½²åœ¨å…¬æœ‰é›²ä¸Šï¼Œä»¥åˆ©ç”¨å…¶ä¾¿åˆ©æ€§å’Œæˆæœ¬å„ªå‹¢ã€‚\né«˜å¯ç”¨æ€§å’Œç½é›£æ¢å¾©ï¼šæ··åˆé›²æ¶æ§‹å…è¨±ä¼æ¥­åœ¨å…¬æœ‰é›²å’Œç§æœ‰é›²ä¹‹é–“è¨­ç½®å†—é¤˜å’Œå‚™ä»½æ–¹æ¡ˆï¼Œå¢å¼·ç³»çµ±çš„é«˜å¯ç”¨æ€§å’Œç½é›£æ¢å¾©èƒ½åŠ›ã€‚\næ‰€ä»¥æ··åˆé›²ä¹Ÿæ˜¯ç›®å‰æœ€å¤šä¼æ¥­æ¡ç”¨çš„é›²ç«¯æ¶æ§‹ï¼Œå¯ä»¥å…¼é¡§å…¬æœ‰é›²å’Œç§æœ‰é›²çš„å„ªå‹¢ï¼Œä¸¦æ ¹æ“šå¯¦éš›éœ€æ±‚éˆæ´»èª¿æ•´è³‡æºçš„ä½¿ç”¨ã€‚\né›²ç«¯é‚„æ˜¯åœ°ç«¯å¥½ï¼Œè¦å¦‚ä½•é¸æ“‡ï¼Ÿ æ²’æœ‰ä¸€å€‹æ˜ç¢ºçš„ç­”æ¡ˆï¼Œè¦çœ‹ä½ çš„éœ€æ±‚å’Œé ç®—ï¼Œä»¥åŠå…¬å¸çš„è¦æ¨¡å’Œç™¼å±•æ–¹å‘ã€‚\nå‡è¨­ä½ æ˜¯ä¸€å€‹å°å‹å…¬å¸ï¼Œå¯èƒ½æ²’æœ‰å¤ªå¤šè³‡é‡‘å»è³¼è²·ä¼ºæœå™¨å’Œè»Ÿé«”ï¼Œä¹Ÿæ²’æœ‰å¤ªå¤šäººåŠ›å»ç®¡ç†ã€æˆ–æ˜¯è€…ä½ çš„å…¬å¸æ¥­å‹™æ˜¯è·¨åœ‹çš„ï¼Œéœ€è¦åœ¨å…¨çƒæä¾›æœå‹™ä»¥åŠéœ€æ±‚é«˜å¯ç”¨æ€§ï¼Œæˆ–æ˜¯é•·æ™‚é–“æœ‰å¤§é‡çš„æµé‡ï¼Œä¾‹å¦‚ï¼šéŠæˆ²å…¬å¸ï¼Œé‚£éº¼é›²ç«¯å°±æ˜¯ä¸€å€‹ä¸éŒ¯çš„é¸æ“‡ã€‚\nå¦‚æœå…¬å¸è³‡æ–™æ•æ„Ÿæ€§é«˜ï¼Œéœ€è¦è‡ªè¡Œæ§åˆ¶è³‡æ–™å­˜å–æ¬Šé™ï¼Œæˆ–æ˜¯å…¬å¸æœ‰è‡ªå·±çš„ IT åœ˜éšŠï¼Œæœ‰èƒ½åŠ›ç®¡ç†ä¼ºæœå™¨å’Œè»Ÿé«”ï¼Œé‚£éº¼åœ°ç«¯å°±æ˜¯ä¸€å€‹ä¸éŒ¯çš„é¸æ“‡ã€‚\næˆ‘å€‘äº†è§£äº†é›²ç«¯å’Œåœ°ç«¯çš„å·®åˆ¥ï¼Œæ¥ä¸‹ä¾†äº†è§£ä¸€ä¸‹æœ‰ä»€éº¼æŠ€è¡“å¯ä»¥å¹«åŠ©æˆ‘å€‘æ›´å¥½çš„éƒ¨ç½²æˆ‘å€‘çš„æœå‹™å‘¢ï¼Ÿ"},"title":"æœé™½ç§‘æŠ€å¤§å­¸ - å®‰å…¨å‰ç»ï¼šç¶²ç«™é˜²è­·èˆ‡ DevOps æŠ€è¡“è¬›åº§ (2024/05/29)"},"/blog/nginx/":{"data":{"":"æ­¤åˆ†é¡åŒ…å« Nginx ç›¸é—œçš„æ–‡ç« ã€‚\næƒ³ä½¿ç”¨ Nginx Upstream Proxy åˆ°å¤–éƒ¨æœå‹™ï¼Œä¸¦å¸¶å…¥å°æ‡‰çš„ header è©²æ€éº¼åšï¼Ÿ Soketi WebSocket Server LOG ä¸å®šæ™‚å‡ºç¾ 502 error ä»¥åŠ connect() failed (111: Connection refused) "},"title":"Nginx"},"/blog/nginx/nginx-upstream-set-host-header/":{"data":{"":"æ­¤æ–‡ç« è¦ä¾†è¨˜éŒ„ä¸€ä¸‹æœ€è¿‘åœ¨å…¬å¸æœå‹™å…¥å£é‡åˆ°çš„ä¸€äº›å°å•é¡Œï¼Œä»¥åŠè§£æ±ºçš„æ–¹æ³•ã€‚ç°¡å–®èªªæ˜ä¸€ä¸‹ï¼Œæˆ‘å€‘çš„æœå‹™å…¥å£æ˜¯ç”¨ Nginx ä¾†ç•¶ä½œ proxy serverï¼Œå°‡ä¸åŒè·¯å¾‘æˆ–æ˜¯ servername å°åˆ°å°æ‡‰çš„å¾Œç«¯ç¨‹å¼ï¼Œæˆ–æ˜¯å¤–éƒ¨çš„æœå‹™ä¸Š(ä¾‹å¦‚ AWS cloudfront.net)ï¼Œæœ¬ç¯‡è¦æ¸¬è©¦çš„æ˜¯å¦‚æœä½¿ç”¨è¦åŒæ™‚ä½¿ç”¨ upstream åˆ°å¤–éƒ¨æœå‹™ï¼Œä¸”éœ€è¦å¸¶ host header è©²æ€éº¼åšã€‚\nNginx çš„ upstream æ˜¯ä»€éº¼ï¼Ÿ\né€šå¸¸æˆ‘å€‘ proxy_pass çš„å¯«æ³•æœƒæ˜¯é€™æ¨£ï¼š\nlocation /aaa { proxy_pass http://aaa.example.com; } ç•¶ Nginx æ”¶åˆ°çš„ request æ˜¯ /aaa æ™‚ï¼Œå°±æœƒå°‡ request è½‰ç™¼åˆ° http://aaa.example.comã€‚\nä½†å‡å¦‚å¾Œç«¯æœ‰å¤šå°æ©Ÿå™¨æˆ–æ˜¯æœå‹™ï¼Œå¯ä»¥è™•ç†åŒä¸€ç¨® requestï¼Œé€™æ™‚å€™å°±å¯ä»¥ä½¿ç”¨ upstream ä¾†è™•ç†ï¼š\nupstream backend_hosts { server aaa.example.com; server bbb.example.com; server ccc.example.com; } location /aaa { proxy_pass http://backend_hosts; } é€™æ¨£å­çš„å¥½è™•æ˜¯å¯ä»¥æœ‰å¤šå€‹æ©Ÿå™¨æˆ–æ˜¯å¾Œç«¯æœå‹™å¯ä»¥åˆ†æ•£è«‹æ±‚ï¼Œåšåˆ°è² è¼‰å¹³è¡¡çš„æ•ˆæœã€‚","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"Make nginx to pass hostname of the upstream when reverseproxyingï¼šhttps://serverfault.com/questions/598202/make-nginx-to-pass-hostname-of-the-upstream-when-reverseproxying","å•é¡Œ#å•é¡Œ":"é‚£å¦‚æœæˆ‘å€‘ä½¿ç”¨ Nginx upstream æ™‚ï¼Œé‚„æƒ³è¦åŒæ™‚å¸¶ host çš„ header åˆ°å¾Œç«¯è©²æ€éº¼åšå‘¢ï¼Ÿæˆ‘å€‘å…ˆä¾†çœ‹ä¸€ä¸‹ç›®å‰çš„å¯«æ³•ï¼š\n( æ¸¬è©¦ç¯„ä¾‹æ˜¯ä½¿ç”¨ docker ä¾†æ¨¡æ“¬ï¼Œå¯ä»¥åƒè€ƒç¨‹å¼ç¢¼ \u003e é»æˆ‘å‰å¾€ githubï¼Œæœƒæœ‰ä¸‰å€‹ nginxï¼Œå…¶ä¸­ä¸€å€‹æ˜¯è² è²¬ proxy çš„ nginx åç‚º proxyï¼Œå¦å¤–å…©å°æ˜¯ upstream å¾Œçš„æœå‹™ï¼Œåç‚º upstream_server1ã€upstream_server2 )\nnginx-old.conf upstream upstream_server { server upstream_server1; server upstream_server2; } server { listen 80; server_name localhost; location /upstream_server/ { proxy_pass http://upstream_server; proxy_set_header Host \"upstream_server1\"; proxy_set_header Host \"upstream_server2\"; access_log /var/log/nginx/access.log upstream_log; } } } å¯ä»¥çœ‹åˆ°æˆ‘å€‘å¸Œæœ› Nginx æ”¶åˆ° request æ˜¯ /upstream_server æ™‚ï¼Œå°‡ request è½‰ç™¼åˆ° http://upstream_serverï¼Œè€Œ upstream_server å¾Œé¢æœ‰å…©å€‹ serverï¼Œä¸¦ä¸”åœ¨ proxy æ™‚ï¼Œå¸¶å…¥å…©å€‹ä¸åŒçš„ host headerã€‚ä½†å¦‚æœçœŸçš„é€™æ¨£å¯«ï¼Œå¯ä»¥é”åˆ°æˆ‘å€‘æƒ³è¦å¾—æ•ˆæœå—ï¼Ÿæˆ‘å€‘å¯¦éš›è·‘çœ‹çœ‹ç¨‹å¼ (ç¯„ä¾‹å¯ä»¥ä½¿ç”¨ nginx-old.conf)ï¼š\nnginx åŸæœ¬å¯«æ³•\nå¾ä¸Šé¢çš„ LOG å¯ä»¥ç™¼ç¾ï¼Œæˆ‘å€‘ call /upstream_server æ™‚ï¼Œå¾Œç«¯çš„ upstream_server1ã€upstream_server2 æ”¶åˆ°çš„ host åªæœƒæ”¶åˆ°ç¬¬ä¸€å€‹è¨­å®šçš„ Hostï¼Œä¸”æœå‹™æœƒå‡ºç¾ 400 Bad Requestï¼ŒæŸ¥äº†ä¸€ä¸‹ç¶²è·¯æ–‡ç« ï¼Œç™¼ç¾å‡ºç¾ 400 Bad Requestï¼Œå¯èƒ½è·Ÿ header é€å¤ªå¤šè³‡è¨Šéå»ï¼Œè©³ç´°å¯ä»¥åƒè€ƒ è§£æ±ºç¶²ç«™å‡ºç¾ 400 Bad Request ç‹€æ…‹çš„æ–¹æ³•ã€‚\né€™é‚Šæ¨æ¸¬æ‡‰è©²æ˜¯å¾Œç«¯å¦‚æœä¹Ÿæ˜¯ç”¨ nginx ç›´æ¥æ¥æ”¶æ‰æœƒé‡åˆ° 400 çš„å•é¡Œï¼Œé‚„å¥½ç›®å‰å…¬å¸æœå‹™é‚„æ˜¯æ­£å¸¸çš„ xDDï¼Œæª¢æŸ¥ä¸€ä¸‹å¾Œç™¼ç¾ï¼Œå…¶å¯¦å¾Œç«¯æ ¹æœ¬æ²’æœ‰è¦æ±‚å°æ‡‰ header æ‰èƒ½æ¥æ”¶(æ‡‰è©²æ˜¯å°æ–¹å¿˜è¨˜åŠ ä¸Šæ­¤é™åˆ¶)ã€‚","è§£æ±º#è§£æ±º":"å¥½ï¼Œä¸ç®¡æ˜¯å¦éœ€è¦å°æ‡‰ headerï¼Œæˆ‘å€‘é‚„æ˜¯æ‰¾çœ‹çœ‹æœ‰æ²’æœ‰è¾¦æ³•åŒæ™‚ä½¿ç”¨ upstreamï¼Œä¸¦å¸¶å…¥å°æ‡‰ host çš„æ–¹æ³•å‘¢ï¼Ÿ\næœ€å¾Œåƒè€ƒç¶²è·¯ä¸Šçš„æ–‡ç« ï¼Œä¼¼ä¹åªèƒ½ä½¿ç”¨å…©å±¤çš„ proxyï¼Œæ‰èƒ½å®Œæˆé€™å…©å€‹éœ€æ±‚ï¼Œæˆ‘å€‘ä¾†çœ‹çœ‹è¦æ€éº¼å¯«å§ (ç¯„ä¾‹å¯ä»¥ä½¿ç”¨ nginx.conf)ï¼š\nnginx.conf server { listen 777; server_name localhost; location / { proxy_pass http://upstream_server1; proxy_set_header Host \"upstream_server1\"; access_log /var/log/nginx/access.log upstream_log; } } server { listen 888; server_name localhost; location / { proxy_pass http://upstream_server2; proxy_set_header Host \"upstream_server2\"; access_log /var/log/nginx/access.log upstream_log; } } upstream upstream_server { server 127.0.0.1:777; server 127.0.0.1:888; } server { listen 80; server_name localhost; location /upstream_server/ { proxy_pass http://upstream_server; access_log /var/log/nginx/access.log upstream_log; } } å¯ä»¥çœ‹åˆ°ä¸Šé¢çš„ç¨‹å¼ç¢¼ï¼Œæˆ‘å€‘é€éå…©å±¤çš„ proxyï¼Œä¾†é”åˆ°æˆ‘å€‘æƒ³è¦çš„æ•ˆæœï¼Œé€™æ¨£å­å°±å¯ä»¥åŒæ™‚ä½¿ç”¨ upstreamï¼Œä¸¦ä¸”å¸¶å…¥å°æ‡‰çš„ host headerã€‚\né¦–å…ˆåœ¨ 28 ~ 36 è¡Œï¼Œæˆ‘å€‘ä¸€æ¨£å¦‚æœ Nginx æ”¶åˆ° request æ˜¯ /upstream_server æ™‚ï¼Œæœƒ proxy åˆ° upstream_server é€™å€‹ upstream ä¸­ï¼Œè€Œ upstream_server æœ‰å…©å€‹ serverï¼Œåˆ†åˆ¥æ˜¯ 127.0.0.1:777ã€127.0.0.1:888ï¼Œä½†å¯¦éš›ä¸Šæ²’æœ‰é€™å…©å€‹ portï¼Œæ‰€ä»¥æˆ‘å€‘éœ€è¦å†å¯«ä¸€å±¤ä¸€èˆ¬çš„ proxy è¨­å®šï¼Œåˆ†åˆ¥æ˜¯ 1 ~ 10 è¡Œã€12 ~ 21 è¡Œï¼Œé€™æ¨£å­å°±å¯ä»¥é”åˆ°æˆ‘å€‘æƒ³è¦çš„æ•ˆæœã€‚\nä½†é€™å€‹æ–¹æ³•æ¯”è¼ƒé©ç”¨æ–¼ upstream å¾Œç«¯æ²’æœ‰å¤ªå¤šå€‹æœå‹™æˆ–æ˜¯æ©Ÿå™¨çš„æƒ…æ³ï¼Œå¦‚æœæœ‰å¾ˆå¤šå€‹æœå‹™æˆ–æ˜¯æ©Ÿå™¨ï¼Œå°±éœ€è¦å¯«å¾ˆå¤šçš„ proxyï¼Œé€™æ¨£å­æœƒè®Šå¾—å¾ˆéº»ç…©ï¼Œæ‰€ä»¥å¦‚æœæœ‰æ›´å¥½çš„æ–¹æ³•ï¼Œä¹Ÿæ­¡è¿ç•™è¨€è·Ÿæˆ‘åˆ†äº« ğŸ¤£ã€‚\næœ€å¾Œæˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹å¯¦éš›åŸ·è¡Œçš„çµæœï¼š\nä½¿ç”¨å¤šå±¤çš„ nginx proxy è™•ç†"},"title":"æƒ³ä½¿ç”¨ Nginx Upstream Proxy åˆ°å¤–éƒ¨æœå‹™ï¼Œä¸¦å¸¶å…¥å°æ‡‰çš„ header è©²æ€éº¼åšï¼Ÿ"},"/blog/nginx/soketi-log-502-error/":{"data":{"":"æ­¤æ–‡ç« è¦ä¾†è¨˜éŒ„ä¸€ä¸‹ RD åŒä»å‰é™£å­æœ‰åæ‡‰ä½¿ç”¨ Soketi é€™å€‹ WebSocket Server æœƒä¸å®šæ™‚åœ¨ LOG å‡ºç¾ 502 error éŒ¯èª¤è¨Šæ¯ä»¥åŠ connect() failed (111: Connection refused) while connecting to upstreamï¼Œé›–ç„¶èªªæœå‹™ä½¿ç”¨ä¸Šä¸æœƒå½±éŸ¿å¾ˆå¤§ï¼Œä½†é‚„æ˜¯å¸Œæœ›æˆ‘å€‘å¯ä»¥å”åŠ©æ‰¾å‡º 502 çš„åŸå› ã€‚\nå‡ºéŒ¯çš„ LOG\nåœ¨é–‹å§‹æ‰¾å•é¡Œå‰ï¼Œå…ˆç°¡å–®ä»‹ç´¹ä¸€ä¸‹ Soketi æ˜¯ä»€éº¼æ±è¥¿å¥½äº†ï¼Œæ ¹æ“šå®˜ç¶²çš„èªªæ˜ï¼Œä»–æ˜¯ç°¡å–®ã€å¿«é€Ÿä¸”æœ‰å½ˆæ€§çš„é–‹æº WebSockets serverï¼Œæƒ³è¦äº†è§£æ›´å¤šçš„å¯ä»¥åˆ°å®ƒå®˜ç¶²å»æŸ¥çœ‹ã€‚\nå¦å¤–æœƒæŠŠç¨‹å¼ç¢¼ç›¸é—œæ”¾åˆ° GitHub Â» é»æˆ‘å‰å¾€","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"[Nginx] è§£æ±º connect() failed (111: Connection refused) while connecting to upstreamï¼šhttps://wshs0713.github.io/posts/8c1276a7/\nWebSocket proxyingï¼šhttp://nginx.org/en/docs/http/websocket.html\nday 10 Pod(3)-ç”Ÿå‘½é€±æœŸ, å®¹å™¨æ¢æ¸¬ï¼šhttps://ithelp.ithome.com.tw/articles/10236314","å£“æ¸¬#å£“æ¸¬":"æœ€å¾Œèª¿æ•´å®Œï¼Œæˆ‘å€‘ä¾†æ¸¬è©¦çœ‹çœ‹æ˜¯å¦åœ¨ Pod è‡ªå‹•é‡å•Ÿ or æ›´æ–° Deployment çš„æ™‚å€™(ä¸¦ä¸”æœ‰å¤§é‡é€£ç·šæ™‚)é‚„æœƒå™´ 502 error æˆ–æ˜¯ connect() failed (111: Connection refused)ï¼Œæˆ‘å€‘é€™é‚Šä½¿ç”¨ k6 ä¾†åš websocket æœå‹™çš„å£“æ¸¬ï¼Œæœ‰ç°¡å–®å¯«ä¸€å€‹å£“æ¸¬ç¨‹å¼å¦‚ä¸‹ï¼š\nk6 å£“æ¸¬\nk6 æ˜¯ä¸€å€‹é–‹æºçš„å£“æ¸¬å·¥å…·ï¼Œå¯ä»¥ç”¨ä¾†æ¸¬è©¦ APIã€WebSocketã€gRPC ç­‰æœå‹™ï¼Œå¯ä»¥åˆ°å®ƒçš„å®˜ç¶²æŸ¥çœ‹æ›´å¤šè³‡è¨Šã€‚\nMacOS å®‰è£æ–¹å¼ï¼šbrew install k6\nwebsocket.jsimport ws from \"k6/ws\"; import { check } from \"k6\"; export const options = { vus: 1000, duration: \"30s\", }; export default function () { const url = \"wss://socket.XXX.com/app/hex-ws?protocol=7\u0026client=js\u0026version=7.4.1\u0026flash=false\"; const res = ws.connect(url, function (socket) { socket.on(\"open\", () =\u003e console.log(\"connected\")); socket.on(\"message\", (data) =\u003e console.log(\"Message received: \", data)); socket.on(\"close\", () =\u003e console.log(\"disconnected\")); }); check(res, { \"status is 101\": (r) =\u003e r \u0026\u0026 r.status === 101 }); } ç°¡å–®èªªæ˜ä¸€ä¸‹ä¸Šé¢ç¨‹å¼åœ¨å¯«ä»€éº¼ï¼Œæˆ‘å€‘åœ¨ const è¨­å®š vus ä»£è¡¨æœ‰ 1000 å€‹è™›æ“¬ä½¿ç”¨è€…ï¼Œæœƒåœ¨ duration 30s å…§å®Œæˆæ¸¬è©¦ï¼Œä¸‹é¢çš„ default å°±æ˜¯æ¸¬è©¦é€£ç·š ws ä»¥åŠ message è·Ÿ close ç­‰å‹•ä½œï¼Œæœ€å¾Œéœ€è¦å›å‚³ 101 (ws äº¤æ¡)\nåŸ·è¡Œ k6 run websocket.js å¾Œï¼Œå°±æœƒé–‹å§‹å£“æ¸¬ï¼Œå¯ä»¥çœ‹åˆ°æœƒé–‹å§‹åŸ·è¡Œå‰›å‰›åœ¨ä¸Šé¢æåˆ° default çš„å‹•ä½œï¼š\nk6 å£“æ¸¬éç¨‹\nç­‰åˆ°è·‘å®Œï¼Œå°±æœƒå‘Šè¨´ä½  1000 ç­†è£¡é¢æœ‰å¤šå°‘çš„ http 101ï¼Œé€™é‚Šé¡¯ç¤º status is 101ï¼Œå°±ä»£è¡¨éƒ½æ˜¯ 101ï¼Œä»£è¡¨éƒ½æœ‰é€£ç·šæˆåŠŸï¼Œæ²’æœ‰å‡ºç¾ 502 error æˆ–æ˜¯ connect() failed (111: Connection refused) çš„éŒ¯èª¤ï¼Œé€™æ¨£å°±ä»£è¡¨æˆ‘å€‘çš„å•é¡Œè§£æ±ºäº†ã€‚\nk6 å£“æ¸¬çµæœ","è§£æ±ºéç¨‹#è§£æ±ºéç¨‹":"æˆ‘å€‘å¯ä»¥çœ‹åˆ°ä¸Šæ–¹éŒ¯èª¤ LOG ä¸­ï¼Œç™¼ç¾æœ‰å‡ºç¾ 502 error ä»¥åŠ connect() failed (111: Connection refused) while connecting to upstreamï¼Œé€™å…©å€‹éŒ¯èª¤éƒ½æ˜¯ç”± Nginx æ‰€ç”¢ç”Ÿçš„ï¼Œé‚£æˆ‘å€‘å…ˆä¾†ç†è§£ä¸€ä¸‹ï¼ŒNginx èˆ‡ Soketi ä¹‹é–“çš„é—œä¿‚ã€‚\nåœ¨ä½¿ç”¨ä¸Šï¼ŒRD çš„ç¨‹å¼æœƒæ‰“ Soketi å°ˆç”¨çš„ Subdomain ä¾†ä½¿ç”¨é€™å€‹ WebSocket æœå‹™ï¼Œè€Œåœ¨æˆ‘å€‘çš„æ¶æ§‹ä¸Šï¼Œé€™å€‹ Subdomain æœƒç¶“éç”¨ nginx proxy serverï¼Œä¾†è½‰ç™¼åˆ° Soketi WebSocket Server (èµ° k8s svc)ï¼Œè¨­å®šæª”å¦‚ä¸‹åœ–ï¼š\nå…¥å£ nginx è¨­å®š\nç„¶å¾Œæœƒå‡ºç¾ connect() failed (111: Connection refused) while connecting to upstream çš„éŒ¯èª¤è¨Šæ¯ï¼Œä»£è¡¨æˆ‘å€‘çš„ Nginx è¨­å®šå°‘äº†ä¸€å€‹é‡è¦çš„ä¸€è¡Œè¨­å®šï¼Œå°±æ˜¯ proxy_http_version 1.1;ï¼Œé€™å€‹è¨­å®šè¦è®“ Nginx ä½œç‚º proxy å¯ä»¥å’Œ upstream çš„å¾Œç«¯æœå‹™ä¹Ÿæ˜¯ç”¨ keepaliveï¼Œå¿…é ˆä½¿ç”¨ http 1.1ï¼Œä½†å¦‚æœæ²’æœ‰è¨­å®šé è¨­æ˜¯ 1.0ï¼Œä¹Ÿè¦è¨˜å¾—è¨­å®š proxy_set_header Upgradeã€proxy_set_header Connectionã€‚èª¿æ•´éå¾Œå°±è®Šæˆï¼š\nws.confserver { server_name socket.XXX.com; listen 80 ; listen [::]:80 ; listen 443 ssl; listen [::]:443 ssl; ssl_certificate /etc/nginx/ingress.gcp.cert; ssl_certificate_key /etc/nginx/ingress.gcp.key; access_log /var/log/nginx/access.log main; location / { proxy_pass http://soketi-ws-ci:6001; proxy_connect_timeout 10s; proxy_read_timeout 1800s; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \"Upgrade\"; proxy_set_header X-Real-IP $remote_addr; } } è§£æ±ºå®Œ connect() failed (111: Connection refused) é€™å€‹å•é¡Œå¾Œï¼Œæ¥ä¸‹ä¾†å°±æ˜¯è¦è§£æ±º 502 error é€™å€‹å•é¡Œï¼Œæœƒå°è‡´ 502 ä»£è¡¨ Nginx é€™å€‹ proxy server é€£ä¸ä¸Šå¾Œç«¯çš„ Soketi WebSocket Serverï¼Œå†è§€å¯Ÿ LOG ä»¥åŠæ¸¬è©¦å¾Œç™¼ç¾ï¼Œç•¶ Pod è‡ªå‹•é‡å•Ÿï¼Œæˆ–æ˜¯æ‰‹å‹•é‡å•Ÿ Deployment çš„æ™‚å€™ï¼Œå°±æœƒæœ‰ 502 çš„éŒ¯èª¤ï¼Œä»£è¡¨ Nginx åœ¨ proxy åˆ°å¾Œé¢çš„ Soketi svc å†åˆ° Pod çš„æ™‚å€™ï¼Œæœ‰ä¸€æ®µæ™‚é–“æ˜¯é€£ä¸ä¸Šçš„ï¼Œæ‰€ä»¥å°±æœƒå‡ºç¾ 502 çš„éŒ¯èª¤ï¼Œå¯ä»¥æ¨æ¸¬æ˜¯æµé‡é€²åˆ°æ­£åœ¨é—œé–‰çš„ Pod æˆ–æ˜¯é€²åˆ°é‚„æ²’æœ‰å•Ÿå‹•å¥½çš„ Pod æ‰å°è‡´çš„ã€‚\né‚£æˆ‘å€‘å…ˆä¾†çœ‹ä¸€ä¸‹ Soketi WebSocket Server çš„æœå‹™ yaml æª”æ¡ˆï¼š\ndeployment.yaml deployment.yaml spec: terminationGracePeriodSeconds: 30 securityContext: {} containers: - name: soketi securityContext: {} image: \"quay.io/soketi/soketi::1.6.0-16-alpine\" ... çœç•¥ (å¯ä»¥åˆ° github çœ‹ code)... livenessProbe: failureThreshold: 3 httpGet: httpHeaders: - name: X-Kube-Healthcheck value: \"Yes\" path: / port: 6001 initialDelaySeconds: 5 periodSeconds: 2 successThreshold: 1 å¯ä»¥çœ‹åˆ°åŸä¾†çš„è¨­å®šåªæœ‰ livenessProbe è€Œå·²ï¼Œå› æ­¤æˆ‘å€‘ç‚ºäº†è¦é¿å…æµé‡é€²åˆ°æ­£åœ¨é—œé–‰çš„ Pod æˆ–æ˜¯é€²åˆ°é‚„æ²’æœ‰å•Ÿå‹•å¥½çš„ Podï¼Œæ‰€ä»¥æˆ‘å€‘éœ€è¦åŠ ä¸Š readinessProbe ä»¥åŠ preStopï¼Œè®“ Pod ç¢ºå®šå•Ÿå‹•å®Œç•¢ï¼Œæˆ–æ˜¯ç­‰å¾… Service çš„ endpoint list ä¸­ç§»é™¤ Podï¼Œæ‰é–‹å§‹æ¥æ”¶æµé‡ï¼Œé€™æ¨£å°±å¯ä»¥é¿å…å‡ºç¾ 502 çš„éŒ¯èª¤ã€‚\ndeployment.yaml spec: terminationGracePeriodSeconds: 30 securityContext: {} containers: - name: soketi securityContext: {} image: \"quay.io/soketi/soketi::1.6.0-16-alpine\" ... çœç•¥ (å¯ä»¥åˆ° github çœ‹ code)... livenessProbe: failureThreshold: 3 httpGet: httpHeaders: - name: X-Kube-Healthcheck value: \"Yes\" path: / port: 6001 initialDelaySeconds: 5 periodSeconds: 2 successThreshold: 1 readinessProbe: failureThreshold: 3 httpGet: httpHeaders: - name: X-Kube-Healthcheck value: \"Yes\" path: /ready port: 6001 initialDelaySeconds: 5 periodSeconds: 2 successThreshold: 1 lifecycle: preStop: exec: command: [\"/bin/sh\", \"-c\", \"sleep 20\"] Pod çµ‚æ­¢çš„éç¨‹"},"title":"Soketi WebSocket Server LOG ä¸å®šæ™‚å‡ºç¾ 502 error ä»¥åŠ connect() failed (111: Connection refused)"},"/blog/opentelemetry/":{"data":{"":"æ­¤åˆ†é¡åŒ…å« Opentelemetry ç›¸é—œçš„æ–‡ç« ã€‚\nä»€éº¼æ˜¯ Opentelemetryï¼Ÿå¯è§€æ¸¬æ€§ (Observability) åˆæ˜¯ä»€éº¼ï¼Ÿ å¦‚ä½•é€é OpenTelemetry ä¾†æ”¶é›† Ingress Nginx Controller çš„ Metrics èˆ‡ Traces ä¸¦é€åˆ° Datadog ä¸Š "},"title":"Opentelemetry"},"/blog/opentelemetry/opentelemetry-ingress-nginx-controller/":{"data":{"":"ç”±æ–¼æœ€è¿‘å…¬å¸æƒ³è¦å°å…¥ Datadogï¼Œåœ¨æ¸¬è©¦éç¨‹ä¸­é †ä¾¿å°å…¥ OpenTelemetry ä¾†æ”¶é›† Metrics èˆ‡ Traces ä¸¦é€åˆ° Datadog ä¸Š ï½\nğŸ”¥ é€™å€‹ç¯„ä¾‹æ¯”è¼ƒç‰¹åˆ¥ï¼Œå› ç‚º Datadog æœ‰æä¾› Ingress Nginx Controller çš„ integrationsï¼Œå¯ä»¥é€é Datadog Agent ä¾†æ”¶é›† Metricsï¼Œä¸éœ€è¦é€é OpenTelemetry Collector ä¾†æ”¶é›†ã€‚ ( Datadog Agent è«‹åƒè€ƒï¼šhttps://docs.datadoghq.com/containers/kubernetes/ )\nç¨‹å¼éƒ¨åˆ†ä¹ŸåŒæ­¥ä¸Šå‚³åˆ° github ä¸Šï¼Œå¯ä»¥é»æˆ‘å‰å¾€","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"Configure Nginx Ingress Controller to use JSON log formatï¼šhttps://dev.to/bzon/send-gke-nginx-ingress-controller-logs-to-stackdriver-2ih4\næ·ºè«‡ OpenTelemetry - Collector Compoentsï¼šhttps://ithelp.ithome.com.tw/articles/10290703","åŸ·è¡Œæ­¥é©Ÿ#åŸ·è¡Œæ­¥é©Ÿ":" å…ˆ clone é€™å€‹ repo (å»¢è©± xD)\nå…ˆå»ºç«‹ OpenTelemetry Collectorï¼ŒåŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š\nhelm upgrade collector \\ opentelemetry-collector \\ --repo https://open-telemetry.github.io/opentelemetry-helm-charts \\ --install \\ --create-namespace \\ --namespace opentelemetry \\ -f \"otel-collector.yaml\" å†å»ºç«‹ Ingress Nginx Controllerï¼ŒåŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š\nhelm upgrade ingress-nginx \\ ingress-nginx \\ --repo https://kubernetes.github.io/ingress-nginx \\ --install \\ --create-namespace \\ --namespace ingress-nginx \\ -f \"ingress-nginx-values.yaml\" æ¥è‘—å»ºç«‹æ¸¬è©¦ç”¨ Nginx æœå‹™ï¼ŒåŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š\nkubectl apply -f nginx.yaml ","æª”æ¡ˆèªªæ˜#æª”æ¡ˆèªªæ˜":" otel-collector.yamlï¼š OpenTelemetry Collector çš„è¨­å®šæª”ï¼Œä¸»è¦æ˜¯è¨­å®šè¦æ”¶é›†å“ªäº› metricsã€tracesï¼Œä¸¦ä¸”è¦é€åˆ°å“ªå€‹ exporterï¼Œè¦æ³¨æ„çš„æ˜¯ exporters çš„ datadog éœ€è¦è¨­å®š siteã€api_keyï¼Œä»¥åŠ image è¦è¨˜å¾—ç”¨ otel/opentelemetry-collector-contribï¼Œæ‰æœƒæœ‰ datadog çš„ exporterã€‚\ningress-nginx-values.yamlï¼š Ingress Nginx Controller çš„è¨­å®šæª”ï¼Œé€™é‚Šçš„ podAnnotations æ˜¯ç‚ºäº†è®“ Ingress Nginx Controller çš„ Pod èƒ½å¤ é€é Datadog agent æ”¶é›† metrics åˆ° Datadog æ‰åŠ ä¸Šçš„ã€‚\nconfig è£¡é¢çš„è¨­å®šæœ‰å¾ˆå¤šï¼Œä¸»è¦éƒ½æ˜¯ openTelemetry çš„è¨­å®šï¼Œè¦æ³¨æ„çš„æ˜¯ enable-opentelemetry è¦è¨­ç‚º trueï¼Œå¦å¤– otlp-collector-host ä»¥åŠ otlp-collector-port è¦é€åˆ°å“ªå€‹ collector ç­‰ç­‰ä¹Ÿè¦è¨˜å¾—è¨­å®šã€‚ å¦å¤–å¦‚æœæƒ³è¦å°‡ LOG èˆ‡ Trace ä¸²å†ä¸€èµ·ï¼Œè¨˜å¾—è¦æŠŠ log-format è¨­ç‚º jsonï¼Œä¸¦ä¸”å¸¶å…¥ï¼Œtrace_id èˆ‡ span_id ( é€™é‚Šæœ‰å¤šå¸¶ dd.trace_id æ˜¯ç‚ºäº†è®“ datadog å¯ä»¥è‡ªå‹•ä¸²æ¥ LOG \u0026 Trace )ã€‚\nnginx.yamlï¼š ä¸€å€‹ç°¡å–®çš„ Nginx æ•´å¥—æœå‹™ (Deploymentã€Serviceã€Ingress)ï¼Œè¦æ³¨æ„çš„æ˜¯ Ingress éœ€è¦è¨­å®š annotations kubernetes.io/ingress.class: nginx (é€™å€‹æ˜¯ Ingress Nginx Controller çš„é è¨­ class name)ï¼Œæ‰æœƒè¢« Ingress Nginx Controller æ¥ç®¡ (æ‰æœƒæœ‰ Load Balancer çš„ IP)","æ¸¬è©¦#æ¸¬è©¦":"ç•¶ä½ åŸ·è¡Œå®Œä¸Šé¢çš„æ­¥é©Ÿå¾Œï¼Œä½ æœƒç™¼ç¾æœ‰ç”¢ç”Ÿå…©å€‹ namespaceï¼Œä¸€å€‹æ˜¯ ingress-nginxï¼Œå¦ä¸€å€‹æ˜¯ opentelemetryï¼Œä¸¦ä¸”æœƒæœ‰ OpenTelemetry Collectorã€Ingress Nginx Controllerã€Nginx ç­‰æœå‹™ï¼Œå¦‚ä¸‹ï¼š\nå•Ÿå‹•æœå‹™\næˆ‘å€‘è©¦è‘—æ‰“ http://nginx.example.com/ (æ¸¬è©¦ç¶²å€ï¼Œéœ€è¦å…ˆåœ¨ /etc/hosts ç¶å®š Ingress Nginx Controller å’¬ä½çš„ Load Balancer IP)ï¼ŒæŸ¥çœ‹ä¸€ä¸‹ Datadog çš„ LOGï¼Œçœ‹çœ‹æ˜¯å¦æœ‰æ”¶åˆ° Nginx çš„ LOG (æ­¤æ”¶é›† LOG çš„æ–¹å¼æ˜¯é€éåœ¨ cluster ä¸Šå®‰è£ Datadog çš„ agent)ï¼Œå¦‚ä¸‹ï¼š\nDatadog LOG\næ¥è‘—æŸ¥çœ‹ Datadog APM çš„ traceï¼Œå¦‚ä¸‹ï¼š\nDatadog APM\nç”±æ–¼æˆ‘å€‘åœ¨å¾Œé¢ç›®å‰æ²’æœ‰ä¸²å…¶ä»–æœå‹™ï¼Œæ‰€ä»¥åªæœ‰ä¸€å€‹ spanï¼Œä¹‹å¾Œé‚„æœ‰å¦å¤–å…©ç¯‡æ–‡ç« æ˜¯ä»‹ç´¹å¦‚ä½•ä¸²å…¶ä»–æœå‹™ (æœƒå¢åŠ æœå‹™ä»¥åŠéƒ¨åˆ†è¨­å®š)ï¼Œå¯ä»¥åƒè€ƒçœ‹çœ‹ï¼šopentelemetry-roadrunnerã€opentelemetry-nodejs\né †ä¾¿çœ‹ä¸€ä¸‹é€é Datadog Agent æ”¶é›†çš„ Ingress Nginx Controller çš„ Metricsï¼Œå¦‚ä¸‹ï¼š\nDatadog Ingress Nginx Controller çš„ Metrics\nå¯ä»¥ç”¨é€™äº› Metrics ä¾†åš Dashboardï¼Œå¦‚ä¸‹ï¼š\nDatadog Dashboard","çµè«–#çµè«–":"é€é OpenTelemetry Collector ä¾†æ”¶é›† Ingress Nginx Controller çš„ Metrics èˆ‡ Traces ä¸¦é€åˆ° Datadog ä¸Šï¼Œé€™æ¨£å°±å¯ä»¥é€é Ingress Nginx Controller çš„ Metrics ä¾†åšç›£æ§äº†ï¼Œå°æ–¼ RD å†é–‹ç™¼ä¸Šï¼Œæœ‰ Traces ä¹Ÿæ›´æ–¹ä¾¿ RD ä»–å€‘æ‰¾åˆ°ç¨‹å¼çš„ç“¶é ¸ (æœ‰å¯èƒ½æ˜¯æœå‹™å°è‡´çš„)ã€‚"},"title":"å¦‚ä½•é€é OpenTelemetry ä¾†æ”¶é›† Ingress Nginx Controller çš„ Metrics èˆ‡ Traces ä¸¦é€åˆ° Datadog ä¸Š"},"/blog/opentelemetry/opentelemetry-observability/":{"data":{"":"åœ¨ä»‹ç´¹ Opentelemetry ä¹‹å‰ï¼Œæˆ‘å€‘è¦å…ˆäº†è§£ä¸€ä¸‹ç›®å‰è»Ÿé«”æ¶æ§‹ä»¥åŠåŸºç¤è¨­æ–½çš„æ¼”é€²ï¼š\nè»Ÿé«”æ¶æ§‹ä»¥åŠåŸºç¤è¨­æ–½çš„æ¼”é€²\nç¬¬ä¸€éšæ®µåœ¨è»Ÿé«”æ¶æ§‹è¨­è¨ˆä¸Šè¼ƒç‚ºç°¡å–®ï¼Œä¸æœƒæœ‰ä»€éº¼ç‰¹åˆ¥éœ€è¦æ‹†åˆ†å‡ºä¾†çš„ç¨‹å¼ï¼Œæ‰€ä»¥éƒ½æ˜¯ä¸€æ•´åŒ…çš„ç¨‹å¼ï¼Œå†æ¸¬è©¦ä»¥åŠé™¤éŒ¯ä¹Ÿæ¯”è¼ƒä¸æœƒæœ‰ä»€éº¼å•é¡Œã€‚åŸºç¤è¨­æ–½éƒ½æ˜¯ä½¿ç”¨ VM æˆ–æ˜¯ä½¿ç”¨æ”¾åœ¨ IDC çš„æ©Ÿæˆ¿ä¾†ç•¶ Serverã€‚\nç¬¬äºŒéšæ®µéš¨è‘—é›²ç«¯æŠ€è¡“çš„æ¨å‡ºï¼Œæœƒé–‹å§‹å°‡æœå‹™æ¬ä¸Šé›²ä¾›æ‡‰å•†æä¾›çš„ IaaS æœå‹™ï¼Œæˆ–æ˜¯ä½¿ç”¨ç§æœ‰é›²çµ¦ä¼æ¥­æ”¾ç½®è¼ƒæ©Ÿå¯†çš„å…§å®¹ï¼Œå…¶ä»–å‰‡æ”¾ç½®å…¬æœ‰é›²ä¸Šï¼Œé”æˆæ··åˆé›²çš„æ¨¡å¼ã€‚\nç¬¬ä¸‰éšæ®µéš¨è‘—é›²ç«¯æŠ€è¡“è¶Šä¾†è¶Šæˆç†Ÿï¼Œæœ‰æ›´å¤šçš„é›²ç«¯ IaC ä»¥åŠåŠŸèƒ½æ¨å‡ºï¼Œæœƒé–‹å§‹è€ƒæ…®ä½¿ç”¨åˆ†æ•£å¼çš„ç³»çµ±æ¶æ§‹ï¼Œå°‡ DB ç­‰æœå‹™ä¹Ÿæ”¹ç”¨ Cloud SQL çš„æ–¹å¼ã€‚åœ¨åŸºç¤è¨­æ–½ä¸Šä¹Ÿéš¨è‘—å®¹å™¨åŒ–çš„æŠ€è¡“æˆç†Ÿè€Œé€²å…¥æ–°çš„æ™‚ä»£ã€‚\nç¬¬å››éšæ®µå·²ç¶“ä½¿ç”¨ docker ä¾†ç®¡ç†å¥½ä¸€é™£å­ï¼Œä½†ç™¼ç¾è™›æ“¬å®¹å™¨æŠ€è¡“åœ¨ç®¡ç†ä¸Šååˆ†ä¸æ–¹ä¾¿ï¼Œå› æ­¤ K8s é€æ¼¸ç››è¡Œï¼Œå°‡æ¶æ§‹å¾åˆ†æ•£å¼æ”¹æˆå¾®æœå‹™çš„æ–¹å¼é€²è¡Œï¼Œåœ¨è®“é–‹ç™¼åœ˜éšŠä½¿ç”¨ä¸Šå¯ä»¥æ›´éˆæ´»ä¸”å®¹æ˜“ã€‚\né›–ç„¶ä½¿ç”¨ K8s å¯ä»¥è®“æˆ‘å€‘çš„æœå‹™æ›´éˆæ´»æ–¹ä¾¿ï¼Œä½†ä¹Ÿæœƒå°‡æœå‹™åˆ‡çš„è¶Šä¾†è¶Šç´°ï¼Œé€™æ™‚æœƒè®“é–‹ç™¼è®Šçš„ååˆ†è¤‡é›œï¼Œæˆ‘å€‘åœ¨æ¶æ§‹ä¸Šå¾ä¸€é–‹å§‹çš„å–®é«”å¼æ¶æ§‹ï¼Œè®Šæˆåˆ†æ•£å¼æ¶æ§‹ï¼Œå†åˆ°æœ€å¾Œçš„å¾®æœå‹™ï¼Œè®“é–‹ç™¼äººå“¡éœ€è¦è™•ç†çš„äº‹æƒ…æœƒè¶Šä¾†è¶Šå¤šã€‚æœå‹™è¦å¦‚ä½•é€£ç·šï¼ŸLog è¦å¦‚ä½•è¨˜éŒ„ï¼Ÿä»¥åŠç•¶ä¸€å€‹è«‹æ±‚æœƒç¶“éå¤šå€‹æœå‹™æ™‚ï¼Œç›¸å°çš„å»¶é²ä¹Ÿæœƒå¢åŠ ï¼Œé€™æ™‚è¦æ€éº¼å»è™•ç†ç­‰ã€‚åœ¨ç›£æ§ä¸Šï¼Œå› ç‚ºæœå‹™åˆ‡åˆ†å¾—å¾ˆç´°ï¼Œç•¶ç·šä¸Šæœ‰ä¸€å€‹æœå‹™æœ‰å•é¡Œæ™‚ï¼Œè¦å¦‚ä½•å¿«é€Ÿçš„æ‰¾åˆ°å•é¡Œé»ä¹Ÿæ˜¯ä¸€å¤§æŒ‘æˆ°ã€‚\nç•¶æˆ‘å€‘ä½¿ç”¨åˆ†æ•£å¼ç³»çµ±æˆ–æ˜¯å¾®æœå‹™æ™‚ç™¼ç”Ÿæ•…éšœæ™‚ï¼Œæœƒå¾ˆé›£å¿«é€Ÿçš„æ¢å¾©æœå‹™ï¼Œå› ç‚ºæ¯å€‹æœå‹™éƒ½äº’ç›¸ä¾è³´ï¼Œåœ¨ä»¥å¾€éƒ½æ˜¯é€éç¶“é©—ä»¥åŠå°ç³»çµ±çš„äº†è§£ä¾†å¾—ä»¥è§£æ±ºã€‚é‚£æœ‰ä»€éº¼å…¶ä»–çš„æ–¹å¼ï¼Œèƒ½å¤ è®“æˆ‘å€‘æ›´å¿«æŒæ¡æ¯å€‹æœå‹™å‘¢ï¼Ÿæˆ‘å€‘å…ˆä¾†äº†è§£ä¸€å€‹åè©ï¼šå¯è§€æ¸¬æ€§(Observability)","opentelemetry#Opentelemetry":"é‚£æˆ‘å€‘é€™æ¬¡è¦ä»‹ç´¹çš„å¯è§€æ¸¬æ€§(Observability)å·¥å…·å°±æ˜¯ Opentelemetryï¼Œç¸®å¯« OTelï¼Œå®ƒæ˜¯ç”± CNCF (Cloud Native Computing Foundation) çµ„ç¹”å­µåŒ–çš„é–‹æºå°ˆæ¡ˆï¼Œåœ¨ 2021 å¹´ 5 æœˆç”± OpenTracing èˆ‡ OpenCensus å…©å€‹æ¡†æ¶åˆä½µï¼Œçµåˆå…©é …åˆ†æ•£å¼è¿½è¹¤æ¡†æ¶æœ€é‡è¦çš„ç‰¹æ€§æˆç‚ºä¸‹ä¸€ä»£æ”¶é›†é™æ¸¬æ•¸æ“šçš„æ–°æ¨™æº–ã€‚\ntelemetry åˆå«åšé™æ¸¬ï¼Œæ˜¯æŒ‡èƒ½å¤ è·¨è¶Šä¸åŒç³»çµ±ä¾†æ”¶é›†è³‡æ–™ (åŒ…å« LOGã€Metricã€trace) çš„èƒ½åŠ›ã€‚\næˆ‘å€‘å¯ä»¥çœ‹ä¸€ä¸‹å®˜ç¶²çš„èªªæ˜ï¼š\nOpentelemetry æ˜¯é›²åŸç”Ÿçš„å¯è§€æ¸¬æ€§(Observability)æ¡†æ¶ï¼Œæä¾›æ¨™æº–åŒ–çš„ APIã€SDK èˆ‡å”è­°è‡ªå‹•æª¢æ¸¬ã€è’é›†ã€å°å‡ºé™æ¸¬æ•¸æ“šè³‡æ–™ (Metricsã€Logã€Trace)ï¼Œä¸¦æ”¯æ´ W3C å®šç¾©çš„ Http trace-context è¦ç¯„ï¼Œé™ä½é–‹ç™¼è€…åœ¨æœé›†é™æ¸¬æ•¸æ“šä¸Šçš„å›°é›£åº¦ï¼Œä»¥åŠæ–¹ä¾¿é€²è¡Œå¾ŒçºŒåˆ†æä»¥åŠæ€§èƒ½çš„å„ªåŒ–ã€‚\nOpentelemetry\nåœ¨ OpenTelemetry æ ¸å¿ƒå…ƒä»¶å¦‚ä¸‹ï¼š\nAPIï¼šé–‹ç™¼äººå“¡å¯ä»¥é€é OpenTelemetry API è‡ªå‹•ç”Ÿæˆã€è’é›†æ‡‰ç”¨ç¨‹å¼(Application)çš„é™æ¸¬æ•¸æ“šè³‡æ–™(Metrics, Log, Trace)ï¼Œæ¯å€‹ç¨‹å¼èªè¨€éƒ½éœ€å¯¦ä½œ OpenTelemetry è¦ç¯„æ‰€å®šç¾©çš„ API æ–¹æ³•ç°½ç« ã€‚\nSDKï¼šæ˜¯ OpenTelemetry API çš„å¯¦ç¾ã€‚\nOTLPï¼šè¦ç¯„å®šç¾©äº†é™æ¸¬æ•¸æ“šçš„ç·¨ç¢¼èˆ‡å®¢æˆ¶ç«¯åŠæœå‹™å™¨ä¹‹é–“å¦‚ä½•äº¤æ›çš„å”è­° (gRPCã€HTTP)ã€‚\nCollectorï¼šOpenTelemetry ä¸­å„²å­˜åº«ï¼Œç”¨æ–¼æ¥æ”¶ã€è™•ç†ã€å°å‡ºé™æ¸¬æ•¸æ“šåˆ°å„ç¨®å¾Œç«¯å¹³å°ã€‚","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"Observabilityï¼šhttps://linkedin.github.io/school-of-sre/level101/metrics_and_monitoring/observability/\n[OpenTelemetry] ç¾ä»£åŒ–ç›£æ§ä½¿ç”¨ OpenTelemetry å¯¦ç¾ : å¯è§€æ¸¬æ€§(Observability)ï¼šhttps://marcus116.blogspot.com/2022/01/modern-monitoring-using-openTelemetry-with-Observability.html\n[OpenTelemetry] ç¾ä»£åŒ–ç›£æ§ä½¿ç”¨ OpenTelemetry å¯¦ç¾ : OpenTelemetry é–‹æ”¾é™æ¸¬ï¼šhttps://marcus116.blogspot.com/2022/01/opentelemetry-opentelemetry.html\næ·ºè«‡ Observability(ä¸‹)ï¼šhttps://ithelp.ithome.com.tw/m/articles/10287598\nManage services, spans, and traces in Splunk APMï¼šhttps://docs.splunk.com/Observability/apm/apm-spans-traces/traces-spans.html","å¯è§€æ¸¬æ€§observability#å¯è§€æ¸¬æ€§(Observability)":"å¯è§€æ¸¬æ€§æœ‰ä¸‰å€‹é‡è¦çš„ç‰¹æ€§ï¼Œåˆ†åˆ¥æ˜¯ï¼š\nMetrics è² è²¬ç›£æ§ç³»çµ±æœ‰ä»€éº¼ç‹€æ³ï¼Œç•¶è¦ç™¼ç”Ÿæœå‹™æ•…éšœå‰å¯ä»¥é€éè¨­å®šé–¥å€¼æ­é…å‘Šè­¦ææ—©å¾—çŸ¥ã€‚\nLogs ç•¶å•é¡Œç™¼ç”Ÿæ™‚ï¼Œå¯ä»¥ç”¨ä¾†æŸ¥çœ‹æ•…éšœæ™‚æ­£åœ¨åŸ·è¡Œå“ªäº›æœå‹™ï¼Œä»¥åŠç”¢ç”Ÿçš„éŒ¯èª¤è³‡è¨Šã€‚\nTraces ï¼ˆå¾Œé¢è©³ç´°ä»‹ç´¹ï¼‰\nå¯è§€æ¸¬æ€§ä¸‰å¤§æ”¯æŸ±\næˆ‘å€‘å°æ–¼ Metrics è·Ÿ Logs æœ‰åŸºæœ¬çš„äº†è§£ï¼Œæ‰€ä»¥æˆ‘é€™é‚Šæœƒæ³¨é‡åœ¨ Traces çš„éƒ¨åˆ†ï¼š\nç•¶æœ‰å¤šå€‹å¾®æœå‹™çš„è¤‡é›œåˆ†æ•£å¼ç³»çµ±ï¼Œç”¨æˆ¶çš„è«‹æ±‚æœƒç”±ç³»çµ±ä¸­çš„å¤šå€‹å¾®æœå‹™é€²è¡Œè™•ç†ã€‚Metrics è·Ÿ Logs å¯ä»¥æä¾›æˆ‘å€‘æœ‰é—œç³»çµ±å¦‚ä½•å»è™•ç†é€™äº›è«‹æ±‚çš„ä¸€äº›è³‡è¨Šï¼Œä½†æ²’æœ‰è¾¦æ³•æä¾›å¾®æœå‹™çš„è©³ç´°è¨Šæ¯ä»¥åŠä»–æ˜¯å¦‚ä½•å½±éŸ¿å®¢æˆ¶ç«¯çš„è«‹æ±‚ã€‚é€™æ™‚å€™å°±éœ€è¦é€é Trace ä¾†å”åŠ©æˆ‘å€‘è¿½è¹¤ã€‚\nTrace å¯ä»¥åœ¨é€£çºŒçš„æ™‚é–“ç¶­åº¦ä¸Šï¼Œé€é Trace ä»¥åŠ Span é—œè¯ï¼ŒæŠŠç©ºé–“çµ¦æ’åˆ—å±•ç¤ºå‡ºä¾†ï¼Œä¸¦ä¸”æœ‰ Trace-Context è¦ç¯„ï¼Œèƒ½å¤ ç›´è§€çš„çœ‹åˆ°è«‹æ±‚åœ¨åˆ†æ•£å¼ç³»çµ±ä¸­ç¶“éæ‰€æœ‰æœå‹™çš„ç´€éŒ„ã€‚\nä»€éº¼æ˜¯ Traceã€Span ã€Trace-Context å‘¢ï¼Ÿ\næˆ‘å€‘å…ˆèªª Spanï¼ŒSpan åˆå¯ä»¥å«è·¨åº¦ï¼Œæ˜¯ç³»çµ±ä¸­æœ€å°çš„å–®ä½ï¼Œå¯ä»¥çœ‹ä¸‹æ–¹åœ–ç‰‡ï¼ŒSpanA çš„è³‡æ–™æ˜¯ä¾†æº SpanBï¼ŒSpanB ä¾†æºæ˜¯ SpanC ç­‰ç­‰ï¼Œæ¯ä¸€å€‹ Span å¯ä»¥æŠŠå®ƒæƒ³æˆä¸€å€‹è«‹æ±‚å¾Œé¢æ‰€æœ‰ç¶“éæœå‹™çš„å·¥ä½œæµç¨‹ï¼Œä¾‹å¦‚ï¼šnginx_moduleã€dbã€redis ç­‰ç­‰ã€‚\nè«‹æ±‚çš„æ•´å€‹éç¨‹å«åš Traceï¼Œé‚£ä»–è¦æ€éº¼çŸ¥é“ SpanA ~ SpanE æ˜¯åŒä¸€å€‹è«‹æ±‚å‘¢ï¼Ÿ\nå°±éœ€è¦é€é TraceID ä»¥åŠ SpanID ä¾†è¨˜éŒ„ï¼š\nTraceIDï¼šæ˜¯å”¯ä¸€çš„ IDï¼Œç”¨æ–¼è­˜åˆ¥æ•´å€‹åˆ†æ•£å¼è¿½è¹¤çš„ä¸€æ¢è«‹æ±‚è·¯å¾‘ã€‚åœ¨ä¸‹æ–¹åœ–ç‰‡ä¸­ï¼Œç•¶è«‹æ±‚é€²å…¥æ™‚ï¼Œå°±æœƒè¢«è³¦äºˆä¸€å€‹ TraceIDï¼Œæ‰€æœ‰æœ‰ç¶“éçš„ Span éƒ½æœƒè¨˜éŒ„æ­¤ TraceIDï¼Œé€™æ¨£æ‰å¯ä»¥æŠŠä¸åŒæœå‹™ä¾æ“š TraceID é—œè¯æˆåŒä¸€å€‹è«‹æ±‚ã€‚\nSpanIDï¼šæ˜¯ä¸€æ¢è«‹æ±‚è·¯å¾‘ä¸­å–®å€‹æ“ä½œå”¯ä¸€çš„ IDã€‚è¿½è¹¤è·¯å¾‘æ˜¯ç”±å¤šå€‹ Span çµ„æˆï¼Œæ¯å€‹ Span éƒ½ä»£è¡¨ä¸€å€‹æ“ä½œæˆ–ç‰¹å®šçš„æ™‚é–“æ®µã€‚ç•¶è«‹æ±‚é€²å…¥æ™‚ï¼Œæ¯å€‹æœå‹™å°±æœƒç”¢ç”Ÿä¸€å€‹ Span ä¾†ä»£è¡¨å®ƒè™•ç†è«‹æ±‚çš„çš„æ™‚é–“ã€‚é€™äº› Span ä½¿ç”¨ TraceID ä¾†é€£æ¥å†ä¸€èµ·ï¼Œå½¢æˆå®Œæ•´çš„è«‹æ±‚è¿½è¹¤ã€‚\nTrace ç¤ºæ„åœ–\né‚£è¦æ€éº¼æŸ¥çœ‹æ¯å€‹ Span çš„ç´€éŒ„å…§å®¹å‘¢ï¼Œå°±éœ€è¦ Trace-Contextï¼š\næœƒæ”¾ç½®ä¸€äº›ç”¨æ–¼è¿½è¹¤å’Œè­˜åˆ¥è«‹æ±‚çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä¾‹å¦‚ Trace IDã€Span ID å’Œå…¶ä»–ç›¸é—œçš„æ•¸æ“šã€‚é€™äº›ä¸Šä¸‹æ–‡ä¿¡æ¯å¯ä»¥æ˜¯ä¸€äº›é—œéµçš„æ•¸æ“šï¼Œå¯ä»¥å¹«åŠ©æˆ‘å€‘åœ¨æ•´å€‹åˆ†ä½ˆå¼ç³»çµ±ä¸­è¿½è¹¤è«‹æ±‚çš„è·¯å¾‘ï¼Œä¸¦å°‡ç›¸é—œè«‹æ±‚å’Œæ“ä½œé—œè¯èµ·ä¾†ã€‚\nECK Trace ç¤ºæ„åœ–\nä¸Šé¢çš„åœ–ç‰‡ä¸­ï¼Œå¯ä»¥çœ‹åˆ° call /product/XXXX å¾Œï¼Œæœƒç¶“ééœ€å¤šçš„ Spanï¼Œéš¨ä¾¿é»æ“Šä¸€å€‹ Span å¯ä»¥çœ‹åˆ°å®ƒè¨˜éŒ„çš„ Trace-Contextï¼Œä»¥åŠéƒ½æœƒåŒ…å« TraceID åŠ SpanID\nECK Trace ç¤ºæ„åœ–\nTrace å„ªé»å¯ä»¥çœ‹åˆ°è·¨ç¶­åº¦çœ‹åˆ°ä¸­é–“çš„è³‡è¨Šï¼Œå°æ–¼æ‰¾åˆ°å•é¡Œä»¥åŠç“¶é ¸ååˆ†æ–¹ä¾¿ï¼Œä½†ç¼ºé»å°±æ˜¯å› ç‚ºéœ€è¦åœ¨ Span ä¸­ç”¢ç”Ÿ ID ä»¥åŠå…§å®¹ï¼Œéœ€è¦åœ¨ç¨‹å¼è£¡é¢åŠ å…¥ä¸€å®šçš„å¥—ä»¶ä»¥åŠèª¿æ•´ç¨‹å¼ç¢¼ã€‚\næ‰€ä»¥æˆ‘å€‘åœ¨å¯è§€æ¸¬æ€§(Observability)æœ€çµ‚çš„ç›®çš„æ˜¯å¸Œæœ›å¯ä»¥é€éå¯è§€æ¸¬æ€§å·¥å…·è®“æˆ‘å€‘çŸ¥é“ï¼š\nè«‹æ±‚é€šéå“ªäº›æœå‹™ æ¯å€‹æœå‹™åœ¨è™•ç†è«‹æ±‚æ™‚åšäº†äº›ä»€éº¼ å¦‚æœè«‹æ±‚å¾ˆæ…¢ï¼Œç“¶é ¸åœ¨å“ªé‚Š å¦‚æœè«‹æ±‚å¤±æ•—ï¼ŒéŒ¯èª¤é»åœ¨å“ª è«‹æ±‚çš„è·¯å¾‘æ˜¯ä»€éº¼ ç‚ºä»€éº¼èŠ±é€™éº¼é•·çš„æ™‚é–“ "},"title":"ä»€éº¼æ˜¯ Opentelemetryï¼Ÿå¯è§€æ¸¬æ€§ (Observability) åˆæ˜¯ä»€éº¼ï¼Ÿ"},"/blog/other/":{"data":{"":"å…ˆæ”¾ç½®é‚„æ²’æœ‰æƒ³åˆ°çš„åˆ†é¡ Blog æ–‡ç« ã€‚\nLinux å¸¸ç”¨æŒ‡ä»¤ æ¸…é™¤ Linux æ©Ÿå™¨ä¸Šçš„ Swap (Buffã€Cacheã€Swap æ¯”è¼ƒ) æ‰¾å‡ºç¨‹å¼ç¢¼ã€é–‹æºå¥—ä»¶ã€å®¹å™¨çš„å®‰å…¨æ¼æ´å·¥å…· - Snyk Bookstack é–‹æºçŸ¥è­˜åº«ç­†è¨˜å¹³å°å®‰è£ (K8s + docker) "},"title":"å…¶ä»–(é‚„æƒ³ä¸åˆ°åˆ†é¡)"},"/blog/other/bookstack/":{"data":{"":"æœ€è¿‘å‰›å¥½æœ‰å…¬å¸åŒäº‹é›¢è·ï¼Œæƒ³è¦æŠŠäº¤æ¥çš„è³‡æ–™çµ¦æ•´ç†æ•´ç†ï¼Œé›–ç„¶éƒ¨é–€ä¹‹å‰æœ‰æ¶è¨­å°ˆç”¨çš„ wiki çµ¦ RD ä½¿ç”¨ï¼Œä½†è¦ºå¾—ä»‹é¢æ²’æœ‰åˆ°å¾ˆå¥½ç”¨ï¼Œæ–¼æ˜¯å°±åœ¨ç¶²è·¯ä¸Šå°‹æ‰¾ï¼Œå¯ä»¥å¤šäººç·¨è¼¯çš„ç­†è¨˜ç³»çµ±ï¼Œä¸€é–‹å§‹æœ‰æƒ³éç”¨ CodiMD (HackMD)ï¼Œä½†è€ƒé‡åˆ°éœ€è¦å¤šå±¤çš„æ¶æ§‹ä¾†å€åˆ†æ–‡ä»¶ï¼Œæœ€å¾Œé¸æ“‡ Bookstack é€™å€‹é–‹æºçŸ¥è­˜åº«ç­†å¹³å°ä¾†ä½œç‚ºçµ„å…§çš„ç­†è¨˜ç³»çµ±ï¼Œä»¥ä¸‹æœƒç°¡å–®èªªä¸€ä¸‹ Bookstack çš„ç‰¹è‰²ä»¥åŠä½¿ç”¨ K8s è·Ÿ docker çš„å®‰è£æ•™å­¸ã€‚","bookstack-ä»‹ç´¹#Bookstack ä»‹ç´¹":"ä»‹ç´¹éƒ¨åˆ†ä¸»è¦åƒè€ƒ Bookstack ç°¡ä»‹ï¼Œä»¥ä¸‹åˆ—å‡ºæœƒé¸æ“‡å®ƒçš„ä¸‰å€‹ç‰¹è‰²ï¼š\nç°¡æ½”çš„æ›¸æœ¬åˆ—è¡¨æ¨¡å¼ æ›¸æ¶åˆ†é¡\næ›¸æœ¬åˆ†é¡\né é¢ç« ç¯€åˆ†é¡\næœ€ä¸»è¦æ˜¯å› ç‚ºæœ‰ä»¥ä¸Šå¹¾å€‹ä¸åŒçš„åˆ†å±¤æ¶æ§‹ï¼Œåœ¨è³‡æ–™æ•´ç†ä¸Šæœƒæ›´æ–¹ä¾¿ã€æ›´å¥½å½™æ•´ï¼Œå¯ä»¥è‡ªè¨‚æ›¸æ¶ä»¥åŠæ›¸æœ¬ã€é é¢æˆ–æ˜¯ç« ç¯€çš„å°é¢ä»¥åŠå…§å®¹ã€‚\nå¼·å¤§çš„æœå°‹åŠŸèƒ½ æœå°‹åŠŸèƒ½\nç•¶æˆ‘å€‘çš„ç­†è¨˜å…§å®¹è¶Šä¾†è¶Šå¤šï¼Œé›–ç„¶æœ‰ä¸Šé¢æåˆ°çš„åˆ†é¡æ¨¡å¼ï¼Œæƒ³è¦æ‰¾åˆ°å…§å®¹é‚„æ˜¯éœ€è¦èŠ±ä¸€æ®µæ™‚é–“ï¼Œä½† Bookstack æœ‰å¼·å¤§çš„æœå°‹åŠŸèƒ½ï¼Œå¯ä»¥é‡å°æ›¸æ¶ã€æ›¸æœ¬ã€ç« ç¯€æˆ–æ˜¯æ›¸é¢å€‹åˆ¥æœå°‹ï¼Œå¯ä»¥åˆ©ç”¨æ™‚é–“ã€æ¨™ç±¤ã€æ¨™é¡Œæˆ–æ˜¯å…§å®¹ä¾†å¿«é€Ÿæ‰¾åˆ°æƒ³è¦çš„å…§å®¹ã€‚\nç•«åœ–åŠŸèƒ½ åœ¨è¨è«–ç³»çµ±æˆ–æ˜¯ç¨‹å¼çš„æ¶æ§‹ï¼Œæœ€å¥½çš„æ–¹å¼å°±æ˜¯ç”¨ç•«åœ–çš„ä¾†è¡¨ç¤ºã€‚åœ¨ä»¥å¾€éƒ½æ˜¯ä½¿ç”¨ Draw.io ä¾†ç•«åœ–ï¼Œç•¶ç•«å®Œåœ–å¾Œéœ€è¦åŒ¯å‡ºç•«å¥½çš„åœ–ä»¥å¤–ï¼Œå¦‚æœæ€•ç•«åœ–çš„åŸæª”æ¶ˆå¤±ï¼Œé‚„éœ€è¦å†å¦å¤–ä¸‹è¼‰åŸæª”ä¾†ä¿ç•™ï¼Œå¾ˆä¸æ–¹ä¾¿ï¼Œåˆæ€•å¿˜è¨˜ä¸‹è¼‰ï¼Œè€Œ Bookstack å…§å»ºå¯ç›´æ¥ç·¨è¼¯çš„åŠŸèƒ½ï¼Œç•¶ç•«å®Œåœ–å¾Œæœ‰å•é¡Œï¼Œå¯ä»¥ç›´æ¥é»æ“Šåœ–ç‰‡ä¾†ç·¨è¼¯ï¼Œè€Œé€™äº›åŠŸèƒ½é‚„æœƒæ­é…å…§å»ºçš„ç‰ˆæ§ï¼Œè‹¥æœ‰å•é¡Œé‚„å¯ä»¥é‚„åŸåˆ°æ­£ç¢ºçš„åœ–ç‰‡ç‰ˆæœ¬ã€‚\nç•«åœ–åŠŸèƒ½","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"BookStack ç°¡ä»‹ï¼šhttps://docs.ossii.com.tw/books/bookstack/page/bookstack\nBookStack Installationï¼šhttps://www.bookstackapp.com/docs/admin/installation/","å®‰è£èªªæ˜#å®‰è£èªªæ˜":"é‚£ç°¡å–®èªªæ˜ç‚ºä»€éº¼æœƒé¸æ“‡ Bookstack æˆ‘å€‘å°±ä¾†å®‰è£å®ƒï¼Œé€™é‚Šæœ‰ä½¿ç”¨ K8s + docker ä¾†æ¸¬è©¦å®‰è£ï¼Œé‚£æˆ‘å€‘å°±ä¸€èµ·ä¾†çœ‹ç¨‹å¼ç¢¼å§ï¼Œç¨‹å¼ç¢¼æ”¾åœ¨é€™ ğŸ‘ˆï¼š\nK8s namespace.yamlapiVersion: v1 kind: Namespace metadata: name: bookstack æˆ‘ç¿’æ…£æœƒå°‡ä¸åŒçš„æœå‹™åˆ‡ namespace ä¾†éƒ¨ç½²ï¼Œå¤§å®¶å¯ä»¥ä¾ç…§ç¿’æ…£ä¾†ä½¿ç”¨ï¼Œä¸‹æ–¹çš„ yaml éƒ½æ˜¯å»ºåœ¨æ­¤ namespace ä¸Šã€‚\ndeployment.yamlapiVersion: apps/v1 kind: Deployment metadata: name: bookstack namespace: bookstack labels: app: bookstack spec: replicas: 1 selector: matchLabels: app: bookstack template: metadata: labels: app: bookstack spec: containers: - name: bookstack image: linuxserver/bookstack ports: - name: http containerPort: 80 env: - name: DB_DATABASE value: bookstack - name: DB_HOST value: \u003c\u003cæ›´æ›æ­¤è™•\u003e\u003e - name: DB_PORT value: \"3306\" - name: DB_PASSWORD value: \u003c\u003cæ›´æ›æ­¤è™•\u003e\u003e - name: DB_USERNAME value: \u003c\u003cæ›´æ›æ­¤è™•\u003e\u003e - name: MAIL_USERNAME value: example@test.com - name: MAIL_PASSWORD value: mailpass - name: MAIL_HOST value: smtp.server.com - name: MAIL_PORT value: \"465\" - name: MAIL_ENCRYPTION value: SSL - name: MAIL_DRIVER value: smtp - name: MAIL_FROM value: no-reply@test.com - name: APP_URL value: https://\u003c\u003cæ›´æ›æ­¤è™•\u003e\u003e - name: APP_LANG value: zh_TW - name: APP_TIMEZONE value: Asia/Taipei resources: limits: cpu: \"0.5\" memory: \"512Mi\" å¿…è¦æ›´æ›çš„åƒæ•¸æœ‰æ¨™ç¤º Â«æ›´æ›æ­¤è™•Â»ï¼Œå…¶é¤˜å¯ä»¥ä¾ç…§å„çµ„ç¹”ä¾†è‡ªè¡Œé…ç½®ï¼ŒBookstack æœƒå°‡å…§å®¹å­˜åœ¨ dbï¼Œåœ–ç‰‡ç­‰å­˜åœ¨ pod ä¸­ï¼Œéœ€è¦æ°¸ä¹…ä¿å­˜è«‹ä½¿ç”¨ pvc + pv æˆ–æ˜¯å¦å¤–æ› nasã€‚\nsvc.yamlapiVersion: v1 kind: Service metadata: name: bookstack namespace: bookstack spec: type: NodePort selector: app: bookstack ports: - name: http protocol: TCP port: 80 targetPort: 80 ingress.yamlapiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: bookstack-ingress namespace: bookstack annotations: kubernetes.io/ingress.class: nginx service.beta.kubernetes.io/do-loadbalancer-enable-proxy-protocol: \"true\" spec: rules: - host: \u003c\u003cæ›´æ›æ­¤è™•\u003e\u003e http: paths: - path: / pathType: Prefix backend: service: name: bookstack port: number: 80 æœ€å¾Œé€é ingress çš„ domain å»è¨ªå• svc \u003e pod ä¸Šï¼Œå°±å®Œæˆéƒ¨ç½²æ‹‰ï½ç¬¬ä¸€æ¬¡ç™»å…¥è¦ä½¿ç”¨é è¨­å¸³è™ŸåŠå¯†ç¢¼ admin@admin.com/password\ndocker docker-compose.yamlversion: \"3.8\" services: bookstack: image: lscr.io/linuxserver/bookstack container_name: bookstack environment: - PUID=\u003c\u003cæ›´æ›æ­¤è™•\u003e\u003e - PGID=\u003c\u003cæ›´æ›æ­¤è™•\u003e\u003e - DB_HOST=bookstack_db - DB_PORT=3306 - DB_USER=bookstack - DB_PASS=bookstack - DB_DATABASE=bookstackapp - APP_LANG=zh_TW - APP_TIMEZONE=Asia/Taipei - APP_URL=\u003c\u003cæ›´æ›æ­¤è™•\u003e\u003e - GOOGLE_APP_ID=\u003c\u003cæ›´æ›æ­¤è™•\u003e\u003e - GOOGLE_APP_SECRET=\u003c\u003cæ›´æ›æ­¤è™•\u003e\u003e volumes: - /bookstack/config:/config ports: - 80:80 restart: unless-stopped depends_on: - bookstack_db bookstack_db: image: lscr.io/linuxserver/mariadb container_name: bookstack_db environment: - PUID=\u003c\u003cæ›´æ›æ­¤è™•\u003e\u003e - PGID=\u003c\u003cæ›´æ›æ­¤è™•\u003e\u003e - MYSQL_ROOT_PASSWORD=bookstack - TZ=Asia/Taipei - MYSQL_DATABASE=bookstackapp - MYSQL_USER=bookstack - MYSQL_PASSWORD=bookstack volumes: - /bookstack/config:/config restart: unless-stopped docker çš„éƒ¨åˆ†å°±æ›´ç°¡å–®äº†ï¼Œä¸€æ¨£æ˜¯æŠŠ Â«æ›´æ›æ­¤è™•Â» æ›æˆå°æ‡‰çš„å…§å®¹å³å¯ï¼Œenv çš„éƒ¨åˆ†å¯ä»¥åƒè€ƒå®˜æ–¹æ–‡ä»¶ï¼Œé€™é‚Šæ¯”è¼ƒç‰¹åˆ¥çš„æ˜¯æˆ‘å€‘æœ‰å¤šä½¿ç”¨ Google ä¾† Oauth ç™»å…¥ï¼ŒBookstack æ”¯æ´å¤šç¨®çš„ Oauth ç™»å…¥æ–¹å¼ï¼Œå¯ä»¥åƒè€ƒ Third Party Authenticationã€‚\næ¶è¨­å¥½ Bookstack å°±å¯ä»¥é–‹å§‹å¯«éƒ¨é–€æˆ–æ˜¯çµ„ç¹”å…§çš„ç­†è¨˜æ‹‰ï½ å¦‚æœæœ‰é–‹æ”¾å¤–ç¶²é€£ç·šï¼Œè¦è¨˜å¾—ä¿®æ”¹é è¨­çš„ç®¡ç†å“¡å¸³è™Ÿï¼Œä»¥åŠç”¨ç®¡ç†å“¡å¸³è™Ÿç™»å…¥ï¼Œåˆ°åŠŸèƒ½èˆ‡å®‰å…¨çš„å…¬é–‹å­˜å–çµ¦å–æ¶ˆï¼Œé€™æ¨£å°±å¿…é ˆè¦ç™»å…¥æ‰å¯ä»¥ç€è¦½ç­†è¨˜äº†ï¼é‚£å°±äº¤çµ¦å¤§å®¶è‡ªå·±å»ç©é€™å€‹å¥½ç”¨çš„ç­†è¨˜å·¥å…·å›‰ï½ï½ ğŸ˜\nåŠŸèƒ½èˆ‡å®‰å…¨è¨­å®š"},"title":"Bookstack é–‹æºçŸ¥è­˜åº«ç­†è¨˜å¹³å°å®‰è£ (K8s + docker)"},"/blog/other/linux-clear-swap/":{"data":{"":"ä»Šå¤©åœ¨å·¥ä½œæ™‚ï¼Œé‡åˆ°æ©Ÿå™¨çš„ Swap è¶…éé è­¦å€¼ï¼Œéœ€è¦æ‰‹å‹•å»æ¸…é™¤ Swapï¼Œé‚£å‰›å¥½å°±ç”±é€™æ¬¡æ©Ÿæœƒä¾†ä»‹ç´¹è¦å¦‚ä½•æ¸…é™¤ Linux æ©Ÿå™¨ä¸Šçš„ Swapï¼Œä»¥åŠæŸ¥è©¢ Linux è¨˜æ†¶é«”çš„ä½¿ç”¨ç‹€æ³ï¼","buff-è·Ÿ-cache-ä»¥åŠ-swap-çš„æ¯”è¼ƒ#buff è·Ÿ cache ä»¥åŠ Swap çš„æ¯”è¼ƒ":" æ¯”è¼ƒ buff cache Swap åŠŸç”¨ è¨˜æ†¶é«”å¯«å®Œè³‡æ–™æœƒå…ˆæš«å­˜èµ·ä¾†ï¼Œç­‰ä¹‹å¾Œå†å®šæœŸå°‡è³‡æ–™å­˜åˆ°ç¡¬ç¢Ÿä¸Š è¨˜æ†¶é«”è®€å®Œè³‡æ–™å¾Œæš«å­˜èµ·ä¾†ï¼Œå¯ä»¥åœ¨ä¸‹æ­¤æŸ¥è©¢æ™‚å¿«é€Ÿçš„é¡¯ç¤º ç¡¬ç¢Ÿçš„äº¤æ›åˆ†å€ï¼Œç•¶ buff/cache è¨˜æ†¶é«”å·²ç¶“ç”¨å®Œå¾Œï¼Œåˆæœ‰æ–°çš„è®€å¯«è«‹æ±‚æ™‚ï¼Œå°±æœƒå°‡éƒ¨ä»½å…§å­˜çš„è³‡æ–™å­˜å…¥ç¡¬ç¢Ÿï¼Œä¹Ÿå°±æ˜¯æŠŠå…§å­˜çš„éƒ¨åˆ†ç©ºé–“ç•¶æˆè™›æ“¬çš„è¨˜æ†¶é«”ä¾†åšä½¿ç”¨ ","free-èˆ‡-available-çš„æ¯”è¼ƒ#free èˆ‡ available çš„æ¯”è¼ƒ":" freeï¼šæ˜¯çœŸæ­£å°šæœªè¢«ä½¿ç”¨çš„å¯¦é«”è¨˜æ†¶é«”æ•¸é‡ availableï¼šæ˜¯æ‡‰ç”¨ç¨‹å¼èªç‚ºå¯ç”¨çš„è¨˜æ†¶é«”æ•¸é‡ï¼Œå¯ä»¥ç†è§£æˆ available = free + buff/cache æ¥ä¸‹ä¾†æˆ‘å€‘å°±è¦é€²å…¥ä¸»é¡Œï¼Œå¦‚ä½•æ¸…é™¤ Swap ï¼š","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"Linux å…§å­˜ã€Swapã€Cacheã€Buffer è©³ç´°è§£æï¼šhttps://os.51cto.com/article/636622.html\nlinux free å‘½ä»¤ä¸‹ free/available å€åˆ¥ï¼šhttps://www.796t.com/content/1545715382.html\né‡‹æ”¾ linux çš„ swap è¨˜æ†¶é«”ï¼šhttps://www.796t.com/article.php?id=207781","å¦‚ä½•æŸ¥è©¢-linux-è¨˜æ†¶é«”#å¦‚ä½•æŸ¥è©¢ Linux è¨˜æ†¶é«”":"åœ¨è¬› Swap ä¹‹å‰ï¼Œæˆ‘å€‘å…ˆä¾†èªªä¸€ä¸‹æ€éº¼æŸ¥è©¢ Linux è¨˜æ†¶é«”ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤ä¾†é¡¯ç¤ºï¼š\nfree ä¸‹å®Œå¾Œï¼Œæ ¼å¼æœƒé•·é€™æ¨£ï¼š\ntotal used free shared buff/cache available Mem: 32765564 8499252 1825132 1857720 22441180 19693100 Swap: 16776188 0 16776188 ä½†é€™æ¨£å­ä¸æ˜¯å¾ˆå¥½è§€å¯Ÿï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥åŠ ä¸Š -h ä¾†é¡¯ç¤ºå¤§å°çš„å–®ä½ï¼Œè®“æˆ‘æ›´æ¸…æ¥šçš„çŸ¥é“æ¯ä¸€å€‹çš„å¤§å°ï¼š\ntotal used free shared buff/cache available Mem: 31G 8.1G 1.6G 1.8G 21G 18G Swap: 15G 0B 15G é‚£æˆ‘å€‘æ¥è‘—å…ˆä¾†èªªèªªä½¿ç”¨ free æŸ¥è©¢å¾Œï¼Œæ‰€æœ‰æ¬„ä½çš„æ„æ€å§ï¼\nfree ç¬¬ä¸€åˆ— Memï¼šè¨˜æ†¶é«”çš„ä½¿ç”¨è³‡è¨Š Swapï¼šäº¤æ›ç©ºé–“çš„ä½¿ç”¨è³‡è¨Š free ç¬¬ä¸€è¡Œ totalï¼šç³»çµ±ç¸½å…±çš„å¯ç”¨å¯¦é«”è¨˜æ†¶é«”å¤§å° usedï¼šå·²è¢«ä½¿ç”¨çš„å¯¦é«”è¨˜æ†¶é«”å¤§å° freeï¼šé‚„å‰©ä¸‹å¤šå°‘å¯ç”¨çš„å¯¦é«”è¨˜æ†¶é«” sharedï¼šè¢«å…±äº«ä½¿ç”¨çš„å¯¦é«”è¨˜æ†¶é«”å¤§å° buff/cacheï¼šè¢« buffer å’Œ cache ä½¿ç”¨çš„å¯¦é«”è¨˜æ†¶é«”å¤§å° availableï¼šå¯è¢« æ‡‰ç”¨ç¨‹å¼ ä½¿ç”¨çš„å¯¦é«”è¨˜æ†¶é«”å¤§å° ","æ¸…é™¤-swap#æ¸…é™¤ Swap":"é¦–å…ˆç¬¬ä¸€æ­¥æˆ‘å€‘å…ˆä½¿ç”¨ free ä¾†æŸ¥çœ‹ç›®å‰çš„ Swap ä½¿ç”¨ç‹€æ…‹ï¼š\nSwap ä½¿ç”¨ (å°šæœªæ¸…é™¤)\nå¯ä»¥çœ‹åˆ°æˆ‘å€‘çš„ Swap used æ˜¯ 797Mï¼Œæˆ‘å€‘è¨­å®šå®ƒä¸èƒ½è¶…é 5%ï¼Œè¶…éå°±æœƒé€šçŸ¥ï¼Œæ‰€ä»¥æˆ‘å€‘è¦æŠŠå®ƒæ‰‹å‹•æ¸…é™¤ã€‚\nå…ˆæª¢æŸ¥è¨˜æ†¶é«” available ç‚ºä»€éº¼è¦å…ˆæª¢æŸ¥ availableï¼Œæ˜¯å› ç‚ºä¸€é–‹å§‹æœƒä½¿ç”¨åˆ° Swap çš„åŸå› å°±æ˜¯å› ç‚ºæ‡‰ç”¨ç¨‹å¼çš„å¯ç”¨è¨˜æ†¶é«”ç©ºé–“ä¸è¶³ï¼Œæ‰€ä»¥ç¾åœ¨è¦æ¸…é™¤ Swap æ¢ä»¶å°±æ˜¯ï¼šMem çš„ available å¿…é ˆè¦å¤§æ–¼ Swap çš„ used æ‰å¯ä»¥ï¼Œå¦å‰‡æœƒå°è‡´è¨˜æ†¶é«”çˆ†ç‚¸ ğŸ’¥\nå°‡è¨˜æ†¶é«”è³‡æ–™æš«å­˜åˆ°ç¡¬ç¢Ÿ æ¥ä¸‹ä¾†å› ç‚ºæˆ‘å€‘è¦æ¸…é™¤ Swap ï¼Œæ‰€ä»¥ä¸èƒ½è®“è³‡æ–™åœ¨å¯«å…¥è¨˜æ†¶é«”ä¸­ï¼Œæ‰€ä»¥æˆ‘å€‘å…ˆä½¿ç”¨ä¸‹æ–¹æŒ‡ä»¤ï¼Œè®“è¨˜æ†¶é«”çš„è³‡æ–™æš«å­˜åˆ°ç¡¬ç¢Ÿã€‚\nsync é€™å€‹æŒ‡ä»¤å°±æ˜¯å°‡å­˜æ–¼æš«å­˜çš„è³‡æ–™å¼·åˆ¶å¯«å…¥åˆ°ç¡¬ç¢Ÿä¸­ï¼Œä¾†ç¢ºä¿æ¸…é™¤æ™‚å°è‡´è³‡æ–™éºå¤±ã€‚\né—œé–‰ Swapï¼Œå†æ‰“é–‹ Swap æ²’éŒ¯ï¼ŒSwap çš„æ¸…é™¤å°±æ˜¯æŠŠä»–å…ˆé—œæ‰ï¼Œå†é‡æ–°æ‰“é–‹ï¼Œä»–å°±æœƒè‡ªå·±æ¸…é™¤ Swap çš„è³‡æ–™äº†ï¼ä½¿ç”¨çš„æŒ‡ä»¤å¦‚ä¸‹ï¼š(æ¸…é™¤éç¨‹éœ€è¦ç¨ç­‰ï¼Œè®“ä»–é€²è¡Œåˆªé™¤å‹•ä½œ)\nswapoff -a \u0026\u0026 swapon -a ç¢ºèªéƒ½æ²’å•é¡Œå¾Œï¼Œæˆ‘å€‘å°±ä½¿ç”¨ free ä¾†é‡æ–°æŸ¥çœ‹è¨˜æ†¶é«”ç‹€æ…‹ï¼š\nSwap ä½¿ç”¨ (å·²æ¸…é™¤)\nå¯ä»¥çœ‹åˆ°æˆ‘å€‘æ¸…é™¤å®Œ Swap å¾Œï¼ŒSwap çš„ used å·²ç¶“å¾ 797M è®Šæˆ 0Bã€‚\nå¦‚æœç¢°åˆ°åŸ·è¡Œ swapoff -a \u0026\u0026 swapon -a å‡ºç¾ swapoff: Not superuser.ï¼Œåªéœ€è¦åœ¨æŒ‡ä»¤å‰é¢åŠ ä¸Š sudo å°±å¯ä»¥äº†ï¼ "},"title":"æ¸…é™¤ Linux æ©Ÿå™¨ä¸Šçš„ Swap (Buffã€Cacheã€Swap æ¯”è¼ƒ)"},"/blog/other/linux-command/":{"data":{"":"å› ç‚ºæœ€è¿‘åœ¨ç®¡ç†æ©Ÿå™¨æ™‚ï¼Œå¸¸å¸¸æœƒä½¿ç”¨å„å¼å„æ¨£çš„æŒ‡ä»¤ä¾†å”åŠ©ç®¡ç†ï¼Œæ‰€ä»¥æŠŠå¸¸ç”¨çš„æŒ‡ä»¤ä¾ç…§ä¸åŒé¡åˆ¥æ•´ç†åœ¨åº•ä¸‹å‘¦ ğŸ˜˜","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"3 ç¨®æª¢æŸ¥é ç«¯åŸ è™Ÿæ˜¯å¦é–‹å•Ÿçš„æ–¹æ³•ï¼šhttps://www.ltsplus.com/linux/3-ways-check-remote-server-open-port","ç³»çµ±é¡#ç³»çµ±é¡":"é¡¯ç¤ºç•¶å‰é€²ç¨‹ç‹€æ…‹ ps ps [åƒæ•¸] -A åˆ—å‡ºæ‰€æœ‰çš„é€²ç¨‹ -w å¯ä»¥åŠ å¯¬é¡¯ç¤ºè¼ƒå¤šçš„è¨Šæ¯ -au é¡¯ç¤ºæ›´è©³ç´°çš„è¨Šæ¯ -aux é¡¯ç¤ºæ‰€æœ‰åŒ…å«å…¶ä»–ç”¨æˆ¶çš„é€²ç¨‹ au(x) è¼¸å‡ºçš„æ ¼å¼ï¼š\nUSER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND USERï¼šè¡Œç¨‹çš„æ“æœ‰è€… PIDï¼špid %CPUï¼šä½”ç”¨çš„ CPU ä½¿ç”¨ç‡ %MEMï¼šä½”ç”¨çš„è¨˜æ†¶é«”ä½¿ç”¨ç‡ VSZï¼šä½”ç”¨çš„è™›æ“¬è¨˜æ†¶é«”å¤§å° RSSï¼šä½”ç”¨çš„è¨˜æ†¶é«”å¤§å° TTYï¼šçµ‚ç«¯çš„æ¬¡è¦è£ç½®è™Ÿç¢¼ STATï¼šè©²è¡Œç¨‹çš„ç‹€æ…‹ï¼š Dï¼šç„¡æ³•ä¸­æ–·çš„ä¼‘çœ ç‹€æ…‹ (é€šå¸¸éƒ½æ˜¯ IO é€²ç¨‹) Rï¼šæ­£åœ¨åŸ·è¡Œä¸­ Sï¼šéœæ­¢ç‹€æ…‹ Tï¼šæš«åœåŸ·è¡Œ Zï¼šä¸å­˜åœ¨ä½†æš«æ™‚ç„¡æ³•æ¶ˆé™¤ Wï¼šæ²’æœ‰è¶³å¤ çš„è¨˜æ†¶é«”å¯ä»¥åˆ†é… \u003cï¼šé«˜å„ªå…ˆåºçš„é€²ç¨‹ Nï¼šä½å„ªå…ˆåºçš„é€²ç¨‹ STARTï¼šé€²ç¨‹é–‹å§‹æ™‚é–“ TIMEï¼šåŸ·è¡Œçš„æ™‚é–“ COMMANDï¼šæ‰€åŸ·è¡Œçš„æŒ‡ä»¤ åˆªé™¤åŸ·è¡Œä¸­çš„é€²ç¨‹ kill kill [-s \u003cè¨Šæ¯åç¨±æˆ–ç·¨è™Ÿ\u003e] [ç¨‹åº] or [-l \u003cè¨Šæ¯ç·¨è™Ÿ\u003e] -l \u003cè¨Šæ¯ç·¨è™Ÿ\u003eï¼šè‹¥ä¸åŠ  \u003cè¨Šæ¯ç·¨è™Ÿ\u003eé¸é …ï¼Œ-l æœƒåˆ—å‡ºå…¨éƒ¨çš„è¨Šæ¯åç¨± -s \u003cè¨Šæ¯åç¨±æˆ–ç·¨è™Ÿ\u003eï¼šæŒ‡å®šè¦é€å‡ºçš„è¨Šæ¯ æœ€å¸¸ç”¨çš„è¨Šæ¯æ˜¯\n1 (HUP)ï¼šé‡æ–°åŠ è¼‰é€²ç¨‹ 9 (KILL)ï¼šåˆªé™¤ä¸€å€‹é€²ç¨‹ 15 (TERM)ï¼šæ­£å¸¸åœæ­¢ä¸€å€‹é€²ç¨‹ é¡¯ç¤ºç³»çµ±é–‹æ©Ÿç´€éŒ„ who who [åƒæ•¸] -bï¼šæŸ¥çœ‹æœ€å¾Œä¸€æ¬¡(ä¸Šæ¬¡)ç³»çµ±å•Ÿå‹•æ™‚é–“ -rï¼šæŸ¥çœ‹æœ€å¾Œä¸€æ¬¡(ä¸Šæ¬¡)ç³»çµ±å•Ÿå‹•æ™‚é–“åŠé‹è¡Œç´šåˆ¥ top up å¾Œé¢ä»£è¡¨ç³»çµ±åˆ°ç›®å‰é‹è¡Œçš„æ™‚é–“ï¼Œæ‰€ä»¥åæ¨å°±å¯ä»¥çŸ¥é“å•Ÿå‹•æ™‚é–“\nuptime uptime 17:44 up 2 days, 8:48, 3 users, load averages: 3.48 3.37 3.56 ä¸€æ¨£æœƒé¡¯ç¤ºåˆ°ç›®å‰å·²ç¶“å•Ÿå‹•å¤šä¹…ï¼Œè·Ÿæ˜¯å¹¾é»å•Ÿå‹•ç­‰è³‡è¨Š","ç¶²è·¯é¡#ç¶²è·¯é¡":"æŸ¥è©¢é ç«¯ Port æ˜¯å¦é–‹æ”¾ nc (netcat) nc (netcat)ï¼Œå¯ä»¥è®€å–ç¶“é TCP åŠ UDP çš„ç¶²è·¯é€£ç·šè³‡æ–™ï¼Œæ˜¯ä¸€å¥—å¾ˆå¯¦ç”¨çš„ç¶²è·¯é™¤éŒ¯å·¥å…·ã€‚\nå®‰è£æŒ‡ä»¤ï¼š\nyum install nc æª¢æŸ¥ Port æ˜¯å¦æœ‰é–‹æ”¾ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹æŒ‡ä»¤ä¾†æŸ¥è©¢ï¼š\nnc -zvw3 \u003cIP:Port\u003e -z åªé€²è¡Œæƒæï¼Œä¸é€²è¡Œä»»ä½•çš„è³‡æ–™å‚³è¼¸\n-v é¡¯ç¤ºæƒæè¨Šæ¯\n-w3 ç­‰å¾… 3 ç§’\nå¦‚æœ Port æœ‰é–‹æ”¾ï¼Œæœƒå›å‚³ä»¥ä¸‹å…§å®¹ï¼š\nNcat: Version 7.50 ( https://nmap.org/ncat ) Ncat: Connected to \u003cIP:Port\u003e. Ncat: 0 bytes sent, 0 bytes received in 0.01 seconds. å¦‚æœæ²’æœ‰é–‹æ”¾ï¼Œæœƒå›å‚³ä»¥ä¸‹å…§å®¹ï¼š\nNcat: No route to host. nmap nmap (Network Mapper) æ˜¯å¦ä¸€å€‹å¯ä»¥æª¢æŸ¥ Port çš„å·¥å…·ï¼Œå®‰è£èªæ³•æ˜¯é€™æ¨£ï¼š\nyum install nmap æª¢æŸ¥ Port æ˜¯å¦æœ‰é–‹æ”¾ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹æŒ‡ä»¤ä¾†æŸ¥è©¢ï¼š\nnmap \u003cIP\u003e -p \u003cPort\u003e å¦‚æœ Port æœ‰é–‹æ”¾ï¼Œæœƒå›å‚³ä»¥ä¸‹å…§å®¹ï¼š\nStarting Nmap 7.92 ( https://nmap.org ) at 2022-06-17 16:06 CST Nmap scan report for\u003cDomain\u003e (\u003cIP\u003e) Host is up (0.0039s latency). PORT STATE SERVICE 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 1.09 seconds å¦‚æœæ²’æœ‰é–‹æ”¾ï¼Œæœƒå›å‚³ä»¥ä¸‹å…§å®¹ï¼š\nStarting Nmap 7.92 ( https://nmap.org ) at 2022-06-17 16:06 CST Nmap scan report for\u003cDomain\u003e (\u003cIP\u003e) Host is up (0.0039s latency). PORT STATE SERVICE 80/tcp filtered http Nmap done: 1 IP address (1 host up) scanned in 1.09 seconds Telnet Telnet ä¹Ÿæ˜¯ä¸€å€‹å¯ä»¥æª¢æŸ¥ Port çš„å·¥å…·ï¼Œå®‰è£èªæ³•æ˜¯é€™æ¨£ï¼š\nyum install telnet æª¢æŸ¥ Port æ˜¯å¦æœ‰é–‹æ”¾ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹æŒ‡ä»¤ä¾†æŸ¥è©¢ï¼š\ntelnet \u003cIP\u003e \u003cPort\u003e å¦‚æœ Port æœ‰é–‹æ”¾ï¼Œæœƒå›å‚³ä»¥ä¸‹å…§å®¹ï¼š\nTrying \u003cIP\u003eâ€¦ Connected to \u003cIP\u003e. Escape character is â€˜^]â€™. ^CConnection closed by foreign host. å¦‚æœæ²’æœ‰é–‹æ”¾ï¼Œæœƒå›å‚³ä»¥ä¸‹å…§å®¹ï¼š\nTrying \u003cIP\u003eâ€¦ telnet: Unable to connect to remote host: Connection refused "},"title":"Linux å¸¸ç”¨æŒ‡ä»¤"},"/blog/other/snyk/":{"data":{"":"å‰å¹¾å¤©æœ‰æ©Ÿæœƒå¯ä»¥å»åƒåŠ  DevOpsDays Taipei 2022 æ´»å‹•ï¼Œè½åˆ°äº†ä¸€é–€æœ‰é—œæ–¼å¦‚ä½•å°‡ Security åŠ å…¥ DevOps - GitLab CI/CD with Snyk çš„è¬›åº§ï¼Œè¦ºå¾—è »æœ‰è¶£çš„ï¼Œæƒ³èªªé †ä¾¿ç´€éŒ„ä¸€ä¸‹é€™å¹¾å¤©å»è½çš„å…§å®¹ï¼Œæ–‡ç« åº•ä¸‹æœ‰é™„ä¸Šæœ¬æ¬¡å¤§æœƒçš„å…±ç­†ä»¥åŠè©²è¬›è€…æ–¼è‡ªå·±éƒ¨è½æ ¼æ‰€ç™¼çš„æ–‡ç« ï¼Œæ­¡è¿å¤§å®¶å…ˆè¡ŒæŸ¥çœ‹æ­ ğŸ˜†\nDevOps åœ–ç‰‡ (é†«é™¢ DevOps å¦‚ä½•è½åœ°(1) â”€ DevOps èˆ‡é†«é™¢)\næˆ‘å€‘å¹³å¸¸ç†ŸçŸ¥çš„ DevOps æ–‡åŒ–æ‡‰è©²æ˜¯åƒä¸Šé¢é€™å¼µåœ–ä¸€æ¨£ï¼Œå¯ä»¥é€éè‡ªå‹•åŒ–ã€Œè»Ÿé«”äº¤ä»˜ã€å’Œã€Œæ¶æ§‹è®Šæ›´ã€çš„æµç¨‹ï¼Œä¾†ä½¿å¾—æ§‹å»ºã€æ¸¬è©¦ã€ç™¼å¸ƒè»Ÿé«”èƒ½å¤ æ›´åŠ åœ°å¿«æ·ã€é »ç¹å’Œå¯é ã€‚\né€šå¸¸åœ¨ Development è·Ÿ Operations ä¹‹å¤–é‚„æœ‰ä¸€å€‹å°ˆé–€è² è²¬æª¢æŸ¥ç¨‹å¼æœ‰ç„¡æ¼æ´æˆ–æ˜¯å®‰å…¨æ€§å•é¡Œçš„å–®ä½ï¼Œé‚£æˆ‘å€‘è©¦æƒ³ä¸€ä¸‹ï¼Œå¦‚æœåœ¨ Dev æˆ–æ˜¯ Ops ä¸­é–“å…ˆåŠ ä¸Šäº†æª¢æŸ¥å®‰å…¨çš„æ­¥é©Ÿï¼Œæ˜¯ä¸æ˜¯å¯ä»¥è®“æ•´é«”æµç¨‹æ•ˆç‡æ›´åŠ æå‡å‘¢ï¼ï¼Ÿ å¯ä»¥å…å»ç¨‹å¼å¯«å®Œæ‰ç™¼ç¾æœ‰å®‰å…¨æ€§å•é¡Œçš„æ¼æ´ï¼Œéœ€è¦é‡æ–°ä¿®æ”¹ï¼Œè€Œæ˜¯åœ¨éƒ¨ç½²å‰ï¼Œæˆ–æ˜¯ç¨‹å¼é–‹ç™¼ä¸­å°±å…ˆè¢«æª¢æŸ¥å‡ºä¾†ã€‚\nå°æ–¼è³‡è¨Šå®‰å…¨æ–¹é¢ï¼Œé–‹ç™¼äººå“¡é€²è¡Œé–‹ç™¼æ™‚ï¼Œå¿…é ˆé—œæ³¨ç›®å‰çš„å¯«æ³•æ˜¯ä¸æ˜¯å®‰å…¨çš„ï¼Œé™¤äº†é–‹ç™¼äººå“¡çš„ç¨‹å¼ç¢¼å¤–ï¼Œé‚„è¦æ³¨æ„ä½¿ç”¨çš„é–‹æºç¨‹å¼æˆ–æ˜¯å¥—ä»¶æ˜¯ä¸æ˜¯å·²ç¶“æœ‰è¢«æƒå‡ºæ¼æ´ï¼ŒåŠ ä¸Šç¾åœ¨è¶Šä¾†è¶Šå¤šäººä½¿ç”¨å®¹å™¨åŒ–ï¼Œå°æ–¼ Container Images è£¡é¢æ‰€åŒ…å«çš„å¥—ä»¶å®‰å…¨ä¹Ÿæ˜¯ä¸€å¤§å•é¡Œã€‚\næ‰€ä»¥å–®ç´”çš„è‡ªå‹•åŒ–æ•´åˆèˆ‡éƒ¨ç½²å·²ç¶“ä¸èƒ½æ»¿è¶³éœ€æ±‚ï¼Œå°±åƒä¸‹åœ–ä¸€æ¨£ï¼Œé–‹å§‹æœ‰äº† DevSecOps é€™å€‹è©ç”¢ç”Ÿï¼Œåœ¨ DevOps çš„ CI/CD æµç¨‹ä¸­åŠ å…¥è³‡å®‰è§£æ±ºæ–¹æ¡ˆï¼Œè—‰ç”±è³‡å®‰è§£æ±ºæ–¹æ¡ˆä¾†æ¸›å°‘é–‹ç™¼äººå“¡å»æª¢æŸ¥ç¨‹å¼æ¼æ´çš„æ™‚é–“ï¼Œä¹Ÿè®“ DevOps å¿«é€Ÿè¿­ä»£æ›´åŠ çš„å®Œæ•´ã€‚\nDevSecOps åœ–ç‰‡ (Apps Built Better: Why DevSecOps is Your Security Teamâ€™s Silver Bullet)","snyk#Snyk":"é‚£æˆ‘å€‘é€™æ¬¡è¦ä½¿ç”¨çš„å·¥å…·æ˜¯ - Snykï¼Œæˆ‘å…ˆç°¡å–®ä»‹ç´¹ä¸€ä¸‹é€™å€‹å…¬å¸ä»¥åŠå·¥å…·ï¼Œå®ƒæ˜¯ä½æ–¼æ³¢å£«é “çš„ç¶²çµ¡å®‰å…¨å…¬å¸ï¼Œå°ˆé–€å¾äº‹é›²è¨ˆç®—ï¼Œæä¾›å¢è¼•é¬†é›†æˆï¼Œå¯ä»¥å°‡å®‰å…¨æƒæçµåˆåˆ° IDEã€Repositoryã€CI/CD ç­‰ï¼Œé€£çºŒæƒæä»¥åŠä¸€éµä¿®å¾©ç­‰åŠŸèƒ½ã€‚ä»–æœ¬èº«æ˜¯ä¸€å€‹ SaaS çš„æœå‹™ï¼Œæ‰€ä»¥éœ€è¦åˆ°å®˜ç¶²è¨»å†Šä¸€å€‹å¸³è™Ÿæ‰èƒ½ä½¿ç”¨ï¼Œä¹Ÿæ”¯æ´ä¸åŒçš„ SSO ç™»å…¥ï¼Œè©³ç´°å¯ä»¥åƒè€ƒè¨»å†Šç•«é¢ã€‚\né€™å€‹å·¥å…·ä¸»è¦æä¾›äº† 4 ç¨®æƒæçš„åŠŸèƒ½ï¼Œ åˆ†åˆ¥æ˜¯ï¼š\nCode Open Source Container IaC é‚£æˆ‘å€‘æœƒä¾ç…§é€™ï¼”ç¨®åŠŸèƒ½ä¾åºä»‹ç´¹ï¼Œè©³ç´°çš„å¯ä»¥åƒè€ƒ Snyk User Documentation # Explore Snyk productsã€‚\nCode èƒ½å¤ ç›´æ¥æƒæç›®å‰é–‹ç™¼ Project çš„ç¨‹å¼ç¢¼æœ‰æ²’æœ‰å®‰å…¨æ€§çš„å•é¡Œï¼Œå¯ä»¥å¤§å¹…æ¸›å°‘é–‹ç™¼äººå“¡å»æª¢æŸ¥ç¨‹å¼æ¼æ´çš„æ™‚é–“ï¼Œç›®å‰æ”¯æ´äº†ä»¥ä¸‹ä¸‰ç¨®æƒææ–¹å¼ï¼š\nIDE Plugins Web CLI IDE Plugins IDE æˆ‘å€‘é€™é‚Šä»¥ VS Code ç‚ºä¾‹ä¾†èªªæ˜ï¼Œå¦‚æœæœ‰åœ¨ç”¨ VS Code çš„å¤§å®¶æ‡‰è©²çŸ¥é“ VS Code æœ‰ä¸€å€‹ Marketplaceï¼Œå¯ä»¥å®‰è£å¾ˆå¤šä¸åŒçš„å¥—ä»¶ Pluginsï¼Œä¹‹å¾Œæœ‰æ™‚é–“ä¹Ÿæœƒå¯«ä¸€ç¯‡å¥½ç”¨çš„ Plugins æ–‡ç« ï¼Œå¤§å®¶å¯ä»¥åœ¨æŒçºŒé—œæ³¨æˆ‘æ­ ğŸ˜\né¦–å…ˆå…ˆé–‹å•Ÿå·¦å´çš„ Marketplaceï¼Œæœå°‹ Snykï¼Œé¸æ“‡ä¸‹è¼‰é‡æœ€é«˜çš„æº–æ²’éŒ¯ï¼Œé¸æ“‡ Snyk Security - Code and Open Source Dependenciesã€‚ VS Code Marketplace å®‰è£ Snyk\nå®‰è£å®Œå¾Œï¼Œåœ¨å·¦å´æ¬„ä½æ‡‰è©²å°±æœƒçœ‹åˆ° Snyk çš„ç‹—ç‹— Logoï¼Œå¦‚æœæ²’æœ‰ç™»å…¥éï¼Œæœƒå…ˆè¦æ±‚ä½ ç™»å…¥ Snyk ä¸¦æˆæ¬Šçµ¦ Plugins ä½¿ç”¨ã€‚æœ€å¾Œç•¶ä½ é–‹å•Ÿå°ˆæ¡ˆæ™‚ï¼Œæœƒé–‹å§‹æƒæç¨‹å¼ç¢¼ï¼Œä¸¦ä¸”æœƒä¾ç…§é–‹æºå¥—ä»¶å®‰å…¨æ€§ã€ç¨‹å¼ç¢¼å®‰å…¨æ€§ä¾†åˆ†é¡ï¼Œæœƒé¡¯ç¤ºå¥—ä»¶é‡åˆ°ä»€éº¼æ¼æ´éœ€è¦å‡ç´šä»¥åŠç¨‹å¼ç¢¼å“ªä¸€æ®µæœƒæœ‰å®‰å…¨æ€§çš„å•é¡Œï¼Œèƒ½å¤ è®“é–‹ç™¼äººå“¡åœ¨ç¬¬ä¸€æ™‚é–“å°±ä¿®å¾©å®‰å…¨å•é¡Œã€‚ IDE Plugins æƒæ\nWeb ç™»å…¥ Snyk ç¶²ç«™ï¼Œç›´æ¥åŠ å…¥å°æ‡‰çš„ Projectï¼Œæœƒç›´æ¥æ–¼ç¶²é ä¸Šæƒææ¼æ´ï¼Œä¸¦æç¤ºéŒ¯èª¤å…§å®¹ã€‚\né¸æ“‡åŠ å…¥ project\næƒææ¼æ´ä¸¦é¡¯ç¤ºéŒ¯èª¤å…§å®¹\nCLI è¦ä½¿ç”¨ CLI éœ€è¦å…ˆå®‰è£ Snyk CLIï¼Œæˆ‘å€‘ä¸€æ¨£ä½¿ç”¨ Homebrew ä¾†å®‰è£ï¼š\nbrew tap snyk/tap brew install snyk ç•¶ç„¶é™¤äº† Homebrew ä»¥å¤–é‚„æœ‰å…¶ä»–çš„å®‰è£æ–¹å¼ï¼Œä¾‹å¦‚ï¼šcurl ä¸‹è¼‰åŸ·è¡Œæª”ã€npmã€yarnã€docker åŸ·è¡Œç­‰ç­‰ï¼Œè©³ç´°å¯ä»¥åƒè€ƒä»¥ä¸‹å®‰è£é€£çµã€‚\nå¯ä»¥ç›´æ¥ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤æ‰é€²è¡Œæ¸¬è©¦ sync testï¼Œé‚„æœ‰å…¶ä»– CLI æŒ‡ä»¤ï¼Œè©³ç´°å¯ä»¥åƒè€ƒ Snyk CLIï¼š\nCLI æƒæ (å®˜ç¶²)\nOpen Source èƒ½å¤ æƒæç›®å‰é–‹ç™¼çš„ Project ä¸­æœ‰æ²’æœ‰ä½¿ç”¨åˆ°æœ‰æ¼æ´çš„ libraryï¼Œç›®å‰æ”¯æ´ä»¥ä¸‹åœ–ç‰‡èªè¨€ï¼Œè©³ç´°å¯ä»¥åƒè€ƒ Open Source - Supported languages and package managersï¼š\nOpen Source library æƒæ (å®˜ç¶²)\nContainer åœ¨ Container image ä¸­æœƒå­˜æ”¾è‘—ä¸åŒçš„ base image ï¼Œåœ¨ base image ä¸­åˆæœƒä½¿ç”¨ä¸åŒçš„ libraryã€‚æ‰€ä»¥é€™äº› container çš„å®‰å…¨æ€§ä¹Ÿæ˜¯éœ€è¦è¢«é—œæ³¨çš„ã€‚\nå¯ä»¥ç›´æ¥ä½¿ç”¨ web ä¾†é¸æ“‡ç›¸å°çš„ Container å€‰åº«å»åšæƒæï¼Œå¦‚æœæœ‰å®‰è£ä¸Šé¢èªªçš„ Snyk CLIï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è©²æŒ‡ä»¤åŸ·è¡Œ snyk container test \u003ccontainer image\u003e\nContainer æƒæ\nIac Snyk çš„åŸºç¤è¨­æ–½å³ä»£ç¢¼ (IaC) å¯å¹«åŠ©é–‹ç™¼äººå“¡ç·¨å¯«å®‰å…¨çš„åŸºç¤è¨­æ–½é…ç½®ï¼Œé é˜²éŒ¯èª¤çš„è¨­å®šç”¢ç”Ÿï¼Œä¸¦ä¸”æ”¯æ´å¤šç¨®æ ¼å¼ï¼š\nK8s YAML HashiCorp Terraform AWS CloudFormation Azure Resource Manager (ARM) ","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"DevOpsDays Taipei 2022 å…±åŒç­†è¨˜ - åœ¨ä½ çš„ DevOps ä¸­åŠ å…¥ä¸€é» Security â€” GitLab CI/CD with Snyk - é„­èƒæ¨º (Barry.Cheng) ï¼šhttps://hackmd.io/@DevOpsDay/2022/%2F%40DevOpsDay%2FHkm1iY6xi\nèº«ç‚º DevOps å·¥ç¨‹å¸«ï¼Œä½¿ç”¨ Snyk æƒææ¼æ´ä¹Ÿæ˜¯å¾ˆæ­£å¸¸çš„ï¼šhttps://barry-cheng.medium.com/%E8%BA%AB%E7%82%BAdevops%E5%B7%A5%E7%A8%8B%E5%B8%AB-%E4%BD%BF%E7%94%A8snyk%E6%8E%83%E6%8F%8F%E6%BC%8F%E6%B4%9E%E4%B9%9F%E6%98%AF%E5%BE%88%E6%AD%A3%E5%B8%B8%E7%9A%84-d7d8f2ad2304\nåœ¨ä½ çš„ DevOps ä¸­åŠ å…¥ä¸€é» Security â€” GitLab CI/CD with Snyk (è¬›å¸«ç°¡å ±)ï¼šhttps://s.itho.me/ccms_slides/2022/9/26/3a2ac1ef-4143-4328-9fef-066782ac7dc6.pdf"},"title":"æ‰¾å‡ºç¨‹å¼ç¢¼ã€é–‹æºå¥—ä»¶ã€å®¹å™¨çš„å®‰å…¨æ¼æ´å·¥å…· - Snyk"},"/blog/rd/":{"data":{"":"æ­¤åˆ†é¡åŒ…å« RD ä½¿ç”¨çš„ç›¸é—œå·¥å…·æ–‡ç« ã€‚\nFluentd-Server å‡ºç¾ Fluent::Plugin::Elasticsearch Error 400 - Rejected by Elasticsearch éŒ¯èª¤è§£æ±º Kibana æ–°å¢ index ç´¢å¼•æ™‚ä¸€ç›´è½‰åœˆåœˆä»¥åŠé¡¯ç¤º HTTP 403 Forbidden "},"title":"RD ä½¿ç”¨çš„ç›¸é—œå·¥å…·"},"/blog/rd/fluentd-server-show-fluent-plugin-elasticsearch-error400/":{"data":{"":"å…ˆèªªçµè«– â€¦ EFK çœŸçš„å¥½å¤šé›· ğŸ˜† æˆ‘å€‘ä»Šå¤©åˆå†åº¦è¸©é›·æ‹‰ï¼Œé€™æ¬¡åˆæ˜¯ç‚¸çš„åˆ†èº«ç¢éª¨ï¼ŒèŠ±äº† 4 å€‹å¤šå°æ™‚æ‰æ‰¾åˆ°åŸå› ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯å°å¼Ÿæˆ‘è·Ÿ EFK ä¸æ˜¯å¾ˆç†Ÿ XDã€‚å°±å¦‚æ¨™é¡Œæ‰€èªªï¼Œæˆ‘åœ¨æŠ½ Log çš„æ™‚å€™ç™¼ç¾æœ‰éƒ¨åˆ†çš„ Log é€ä¸åˆ° Kibanaï¼Œæª¢æŸ¥ Fluentd-Server çš„ Log ç™¼ç¾è£¡é¢æœ‰ Fluent::Plugin::Elasticsearch Error 400 - Rejected by Elasticsearch çš„éŒ¯èª¤è¨Šæ¯ï¼Œåˆ°åº•é€™å€‹ Error 400 æ˜¯ä»€éº¼å’§ï¼Œå°±è·Ÿè‘—æˆ‘ä¸€èµ·é‡æº«æ‰¾å•é¡Œçš„è‹¦é›£å§ XD","efk-çµæ§‹#EFK çµæ§‹":"åœ¨é–‹å§‹ä¹‹å‰æˆ‘å…ˆç°¡å–®èªªä¸€ä¸‹æˆ‘ç¾åœ¨çš„ EFK çµæ§‹ï¼š\nEFK çµæ§‹\nç¾åœ¨çš„ EFK çµæ§‹å¦‚ä¸Šåœ–ï¼Œæˆ‘åœ¨è¦æŠ½ Log çš„ Pod ä¸­å¤šå¡ä¸€å€‹ fluentd-bit containerï¼Œå°‡ fluentd-bit èˆ‡æœå‹™(ä¾‹å¦‚ nginx) çš„ log æ›ç›¸åŒè·¯å¾‘ï¼Œè®“ fluentd-bit å¯ä»¥æŠ½åˆ°æœå‹™ logï¼Œæ¥è‘—å°±é€é fluentd-server-svc æ‰“åˆ° fluentd-server podï¼Œå¾Œé¢å°±æ˜¯å¸¸è¦‹çš„ EFK çµæ§‹ï¼Œå°±ä¸å¤šåšèªªæ˜ã€‚","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"Elasticsearch 400 error #467ï¼šhttps://github.com/uken/fluent-plugin-elasticsearch/issues/467","å•é¡Œçš„å‡ºç¾#å•é¡Œçš„å‡ºç¾":"æˆ‘å€‘å°±åƒå¹³å¸¸ä¸€æ¨£å¯«å¥½æ•´å€‹ EFK çš„ yamlï¼Œrun çš„æ™‚å€™ä¹Ÿæ­£å¸¸ï¼Œå¯ä»¥æ”¶åˆ° logï¼Œä½†å¾ˆå¥‡æ€ªçš„æ˜¯æˆ‘å€‘å…ˆé€ log_false çš„ log å¯ä»¥æ­£å¸¸æ”¶åˆ°ï¼Œä½†å†æ¥è‘—é€ log_true å°±æ”¶ä¸åˆ°ï¼Œæˆ‘å€‘ä¹Ÿå˜—è©¦åéä¾†é€ï¼Œå…ˆé€ log_trueï¼Œå†é€ log_falseï¼Œç™¼ç¾æ›æ”¶ä¸åˆ° log_false çš„ log\nlog_false { \"result\": false, \"message\": \"æˆ‘æ˜¯é¦¬è³½å…‹\", \"code\": 11223344, \"data\": { \"end_at\": \"2022-12-19 04:09:00\" }, \"response_code\": \"326dgf241geh1596489\", \"job_name\": \"å®å®å™¹å™¹è–èª•ç¯€\", \"method\": \"GET\", \"url\": \"url.com\" } log_true { \"result\": true, \"data\": true, \"response_code\": \"wkCJl1dfr45671607965\" } æ¥è‘—åœ¨ Fluentd-Server Log ä¸­ç™¼ç¾ Fluent::Plugin::Elasticsearch Error 400 - Rejected by Elasticsearch éŒ¯èª¤\nfluentd-server è·³å‡ºéŒ¯èª¤ LOG\næˆ‘åˆ°ç¶²è·¯ä¸Šæœå°‹ï¼Œçœ‹çœ‹æœ‰æ²’æœ‰äººæœ‰é‡åˆ°è·Ÿæˆ‘ä¸€æ¨£çš„å•é¡Œï¼Œç™¼ç¾åœ¨ uken/fluent-plugin-elasticsearch ä¹Ÿæœ‰å…¶ä»–äººæœ‰é‡åˆ°åŒæ¨£çš„å•é¡Œ\nuken/fluent-plugin-elasticsearch issus è©¢å•\næœ‰äººèªªå¯èƒ½æ˜¯ Elasticsearch çš„ disk æ»¿äº†ï¼Œä¹Ÿæœ‰äººèªªæ˜¯è£åœ¨ Fluentd-Server çš„å¥—ä»¶ fluent-plugin-elasticsearch ç‰ˆæœ¬æœ‰å•é¡Œï¼Œæˆ–æ˜¯å°‡ Elasticsearch è·Ÿ Kibana index åˆªé™¤å°±å¯ä»¥ï¼Œæˆ‘æœ‰ç æ‰ index å†é‡æ–°å€’å…¥ Logï¼Œé‚„æ˜¯æœƒæœ‰å•é¡Œã€‚\nä¸€é–‹å§‹ä»¥ç‚ºæ˜¯ log_false è·Ÿ log_true çš„æ¬„ä½ä¸åŒï¼Œæ‰€ä»¥æ‰æœƒæœ‰é€™å€‹å•é¡Œç™¼ç”Ÿï¼ˆä½ çœ‹å°±çŸ¥é“æˆ‘è·Ÿ EFK ä¸ç†Ÿå§ï¼¸ï¼¤ï¼‰ï¼Œæ‰€ä»¥æœ‰å¦å¤–å€’ä¸€äº›å…¶ä»–æœå‹™(æ¬„ä½ä¹Ÿä¸åŒ)çš„ log é€²å»æ¸¬è©¦ï¼Œç™¼ç¾æ˜¯å¯ä»¥æ­£å¸¸æŠ½åˆ°ï¼Œä¸” kibana é‚£é‚Šæœƒä¾ç…§ es æä¾›çš„æ¬„ä½è‡ªå‹•æ–°å¢ï¼Œæ‰€ä»¥ä¹Ÿä¸æ˜¯æ¬„ä½çš„å•é¡Œï¼Œé‚£æœ€å¾Œçš„å•é¡Œæ˜¯ä»€éº¼å‘¢ï¼Ÿ","å¦‚ä½•è§£æ±ºå•é¡Œ#å¦‚ä½•è§£æ±ºå•é¡Œ":"æœ€å¾Œåœ¨æˆ‘å€‘ä»”ç´°æª¢æŸ¥å¾Œç™¼ç¾ï¼Œlog_false è·Ÿ log_true çš„æ¬„ä½å…¶ä¸­ä¸€æ¨£å­˜çš„è³‡æ–™å‹æ…‹ä¸å¤ªä¸€æ¨£ï¼Œç™¼ç¾å…¶ä¸­çš„ data æ¬„ä½åœ¨ log_false çš„è³‡æ–™å‹æ…‹æ˜¯ arrayï¼Œåœ¨ log_true å­˜çš„æ™‚å€™æ˜¯å­—ä¸²ï¼Œæ‰€ä»¥å°è‡´ç•¶å…¶ä¸­ä¸€å€‹ log å¯«å…¥å¾Œï¼Œå¦ä¸€å€‹ log å°±æœƒå› ç‚ºåŒæ¬„ä½çš„è³‡æ–™å‹æ…‹æœ‰æ‰€ä¸åŒï¼Œè€Œç„¡æ³•å¯«å…¥ logï¼Œä¸”åœ¨ Fluentd-Server æœƒå‡ºç¾æ¨™é¡Œçš„ Error 400 åŸå› æ‹‰ï½\næœ€å¾Œé‡æ–°èª¿æ•´æ¬„ä½çš„è³‡æ–™å‹æ…‹ï¼Œå°±é †åˆ©è§£æ±ºæ­¤æ¬¡å•é¡Œ âœŒï¸âœŒï¸âœŒï¸"},"title":"Fluentd-Server å‡ºç¾ Fluent::Plugin::Elasticsearch Error 400 - Rejected by Elasticsearch éŒ¯èª¤è§£æ±º"},"/blog/rd/kibana-create-index-forbidden/":{"data":{"":"å‰å¹¾å¤©åœ¨å·¥ä½œä½¿ç”¨ Kibana æ™‚ï¼Œæƒ³è¦æ–°å¢ä¸€å€‹æ–°çš„ç´¢å¼•ï¼Œç™¼ç¾é¸æ“‡ç´¢å¼•ä¸¦æŒ‰ä¸‹æ–°å¢çš„æŒ‰éˆ•ï¼Œæœƒä¸€ç›´è½‰åœˆåœˆï¼Œç­‰äº†ä¸€é™£å­ï¼Œä½¿ç”¨é–‹ç™¼å·¥å…· F12 æŸ¥çœ‹ï¼Œè·³å‡ºäº† HTTP 403 Forbiddenï¼Œåˆ°åº•æ˜¯ä»€éº¼åŸå› å°è‡´çš„å‘¢ï¼ï¼Ÿæˆ‘å€‘ä¸€èµ·çœ‹ä¸‹å»å§ï¼Œæœƒå¾å•é¡Œçš„å‡ºç¾åˆ°å•é¡ŒåŸå› å†åˆ°å¦‚ä½•è§£æ±ºå•é¡Œï¼Œä¾†ä»”ç´°ä»‹ç´¹ï¼Œå¸Œæœ›å¤§å®¶ä¸è¦åƒæˆ‘ä¸€æ¨£è¸©åˆ°é›· ğŸ¤£","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"Kibana åˆ›å»ºç´¢å¼• POST 403 (forbidden) on create indexï¼šhttps://www.cnblogs.com/caoweixiong/p/10972120.html","å•é¡ŒåŸå› #å•é¡ŒåŸå› ":"æ–‡ç« çš„èªªæ˜æ˜¯ç´¢å¼•è®Šæˆåªå…è¨±è®€å–çš„ç‹€æ…‹ï¼Œå…¶åŸå› æ˜¯å› ç‚ºå‡ºç¾é€™å€‹ HTTP 403 Forbidden å‰ï¼ŒElasticSearch çš„ç©ºé–“æ»¿äº†ï¼Œå°è‡´ Kibana æœƒè‡ªå‹•çš„å°‡ç´¢å¼•æ”¹æˆåªå…è¨±è®€å–çš„ç‹€æ…‹ï¼Œæˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹å‰›å‰›çš„ Index ç‹€æ…‹æ˜¯ä¸æ˜¯åƒä»–èªªçš„ä¸€æ¨£è®Šæˆåªå…è¨±è®€å–çš„ç‹€æ…‹å‘¢\nå¯ä»¥åˆ° kibana çš„ Dev Tools ä¸‹æŒ‡ä»¤ä¾†æŸ¥è©¢æ­ï¼Œè¼¸å…¥ GET _settingsï¼Œå°±æœƒé¡¯ç¤ºä»¥ä¸‹åœ–ç‰‡çš„å…§å®¹å›‰ ç´¢å¼•åªå…è¨±è®€å–çš„è¨­å®šè®Šæˆ\nç™¼ç¾æ­£å¦‚æ–‡ç« æ‰€èªªï¼Œæ˜¯å› ç‚º read_only_allow_delete çš„ç‹€æ…‹è®Šæˆäº† trueï¼Œæ‰€ä»¥æ‰æ²’è¾¦æ³•æ–°å¢ç´¢å¼•ï½","å•é¡Œçš„å‡ºç¾#å•é¡Œçš„å‡ºç¾":"é‚£å¤©æ˜¯å€‹è®Šå†·çš„ 12 æœˆï¼Œè¦å¹« RD åŒä»æ–°å¢ Kibana çš„ç´¢å¼•æ™‚ï¼Œç…§å¾€å¸¸ä¸€æ¨£è¼¸å…¥ Index patternï¼ŒæŒ‰ä¸‹ä¸€æ­¥ï¼Œé¸æ“‡ Configure settings ï¼š\nè¼¸å…¥ Index pattern (åœ–ç‰‡ç‚ºç¯„ä¾‹ï¼Œæ­£å¸¸éƒ½æ˜¯ç”¨ -* )\næŒ‰ä¸‹æ–°å¢ç´¢å¼•ï¼Œä»–å°±é–‹å§‹ç„¡é™çš„è½‰åœˆåœˆï¼Œæœ‰å»æŸ¥çœ‹ ElasticSearch çš„ logï¼Œç™¼ç¾ä¹Ÿæ²’æœ‰ç‰¹åˆ¥çš„éŒ¯èª¤è¨Šæ¯\næ–°å¢ç´¢å¼•å¾Œï¼Œä¸€ç›´è½‰åœˆåœˆ\næ¥è‘—æƒ³èªªæ‰“é–‹é–‹ç™¼è€…å·¥å…· F12 ä¾†çœ‹çœ‹ï¼Œæ˜¯å¡åœ¨å“ªä¸€å€‹é»ï¼Œå»ç™¼ç¾æœ‰å¹¾å€‹ç´…å­—å¯«è‘— HTTP 403 Forbidden\né–‹ç™¼è€…å·¥å…·ç¶²é å…§å®¹é¡¯ç¤º HTTP 403 Forbidden\næƒ³èªªç‚ºä»€éº¼æœƒæœ‰ HTTP 403 Forbiddenï¼Œä¹‹å‰ä¹Ÿæ²’æœ‰çœ‹éé¡ä¼¼çš„éŒ¯èª¤è¨Šæ¯ï¼Œæ–¼æ˜¯å°±é–‹å§‹åœ¨ç¶²è·¯ä¸Šäº‚æ™ƒï¼Œæœ€å¾Œåœ¨åŒäº‹çš„å¹«åŠ©ä¸‹æ‰¾åˆ°äº†ä¸€å€‹è·Ÿæˆ‘å€‘æƒ…æ³å¾ˆç›¸ä¼¼çš„æ–‡ç«  Kibana åˆ›å»ºç´¢å¼• POST 403 (forbidden) on create index","å¦‚ä½•è§£æ±ºå•é¡Œ#å¦‚ä½•è§£æ±ºå•é¡Œ":"æˆ‘å€‘æŸ¥çœ‹æ–‡ç« çš„è§£æ±ºè¾¦æ³•ï¼Œæœ‰å…©ç¨®è¾¦æ³•ï¼Œä¸€å€‹æ˜¯æ“´å¤§ ElasticSearch çš„ç©ºé–“ï¼Œä»¥åŠä½¿ç”¨ kibana çš„ Dev Tools ä¸‹æŒ‡ä»¤ä¿®æ”¹ï¼Œé‚£æˆ‘å€‘å…©ç¨®éƒ½æœ‰åšï¼Œé€™é‚Šå°±ç›´æ¥ä»‹ç´¹ä¸‹æŒ‡ä»¤éœ€è¦è¼¸å…¥ä»€éº¼ï½\néœ€è¦å† Dev Tools è¼¸å…¥ä»¥ä¸‹æŒ‡ä»¤ï¼Œä¾†ä¿®æ”¹ Index çš„ç‹€æ…‹ï¼š\nPUT _settings { \"index\": { \"blocks\": { \"read_only_allow_delete\": \"false\" } } } Dev Tools ä¿®æ”¹ Index çš„ç‹€æ…‹\næœ€å¾Œæˆ‘å€‘ç”¨ GET _settings æª¢æŸ¥ä¸€ä¸‹ç´¢å¼•ç‹€æ…‹æ˜¯ä¸æ˜¯å·²ç¶“è®Šå›åŸæœ¬çš„äº†ï¼š\nç´¢å¼•åªå…è¨±è®€å–çš„è¨­å®šè®Šæˆ false\næœ€å¾Œå°±å¯ä»¥é †åˆ©æ–°å¢ç´¢å¼•æ‹‰ ğŸ‘ğŸ‘ğŸ‘\né †åˆ©æ–°å¢ç´¢å¼•"},"title":"Kibana æ–°å¢ index ç´¢å¼•æ™‚ä¸€ç›´è½‰åœˆåœˆä»¥åŠé¡¯ç¤º HTTP 403 Forbidden"},"/blog/terraform/":{"data":{"":"æ­¤åˆ†é¡åŒ…å« Terraform ç›¸é—œçš„æ–‡ç« ã€‚\nä»€éº¼æ˜¯ IaC ? Terraform åˆæ˜¯ä»€éº¼ï¼Ÿ ä½¿ç”¨ Terraform å»ºç«‹ Google Compute Engine ä½¿ç”¨ Terraform å»ºç«‹ Google Kubernetes Engine Terraform å¦‚ä½•å¤šäººå…±åŒé–‹ç™¼ (å°‡ tfstate å­˜åœ¨å¾Œç«¯) å¦‚ä½•å°‡ Terraform æ”¹å¯«æˆ module ? å¦‚ä½•å°å…¥ Terragruntï¼ŒTerragrunt å¥½è™•æ˜¯ä»€éº¼ï¼Ÿ "},"title":"Terraform"},"/blog/terraform/terraform-gce/":{"data":{"":"å—¨å—¨å¤§å®¶å¥½ï¼Œè·é›¢ä¸Šä¸€ç¯‡ç­†è¨˜åˆéš”äº† 3 å€‹æœˆï¼Œæœ€è¿‘å…¬å¸æœ‰å°ˆæ¡ˆåœ¨å¿™ï¼Œæ²’æ™‚é–“æŠŠä¸Šæ¬¡æåˆ°çš„ Terraform æ‡‰ç”¨ç­†è¨˜å¯«å®Œï¼Œç¾åœ¨ä»–ä¾†æ‹‰ï½ï½ï½ ğŸ˜‚ æˆ‘å€‘é€™æ¬¡çš„ä¸»é¡Œæ˜¯ä½¿ç”¨ Terraform ä¾†å»ºç«‹ Google Compute Engine çš„æ©Ÿå™¨ï¼Œæƒ³çŸ¥é“è¦æ€éº¼ç”¨ä¸€æ®µç¨‹å¼ç¢¼å°±å¯ä»¥å»ºç«‹ã€ä¿®æ”¹ã€åˆªé™¤ Google Compute Engine çš„æ©Ÿå™¨ä¸€å®šè¦ä¾†çœ‹é€™ä¸€ç¯‡ï½æˆ‘å€‘é–‹å§‹å›‰ ğŸ§‘â€ğŸ’»","ä¿®æ”¹-google-compute-engine#ä¿®æ”¹ Google Compute Engine":"ç•¶æˆ‘å€‘ç™¼ç¾æˆ‘å€‘å»ºç«‹çš„ Google Compute Engine åƒæ•¸æœ‰éŒ¯ï¼Œæƒ³è¦ä¿®æ”¹æ™‚ï¼Œæˆ‘å€‘åªéœ€è¦ä¿®æ”¹ç¨‹å¼ç¢¼éƒ¨åˆ†ï¼Œä¸¦é‡æ–°ä¸‹ä¸€æ¬¡ terraform apply ä¾†ä¿®æ”¹ Google Compute Engineï¼Œå°±æœƒçœ‹åˆ°ä»¥ä¸‹ç•«é¢ (æœ‰äº›è¨­å®šæª”æ˜¯ä¸èƒ½ä¿®æ”¹çš„ï¼Œè‹¥ä¿®æ”¹ä»–æœƒé‡æ–°å‰µå»ºä¸€å€‹æ–°çš„æ©Ÿå™¨ï¼Œåƒæ˜¯ name ä¹‹é¡çš„ï¼Œä½¿ç”¨æ™‚è¦å°å¿ƒä¸€é» ğŸ˜‰)\næˆ‘å€‘æ‹¿å‰›å‰›æåˆ°çš„ nat_ipï¼Œæˆ‘å€‘å…ˆæŠŠå®ƒè¨»è§£æ‰ï¼Œå†ä¸‹ terraform apply çœ‹çœ‹æ©Ÿå™¨æœ‰ä»€éº¼è®ŠåŒ–ï½\nterraform changed\nå¯ä»¥çœ‹åˆ°ä»–æœƒæç¤ºèªªï¼Œä»–æœƒæ”¹è®Š network_interfaceï¼Œä¹Ÿç§»é™¤ access_config çš„è¨­å®šï¼ŒåŸ·è¡Œå¾Œçš„ Resources ä¹Ÿæœƒå¾å‰›å‰›çš„ added è®Šæˆ changedï¼Œæˆ‘å€‘çœ‹ä¸€ä¸‹ GCP æœ‰æ²’æœ‰æ”¹è®Šï¼š\nterraform changed\nå¯ä»¥çœ‹åˆ°åŸæœ¬çš„å¤–éƒ¨ IP ä½ç½®è¢«æ”¹æ‰äº†ï½ æœ€å¾Œæé†’ï¼šå¦‚æœæœ‰ä½¿ç”¨ terraform ä¾†ä¿®æ”¹è³‡æºè¨­å®šï¼Œä¸èƒ½å‹•åˆ°ç‰¹å®šçš„é …ç›®ï¼Œä¸ç„¶ä»–çš„æµç¨‹æ˜¯å…ˆæŠŠåŸæœ¬çš„çµ¦åˆªæ‰ï¼Œå†é‡æ–°å»ºç«‹ä¸€å€‹æ–°çš„ï¼ŒåŸæœ¬çš„æ©Ÿå™¨æ²’æœ‰å‚™ä»½ï¼Œæ±è¥¿å°±æœƒä¸è¦‹æ­ï½","åˆªé™¤-google-compute-engine#åˆªé™¤ Google Compute Engine":"æœ€å¾Œå‡å¦‚æˆ‘å€‘è¦åˆªé™¤ Google Compute Engineï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ terraform çš„æŒ‡ä»¤ä¾†åˆªé™¤ï¼Œæˆ‘å€‘é †ä¾¿ä¾†æ¸¬è©¦ä¸€ä¸‹ä¸Šé¢æœ‰è¨­å®šçš„ deletion_protection åˆªé™¤ä¿è­·æ©Ÿåˆ¶æ˜¯ä¸æ˜¯æ­£å¸¸ï½\nç›®å‰ deletion_protection é‚„æ˜¯ trueï¼Œæˆ‘å€‘ç›´æ¥ä¸‹ terraform destroyï¼Œçœ‹çœ‹æ˜¯å¦å¯ä»¥åˆªé™¤ Google Compute Engine\nterraform destroy\nå¯ä»¥çœ‹åˆ°ä»–æœƒæé†’ä½ èªª Deletion Protection is enabledï¼Œå¿…é ˆå…ˆæŠŠä»–æ”¹æˆ false terraform apply å¾Œæ‰å¯ä»¥åˆªé™¤ï½\næ”¹æˆ false åœ¨ä¸‹ terraform apply\nç¾åœ¨ deletion_protection æ˜¯ falseï¼Œæˆ‘å€‘å°±å¯ä»¥ä¸‹ terraform destroy ä¾†åˆªé™¤ Google Compute Engine ğŸ”ª\nterraform destroy\nGoogle Compute Engine åˆªé™¤ä¸­â€¦\nä»¥ä¸Šå°±æ˜¯ç°¡å–®çš„ä½¿ç”¨ Terraform å»ºç«‹ Google Compute Engine ä»‹ç´¹å›‰ï½æ­¡è¿å¤§å®¶ç•™è¨€æŒ‡æ•™ï¼Œæ˜å¤©çš„æ–‡ç« æ˜¯ä»‹ç´¹å¦‚ä½•ä½¿ç”¨ Terraform å»ºç«‹ GKE ğŸ’•","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"registry.terraform.io/providers (google_compute_instance)ï¼šhttps://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance","å»ºç«‹-google-compute-engine#å»ºç«‹ Google Compute Engine":"ç•¶æˆ‘å€‘å¯«å¥½ Google Compute Engine tf æª”æ¡ˆå¾Œï¼Œæˆ‘å€‘æ¥è‘—æŠŠä»–å»ºç«‹ï¼Œå»ºç«‹å‰è¦å…ˆä½¿ç”¨ terraform init ä¾†åšåˆå§‹åŒ–\nterraform init\næ¥è‘—å¯ä»¥å…ˆä½¿ç”¨ terraform plan ä¾†æŸ¥çœ‹æˆ‘å€‘çš„è¨­å®šæ˜¯å¦æ˜¯æˆ‘å€‘æƒ³è¦çš„ï¼Œæˆ–æ˜¯ç›´æ¥ç”¨ terraform apply ä¾†å»ºç«‹ Google Compute Engine\nterraform apply\nå¯ä»¥çœ‹åˆ°æˆåŠŸå»ºç«‹æˆ‘å€‘çš„ test Google Compute Engineï¼ˆä¹Ÿå¯ä»¥çœ‹åˆ°å› ç‚ºæˆ‘å€‘æœ‰é–‹ nat_ip æ‰€ä»¥æœ‰å¤–éƒ¨ IPï¼‰\nGCP Google Compute Engine","æ’°å¯«-google-compute-engine-tf-æª”æ¡ˆ#æ’°å¯« Google Compute Engine tf æª”æ¡ˆ":"ç›¸ä¿¡å¤§å®¶æœ‰å…ˆçœ‹å®Œä¸Šä¸€ç¯‡ ä»€éº¼æ˜¯ IaC ? Terraform åˆæ˜¯ä»€éº¼ï¼Ÿ æ‰ä¾†çœ‹é€™ä¸€ç¯‡çš„å°å§ ğŸ˜ï¼Œå°æ–¼ Terraform çš„ç¨‹å¼æ¶æ§‹åŠæŒ‡ä»¤ï¼Œæˆ‘å€‘é€™é‚Šå°±ä¸å¤šåšä»‹ç´¹ï¼Œæˆ‘å€‘ç›´æ¥ä¾†çœ‹ç¨‹å¼è¦æ€éº¼å¯«ï½(ç¨‹å¼ç¢¼ä¸»è¦æ˜¯åƒè€ƒå®˜æ–¹æ–‡ä»¶ï¼ŒåŠ ä¸Šä¸€äº›å…¶ä»–çš„è¨­å®šä¾†åšä»‹ç´¹ï¼Œç¨‹å¼ç¢¼ä¹ŸæœƒåŒæ­¥åˆ° Github ï¼Œéœ€è¦çš„ä¹Ÿå¯ä»¥å» Clone ä¾†ä½¿ç”¨æ­ï¼ Github ç¨‹å¼ç¢¼é€£çµ )\nå°æé†’ï¼šç”±æ–¼ç¨‹å¼ç¢¼è¼ƒé•·ï¼Œæˆ‘å°‡ä»–æ‹†é–‹ä¾†èªªæ˜ ğŸ’–\né¸æ“‡ä¾›æ‡‰è€…ä»¥åŠå°æ‡‰çš„å°ˆæ¡ˆ provider \"google\" { project = \"gcp-20210526-001\" } ç”±æ–¼æˆ‘å€‘è¦å»ºç«‹çš„ Google Compute Engine æ˜¯ç”± Google æ‰€æä¾›çš„ api ä¾†å»ºç«‹çš„ï¼Œæ‰€ä»¥ä¸€é–‹å§‹è¦å…ˆè¨­å®šå¥½æä¾›è€…çš„åç¨± google ä»¥åŠæˆ‘å€‘è¦åœ¨å“ªä¸€å€‹ GCP çš„å°ˆæ¡ˆ ID\nresource è¨­å®š æ¥ä¸‹ä¾†çš„è¨­å®šéƒ½æœƒæ”¾åœ¨ä»¥ä¸‹çš„ google_compute_instance resource å…§ï¼Œç‚ºäº†æ–¹ä¾¿ä»‹ç´¹ï¼Œå°±ä¸æœƒæ¨™æ˜ google_compute_instanceï¼Œè©³ç´°å®Œæ•´ç¨‹å¼ç¢¼è«‹åƒè€ƒ GitLab Github ç¨‹å¼ç¢¼é€£çµ\nresource \"google_compute_instance\" \"default\" { } åŸºæœ¬è¨­å®š name = \"test\" description = \"æˆ‘æ˜¯ test æ©Ÿå™¨\" machine_type = \"n2-standard-8\" zone = \"asia-east1-b\" tags = [\"test\"] labels = { env = \"test\" } deletion_protection = \"true\" nameï¼šGCE è¦æ±‚è³‡æºçš„å”¯ä¸€åç¨±ã€‚å¦‚æœæœ‰æ›´æ”¹æ­¤é …æœƒç›´æ¥å¼·åˆ¶å‰µå»ºçš„æ–°è³‡æº (å¿…å¡«) descriptionï¼šå°æ­¤è³‡æºçš„ç°¡å–®èªªæ˜ (é¸å¡«) machine_typeï¼šè¦å‰µå»ºçš„æ©Ÿå™¨é¡å‹ (å¿…å¡«) zoneï¼šå‰µå»ºæ©Ÿå™¨çš„æ‰€åœ¨å€åŸŸï¼Œè‹¥æ²’æœ‰å¡«å¯«ï¼Œå‰‡æœƒä½¿ç”¨æä¾›è€…çš„å€åŸŸ (é¸å¡«) tagsï¼šé™„åŠ åˆ°å¯¦é«”çš„ç¶²è·¯æ¨™ç±¤åˆ—è¡¨ (é¸å¡«) labelsï¼šä¸€çµ„åˆ†é…çµ¦ disk çš„ key/value æ¨™ç±¤ (é¸å¡«) deletion_protectionï¼šåˆªé™¤ä¿è­·ï¼Œé è¨­æ˜¯ falseï¼Œç•¶æˆ‘å€‘ä½¿ç”¨ terraform destroy åˆªé™¤ GCE æ™‚ï¼Œå¿…é ˆå…ˆæ”¹æˆ falseï¼Œæ‰å¯ä»¥åˆªé™¤ï¼Œå¦å‰‡æœƒç„¡æ³•åˆªé™¤ä¸” Terraform é‹è¡Œä¹Ÿæœƒå¤±æ•—ï¼Œç®—æ˜¯ä¸€å€‹ä¿è­·æ©Ÿåˆ¶ï¼Œå¾Œé¢å†åˆªé™¤ Google Compute Engine æ™‚æœƒæ¸¬è©¦ç•«é¢ (é¸å¡«) å•Ÿå‹• disk è¨­å®š boot_disk { initialize_params { image = \"debian-cloud/debian-10-buster-v20210512\" type = \"pd-balanced\" size = \"50\" } } imageï¼šåˆå§‹åŒ–æ­¤ disk çš„ image (é¸å¡«) typeï¼šGCE disk é¡å‹ (é¸å¡«) sizeï¼šimage å¤§å°ï¼Œå·² GB ç‚ºå–®ä½ï¼Œå¦‚æœæœªæŒ‡å®šï¼Œå°‡æœƒç¹¼æ‰¿å…¶åˆå§‹åŒ– disk çš„ image å¤§å° (é¸å¡«) ç¶²è·¯è¨­å®š network_interface { network = \"projects/rd-gateway/global/networks/rd-common\" subnetwork = \"projects/rd-gateway/regions/asia-east1/subnetworks/rd-common-asia-east1-pid-cicd\" access_config { nat_ip = \"\" } } networkï¼šè¨­å®šé™„åŠ åˆ°çš„ç¶²è·¯åç¨±æˆ–æ˜¯ self_link (é¸å¡«) subnetworkï¼šè¨­å®šé™„åŠ åˆ°çš„å­ç¶²è·¯åç¨±æˆ–æ˜¯ self_link (é¸å¡«) nat_ipï¼šå¦‚æœæƒ³è¦æœ‰å¤–ç¶²çš„ ipï¼Œå¿…é ˆåŠ ä¸Šæ­¤åƒæ•¸ï¼Œæ‰æœƒç”¢ç”Ÿä¸€çµ„å¤–ç¶² ip (é¸å¡«) æ¬Šé™è¨­å®š service_account { email = \"676962704505-compute@developer.gserviceaccount.com\" scopes = [\"storage-rw\", \"logging-write\", \"monitoring-write\", \"service-control\", \"service-management\", \"trace\"] } emailï¼šæœå‹™å¸³æˆ¶é›»å­éƒµä»¶åœ°å€ã€‚å¦‚æœæœªæä¾›ï¼Œå‰‡ä½¿ç”¨é è¨­çš„ Google Compute Engine æœå‹™å¸³æˆ¶ (é¸å¡«) scopesï¼šæœå‹™ç¯„åœåˆ—è¡¨ï¼Œå¯ä»¥é»æˆ‘æŸ¥çœ‹ç¯„åœçš„å®Œæ•´åˆ—è¡¨ (å¿…å¡«) ä»¥ä¸Šåªæ˜¯æˆ‘åœ¨å»ºç«‹ Google Compute Engine æœ€ç°¡å–®çš„è¨­å®šï¼Œç•¶ç„¶é‚„æœ‰å¾ˆå¤šå…¶ä»–çš„è¨­å®šï¼Œå¯ä»¥åƒè€ƒ registry.terraform.io/providers (google_compute_instance) è£¡é¢æœ‰æ›´å¤šçš„ resource è¨­å®šï¼Œæœ‰éœ€è¦çš„å°±è‡ªå·±ä¾†çœ‹çœ‹å§ ğŸ§"},"title":"ä½¿ç”¨ Terraform å»ºç«‹ Google Compute Engine"},"/blog/terraform/terraform-gke/":{"data":{"":"æˆ‘å€‘æ¥çºŒæ˜¨å¤©çš„å»ºç«‹ Google Kubernetes Engine æ–‡ç« ï¼Œä»Šå¤©è¦ä¾†ä»‹ç´¹çš„æ˜¯å¦‚ä½•ç”¨ Terraform å»ºç«‹ Google Kubernetes Engineï¼Œç”±æ–¼ä½¿ç”¨ terraform å»å»ºç«‹ã€ä¿®æ”¹ã€åˆªé™¤çš„æŒ‡ä»¤å¤§å®¶æ‡‰è©²éƒ½æ¸…æ¥šäº†ï¼Œé‚£æˆ‘ä»Šå¤©çš„æ–‡ç« å°±ä¸åœ¨å¤šèªªï¼Œç›´æ¥ä¾†ä»‹ç´¹ä¸€ä¸‹è¦æ€éº¼æ’°å¯« Google Kubernetes Engine tf æª”æ¡ˆ ğŸ˜","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"registry.terraform.io/providers (google_container_cluster)ï¼šhttps://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster\nregistry.terraform.io/providers (google_container_node_pool)ï¼šhttps://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_node_pool","æ’°å¯«-google-kubernetes-engine-tf-æª”æ¡ˆ#æ’°å¯« Google Kubernetes Engine tf æª”æ¡ˆ":"ç¨‹å¼ç¢¼æœƒåŒæ­¥åˆ° Github ï¼Œéœ€è¦çš„ä¹Ÿå¯ä»¥å» Clone ä¾†ä½¿ç”¨æ­ï¼ Github ç¨‹å¼ç¢¼é€£çµï¼Œå°æé†’ï¼šç”±æ–¼ç¨‹å¼ç¢¼è¼ƒé•·ï¼Œæˆ‘å°‡ä»–æ‹†é–‹ä¾†èªªæ˜ ğŸ’–\nç”±æ–¼ç­‰ç­‰ç¨‹å¼ç¢¼è¼ƒé•·ï¼Œæ‰€ä»¥æˆ‘åœ¨å‰é¢é€™é‚Šå…ˆåšèªªæ˜ï¼ŒGKE çš„çµæ§‹æ˜¯ å¢é›†(cluster) \u003e ç¯€é»æ± (node_pool) \u003e ç¯€é»(node)ï¼Œæœ¬æ¬¡çš„ä»‹ç´¹ç¯„ä¾‹ï¼Œæœƒæœ‰ä¸€å€‹å¢é›†è£¡é¢æœ‰ä¸€å€‹ç¯€é»æ± ï¼Œç¯€é»æ± è£¡é¢æœ‰ 6 å€‹ç¯€é»æ•¸é‡ï¼Œç¯„ä¾‹è£¡é¢æœƒåŠ ä¸Šæˆ‘æ¯”è¼ƒå¸¸ç”¨åˆ°çš„ä¸€äº›è¨­å®šï¼Œä»¥åŠä¸€äº›æ–‡ä»¶è£¡é¢çš„ç”¨æ³•ï¼Œå¤§å®¶å¯ä»¥ä¾ç…§è‡ªå·±çš„éœ€æ±‚ä¾†ä½¿ç”¨åƒæ•¸ï¼š\né™åˆ¶ä½¿ç”¨çš„ç‰ˆæœ¬ åœ¨ä¸Šä¸€ç¯‡ ä½¿ç”¨ Terraform å»ºç«‹ Google Compute Engineï¼Œæˆ‘å€‘çŸ¥é“ Terraform å…¶å¯¦å°±æ˜¯å°æ‡‰çš„æä¾›å•†ï¼Œæä¾›å°æ‡‰çš„ api ä¾†è®“æˆ‘å€‘å¯ä»¥ç”¨ terraform å»å»ºç½®å¾ˆå¤š IaCï¼Œä½†ä¾›æ‡‰å•†æä¾›çš„ api æœƒéš¨è‘—ç‰ˆæœ¬è€Œæœ‰æ‰€æ›´å‹•ï¼Œå¯èƒ½æ›äº†ä¸€å€‹ç‰ˆæœ¬ï¼ŒåŸæœ¬å¯ä»¥ä½¿ç”¨çš„ resource åƒæ•¸å°±æœƒæœ‰æ‰€ä¸åŒï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥åœ¨ä¸€é–‹å§‹ï¼Œå…ˆè¨­å®šå¥½é€™éš» tf è¦ä½¿ç”¨çš„ä¾›æ‡‰å•†åŠå°æ‡‰çš„ç‰ˆæœ¬ï¼Œå¯ä»¥åƒè€ƒä»¥ä¸‹ç¨‹å¼ç¢¼ï¼š\nterraform { required_providers { google = { source = \"hashicorp/google\" version = \"~\u003e 4.38.0\" } } } å¯ä»¥çœ‹åˆ°æˆ‘å€‘æŠŠ google é€™å€‹ä¾›æ‡‰å•†è£¡é¢è¨­å®šå¥½ä»–çš„ source ä»¥åŠ versionï¼Œé€™æ¨£å°±ç®—ä¹‹å¾Œ goolge æœ‰æ›´æ–° terraform çš„ apiï¼Œæˆ‘å€‘ä¹Ÿä¸éœ€è¦å»æ›´æ›åƒæ•¸å°±å¯ä»¥ä½¿ç”¨äº†ï½\né¸æ“‡ä¾›æ‡‰è€…ä»¥åŠå°æ‡‰çš„å°ˆæ¡ˆ provider \"google\" { project = \"project\" } é™¤äº†å¯ä»¥ä½¿ç”¨å°ˆæ¡ˆ ID ä»¥å¤–ï¼Œç•¶ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨å°ˆæ¡ˆçš„åç¨±æ‹‰ ğŸ¥³\nresource è¨­å®š google_container_cluster resource \"google_container_cluster\" \"cluster\" { name = \"test\" location = \"asia-southeast1-b\" min_master_version = \"1.22.12-gke.300\" network = \"projects/gcp-202011216-001/global/networks/XXXX\" subnetwork = \"projects/gcp-202011216-001/regions/asia-southeast1/subnetworks/XXXX\" default_max_pods_per_node = 64 remove_default_node_pool = true initial_node_count = 1 enable_intranode_visibility = false ip_allocation_policy { cluster_secondary_range_name = \"gke-pods\" services_secondary_range_name = \"gke-service\" } resource_labels = { \"env\" = \"test\" } addons_config { http_load_balancing { disabled = false } horizontal_pod_autoscaling { disabled = false } network_policy_config { disabled = false } } master_auth { client_certificate_config { issue_client_certificate = false } } private_cluster_config { enable_private_endpoint = false enable_private_nodes = true master_ipv4_cidr_block = \"172.16.0.0/28\" } logging_config { enable_components = [\"SYSTEM_COMPONENTS\", \"WORKLOADS\"] } monitoring_config { enable_components = [\"SYSTEM_COMPONENTS\"] } node_config { machine_type = \"e2-medium\" disk_size_gb = 100 disk_type = \"pd-standard\" image_type = \"COS_CONTAINERD\" oauth_scopes = [ \"https://www.googleapis.com/auth/devstorage.read_only\", \"https://www.googleapis.com/auth/logging.write\", \"https://www.googleapis.com/auth/monitoring\", \"https://www.googleapis.com/auth/servicecontrol\", \"https://www.googleapis.com/auth/service.management.readonly\", \"https://www.googleapis.com/auth/trace.append\" ] metadata = { disable-legacy-endpoints = \"true\" } } } nameï¼šå¢é›†çš„åç¨±ï¼Œåœ¨é€™å€‹å°ˆæ¡ˆåŠå€åŸŸå”¯ä¸€åç¨± (å¿…å¡«) locationï¼šè¦å°‡æ­¤å¢é›†å»ºç«‹åœ¨å“ªä¸€å€‹å€åŸŸ (é¸å¡«) min_master_versionï¼šmaster çš„æœ€ä½ç‰ˆæœ¬ (é¸å¡«) networkï¼šå¢é›†é€£æ¥åˆ°çš„ Google Compute Engine ç¶²çµ¡çš„åç¨±æˆ– self_link (é¸å¡«) subnetworkï¼šå•Ÿå‹•å¢é›†çš„ Google Compute Engine å­ç¶²çš„åç¨±æˆ– self_link (é¸å¡«) default_max_pods_per_nodeï¼šæ­¤å¢é›†ä¸­æ¯å€‹ç¯€é»çš„é è¨­æœ€å¤§ pod æ•¸ (é¸å¡«) remove_default_node_poolï¼šå¦‚æœè¨­å®šç‚º trueï¼Œå‰‡åœ¨å‰µå»ºå¢é›†æ™‚æœƒå¹«æˆ‘å€‘åˆªé™¤é è¨­çš„ç¯€é»æ± ã€‚æœƒä½¿ç”¨åˆ°é€™å€‹çš„åŸå› æ˜¯å› ç‚º terraform æ²’è¾¦æ³•ä¿®æ”¹é è¨­ç¯€é»æ± çš„åç¨±ï¼Œæ‰€ä»¥æˆ‘çš„åšæ³•æ˜¯ï¼Œæœƒæ–°å¢è¦çš„ç¯€é»æ± ï¼Œåœ¨ä½¿ç”¨é€™å€‹åƒæ•¸æŠŠé è¨­çš„çµ¦åˆªæ‰(é¸å¡«) initial_node_countï¼šè¦åœ¨æ­¤å¢é›†çš„é è¨­ç¯€é»æ± ä¸­å‰µå»ºçš„ç¯€é»æ•¸ (é¸å¡«) enable_intranode_visibilityï¼šæ˜¯å¦ç‚ºæ­¤å¢é›†å•Ÿç”¨äº†ç¯€é»å…§å¯è¦‹æ€§ (é¸å¡«) ip_allocation_policyï¼šç‚º VPC åŸç”Ÿå¢é›†åˆ†é…å¢é›† IP (é¸å¡«) resource_labelsï¼šæ‡‰ç”¨æ–¼å¢é›†çš„ GCE è³‡æºæ¨™ç±¤ key/value (é¸å¡«) addons_config http_load_balancingï¼šæ˜¯å¦è¦å•Ÿç”¨ HTTP (L7) çš„è² è¼‰å¹³è¡¡ (é¸å¡«) horizontal_pod_autoscalingï¼šæ˜¯å¦è¦å•Ÿç”¨ HPA æ°´å¹³ Pod è‡ªå‹•æ“´å±• (é¸å¡«) network_policy_configï¼šæ˜¯å¦è¦å•Ÿç”¨ç¶²è·¯ç­–ç•¥ (é¸å¡«) master_auth client_certificate_configï¼šæ˜¯å¦è¦å•Ÿç”¨è©²å¢é›†å®¢æˆ¶ç«¯è­‰æ›¸æˆæ¬Š (é¸å¡«) private_cluster_config enable_private_endpointï¼šæ˜¯å¦è¦å•Ÿç”¨å¢é›†å°ˆç”¨çš„ç§æœ‰ç«¯é»ï¼Œç¦æ­¢å…¬å…±ç«¯é»çš„è¨ªå• (é¸å¡«) enable_private_nodesï¼šæ˜¯å¦è¦å•Ÿç”¨ç§æœ‰å¢é›†åŠŸèƒ½ï¼Œåœ¨å¢é›†å‰µå»ºç§æœ‰ç«¯é» (é¸å¡«) master_ipv4_cidr_blockï¼šç§æœ‰ç«¯é» IP ç¯„åœ (é¸å¡«) logging_configï¼šå¢é›†çš„æ—¥èªŒè¨˜éŒ„é…ç½® enable_components (å…¬é–‹æ—¥èªŒçš„ GKE çµ„ä»¶) è¨­å®šï¼ŒåŒ…å«ï¼šSYSTEM_COMPONENTSã€APISERVERã€CONTROLLER_MANAGERã€SCHEDULERã€WORKLOADS (å¿…å¡«) monitoring_configï¼šå¢é›†çš„ç›£æ§é…ç½® enable_components (GKE çµ„ä»¶å…¬é–‹æŒ‡æ¨™) è¨­å®šï¼ŒåŒ…å«ï¼šSYSTEM_COMPONENTSã€APISERVERã€CONTROLLER_MANAGERã€SCHEDULER (é¸å¡«) node_configï¼šå‰µå»ºé è¨­ç¯€é»æ± åƒæ•¸ machine_typeï¼šGoogle Compute Engine æ©Ÿå™¨é¡å‹ï¼Œé è¨­ç‚º e2-medium (é¸å¡«) disk_size_gbï¼šæ¯å€‹ç¯€é»çš„ disk å¤§å°ï¼Œä»¥ GB ç‚ºå–®ä½ã€‚å…è¨±æœ€å°ç‚º 10 GBï¼Œé è¨­ç‚º 100 GB (é¸å¡«) disk_typeï¼šé€£æ¥åˆ°æ¯å€‹ç¯€é»çš„ disk é¡å‹ï¼Œæœ‰ pd-standardã€pd-balanced æˆ– pd-ssdï¼Œé è¨­ç‚º pd-standard (é¸å¡«) image_typeï¼šå‰µå»ºæ–°ç¯€é»æ± å¾Œ NAP ä½¿ç”¨çš„é è¨­ image é¡å‹ã€‚è©²å€¼å¿…é ˆæ˜¯ [COS_CONTAINERDã€COSã€UBUNTU_CONTAINERDã€UBUNTU] ä¹‹ä¸€ã€‚COS å’Œ UBUNTU å·²æ–¼ GKE 1.24 æ£„ç”¨ (é¸å¡«) oauth_scopesï¼šåœ¨é è¨­æœå‹™å¸³æˆ¶ä¸‹çš„æ‰€æœ‰ç¯€é»è™›æ“¬æ©Ÿä¸Šå¯ç”¨çš„ä¸€çµ„ Google API ç¯„åœã€‚ (é¸å¡«) metadataï¼šåˆ†é…çµ¦å¢é›†ä¸­å¯¦ä¾‹çš„ key/value (é¸å¡«) google_container_node_pool resource \"google_container_node_pool\" \"aaa\" { name = \"aaa\" project = \"project\" location = google_container_cluster.cluster.location cluster = google_container_cluster.cluster.name node_count = 6 node_locations = [ google_container_cluster.cluster.location ] node_config { # çœç•¥ ... èˆ‡ä¸Šé¢çš„ google_container_cluster ç›¸åŒ } management { auto_repair = true auto_upgrade = false } upgrade_settings { max_surge = 1 max_unavailable = 0 } } nameï¼šç¯€é»æ± åç¨± (é¸å¡«) projectï¼šå‰µå»ºç¯€é»æ± çš„é …ç›® ID (é¸å¡«) locationï¼šå¢é›†æ‰€åœ¨ä½ç½®ï¼Œå¯ä»¥ä½¿ç”¨è³‡æºåç¨± (google_container_node_pool) +å‘½å (cluster) + åƒæ•¸ (location) ä¾†ä»£è¡¨ (é¸å¡«) clusterï¼šå¢é›†åç¨±ï¼Œå¯ä»¥ä½¿ç”¨è³‡æºåç¨± (google_container_node_pool) +å‘½å (cluster) + åƒæ•¸ (name) ä¾†ä»£è¡¨ (é¸å¡«) node_countï¼šç¯€é»æ•¸é‡ (é¸å¡«) node_locationsï¼šç¯€é»å€åŸŸ (é¸å¡«) managementï¼šç¯€é»ç®¡ç†é…ç½® auto_repairï¼šæ˜¯å¦è¦è‡ªå‹•ä¿®å¾© (é¸å¡«) auto_upgradeï¼šæ˜¯å¦è¦è‡ªå‹•å‡ç´š (é¸å¡«) upgrade_settingsï¼šæŒ‡å®šç¯€é»å‡ç´šè¨­å®šåŠæ–¹å¼ max_surgeï¼šå‡ç´šæœŸé–“å¯ä»¥æ·»åŠ åˆ°ç¯€é»æ± çš„é¡å¤–ç¯€é»æ•¸ (é¸å¡«) max_unavailableï¼šå‡ç´šæœŸé–“å¯ä»¥åŒæ™‚ä¸å¯ç”¨çš„ç¯€é»æ•¸ (é¸å¡«) å¯ä»¥çœ‹åˆ°æœ‰å¾ˆå¤šè¨­å®šéƒ½æ˜¯é¸å¡«çš„ï¼Œæ‰€ä»¥ä¸éœ€è¦åƒæˆ‘ç¯„ä¾‹ä¸€æ¨£ï¼ŒæŠŠæ‰€æœ‰çš„éƒ½æ‰“å‡ºä¾†ï¼Œå¯ä»¥åƒè€ƒå®˜æ–¹æ–‡ä»¶ï¼Œå°‡è‡ªå·±æƒ³è¦çš„è¨­å®šå¯«å‡ºä¾†ï¼Œä¸¦æ³¨æ„å…¶ä»–åƒæ•¸çš„é è¨­å€¼æ˜¯å¤šå°‘ï¼Œå°±å¯ä»¥æ‰“é€ å±¬æ–¼è‡ªå·±çš„ Terraform å»ºç«‹ Google Kubernetes Engine IaC ç¨‹å¼å›‰ï½"},"title":"ä½¿ç”¨ Terraform å»ºç«‹ Google Kubernetes Engine"},"/blog/terraform/terraform-module/":{"data":{"":"ç•¶æˆ‘å€‘è¦ç®¡ç†çš„è³‡æºè¶Šä¾†è¶Šå¤šå¾Œï¼Œæœƒç”¢ç”Ÿå¾ˆå¤šçš„ tf æª”æ¡ˆï¼Œå‡è¨­æˆ‘å€‘ç¾åœ¨æœ‰ä¸‰å€‹ gce æœå‹™ï¼Œæœƒåœ¨ä»¥ä¸‹ä¸‰å€‹ä¸åŒç’°å¢ƒä¸Šé¢é‹ä½œï¼Œæ¯å€‹ç’°å¢ƒéƒ½æœƒæœ‰æˆ‘å€‘ä¹‹å‰å­¸æœƒçš„åŸºæœ¬ tf æª”æ¡ˆ(åŒ…å« provider.tf ã€main.tfã€backend.tf)ï¼Œä¸”å…¶ä¸­çš„ main.tf æª”æ¡ˆå…§æœ‰äº›è¨­å®šæœƒä¸å¤ªä¸€æ¨£ï¼Œå¦‚ä¸‹ï¼š\ndev backend.tf main.tf provider.tf prod backend.tf main.tf provider.tf qa backend.tf main.tf provider.tf dev/main.tfresource \"google_compute_instance\" \"instance\" { project = \"é¦¬è³½å…‹\" name = \"test-dev\" machine_type = \"e2-small\" zone = \"asia-east1-b\" boot_disk { initialize_params { image = \"debian-cloud/debian-10\" size = 50 } } .... å…¶ä»–çœç•¥ä¸å¯« .... } qa/main.tf (å¤šäº† tags)resource \"google_compute_instance\" \"instance\" { project = \"é¦¬è³½å…‹\" name = \"test-qa\" machine_type = \"e2-small\" zone = \"asia-east1-b\" tags = [\"for-qa\"] boot_disk { initialize_params { image = \"debian-cloud/debian-10\" size = 50 } } .... å…¶ä»–çœç•¥ä¸å¯« .... } prod/main.tf (å¤šäº† labels)resource \"google_compute_instance\" \"instance\" { project = \"é¦¬è³½å…‹\" name = \"test-prod\" machine_type = \"e2-small\" zone = \"asia-east1-b\" labels = { aaa = \"test1\" bbb = \"test2\" ccc = \"test3\" } boot_disk { initialize_params { image = \"debian-cloud/debian-10\" size = 50 } } .... å…¶ä»–çœç•¥ä¸å¯« .... } å¯ä»¥çœ‹åˆ°ä¸‰å€‹ main.tf æª”æ¡ˆé™¤äº† name ä»¥å¤–ï¼Œåœ¨ qa é‚„å¤šäº† tagsã€prod å¤šäº† labels ç­‰è¨­å®šï¼Œç­‰æ–¼æˆ‘å€‘æœƒä¾ç…§æ¯å€‹ä¸åŒç’°å¢ƒä¸åŒæœå‹™å»å®¢è£½åŒ–ä»–çš„ tf è³‡æºè¨­å®šï¼Œé›–ç„¶éå¸¸ç›´è¦ºï¼Œä½†å¾€å¾Œçš„ç¶­è­·ä»¥åŠèª¿æ•´å»éå¸¸ä¸æ–¹ä¾¿ ( å‡è¨­æˆ‘å€‘ç¾åœ¨è¦å…¨éƒ¨éƒ½åŠ ä¸Š labelsï¼Œå°±å¿…é ˆä¸€å€‹ä¸€å€‹æª¢æŸ¥ä¸¦èª¿æ•´ )ã€‚\nç‚ºäº†æ–¹ä¾¿æˆ‘å€‘ç¶­è­·ä»¥åŠé‡è¤‡ä½¿ç”¨ï¼Œå› æ­¤æœ‰äº† moduleï¼Œå¯ä»¥å…ˆå°‡å…¨éƒ¨æœƒä½¿ç”¨åˆ°çš„è¨­å®šå¯«æˆæ¨¡æ¿ï¼Œé€éåƒæ•¸çš„æ–¹å¼å¸¶å…¥å³å¯ï¼Œmodule æœ‰ä»¥ä¸‹å¹¾å€‹å„ªé»ï¼š\né‡è¤‡ä½¿ç”¨æ€§ï¼š module è®“ç¨‹å¼ç¢¼æ›´æ˜“æ–¼é‡è¤‡ä½¿ç”¨ã€‚ç•¶æˆ‘å€‘éœ€è¦åœ¨å¤šå€‹é …ç›®ä¸­ä½¿ç”¨ç›¸åŒçš„åŸºç¤æ¶æ§‹æˆ–é…ç½®æ™‚ï¼Œå¯ä»¥å…ˆå°‡å…¶å°è£ç‚ºä¸€å€‹ moduleã€‚é€™æ¨£ï¼Œæˆ‘å€‘åªéœ€è¦åœ¨ä¸åŒçš„é …ç›®ä¸­å¼•ç”¨ä¸¦èª¿æ•´æ¨¡çµ„çš„åƒæ•¸ï¼Œè€Œä¸éœ€è¦é‡æ–°å¯«æ•´å€‹ tf æª”ã€‚\næŠ½è±¡åŒ–ï¼šå°‡ Terraform ä»£ç¢¼è½‰æ›ç‚º module å¯ä»¥å°‡è©³ç´°çš„å¯¦ç¾ç´°ç¯€æŠ½è±¡åŒ–ï¼Œåƒ…å¯«å¿…è¦çš„åƒæ•¸ã€‚é€™æ¨£åšå¯ä»¥æé«˜ç¨‹å¼ç¢¼çš„å¯è®€æ€§å’Œå¯ç¶­è­·æ€§ï¼Œä¸¦é™ä½ä½¿ç”¨è€…å­¸ç¿’å’Œä½¿ç”¨çš„é–€æª»ã€‚\nåƒæ•¸åŒ–é…ç½®ï¼šmodule å¯ä»¥ä½¿ç”¨è¼¸å…¥åƒæ•¸ä¾†æ¥æ”¶ä¸åŒçš„é…ç½®å€¼ã€‚é€™æ„å‘³è‘—æ‚¨å¯ä»¥æ ¹æ“šéœ€è¦å‹•æ…‹æ›´æ”¹æ¨¡çµ„çš„è¡Œç‚ºï¼Œè€Œä¸éœ€è¦ç›´æ¥ä¿®æ”¹æ¨¡çµ„çš„å…§éƒ¨ç¨‹å¼ã€‚é€™ä½¿å¾—é…ç½®æ›´éˆæ´»ä¸¦æ”¯æŒä¸åŒç’°å¢ƒçš„éƒ¨ç½²ã€‚\nmodule ç‰ˆæœ¬æ§åˆ¶ï¼šå°‡ Terraform ç¨‹å¼å°è£ç‚º module å¾Œï¼Œå¯ä»¥ä½¿ç”¨ git å°å…¶é€²è¡Œç‰ˆæœ¬æ§åˆ¶ã€‚å¯ä»¥æ›´è¼•é¬†åœ°å”ä½œå’Œå…±äº« module (å¯ä»¥å°‡ module èˆ‡ Terraform åˆ†åˆ¥å­˜æ”¾ï¼Œä¸¦ä½¿ç”¨å°æ‡‰ tag or åˆ†æ”¯ä¾†åšé–‹ç™¼ )ã€‚","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"Types and Valuesï¼šhttps://developer.hashicorp.com/terraform/language/expressions/types","å¯¦ä½œ#å¯¦ä½œ":"ç•¶æˆ‘å€‘å®Œæˆä¸Šé¢çš„æ¶æ§‹å¾Œï¼Œæˆ‘å€‘é€²å…¥ projects/prod/main.tf è·¯å¾‘ä¸‹ï¼Œé–‹å§‹ç”¨ module çš„æ–¹å¼å»ºç«‹è³‡æºï¼Œå»ºç«‹è³‡æºçš„æµç¨‹èˆ‡åŸæœ¬çš„ç›¸åŒï¼Œä¸€æ¨£æ˜¯ init \u003e plan \u003e apply é€™ä¸‰å€‹æ­¥é©Ÿï¼Œé‚£æˆ‘å€‘ä¸€å€‹ä¸€å€‹ä¾†çœ‹ï¼Œèˆ‡åŸæœ¬çš„å»ºç«‹æ–¹å¼æœ‰å“ªäº›ä¸åŒä¹‹è™•å§ï½\ninit æˆ‘å€‘ä½¿ç”¨ terraform init ä¾†çœ‹çœ‹åŸæœ¬ init èˆ‡ä½¿ç”¨æ¨¡çµ„ init å¾Œå·®åœ¨å“ªè£¡ï¼š\nåŸå…ˆ terraform init çµæœ\nä½¿ç”¨ module init çµæœ\nå¯ä»¥çœ‹åˆ°æœ‰ä½¿ç”¨ module åœ¨åˆå§‹åŒ–çš„æ™‚å€™ï¼Œæœƒé€£åŒ module ä¹Ÿä¸€ä½µåˆå§‹åŒ–ï¼Œæ¥è‘—æˆ‘å€‘é€²åˆ° .terraform è³‡æ–™å¤¾å…§ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ moduels è³‡æ–™å¤¾ã€‚\n.terraform æª”æ¡ˆå·®ç•°\nåœ¨é€²å»çœ‹æœƒçœ‹æœ‰ä¸€å€‹ modules.json æª”æ¡ˆï¼Œæœƒç´€éŒ„ module ä½¿ç”¨çš„è·¯å¾‘ï¼Œå› æ­¤ç•¶æˆ‘å€‘ä½¿ç”¨çš„ module æœ‰æ”¹è®Šæ™‚ï¼Œè¦è¨˜å¾—é‡æ–° init æ‰å¯ä»¥ç¢ºä¿ä½¿ç”¨çš„ module æ˜¯æ­£ç¢ºçš„ã€‚\nä½¿ç”¨ module æœƒå¤šä¸€å€‹ modules.json æª”æ¡ˆ\nplan æˆ‘å€‘ä¸€æ¨£ä¸‹ terraform plan æŒ‡ä»¤ï¼Œä¾†çœ‹çœ‹å…©è€…é¡¯ç¤ºçš„å·®ç•°ï¼š\nåŸå…ˆ terraform plan çµæœ\nä½¿ç”¨ module plan çµæœ\nå¯ä»¥çœ‹åˆ°ä½¿ç”¨ module åœ¨ plan æ™‚ï¼Œé è¦½å‰µå»ºçš„è³‡æºæ ¼å¼ä¸åŒï¼Œä¹Ÿå°±ä»£è¡¨ä»–å­˜åœ¨ tfstate æª”æ¡ˆçš„æ ¼å¼ä¹Ÿæœƒä¸åŒ (é€™å€‹å¾Œé¢æœƒåœ¨æåˆ°ï¼Œèˆ‡ import ä¹Ÿæœ‰é—œä¿‚)\napply ä½¿ç”¨ terraform apply ä¾†çœ‹å»ºç«‹è³‡æºå¾Œçš„çµæœæœ‰ä»€éº¼ä¸åŒï¼š\nåŸå…ˆ terraform apply çµæœ\nä½¿ç”¨ module apply çµæœ\napply çœ‹åˆ°çš„èˆ‡ plan é¡¯ç¤ºçš„ä¸€æ¨£ï¼Œä½¿ç”¨ module å»ºç«‹çš„è³‡æ–™æ ¼å¼æœƒä¸å¤ªä¸€æ¨£ï¼Œæ‰€ä»¥æˆ‘å€‘ä¾†çœ‹çœ‹å…©è€… tfstate æª”æ¡ˆçš„å·®ç•°ï¼š\nåŸå…ˆ terraform å»ºç«‹çš„ tfstate æª”æ¡ˆ\nä½¿ç”¨ module å»ºç«‹çš„ tfstate æª”æ¡ˆ\nimport import çš„åŠŸç”¨æ˜¯å¯ä»¥å¾é›²ä¸Šæœå‹™è½‰æˆ tfï¼Œåœ¨ä¹‹å‰åŸæœ¬çš„ terraform æ˜¯è¦å…ˆå»ºç«‹ä¸€å€‹ç©ºçš„ resourceï¼š\nresource \"google_compute_instance\" \"instance\" { } å†ä½¿ç”¨ terraform import google_compute_instance.instance å°ˆæ¡ˆID/æ©Ÿå™¨åœ°å€/æ©Ÿå™¨åç¨± ä¾†åŒ¯å…¥é›²ä¸Šæœå‹™çš„ç‹€æ…‹åˆ°å¾Œç«¯å­˜åˆ° tfstate çš„ä½å­ã€‚\nåŸå…ˆ terraform import ç·šä¸Šæœå‹™\né‚£æˆ‘å€‘ç¾åœ¨æ”¹æˆ moduleï¼Œæœƒæ¯”è¼ƒéº»ç…©ä¸€é»ï¼Œå› ç‚ºæˆ‘å€‘æœ‰åœ¨ variables.tf è¨­å®šæˆ‘å€‘çš„è®Šæ•¸ï¼Œè‹¥æ˜¯æ²’æœ‰è¨­å®šé è¨­å€¼ï¼Œå°±å¿…é ˆä¸€å®šè¦è¼¸å…¥ï¼Œæ‰€ä»¥æˆ‘å€‘åœ¨å»ºç«‹æ™‚ï¼Œè¦å…ˆæŠŠè®Šæ•¸çš„ç©ºå€¼ä¹Ÿè£œä¸Šï¼Œå¦‚ä¸‹ï¼š\nmodule \"ian-test\" { source = \"../../module/google_compute_instance\" project_id = \"\" instance_name = \"\" machine_type = \"\" instance_zone = \"\" instance_tags = [] instance_labels = {} boot_disk_image_name = \"\" boot_disk_size = 50 attached_disk_enabled = false network_name = \"\" subnetwork_name = \"\" nat_ip_enabled = false metadata = {} resource_policies = [] service_account_email = \"\" service_account_scopes = [] } \" \" æ˜¯ string æ ¼å¼çš„ç©ºå€¼ï¼Œ[ ] æ˜¯ list æ ¼å¼çš„ç©ºå€¼ï¼Œ{ } æ˜¯ map æ ¼å¼çš„ç©ºå€¼ï¼Œå…¶ä»–çš„ bool æˆ‘é è¨­æœƒçµ¦ä»– falseï¼Œnumber æˆ‘æœƒéš¨ä¾¿çµ¦ä»–ä¸€å€‹æ•¸å­— xDã€‚é€™é‚Šå¸¶å…¥çš„å…§å®¹ä¸æ˜¯å¾ˆé‡è¦ï¼Œä¸»è¦æ˜¯è®“ä»–å¯ä»¥å»æŠ“åˆ°ä»–çš„æ¶æ§‹ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥åœ¨ variables.tf è¨­å®šæ™‚éƒ½è£œä¸Šé è¨­å€¼ã€‚\nå†ä½¿ç”¨ terraform import module.ian-test.google_compute_instance.instance å°ˆæ¡ˆID/æ©Ÿå™¨åœ°å€/æ©Ÿå™¨åç¨± ä¾†åŒ¯å…¥ç‹€æ…‹æª”æ¡ˆã€‚(é€™é‚Šè¦è¨˜å¾—ä¾ç…§ä½  module è¨­å®šçš„åç¨±å¸¶å…¥)\nä½¿ç”¨ module import ç·šä¸Šæœå‹™","æª”æ¡ˆèªªæ˜#æª”æ¡ˆèªªæ˜":"\né¦–å…ˆæˆ‘å€‘è¦å…ˆå®šç¾©æˆ‘å€‘çš„ moduleï¼Œæˆ‘å€‘å…ˆå»ºç«‹ä»¥ä¸‹è³‡æ–™å¤¾çµæ§‹ä»¥åŠå°æ‡‰æª”æ¡ˆï¼š(åŒæ­¥åˆ° GitHub éœ€è¦ç¨‹å¼ç¢¼çš„å¯ä»¥å‰å¾€æŸ¥çœ‹)\n(å†æ¬¡æé†’ï¼Œæœƒå€åˆ†æª”æ¡ˆåç¨±æ˜¯å› ç‚ºæ–¹ä¾¿èª¿æ•´è·Ÿç¶­è­·ï¼Œä¹Ÿå¯ä»¥æŠŠå®ƒå…¨éƒ¨å¯«åœ¨åŒä¸€å€‹ tf æª”æ¡ˆå…§æ­)\nmodule google_compute_instance main.tf outputs.tf variables.tf projects dev backend.tf main.tf provider.tf prod backend.tf main.tf provider.tf qa backend.tf main.tf provider.tf module è³‡æ–™å¤¾ï¼šæ”¾æˆ‘å€‘ module è¨­å®š (é€™é‚Šç¯„ä¾‹æ˜¯æ”¾ gce)\nprojects è³‡æ–™å¤¾ï¼šæ”¾æˆ‘å€‘ä¸åŒæœå‹™ã€ä¸åŒç’°å¢ƒè¨­å®š (é€™é‚Šç‚ºäº†ç°¡åŒ–ï¼Œç¯„ä¾‹åªä»¥ä¸åŒç’°å¢ƒç‚ºä¾‹)\nmodule/google_compute_instance/main.tfprovider \"google\" { project = var.project_id zone = var.instance_zone } resource \"google_compute_instance\" \"instance\" { name = var.instance_name machine_type = var.machine_type zone = var.instance_zone tags = var.instance_tags labels = var.instance_labels boot_disk { auto_delete = var.boot_disk_auto_delete initialize_params { image = var.boot_disk_image_name size = var.boot_disk_size } } dynamic \"attached_disk\" { for_each = var.attached_disk_enabled ? [1] : [] content { device_name = var.attached_disk_name mode = var.attached_disk_mode source = var.attached_disk_source } } network_interface { network = var.network_name subnetwork = var.subnetwork_name dynamic \"access_config\" { for_each = var.nat_ip_enabled ? [1] : [] content { } } } metadata = var.metadata enable_display = var.enable_display resource_policies = var.resource_policies service_account { email = var.service_account_email scopes = var.service_account_scopes } timeouts {} deletion_protection = var.deletion_protection allow_stopping_for_update = var.allow_stopping_for_update } æˆ‘å€‘éœ€è¦æŠŠæ‰€æœ‰è¨­å®šçš„å€¼éƒ½æŒ–æ´ï¼Œä½¿ç”¨ var çš„æ–¹å¼ä¾†å¸¶å…¥åƒæ•¸ï¼Œé€™é‚Šè¦æ³¨æ„çš„æ˜¯ç­‰è™Ÿå‰é¢çš„å€¼æˆ–æ˜¯ block åç¨±éƒ½æ˜¯ä¸èƒ½ä¿®æ”¹çš„ï¼Œä»–æ˜¯ google å®šç¾©çš„ api è®Šæ•¸ï¼Œä½† var å¾Œçš„åƒæ•¸åç¨±æˆ‘å€‘å¯ä»¥è‡ªè¨‚ (å¾Œé¢ variable.tf æœƒåœ¨è©³ç´°èªªæ˜)ï¼Œé‚£é€™é‚Šæ¯”è¼ƒç‰¹åˆ¥çš„ç”¨æ³•æ˜¯ dynamicï¼Œä»¥ä¸‹èªªæ˜ï¼š\ndynamic \"attached_disk\" { for_each = var.attached_disk_enabled ? [1] : [] content { device_name = var.attached_disk_name mode = var.attached_disk_mode source = var.attached_disk_source } } æˆ‘å€‘æœ‰äº› block åªæœ‰åœ¨ç‰¹å®šæœå‹™æ™‚æ‰éœ€ä½¿ç”¨ï¼Œä¾‹å¦‚ä¸Šé¢çš„ attached_disk ä»–æ˜¯ gce å¦å¤–æ›è¼‰å…¶ä»–ç£ç¢Ÿçš„è¨­å®šï¼Œå¦‚æœæœ‰éœ€è¦æˆ‘å€‘æ‰æœƒå¤šè¨­å®šé€™å€‹ blockï¼Œæ²’æœ‰å‰‡ä¸éœ€è¦åŠ ï¼Œå› æ­¤é ˆä½¿ç”¨ dynamic ä¾†å‹•æ…‹ç”¢ç”Ÿ blockï¼Œé€™é‚Šçš„è¨­å®šæ˜¯æˆ‘å€‘è¦åœ¨åƒæ•¸è¦å¸¶å…¥ attached_disk_enabled ç”¨ for_each ä¾†åˆ¤æ–·æ˜¯å¦éœ€è¦é€™å€‹ blockï¼Œå¦‚æœæ˜¯ trueï¼Œå°±æœƒç”¢ç”Ÿ attached_disk blockï¼Œä¸”éœ€è¦è¼¸å…¥ attached_disk_nameã€attached_disk_modeã€attached_disk_sourceã€‚\nmodule/google_compute_instance/variables.tfvariable \"project_id\" { type = string description = \"GCP å°ˆæ¡ˆ ID\" } variable \"instance_name\" { type = string description = \"GCE åç¨±\" } variable \"machine_type\" { type = string description = \"GCE é¡å‹\" } variable \"instance_zone\" { type = string description = \"GCE æ‰€åœ¨å€åŸŸ\" } variable \"instance_tags\" { type = list(string) description = \"GCE ç¶²è·¯æ¨™è¨˜\" } variable \"instance_labels\" { type = map(string) description = \"GCE æ¨™ç±¤\" } variable \"boot_disk_auto_delete\" { type = bool description = \"æ˜¯å¦åˆªé™¤ instance æ™‚ï¼Œè‡ªå‹•åˆªé™¤é–‹æ©Ÿç£ç¢Ÿ\" default = true } variable \"boot_disk_image_name\" { type = string description = \"GCE æ˜ åƒæª”åç¨±\" } variable \"boot_disk_size\" { type = number description = \"GCE é–‹æ©Ÿç£ç¢Ÿå¤§å° (å–®ä½: GB)\" } variable \"attached_disk_enabled\" { type = bool description = \"æ˜¯å¦å•Ÿç”¨é™„åŠ ç£ç¢Ÿ\" default = false } variable \"attached_disk_name\" { type = string description = \"GCE é™„åŠ ç£ç¢Ÿåç¨±\" default = \"\" } variable \"attached_disk_mode\" { type = string description = \"GCE é™„åŠ ç£ç¢Ÿæ¨¡å¼\" default = \"READ_ONLY\" validation { condition = contains([\"READ_WRITE\", \"READ_ONLY\"], var.attached_disk_mode) error_message = \"ä¸ç¬¦åˆé™„åŠ ç£ç¢Ÿæ¨¡å¼çš„å€¼ï¼Œè«‹è¼¸å…¥ READ_WRITE æˆ– READ_ONLY\" } } variable \"attached_disk_source\" { type = string description = \"GCE é™„åŠ ç£ç¢Ÿä¾†æº\" default = \"\" } variable \"network_name\" { type = string description = \"GCE ç¶²è·¯åç¨±\" } variable \"subnetwork_name\" { type = string description = \"GCE å­ç¶²è·¯åç¨±\" } variable \"nat_ip_enabled\" { type = bool description = \"æ˜¯å¦å•Ÿç”¨ NAT IP\" default = false } variable \"metadata\" { type = map(string) description = \"GCE ä¸­ç¹¼è³‡æ–™\" } variable \"enable_display\" { type = bool description = \"æ˜¯å¦å•Ÿç”¨è™›æ“¬é¡¯ç¤º\" default = false } variable \"resource_policies\" { type = list(string) description = \"GCE è³‡æºåŸå‰‡\" } variable \"service_account_email\" { type = string description = \"GCE æœå‹™å¸³æˆ¶é›»å­éƒµä»¶\" } variable \"service_account_scopes\" { type = list(string) description = \"GCE æœå‹™å¸³æˆ¶ç¯„åœ\" } variable \"deletion_protection\" { type = bool description = \"æ˜¯å¦å•Ÿç”¨åˆªé™¤ä¿è­·\" default = false } variable \"allow_stopping_for_update\" { type = bool description = \"æ˜¯å¦å…è¨±è‡ªå‹•åœæ­¢å¾Œæ›´æ–°\" default = false } é€™å€‹æª”æ¡ˆæœƒå®šç¾©æ¯å€‹è®Šæ•¸çš„åç¨±ä»¥åŠè³‡æ–™å‹æ…‹ï¼Œä¹Ÿå¯ä»¥å¯«èªªæ˜ä»¥åŠé è¨­çš„å€¼ï¼Œé€™é‚Šæ¯”è¼ƒç‰¹åˆ¥çš„æ˜¯ validation ï¼Œä»–å¯ä»¥é©—è­‰å¸¶å…¥çš„åƒæ•¸æ˜¯å¦ç¬¦åˆ condition å…§å®¹ï¼Œä¹Ÿå¯ä»¥è‡ªå®šç¾©éŒ¯èª¤çš„è¨Šæ¯ï¼Œå¦‚ä¸‹ï¼š\nvariable \"attached_disk_mode\" { type = string description = \"GCE é™„åŠ ç£ç¢Ÿæ¨¡å¼\" default = \"READ_ONLY\" validation { condition = contains([\"READ_WRITE\", \"READ_ONLY\"], var.attached_disk_mode) error_message = \"ä¸ç¬¦åˆé™„åŠ ç£ç¢Ÿæ¨¡å¼çš„å€¼ï¼Œè«‹è¼¸å…¥ READ_WRITE æˆ– READ_ONLY\" } } é€™é‚Šé™åˆ¶ attached_disk_mode è¼¸å…¥å¿…é ˆç¬¦åˆ READ_WRITE or READ_ONLY çš„å€¼ï¼Œå¦‚æœè¼¸å…¥å…¶ä»–ä¸ç¬¦åˆçš„æœƒé¡¯ç¤º error_message å…§å®¹ã€‚\nå¦å¤– variable é€™é‚Šæœ‰å¹¾å€‹è³‡æ–™å‹æ…‹å¯ä»¥é¸æ“‡ï¼Œå¦‚ä¸‹ï¼š\nstringï¼šå­—ä¸²ï¼Œä¸çŸ¥é“è¦é¸ä»€éº¼å°±é¸ä»–æ²’éŒ¯ xD\nboolï¼šå¸ƒæ—å€¼ï¼Œåªæœ‰ trueã€false å…©ç¨®é¸é …ï¼Œé©ç”¨æ–¼åˆ¤æ–·çš„å…§å®¹ï¼Œä¾‹å¦‚å‰›å‰›ä¸Šé¢èªªçš„ attached_disk_enabled å°±æ˜¯ä½¿ç”¨ bool\nnumberï¼šæ•¸å­—ï¼Œåªèƒ½è¼¸å…¥æ•¸å­—\nlist (tuple)ï¼šæ¸…å–®ï¼Œå…§å®¹å¯ä»¥æ”¾ç½®é¡ä¼¼ [\"us-west-1a\", \"us-west-1c\"] çš„è³‡æ–™\nmap (object)ï¼š key value å­˜æ”¾æ¨¡å¼ï¼Œä¾‹å¦‚ï¼š\n{ \"aaa\": \"test1\", \"bbb\": \"test2\", \"ccc\": \"test3\" } module/google_compute_instance/outputs.tfoutput \"instance_id\" { value = google_compute_instance.instance.instance_id } é€™é‚Šä¸»è¦æ”¾ç½®è¦è¼¸å‡ºçš„å…§å®¹ï¼Œåƒæˆ‘å€‘é€™é‚Šå°±æœƒæŠŠ instance_id çµ¦é¡¯ç¤ºå‡ºä¾†ã€‚\nprojects æˆ‘é€™é‚Šåªç¤ºç¯„ prod çš„éƒ¨åˆ†\nprojects/prod/main.tfmodule \"ian-test\" { source = \"../../module/google_compute_instance\" project_id = \"é¦¬è³½å…‹\" instance_name = \"test-prod\" machine_type = \"e2-small\" instance_zone = \"asia-east1-b\" instance_tags = [] instance_labels = { \"aaa\" = \"test1\" \"bbb\" = \"test2\" \"ccc\" = \"test3\" } boot_disk_image_name = \"debian-cloud/debian-10\" boot_disk_size = \"50\" attached_disk_enabled = false network_name = \"é¦¬è³½å…‹\" subnetwork_name = \"é¦¬è³½å…‹\" nat_ip_enabled = false metadata = {} resource_policies = [] service_account_email = \"é¦¬è³½å…‹\" service_account_scopes = [\"storage-ro\", \"logging-write\", \"monitoring-write\", \"service-control\", \"service-management\", \"trace\"] } é€™é‚Šæˆ‘å€‘å¯ä»¥å®šç¾©è¦ä½¿ç”¨ module çš„å«ä»€éº¼ï¼Œé€™é‚Šæˆ‘å°±å–å google_compute_instanceï¼Œç„¶å¾Œä»–æœƒå» source \"../../module/ian-test\"ï¼Œä¹Ÿå°±æ˜¯æˆ‘å€‘å‰›å‰›åœ¨ä¸Šé¢å…ˆæŒ–æ´çš„æ¨¡æ¿ï¼Œåº•ä¸‹å°±é–‹å§‹å¸¶å…¥æˆ‘å€‘åœ¨ variables.tf æœ‰è¨­å®šçš„åƒæ•¸ã€‚é€™é‚Šæ¯”è¼ƒè¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ main.tfã€variables.tf æœ‰ä½¿ç”¨çš„è®Šæ•¸è¨­å®šï¼Œéƒ½å¿…é ˆè¦å¯«åœ¨å€‹åˆ¥è³‡æº tf çš„æª”æ¡ˆè£¡é¢ï¼Œæ²’æœ‰çš„å°±å¸¶å…¥å°æ‡‰è³‡æ–™å‹æ…‹çš„ç©ºå€¼ï¼Œä¾‹å¦‚ instance_tagsã€metadataã€resource_policies ç­‰ç­‰ã€‚"},"title":"å¦‚ä½•å°‡ Terraform æ”¹å¯«æˆ module ?"},"/blog/terraform/terraform-tfstate/":{"data":{"":"æ­¤ç¯‡æ˜¯æ¥çºŒä¸Šä¸€ç¯‡ ä»€éº¼æ˜¯ IaC ? Terraform åˆæ˜¯ä»€éº¼ï¼Ÿçš„ Terraform æ–‡ç« ï¼Œæˆ‘å€‘åœ¨ä¸Šä¸€ç¯‡æœ‰æåˆ° terraform apply å®Œå¾Œï¼Œæœƒå¤šä¸€å€‹æª”æ¡ˆ *.tfstateï¼Œé€™å€‹æª”æ¡ˆæ˜¯ç”¨ä¾†å­˜æ”¾æœå‹™ç‹€æ…‹çš„æª”æ¡ˆï¼Œå®ƒåŒ…å«åŸºç¤æ¶æ§‹çš„ç‹€æ…‹å’Œè³‡æºçš„è©³ç´°ä¿¡æ¯ã€‚å‡è¨­å¤§å®¶éƒ½åœ¨è‡ªå·±çš„æœ¬åœ°å» apply åŒä¸€å€‹æœå‹™ï¼Œæœƒå°è‡´æ¯å€‹äººçš„ tfstate æª”æ¡ˆå…§å®¹ä¸åŒï¼Œæœ‰å¯èƒ½å»è¦†è“‹æ‰å…¶ä»–äººå·²ç¶“èª¿æ•´çš„å…§å®¹ï¼Œå› æ­¤æˆ‘å€‘å¿…é ˆå°‡æ­¤ tfstate æª”æ¡ˆå­˜æ”¾åœ¨ä¸€å€‹åœ°æ–¹ï¼Œè®“å¤§å®¶éƒ½å»ä½¿ç”¨åŒä¸€ä»½æª”æ¡ˆä¾†èª¿æ•´è³‡æºã€‚\næˆ‘å€‘å¸¸ç”¨çš„å„²å­˜æ–¹å¼æœƒå°‡ tfstate å­˜åœ¨ gitlab æˆ– gcs (gcp æ¶æ§‹ç‚ºä¾‹)ï¼Œä»¥ä¸‹æœƒç°¡å–®èªªæ˜è¦å¦‚ä½•æŠŠ tfstate å­˜åˆ°å¾Œç«¯ä»¥åŠå„é é¢çš„åŠŸèƒ½ï¼š","gcs#gcs":"gcs å„²å­˜æ¯”è¼ƒç°¡å–®ä¸€é»ï¼Œå› ç‚ºä»–å°±æ˜¯ä¸€å€‹ bucketï¼Œæ‰€ä»¥é é¢å°±è·Ÿä¸€èˆ¬çš„ gcs ä¸€æ¨£ï¼Œæœƒé¡¯ç¤ºæª”æ¡ˆåç¨±ã€å¤§å°ã€é¡å‹ç­‰ï¼Œå¦‚æœéœ€è¦æŸ¥çœ‹ tfstateï¼Œå¯ä»¥é»æ“Šæœ€å¾Œçš„ä¸‹è¼‰æŒ‰éˆ•ä¾†æŸ¥çœ‹\né‚£æˆ‘å€‘æ¥è‘—ä½¿ç”¨ä¸Šé¢ gitlab çš„ç¯„ä¾‹æª”æ¡ˆï¼Œåªæ˜¯è¦å°‡ backend.tf å…§å®¹æ”¹ç‚ºä»¥ä¸‹ï¼š\nbackend.tfterraform { backend \"gcs\" { bucket = \"pid-terraform-state\" prefix = \"/aaa\" } } ä¸Šé¢çš„è¨­å®šæ˜¯æŒ‡ï¼Œæˆ‘å€‘å°‡ backend å¾Œç«¯è¨­å®šæ”¹æˆ gcsï¼Œä¸¦ä¸”é¸æ“‡åç‚º pid-terraform-state çš„ bucketï¼Œæ­¤ bucket éœ€è¦å…ˆæ‰‹å‹•å»ºç«‹(å› ç‚º bucket åç¨±æ˜¯å…¨åŸŸä¸é‡è¤‡ï¼Œæ‰€ä»¥ä¸éœ€è¦ç‰¹åˆ¥è¨­å®šå…¶ project_idï¼Œåªè¦æœ‰æ¬Šé™æ­£ç¢ºéƒ½å¯ä»¥è·¨å°ˆæ¡ˆä½¿ç”¨)ï¼Œä»¥åŠæˆ‘å€‘è¦å°‡æ­¤ tfstate å­˜åœ¨ aaa è³‡æ–™å¤¾å…§ã€‚\næ¥è‘—æˆ‘å€‘é‡æ–°åˆªé™¤å‰›å‰› gitlab å·²ç”¢ç”Ÿçš„ .terraform/ è·Ÿ .terraform.lock.hcl æª”æ¡ˆï¼Œé‡æ–°ä¸‹ initï¼Œå°±å¯ä»¥åˆ° gcs å°æ‡‰è³‡æ–™å¤¾ä¸‹ï¼Œæ–°å¢äº† defaulte.tfstate æª”æ¡ˆã€‚\nç”¢ç”Ÿ defaulte.tfstate\nLock æˆ‘å€‘ä¸€æ¨£ä¾†çœ‹ä¸€ä¸‹ gcs çš„ lock æœƒé•·ä»€éº¼æ¨£å­ï¼Œgcs lock æœƒç”¢ç”Ÿä¸€å€‹ default.tflock æª”æ¡ˆï¼Œç”±ä»–å»åˆ¤æ–·ç¾åœ¨æ˜¯å¦æ˜¯ Lock ç‹€æ…‹\ngcs Lock æœƒå‡ºç¾ .tflock æª”æ¡ˆ\nç•¶æœ‰å…¶ä»–äººä¹ŸåŸ·è¡Œ plan or apply å¾Œï¼Œå°±æœƒé¡¯ç¤ºä»¥ä¸‹ï¼š\ngcs Lock å…¶ä»–äººä¸èƒ½æ“ä½œ","gitlab#gitlab":"é‚£æˆ‘å€‘è¦æ€éº¼æŠŠ tfstate å­˜åˆ° gitlab å‘¢ï¼Ÿé¦–å…ˆè·Ÿä¹‹å‰ä¸€æ¨£ï¼Œå…ˆæ–°å¢ provider.tf ä¾†æ”¾ä¾›æ‡‰å•†çš„ä¾†æºä»¥åŠç‰ˆæœ¬ï¼Œä»¥åŠ main.tf ä¾†æ”¾ gce ç›¸é—œè¨­å®šï¼Œæœ€å¾Œé‚„è¦å¤šä¸€å€‹ backend.tf ä¾†æ”¾æˆ‘å€‘è¦å„²å­˜ tfstate çš„ä½ç½®è¨­å®šï¼Œå¦‚ä¸‹ï¼š(åŒæ­¥åˆ° GitHub éœ€è¦ç¨‹å¼ç¢¼çš„å¯ä»¥å‰å¾€æŸ¥çœ‹)\n(é€™æ¬¡ç¯„ä¾‹æœƒä½¿ç”¨ gceï¼Œæ­¤é …æœƒéœ€è¦ gitlab å…ˆå•Ÿç”¨ Infrastructure åŠŸèƒ½ä»¥åŠå»ºç«‹è‡ªå·±çš„ gitlab token)\nprovider.tfterraform { required_providers { google = { source = \"hashicorp/google\" version = \"~\u003e 4.48.0\" } } } main.tf provider \"google\" { project = \"XXXXX\" zone = \"asia-east1-b\" } resource \"google_compute_instance\" \"instance\" { name = \"test\" machine_type = \"e2-small\" zone = \"asia-east1-b\" labels = { env = \"11\" } boot_disk { initialize_params { image = \"debian-cloud/debian-10\" } } network_interface { network = \"projects/XXXX/global/networks/test\" subnetwork = \"projects/XXXX/regions/asia-east1/subnetworks/testtest\" } } backend.tf Â« æ–°çš„ å°ˆæ¡ˆ ID è¦å¯«æˆ‘å€‘æƒ³è¦æ”¾ terraform state çš„ GitLab Project IDï¼Œæœå‹™åç¨±æ˜¯æŒ‡é¡¯ç¤ºåœ¨ GitLab terraform state çš„åç¨±\ngitlab å€‹äºº token æ˜¯æŒ‡å€‹äººå­˜å–æ¬Šæ–ï¼Œå¤§å®¶å†ä¾ç…§è‡ªå·±çš„ä¾†åšè¨­å®š\nbackend.tfterraform { backend \"http\" { address = \"[Gitlab ç¶²å€]/api/v4/projects/[å°ˆæ¡ˆID]/terraform/state/[æœå‹™åç¨±]\" lock_address = \"[Gitlab ç¶²å€]/api/v4/projects/[å°ˆæ¡ˆID]/terraform/state/[æœå‹™åç¨±]/lock\" unlock_address = \"[Gitlab ç¶²å€]/api/v4/projects/[å°ˆæ¡ˆID]/terraform/state/[æœå‹™åç¨±]/lock\" username = \"[Gitlab å¸³è™Ÿ]\" password = \"[Gitlab å€‹äºº token]\" lock_method = \"POST\" unlock_method = \"DELETE\" retry_wait_min = 5 } } ç•¶æˆ‘å€‘æ–°å¢å¥½å¾Œï¼Œå°±è·Ÿä¹‹å‰æ­¥é©Ÿä¸€æ¨£ï¼Œå…ˆ init \u003e plan \u003e apply ä¾†åšæ¸¬è©¦ï¼Œåœ¨ init æ™‚æœƒç™¼ç¾ï¼Œèˆ‡ä¹‹å‰ä¸å¤ªä¸€æ¨£çš„æ˜¯ï¼Œåœ¨ Initializing the backend çš„ä¸‹æ–¹æœ‰å¤šäº†ç¶ è‰²çš„æˆåŠŸè¨­å®šå¾Œç«¯å­—æ¨£ï¼Œä»£è¡¨ä»–ä¹Ÿæœƒå°‡å¾Œç«¯çš„ç›¸é—œè³‡è¨Šå­˜é€² .terraform è³‡æ–™å¤¾ä¸­ï¼Œæ‰€ä»¥æœ‰è®Šæ›´å¾Œç«¯å„²å­˜ä½ç½®ï¼Œè¦è¨˜å¾—é‡æ–° init æ­\ninit åˆå§‹åŒ–å¾Œï¼Œæœƒå°‡å¾Œç«¯è³‡è¨Šä¹Ÿå­˜åˆ° .terraform è³‡æ–™å¤¾\nç•¶æˆ‘å€‘ plan \u003e apply å®Œæˆå¾Œï¼Œå¯ä»¥è§€å¯Ÿä¸€ä¸‹ï¼Œç™¼ç¾åŸæœ¬æœƒç”¢ç”Ÿçš„ terraform.tfstate æª”æ¡ˆæ²’æœ‰å‡ºç¾åœ¨è©²ç›®éŒ„ä¸‹ï¼š\napply å®Œï¼Œæ²’æœ‰åœ¨æœ¬åœ°ç”¢ç”Ÿ .tfstate æª”æ¡ˆ\né€™æ™‚å€™ï¼Œæˆ‘å€‘å¯ä»¥åˆ°å‰›å‰›åœ¨ä¸Šé¢è¨­å®šçš„å°ˆæ¡ˆ ID å…§çš„æœ‰ä¸€å€‹ Infrastructure / Terraformï¼Œè£¡é¢å°±æœƒå­˜æ”¾ Terraform state æª”æ¡ˆï¼Œå¦‚ä¸‹ï¼š\ngitlab/Infrastructure/Terraform\næœƒé¡¯ç¤ºç‹€æ…‹åç¨±ã€æ›´æ–°è³‡è¨Šã€ä»¥åŠ Actions ç­‰æ¬„ä½ï¼š\ngitlab terraform tfstate ç¶²é \nåŠŸèƒ½éƒ¨åˆ†å¯ä»¥çœ‹å¾Œé¢çš„ Actions æ¬„ä½åº•ä¸‹æœ‰ä¸‰å€‹é»é»ï¼Œå¯ä»¥ä¸‹è¼‰å°æ‡‰çš„ tfstate æª”æ¡ˆã€Lock è®“å…¶ä»–äººä¸èƒ½å°æ­¤é€²è¡Œ applyï¼Œæˆ–æ˜¯åˆªé™¤æ­¤ tfstate æª”æ¡ˆç­‰\ngitlab terraform tfstate åŠŸèƒ½èªªæ˜\né€™æ¨£æˆ‘å€‘å°±å¯ä»¥é€éåŒä¸€ä»½çš„ tfstate æª”æ¡ˆä¾†åšç®¡ç†ï¼Œä½†æœ‰å€‹å‰ææ˜¯ï¼Œä¹‹å¾Œå°è©²è³‡æºçš„è®Šæ›´éƒ½åªèƒ½ä½¿ç”¨ tfï¼Œå¦‚æœé‚„æœ‰ç”¨ WEB UI å»èª¿æ•´ï¼Œå°±æœƒé‡åˆ°ç·šä¸Šæœå‹™èˆ‡ tfstate å„²å­˜ç‹€æ…‹ä¸åŒçš„å•é¡Œã€‚\nLock é‚£ç•¶æˆ‘å€‘å·²ç¶“æœ‰äº†å…±åŒå„²å­˜çš„åœ°æ–¹ï¼Œä¹Ÿæºé€šå¥½ï¼Œä¸æœƒä½¿ç”¨ WEB UI å»èª¿æ•´ï¼Œä½†å¦‚æœæœ‰å…©å€‹äººåŒæ™‚å»ä¸‹ apply çš„è©±ï¼Œç¬¬ä¸€å€‹äººçš„ apply é‚„åœ¨åŸ·è¡Œï¼Œå¾Œé¢é‚£å€‹äººçš„ apply æ˜¯ä¸æ˜¯å°±æœƒè“‹æ‰å‰ä¸€å€‹äººçš„è¨­å®šå‘¢ï¼Ÿ\næ‰€ä»¥ Terraform åœ¨ 0.14 ç‰ˆæœ¬æ¨å‡ºäº† Lock åŠŸèƒ½ï¼Œç•¶æœ‰äººåœ¨ plan or apply çš„æ™‚å€™ï¼Œæˆ‘å€‘å»æŸ¥çœ‹ gitlab Terraform stateï¼Œæœƒçœ‹åˆ°æˆ‘å€‘çš„ tfstate æª”æ¡ˆæœƒè¢« Lock èµ·ä¾†\nGitLab Lock é–ä½\næ­¤æ™‚é™¤äº†ç¬¬ä¸€å€‹æ“ä½œè€…ï¼Œå…¶ä»–äººå†å» plan or apply å°±æœƒå‡ºç¾éŒ¯èª¤ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯èª°æ­£åœ¨ä½¿ç”¨ï¼Œä»¥åŠæ“ä½œçš„å‹•ä½œæ˜¯ plan or apply\nåœ¨ Lock ä¸‹ï¼Œå…¶ä»–äººæ²’è¾¦æ³•å» plan or apply\nåœ¨ CI æ™‚ï¼Œéœ€è¦åœ¨ plan æ™‚å°±å°‡å®ƒçµ¦ lockï¼Œé¿å…ç¬¬ä¸€å€‹äºº plan å®Œï¼Œæ²’æœ‰åŠæ™‚çš„å»åŸ·è¡Œ applyï¼Œå¾Œä¾†æœ‰å…¶ä»–äººæ¯”ç¬¬ä¸€å€‹äººå…ˆèª¿æ•´äº†è³‡æºï¼Œç¬¬ä¸€å€‹äººå†ä¾†åŸ·è¡Œ applyï¼Œå°±æœƒå°è‡´ç¬¬ä¸€å€‹äºº apply çš„å…§å®¹èˆ‡è‡ªå·±åŸå…ˆçœ‹ plan çš„å…§å®¹æœƒä¸åŒï¼Œä¹Ÿæœ‰å¯èƒ½æœƒå°‡ä¸Šä¸€å€‹äººèª¿æ•´çš„è¨­å®šçµ¦è¦†è“‹ï¼Œç•¶ç¬¬ä¸€å€‹æ“ä½œè€…çµæŸå‹•ä½œå¾Œï¼Œè©² Lock æ‰æœƒè¢«è§£é–ã€‚\nå…¶ä»– gitlab terraform state è©³ç´°å…§å®¹å¯ä»¥åƒè€ƒï¼šhttps://docs.gitlab.com/ee/user/infrastructure/iac/terraform_state.html"},"title":"Terraform å¦‚ä½•å¤šäººå…±åŒé–‹ç™¼ (å°‡ tfstate å­˜åœ¨å¾Œç«¯)"},"/blog/terraform/terraform/":{"data":{"":"è·Ÿä¸Šä¸€ç¯‡ Snyk ä¸€æ¨£ï¼Œæœ¬ç³»åˆ—ä¹Ÿæ˜¯å»åƒåŠ  DevOpsDay Taipei 2022 æ´»å‹•è½åˆ°å„ä½ç”¢æ¥­å¤§ä½¬ç›®å‰åœ¨ä½¿ç”¨çš„åè©ä»¥åŠæŠ€è¡“ï¼Œæƒ³èªªå›å®¶ä¹Ÿå……å¯¦ä¸€ä¸‹è‡ªå·±ï¼Œäº†è§£ä¸€ä¸‹åœ¨ DevOpsDay æœ€å¸¸å‡ºç¾çš„ IaC æ˜¯ä»€éº¼ï¼Ÿä»¥åŠè½èªªå¾ˆæ–¹ä¾¿çš„ Terraform åˆæ˜¯ä»€éº¼ï¼Œå°‡å­¸ç¿’çš„éç¨‹æ‰“æˆæ­¤ç¯‡ç­†è¨˜ï¼Œæ­¡è¿å¤§å®¶å¤šäº¤æµï¼Œé‚£æˆ‘å€‘å°±é–‹å§‹å›‰ã€‚\nç›®å‰æ‰“ç®—å¯«æœ¬ç¯‡ä»‹ç´¹ IaC ä»¥åŠ Terraform ä»¥å¤–ï¼Œä¹‹å¾Œé‚„æƒ³å¯«å¦å¤–å…©ç¯‡èªªæ˜ Terraform å¦‚ä½•å…±åŒç¶­è­·é–‹ç™¼(å°‡ .tfstate æª”æ¡ˆå­˜åœ¨ gitlab or gcs ä¸Š)ã€æ€éº¼æŠŠ Terraform è½‰æˆ moduleï¼Œæœ€å¾Œå°å…¥ Terragrunt é”åˆ° DRY ç­‰ç­‰ï¼Œä¹Ÿæœƒæœ‰ç”¨ Terraform å»ºç«‹ GCE ä»¥åŠ GKEã€‚å¤§å®¶å¯ä»¥æŒçºŒé—œæ³¨æ­¤ç¯‡æ–‡ç« ï¼Œæœ€å¾Œæœƒåœ¨æ–‡ç« å¾Œé™„ä¸Šé€£çµ ğŸ˜","terraform-åˆæ˜¯ä»€éº¼#Terraform åˆæ˜¯ä»€éº¼ï¼Ÿ":"IaC çš„å·¥å…·æœ‰å¾ˆå¤šç¨®ï¼Œæ¥è‘—æˆ‘å€‘å°±ä¾†ä»‹ç´¹å…¶ä¸­ä¸€å€‹å·¥å…· - Terraformï¼ŒTerraform æ˜¯ä»€éº¼å‘¢ï¼Ÿæ ¹æ“šå®˜ç¶²çš„èªªæ˜å¯ä»¥çŸ¥é“ï¼ŒTerraform æ˜¯ HashiCorp æ‰€é–‹ç™¼çš„åŸºç¤è¨­æ–½å³ä»£ç¢¼å·¥å…·ã€‚å®ƒå¯ä»¥ä½¿ç”¨äººé¡æ–¹ä¾¿è®€çš„é…ç½®æ–‡ä»¶ä¾†å®šç¾©è³‡æºå’ŒåŸºç¤è¨­æ–½ï¼Œä»¥ä¸‹æœ‰ä½¿ç”¨ Terraform å¹¾å€‹å„ªé»ï¼š\nTerraform å¯ä»¥ç®¡ç†å¤šå€‹é›²å¹³å°ä¸Šçš„åŸºç¤æ¶æ§‹ ä½¿ç”¨äººé¡å¯è®€çš„é…ç½®èªè¨€ä¾†å¹«åŠ©æˆ‘å€‘å¿«é€Ÿç·¨å¯«åŸºç¤è¨­æ–½ä»£ç¢¼ å¯ä»¥å°‡é…ç½®æäº¤çµ¦ç‰ˆæœ¬æ§åˆ¶ï¼Œå®‰å…¨åœ°åœ¨åŸºç¤æ¶æ§‹ä¸Šé€²è¡Œå”ä½œ ç®¡ç†ä»»ä½•åŸºç¤è¨­æ–½ Terraform æä¾›æ’ä»¶è®“ Terraform å¯ä»¥é€šéå…¶ API èˆ‡é›²å¹³å°å’Œå…¶ä»–æœå‹™é€²è¡Œäº¤äº’ã€‚HashiCorp å’Œ Terraform ç¤¾å€ç·¨å¯«äº† 3193 å¤šå€‹æä¾›å•†ä¾†ç®¡ç†åƒ AWSã€Azureã€GCPã€Kubernetesã€Helmã€GitHub ç­‰è³‡æºï¼Œå¯ä»¥åˆ° Terraform Registry æŸ¥çœ‹æ›´å¤šå¹³å°æˆ–æœå‹™çš„æä¾›è€…ï¼Œç•¶ç„¶å¦‚æœæ²’æœ‰æ‰¾åˆ°æƒ³è¦çš„æä¾›è€…ï¼Œä¹Ÿå¯ä»¥è‡ªå·±ç·¨å¯«è‡ªå·±çš„å¥—ä»¶ã€‚\næ¨™æº–åŒ–éƒ¨ç½²å·¥ä½œæµç¨‹ æä¾›å•†æœƒå°‡åŸºç¤è¨­æ–½çš„æ¯å€‹å–®å…ƒ (ä¾‹å¦‚å»ºç«‹ VM æˆ–æ˜¯ VPC) å®šç¾©ç‚ºè³‡æºã€‚ä½ å¯ä»¥å°‡ä¾†è‡ªä¸åŒæä¾›è€…çš„è³‡æºçµ„åˆï¼Œè®Šæˆæ¨¡çµ„ï¼Œè®“æˆ‘å€‘å¯ä»¥ç”¨ä¸€è‡´çš„èªè¨€å’Œå·¥ä½œæµç¨‹å»ç®¡ç†ä»–å€‘ã€‚\nTerraform ä»€éº¼æ˜¯ Terraform çš„åŸºç¤è¨­æ–½å³ä»£ç¢¼ï¼Ÿ","ä»€éº¼æ˜¯-iac-#ä»€éº¼æ˜¯ IaC ?":"IaC å…¨åæ˜¯ Infrastructure as Code (åŸºç¤è¨­æ–½å³ä»£ç¢¼)ï¼Œå¾å­—é¢æ„æ€å°±å¯ä»¥ç•¥çŸ¥ä¸€äºŒï¼Œä¹Ÿå°±æ˜¯æŠŠåŸºç¤è¨­æ–½è®Šæˆç¨‹å¼ç¢¼ï¼Œåœ¨é‚„æ²’æœ‰é€™äº› IaC å·¥å…·ä¹‹å‰ï¼Œå¤§å®¶éƒ½æ˜¯é–‹å•Ÿ WEB UI ç•«é¢ä¾†é€²è¡Œå»ºç½®æˆ–è¨­å®šï¼Œé›–ç„¶ä½¿ç”¨ UI é»ä¸€é»å°±å»ºå¥½äº†ï¼Œä½†é€™äº›æ­¥é©Ÿéƒ½æ²’æœ‰è¢«ç´€éŒ„ä¸‹ä¾† (git)ï¼Œä¹Ÿæ²’æœ‰è¾¦æ³•é€éå…¶ä»–äººä¸€èµ· Review çš„æ–¹å¼ä¾†é¿å…äººç‚ºæ“ä½œéŒ¯èª¤ã€‚å› æ­¤æœ‰äº† IaC é€™äº›å·¥å…·ï¼Œå¯ä»¥å°‡å¯¦éš›çš„æ“ä½œæµç¨‹ï¼Œè½‰æ›æˆç¨‹å¼ç¢¼æˆ–æ˜¯å…¶ä»–åƒæ˜¯ JSONã€Yaml çš„æ–¹å¼çµ¦ç´€éŒ„ä¸‹ä¾†ï¼Œä»¥ä¸‹æ˜¯å°å…¥ IaC å¸¶ä¾†çš„å¥½è™•ï¼š\nå»ºç½® CI/CD è‡ªå‹•åŒ– (ä¸éœ€è¦å†ä»°è³´ UI é€²è¡Œæ“ä½œ) ç‰ˆæœ¬æ§åˆ¶ (å¤§å®¶å¯ä»¥é€é MR è¦å®š code reviewï¼Œé¿å…å‡ºç¾äººç‚ºéŒ¯èª¤) é‡è¤‡ä½¿ç”¨ (å¯ä»¥å°‡å¸¸ç”¨çš„è®Šæˆåƒæ•¸ä»£å…¥ï¼Œæ¸›å°‘å»ºç½®æ™‚é–“) ç’°å¢ƒä¸€è‡´æ€§ (ä»¥ä¸Š IaC èªªæ˜ä¾†è‡ª å°æƒ¡é­” - åˆæ¢ Infrastructure as Code å·¥å…· Terraform vs Pulumi æ–‡ç« ï¼Œå¯«å¾—çœŸçš„å¾ˆå¥½ï¼Œæ¨æ¨)\nInfrastructure as Code åˆå¿ƒä¼æœè¡Œç ”07ï¼šè®¤è¯†ã€ŒåŸºç¡€è®¾æ–½å³ä»£ç ã€(Infrastructure as Code) â€” åˆå¿ƒå†…å‚","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"åˆæ¢ Infrastructure as Code å·¥å…· Terraform vs Pulumiï¼šhttps://blog.wu-boy.com/2021/02/introduction-to-infrastructure-as-code-terraform-vs-pulumi/\nä»Šæ™šæˆ‘æƒ³èªè­˜ Terraformï¼šhttps://ithelp.ithome.com.tw/articles/10233759","å®‰è£-terraform#å®‰è£ Terraform":"å®‰è£ Terraform çš„æ–¹å¼æœ‰å¾ˆå¤šç¨®ï¼Œæˆ‘å°±ä»¥æˆ‘åœ¨ä½¿ç”¨çš„ Mac OS ç‚ºä¾‹ï¼Œå…¶ä»–å¯ä»¥åƒè€ƒ Install Terraformï¼š\nå®‰è£æ­¥é©Ÿ å…ˆå®‰è£ HashiCorp tapï¼Œé€™æ˜¯ HashiCorp åœ¨ Homebrew çš„å„²å­˜åº«ï¼š brew tap hashicorp/tap ä½¿ç”¨ hashicorp/tap/terraform brew install hashicorp/tap/terraform å¦‚ä½•é©—è­‰æ˜¯å¦å®‰è£æˆåŠŸ æ‰“é–‹ä¸€å€‹æ–°çš„ Terminalï¼Œä½¿ç”¨ terraform -help æª¢æŸ¥æ˜¯å¦æœ‰å®‰è£æˆåŠŸï¼Œä¹Ÿå¯ä»¥åœ¨ -help å¾Œé¢åŠ å…¥åƒæ•¸ä¾†æŸ¥çœ‹è©²åƒæ•¸çš„åŠŸèƒ½èˆ‡æ›´å¤šè¨Šæ¯\né©—è­‰ Terraform å®‰è£æˆåŠŸ Install Terraform\nè‡ªå‹•è£œå…¨æŒ‡ä»¤ å¯ä»¥å•Ÿå‹•çµ‚ç«¯æ©Ÿä¸Šçš„ Tab è‡ªå‹•è£œå…¨åŠŸèƒ½ï¼ŒåŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼Œå†é‡é–‹çµ‚ç«¯æ©Ÿï¼Œå°±æœƒå‡ºç¾äº†ï¼š\nterraform -install-autocomplete æƒ³è¦è§£é™¤è‡ªå‹•è£œå…¨ (é›–ç„¶æ‡‰è©²ä¸æœƒæ‹‰)ï¼ŒåŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š\nterraform -uninstall-autocomplete æ”¾ä¸Šæˆæœåœ–ç‰‡\nå¿«é€Ÿå…¥é–€ ç•¶æˆ‘å€‘å®‰è£å¥½ï¼Œæƒ³è¦æœ€å¿«çš„äº†è§£ Terraform ï¼Œç•¶ç„¶æ˜¯è‡ªå·±å‹•æ‰‹åšä¸€æ¬¡ï¼Œæˆ‘å€‘ä¾ç…§å®˜ç¶²çš„æ•™å­¸ï¼Œå¯ä»¥åœ¨ä¸€åˆ†é˜å…§ä½¿ç”¨ Docker é…ç½®å¥½ NGINX ä¼ºæœå™¨ï¼Œé‚£æˆ‘å€‘é–‹å§‹å›‰ï¼\né¦–å…ˆï¼Œæˆ‘å€‘å¿…é ˆè¦å…ˆå®‰è£å¥½ Dockerï¼Œä¸‹è¼‰ Mac ç‰ˆ Docker æ¡Œé¢ å»ºç«‹ä¸€å€‹è³‡æ–™å¤¾ï¼Œä¸¦é€²å…¥è©²è³‡æ–™å¤¾å…§ å°‡ä»¥ä¸‹ Terraform é…ç½®æ–‡ä»¶è²¼åˆ°æª”æ¡ˆä¸­ï¼Œä¸¦å–å main.tfï¼š(åŒæ­¥åˆ° GitHub éœ€è¦ç¨‹å¼ç¢¼çš„å¯ä»¥å‰å¾€æŸ¥çœ‹) provider \"docker\" {} resource \"docker_image\" \"nginx\" { name = \"nginx:1.23\" keep_locally = false } resource \"docker_container\" \"nginx\" { image = docker_image.nginx.name name = \"nginx\" ports { internal = 80 external = 8000 } } å†é–‹ä¸€å€‹æª”æ¡ˆå–åç‚º provider.tfï¼Œå°‡ä»¥ä¸‹é…ç½®æ–‡ä»¶è²¼åˆ°æª”æ¡ˆä¸­ï¼š terraform { required_providers { docker = { source = \"kreuzwerker/docker\" version = \"~\u003e 2.13.0\" } } } (ä»¥ä¸Šç¨‹å¼ç¢¼ä¾†è‡ªå®˜ç¶² å®‰è£ Terraform#å¿«é€Ÿå…¥é–€ åŠ ä¸Šå°ä¿®æ”¹)\nå…ˆä¾†ç°¡å–®èªªæ˜ä¸€ä¸‹ Terraform ç¨‹å¼ç¢¼æ ¼å¼ï¼ŒTerraform çš„æª”æ¡ˆå‰¯æª”åæ˜¯ *.tfï¼Œæ¡ç”¨åç‚º HCL (HashiCorp Configuration Language) çš„çµ„æ…‹èªè¨€ä¾†æè¿°åŸºç¤æ¶æ§‹ã€‚\n(è£œå……èªªæ˜ï¼šåªè¦æ˜¯åŒä¸€å€‹ç›®éŒ„ä¸‹æœ‰ .tf æª”æ¡ˆçµå°¾çš„ï¼ŒTerraform éƒ½æœƒå»åŸ·è¡Œï¼Œæ‰€ä»¥æª”æ¡ˆåç¨±å¯ä»¥è‡ªå·±å–åï¼Œä½†ç‚ºäº†æ–¹ä¾¿ç®¡ç†éƒ½æœƒä½¿ç”¨ mainã€providerã€backendã€output çš„æª”æ¡ˆä¾†æ”¾ç½®å°æ‡‰çš„å…§å®¹)\nHCL æ˜¯ä¸€ç¨®å®£å‘Šå¼çš„èªè¨€ï¼Œè®“ä½ ç›´æ¥å¯«ä¸‹æœŸæœ›çš„åŸºç¤æ¶æ§‹ï¼Œè€Œä¸æ˜¯å¯«ä¸‹éç¨‹çš„æ¯ä¸€å€‹æ­¥é©Ÿã€‚\næª”æ¡ˆä»‹ç´¹ æˆ‘å€‘å…ˆçœ‹ provider.tf æª”æ¡ˆï¼Œæª”æ¡ˆå…§æœƒå…ˆå¯«å¥½éœ€è¦çš„ä¾›æ‡‰å•†ä¾†æºä»¥åŠç‰ˆæœ¬ (ç‰ˆæœ¬æœ‰é»åƒæ˜¯å°æ‡‰ä¾›æ‡‰å•†æä¾›çš„ api ç‰ˆæœ¬)\nterraform { required_providers { ä¾›æ‡‰å•†åç¨± = { source = \"ä¾›æ‡‰å•†ä¾†æº\" version = \"~\u003e æ‰€ä½¿ç”¨çš„ç‰ˆæœ¬\" } } } main.tf æª”æ¡ˆå…§çš„ provider å€å¡Šæœƒå¯«ä¾›æ‡‰å•†çš„ç›¸é—œè¨­å®šï¼Œå‡è¨­æˆ‘å€‘ä½¿ç”¨ google å°±æœƒåœ¨è£¡é¢å…ˆè¨­å®šå¥½ project id ç­‰ã€‚\nresource å€å¡Šæœƒéœ€è¦å¯«é›²ç«¯è³‡æºåç¨±ä»¥åŠè‡ªå®šç¾©çš„åç¨±ï¼Œé›²ç«¯è³‡æºåç¨±é€™é …æ˜¯ä¸å¯ä»¥æ›´æ”¹çš„ï¼Œå‡è¨­æˆ‘å€‘è¦ä½¿ç”¨ docker çš„ container æœå‹™ï¼Œé€™é‚Šå°±éœ€è¦å¡«å¯« docker_containerã€‚è‡ªå®šç¾©çš„åç¨±å¯ä»¥æ˜¯ä½ æƒ³è¦ç‚ºä½¿ç”¨é€™å€‹é›²ç«¯è³‡æºå»å®šç¾©çš„åç¨±ã€‚\nprovider \"ä¾›æ‡‰å•†åç¨±\" {} resource \"é›²ç«¯è³‡æºåç¨±\" \"è‡ªå®šç¾©çš„åç¨±\" { å±¬æ€§ = å€¼ } æ‰€ä»¥æˆ‘å€‘å·²ä¸Šé¢çš„ Docker é…ç½®å¥½ NGINX ä¼ºæœå™¨ç‚ºä¾‹ï¼Œprovider æˆ‘å€‘é€™æ¬¡ä½¿ç”¨çš„æ˜¯ dockerï¼Œ resource æˆ‘å€‘å¯ä»¥æ‹†é–‹ä¾†å¯«ï¼Œ\nåƒæ˜¯ç¬¬ä¸€å€‹ resource docker_image æˆ‘å€‘å¹«ä»–å–å« nginxï¼Œè£¡é¢å°±æ˜¯æ”¾æœ‰é—œ image çš„è¨­å®šï¼Œè©³ç´°çš„ image è¨­å®šå¯ä»¥åƒè€ƒ Resource (docker_image)ï¼Œ\nç¬¬äºŒå€‹ resource docker_container ä¸€æ¨£å« nginxï¼Œè£¡é¢ç”¨çš„ image æ˜¯æ‹¿å‰é¢çš„ docker_image resource name ä¾†ä½¿ç”¨ï¼Œä¸€æ¨£è©³ç´°å¯ä»¥åƒè€ƒ Resource (docker_container)ã€‚\nå°æé†’ï¼Œå¦‚æœä¸çŸ¥é“è¦æ€éº¼å¯« provider ä¾›æ‡‰å•†è¨­å®šï¼Œå¯ä»¥æ‰“é–‹ terraform å®˜ç¶²æ‰¾åˆ°è©²ä¾›æ‡‰å•†ï¼Œé»é¸å³é‚Šçš„ USE PROVIDER\nå®˜æ–¹æ•™å­¸\nå¯ä»¥çœ‹åˆ°å®˜æ–¹æ•™å­¸è¦æ€éº¼ä½¿ç”¨é€™å€‹ä¾›æ‡‰å•†ã€‚\næŒ‡ä»¤èªªæ˜ æ¥è‘—æœ‰å¹¾å€‹æŒ‡ä»¤è¦å¸¶å¤§å®¶èªè­˜ï¼š\nterraform initï¼šåˆå§‹åŒ–é …ç›®ï¼Œä¸‹è¼‰ tf æª”æ¡ˆä¸­æ‰€éœ€è¦çš„å¤–æ›å¥—ä»¶ terraform planï¼šæœƒç”¢ç”Ÿä¸€ä»½åŸ·è¡Œè¨ˆåŠƒã€‚ä¸Šé¢æœƒå¯«è‘—å®ƒå°‡æœƒåšå“ªäº›äº‹ï¼Œä½ å¯ä»¥é©—è­‰æ˜¯å¦ç¬¦åˆä½ é æœŸçš„è¨­è¨ˆ terraform applyï¼šå¯¦éš›é‹ä½œï¼ŒæŠŠåŸºç¤æ¶æ§‹å»ºç½®å®Œæˆã€‚åœ¨å®Œæˆä¹‹å¾Œï¼ŒæœƒæŠŠç›®å‰çš„ç‹€æ…‹å„²å­˜åˆ°ä¸€ä»½æª”æ¡ˆä¸­ (*.tfstate) terraform destroyï¼šæœƒéŠ·æ¯€ç”¨ Terraform èµ·çš„æœå‹™ terraform fmtï¼šå¹«ä½ æ•´ç†å¥½ tf æ–‡ä»¶ terraform validateï¼šéœæ…‹æª¢æŸ¥ tf æ–‡ä»¶ é™„ä¸Šæ‡¶äººæŒ‡ä»¤\nalias ti='terraform init' alias ta='terraform apply' alias tp='terraform plan' alias td='terraform destroy' ç”±æ–¼åœ¨ apply çš„æ™‚å€™æœƒè·³å‡ºè©¢å•è¦–çª—ï¼Œå¦‚æœæ˜¯è¦å¯«æˆè…³æœ¬ï¼Œå¯ä»¥æŠŠæŒ‡ä»¤æ”¹æˆ terraform apply -auto-approve å°±ä¸éœ€è¦è¼¸å…¥ yes äº†ï¼\nå¯¦éš›æ“ä½œ æœ‰ä¸Šé¢çš„æŒ‡ä»¤å¾Œï¼Œæˆ‘å€‘ä¾†å¯¦éš›æ“ä½œçœ‹çœ‹ï¼š\né¦–å…ˆåˆ°è©² main.tf æª”æ¡ˆç›®éŒ„ä¸‹ï¼Œå…ˆä½¿ç”¨ terraform apply ä¾†æ¸¬è©¦çœ‹çœ‹ï¼š ç„¡æ³•ç›´æ¥åŸ·è¡Œ apply\næœƒç™¼ç¾æ²’æœ‰è¾¦æ³•ç›´æ¥ç”¨ terraform apply æŒ‡ä»¤ä¾†å»ºç½®æœå‹™ï¼Œæˆ‘å€‘çœ‹ä¸€ä¸‹ä»–æç¤ºçš„èªªæ˜ï¼Œä»–èªªä»–æ‰¾ä¸åˆ° lock fileï¼Œéœ€è¦å…ˆé€²è¡Œåˆå§‹åŒ–æ‰å¯ä»¥åŸ·è¡Œï¼Œæ‰€ä»¥æˆ‘å€‘çš„å»ºç½®æµç¨‹æ˜¯å…ˆ init â€“\u003e apply\nterraform init æˆ‘å€‘å…ˆåŸ·è¡Œ terraform initï¼Œå¯ä»¥çœ‹åˆ°ä»–æœƒä¸‹è¼‰ tf æª”æ¡ˆä¸­æ‰€éœ€è¦çš„å¤–æ›å¥—ä»¶ (docker) terraform init\nç•¶æˆ‘å€‘åˆå§‹åŒ–å¾Œï¼Œè³‡æ–™å¤¾æœƒå¤šä¸€å€‹æª”æ¡ˆ (.terraform.lock.hcl) ä»¥åŠè³‡æ–™å¤¾ (.terraform)\ninit å‰å¾Œæª”æ¡ˆå·®ç•°\n.terraform.lock.hclï¼šæ˜¯ Terraform ä¸­ç”¨æ–¼é–å®šå’Œç®¡ç†å¤–éƒ¨æä¾›è€…ï¼ˆprovidersï¼‰ç‰ˆæœ¬çš„æª”æ¡ˆã€‚å®ƒçš„ä¸»è¦åŠŸèƒ½æ˜¯ç¢ºä¿åœ¨ä¸åŒçš„ç’°å¢ƒä¸­ä½¿ç”¨ç›¸åŒçš„å¤–éƒ¨æä¾›è€…ç‰ˆæœ¬ï¼Œä»¥é¿å…åœ¨åœ˜éšŠåˆä½œæˆ–ä¸åŒç’°å¢ƒä¸­å¼•å…¥ä¸ä¸€è‡´æ€§å’Œå•é¡Œã€‚\n.terraform/ï¼šè³‡æ–™å¤¾ä¸»è¦ç”¨æ–¼å­˜å„²åˆå§‹åŒ–å’Œç®¡ç†åŸºç¤æ¶æ§‹ç›¸é—œçš„è‡¨æ™‚æ–‡ä»¶ã€‚\nterraform plan æ¥è‘—æˆ‘å€‘ä½¿ç”¨ terraform plan ä¾†æŸ¥çœ‹æˆ‘å€‘çš„è¨ˆåŠƒï¼Œå¯ä»¥çœ‹åˆ°ä»–æœƒåˆ—å‡ºæˆ‘å€‘æ‰€å¯«çš„ tf è£¡é¢æœ‰ç”¨åˆ°çš„ resourceï¼Œé™¤äº†æˆ‘å€‘æœ‰è¨­å®šçš„å±¬æ€§ï¼Œå…¶ä»–çš„å±¬æ€§ä¹Ÿæœƒé¡¯ç¤ºå‡ºä¾†ï¼Œå¯ä»¥æ›´æ–¹ä¾¿åœ°è®“æˆ‘å€‘çŸ¥é“é€™å€‹ resource æœ‰å“ªäº›å±¬æ€§å¯ä»¥è¨­å®š terraform plan\nterraform apply æœ€å¾Œæˆ‘å€‘æª¢æŸ¥éƒ½æ²’æœ‰å•é¡Œï¼Œå°±å¯ä»¥ä½¿ç”¨ terraform apply ä¾†å»ºç½®ï¼Œapply å…¶å¯¦è·Ÿ plan ä¸€æ¨£éƒ½æœƒå…ˆè®“æˆ‘å€‘çœ‹ä¸€ä¸‹è¨ˆåŠƒï¼Œä½†æœƒè·³å‡ºè©¢å•æ˜¯å¦è¦åŸ·è¡Œï¼Œé™¤éä½ è¼¸å…¥ yesï¼Œå¦å‰‡å°±è·Ÿ plan å–®ç´”é¡¯ç¤ºè¨ˆåŠƒå…§å®¹ï¼Œæœ€å¾Œæˆ‘å€‘å°±å¯ä»¥çœ‹åˆ°ä»–æˆåŠŸåœ¨ docker ä¸Šé¢å»ºç«‹ nginx æœå‹™ terraform apply\næŸ¥çœ‹ docker nginx ä»¥åŠæª¢æŸ¥å…¶æœå‹™\nç•¶æˆ‘å€‘ apply å®Œï¼Œæœå‹™ä¹Ÿå»ºç«‹å¾Œï¼ŒæŸ¥çœ‹ä¸€ä¸‹è³‡æ–™å¤¾å¾Œæœƒç™¼ç¾ï¼Œåˆå¤šäº†ä¸€å€‹æª”æ¡ˆ terraform.tfstateï¼š\nå¤šäº†ä¸€å€‹æª”æ¡ˆ terraform.tfstate\nterraform.tfstateï¼š æ˜¯ Terraform çš„ç‹€æ…‹æª”æ¡ˆï¼Œå®ƒåŒ…å«äº†åŸºç¤æ¶æ§‹çš„ç‹€æ…‹å’Œè³‡æºçš„è©³ç´°ä¿¡æ¯ã€‚é è¨­æƒ…æ³ä¸‹ï¼Œé€™å€‹æª”æ¡ˆæ˜¯æœ¬åœ°çš„ä¸¦ä¸”åªå­˜åœ¨æ–¼ Terraform åˆå§‹åŒ–å’Œæ“ä½œçš„ç›®éŒ„ä¸­ã€‚(ä½†è¦å¦‚ä½•å¯¦ç¾å…±åŒç¶­è­·åŒä¸€å€‹ IaC å‘¢ï¼Œæ•¬å¾…å¾ŒçºŒåˆ†äº« ğŸ¤£)\nterraform destory å¦å¤–ï¼Œç•¶ä½ æƒ³è¦ç§»é™¤æœå‹™æ™‚ï¼Œå¯ä»¥ä½¿ç”¨ terraform destroy ä¾†å°‡æœå‹™çµ¦ç§»é™¤ terraform destroy\nterraform import æœ€å¾Œé‚„æœ‰ä¸€å€‹è »é‡è¦çš„ï¼Œå°±æ˜¯æˆ‘å€‘å·²ç¶“æœ‰å¾ˆå¤šæœå‹™éƒ½æ˜¯ä½¿ç”¨ WEB UI æ–¹å¼å»ºç«‹çš„æœå‹™ï¼Œé‚£æˆ‘å€‘è¦æ€éº¼æŠŠå®ƒè®Šæˆ tf æª”æ¡ˆå‘¢ï¼Ÿ è·Ÿæˆ‘å€‘å‰›å‰›èªªçš„ terraform.tfstate æª”æ¡ˆæœ‰é—œï¼Œä»–æœƒå„²å­˜æˆ‘å€‘ IaC çš„ç‹€æ…‹ï¼Œæ‰€ä»¥æˆ‘å€‘æ‰å¯ä»¥é€éä»–çŸ¥é“ç¾åœ¨æ˜¯å°è³‡æºåšæ–°å¢ã€ä¿®æ”¹ã€åˆªé™¤å“ªå€‹æ“ä½œ\né‚£ç•¶é€™å€‹æª”æ¡ˆä¸è¦‹æ™‚ï¼Œå¦‚æœå†é‡æ–°ä¸‹ terraform applyï¼Œä»–æœƒèªç‚ºä½ æ˜¯æ–°å¢ç‹€æ…‹ï¼Œä½†å¯¦éš›ä¸Š docker æœå‹™é‚„æ˜¯å•Ÿå‹•çš„ç‹€æ…‹ï¼Œæ‰€ä»¥å°±æœƒéŒ¯èª¤ï¼Œæœƒè·Ÿä½ èªªä»–å·²ç¶“å­˜åœ¨ã€‚\næ¸¬è©¦æ²’æœ‰ terraform.tfstate ç›´æ¥ä¸‹ terraform apply\næ‰€ä»¥é€™æ™‚å€™æˆ‘å€‘è¦æŠŠç·šä¸Šæœå‹™çš„è³‡æºè½‰æˆ tf ï¼Œç¬¬ä¸€æ­¥è¦å…ˆæŠŠ resource çš„æ¡†æ¶çµ¦å¯«å‡ºä¾†ï¼Œå…¶ä»–å¯ä»¥å…ˆç•™ç©ºç™½ï¼Œå¦‚ä¸‹ main.tfï¼š\nprovider \"docker\" {} resource \"docker_image\" \"nginx\" { name = \"nginx:1.23\" keep_locally = false } resource \"docker_container\" \"nginx\" { } æ¥è‘—ä½¿ç”¨ terraform import ä¾†å°‡ç·šä¸Šæœå‹™çš„è³‡æºå¥—ç”¨åˆ°æˆ‘å€‘ main.tf è£¡é¢çš„ resourceï¼Œæ‰€ä»¥æœƒé•·å¾—åƒï¼š\nterraform import docker_container.nginx 7f363ea3f6a64b5432ae3627f490b3e297abf80f196bce9c028ec2eb82706f12 import å¾Œé¢æœƒåŠ ä¸Š main.tf resource åç¨± docker_containerï¼Œä»¥åŠæˆ‘å€‘å–åçš„ nginxï¼Œæœ€å¾Œå¸¶ container id (docker ps æŸ¥è©¢)ï¼Œå°±å¯ä»¥åŒ¯å‡º terraform.tfstate æª”æ¡ˆå›‰ï¼Œè©³ç´°çš„ import å¯ä»¥åƒè€ƒæ¯å€‹ä¾›æ‡‰å•†è³‡æºçš„ç¶²é (é€™é‚Šä»¥ docker ç‚ºä¾‹)\nterraform import åŒ¯å‡º terraform.tfstate\nterraform show ç•¶æˆ‘å€‘åŒ¯å‡ºå¾Œï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ terraform.tfstateï¼Œå®ƒæœƒæ˜¯ä¸€å€‹ json æ ¼å¼ï¼Œå¦‚æœè¦è½‰æˆ tf æ ¼å¼ï¼Œé‚„éœ€è¦ä½¿ç”¨ terraform show ä¾†å°‡ terraform.tfstate æª”æ¡ˆè½‰æˆ tf æ ¼å¼ï¼Œå¦‚ä¸‹ï¼š\nterraform show å°‡ terraform.tfstate è½‰æˆ tf\nå¦‚æœé€éä¸Šè¿°çš„æ–¹å¼ä¾†è½‰æˆ tfï¼Œæœƒç™¼ç¾åœ¨é‡æ–° apply æ™‚ï¼Œæœƒå‡ºç¾éŒ¯èª¤ï¼Œé€™é‚Šä»¥ gce çš„ç•¶ç¯„ä¾‹ï¼Œè½‰å®Œçš„ tf è¨­å®šï¼Œæœ‰äº›æ˜¯ tf ä¸æ”¯æ´çš„åƒæ•¸ï¼Œåªæœƒé¡¯ç¤ºåœ¨ tfstateï¼Œæ‰€ä»¥é‚„éœ€è¦æ‰‹å‹•åˆªé™¤ã€‚\nè½‰æ›å¾Œé‚„éœ€å°‡ä¸ç”¨çš„è¨­å®šçµ¦ç§»é™¤"},"title":"ä»€éº¼æ˜¯ IaC ? Terraform åˆæ˜¯ä»€éº¼ï¼Ÿ"},"/blog/terraform/terragrunt/":{"data":{"":"æˆ‘å€‘æ¥çºŒä¸Šä¸€ç¯‡çš„ å¦‚ä½•å°‡ Terraform æ”¹å¯«æˆ module ? ï¼Œæˆ‘å€‘å·²ç¶“å°‡ Terraform æ”¹æˆ module çš„æ–¹å¼ä¾†é€²è¡Œç®¡ç†ï¼Œä½†ç•¶æˆ‘å€‘è¦ç®¡ç†çš„è³‡æºè¶Šä¾†è¶Šå¤šï¼Œä¸”æœ‰åˆ†ä¸åŒçš„å°ˆæ¡ˆæ™‚ï¼Œæ•´å€‹æœå‹™æ¶æ§‹æœƒé•·çš„åƒä»¥ä¸‹ï¼š\nmodules google_compute_instance main.tf outputs.tf variables.tf projects gcp-1234 aaa backend.tf main.tf provider.tf bbb backend.tf main.tf provider.tf ccc backend.tf main.tf provider.tf gcp-2345 aaa backend.tf main.tf provider.tf bbb backend.tf main.tf provider.tf ccc backend.tf main.tf provider.tf gcp-3456 aaa backend.tf main.tf provider.tf bbb backend.tf main.tf provider.tf ccc backend.tf main.tf provider.tf é€™é‚Šçš„ç¯„ä¾‹æ˜¯ä»¥ä¸åŒå°ˆæ¡ˆä¾†åˆ†ï¼Œå†åˆ†å€ä¸åŒçš„æœå‹™ï¼Œæ¯å€‹æœå‹™è£¡é¢éƒ½æœƒæœ‰ backend.tfã€main.tfã€provider.tf æª”æ¡ˆæ‰€çµ„æˆï¼Œæˆ‘å€‘å¯ä»¥ä¾†æ¯”è¼ƒä¸€ä¸‹ gcp-1234 çš„ aaa æœå‹™ä»¥åŠ gcp-2345 çš„ aaa æœå‹™å·®ç•°ï¼š\næª”æ¡ˆå·®ç•°\nå¯ä»¥çœ‹åˆ°åœ¨ backend.tf é™¤äº† prefix è·¯å¾‘ä»¥å¤–ï¼Œå…¶ä»–è¨­å®šä¹Ÿéƒ½ä¸€æ¨£ï¼Œä½†å› ç‚º Terraform æœ¬èº«æ²’è¾¦æ³•é€éå¸¶å…¥åƒæ•¸çš„æ–¹å¼ä¾†è¨­å®š backend.tf å¾Œç«¯éƒ¨åˆ†ï¼Œæ‰€ä»¥å¿…é ˆè¦å…ˆå¯«å¥½æ¯å€‹æœå‹™æ‰€å­˜æ”¾çš„å¾Œç«¯ä½ç½®ï¼Œååˆ†çš„ä¸æ–¹ä¾¿ã€‚\nbackend.tfterraform { backend \"gcs\" { bucket = \"terragrunt-tfstate\" prefix = \"/gcp-1234-aaa\" } } ç‚ºäº†æ¸›å°‘ä¸Šè¿°é€™äº›éœ€è¦ä¸€ç›´é‡è¤‡å¯«å·®ä¸å¤šæª”æ¡ˆçš„å·¥ä½œå…§å®¹ï¼Œå› æ­¤æœ‰äº† Terragrunt é€™å€‹å·¥å…·ï¼ŒTerragrunt æ˜¯ Terraform çš„åŒ…è£å™¨ï¼Œå¯ä»¥å½Œè£œ Terraform ä¸Šçš„ä¸€äº›ç¼ºé™·ï¼Œä¸¦ä¸”è®“æˆ‘å€‘çš„ IaC æ›´è²¼è¿‘ DRY åŸå‰‡ã€‚\né€™é‚Šèªªæ˜ä¸€ä¸‹ DRY åŸå‰‡\nDRY å…¨åæ˜¯ Donâ€™t repeat yourselfï¼Œä¹Ÿå°±æ˜¯ä¸è¦åšé‡è¤‡çš„äº‹æƒ…ï¼Œèƒ½å¤ ä¸€æ¬¡åšå®Œçš„å°±ä¸è¦é‡è¤‡çš„å»åšã€‚","terragrunt-å¥½è™•#Terragrunt å¥½è™•":"\næ¥è‘—ä»‹ç´¹ä¸€ä¸‹ Terragrunt çš„å¥½è™•ï¼š\næ–¹ä¾¿ç®¡ç†å¾Œç«¯ç‹€æ…‹è¨­å®š\nå°‡å¾Œç«¯å­˜å„²æ¡¶ç´å…¥ç®¡ç†\nä½¿ç”¨ generate è‡ªå‹•ç”Ÿæˆæª”æ¡ˆ\nä½¿ç”¨ include æª”æ¡ˆä¾†é”åˆ° DRY åŸå‰‡\nç®¡ç† Module ä¹‹é–“çš„ä¾è³´æ€§\nç”¢ç”Ÿä¾è³´é—œè¯åœ–\næ–¹ä¾¿ç®¡ç†å¾Œç«¯ç‹€æ…‹è¨­å®š é¦–å…ˆç¬¬ä¸€å€‹æ–¹ä¾¿ç®¡ç†å¾Œç«¯ç‹€æ…‹è¨­å®šï¼Œä¹Ÿå°±æ˜¯æˆ‘å€‘ä¸Šé¢æåˆ°çš„ backend.tf è¨­å®šã€‚åœ¨ Terraform åŸç”Ÿç‚ºäº†å€åˆ¥ä¸åŒå°ˆæ¡ˆä¸åŒæœå‹™çš„ç‹€æ…‹æª”ï¼Œå°±å¿…é ˆå…ˆå¯«å¥½æ¯å€‹å„²å­˜çš„è·¯å¾‘ï¼Œä½†ä½¿ç”¨ Terragruntï¼Œå¯ä»¥å…ˆåœ¨è©²ç›®éŒ„ä¸‹ï¼Œä¹Ÿå°±æ˜¯ gcp-3456 ç›®éŒ„ä¸‹å…ˆå¯«ä¸€å€‹è¨­å®šæª”æ¡ˆ (æˆ‘å€‘ä»¥ gcp-3456 å°ˆæ¡ˆç‚ºä¾‹)ï¼Œè®“åº•ä¸‹çš„ aaaã€bbbã€ccc æœå‹™å¯ä»¥å» include å®ƒï¼Œæˆ‘å€‘å°±ä¸éœ€è¦æ¯å€‹æœå‹™éƒ½å¯«å¹¾ä¹å·®ä¸å¤šçš„è¨­å®šæª”ï¼Œæ¥è‘—æˆ‘å€‘åœ¨ gcp-3456 è³‡æ–™å¤¾ä¸‹æ–°å¢ terragrunt.hcl æª”æ¡ˆä¾†èªªæ˜ï¼š\nterragrunt.hclremote_state { backend = \"gcs\" generate = { path = \"backend.tf\" if_exists = \"overwrite\" } config = { bucket = \"terragrunt-tfstate\" prefix = \"${path_relative_to_include()}\" } } é€™é‚Šçš„è¨­å®šå…¶å¯¦è·Ÿä¹‹å‰çš„ backend.tf å·®ä¸å¤šï¼Œåªæ˜¯å¾Œç«¯ç¾åœ¨å„²å­˜çš„ block æ”¹å«åš remote_stateï¼Œå¯ä»¥çœ‹åˆ° backend è¨­å®šæˆ‘å€‘ä¸€æ¨£æ˜¯å­˜åœ¨ gcs ä¸Šï¼Œgenerate é€™å€‹ block å®ƒæœƒåˆ¤æ–· backend.tf æª”æ¡ˆæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœæ²’æœ‰å®ƒå°±æœƒå¹«æˆ‘å€‘å»ºç«‹ï¼Œå…¶ä¸­è¨­å®šæª”æ¡ˆå…§å®¹æ˜¯å°‡ç‹€æ…‹æª”æ¡ˆå­˜åœ¨ terragrunt-tfstate é€™å€‹ bucketï¼Œä¸¦é€é${path_relative_to_include()} é€™å€‹è®Šæ•¸ä¾†è‡ªå‹•å¸¶å…¥æœ‰ include é€™ä»½æª”æ¡ˆçš„è·¯å¾‘ï¼Œä¸¦åœ¨ç›¸å°è·¯å¾‘ç”¢ç”Ÿ backend.tf æª”æ¡ˆã€‚\næœ‰é»æŠ½è±¡ï¼Œæ‰€ä»¥æˆ‘ç•«ä¸€å€‹æ¯”è¼ƒç°¡å–®çš„æ¶æ§‹åœ–ä¾†åšèªªæ˜ä¸€ä¸‹ï¼Œå‡è¨­ç¾åœ¨æœ‰ä¸‰å€‹æœå‹™ï¼Œå¦‚ä¸‹ï¼š\naaa terragrunt.hcl bbb terragrunt.hcl ccc terragrunt.hcl terragrunt.hcl æˆ‘å€‘å‰›å‰›çš„å¾Œç«¯è¨­å®šæ˜¯å¯«åœ¨æ­¤æ ¹ç›®éŒ„çš„ terragrunt.hcl æª”æ¡ˆ(ç¬¬ 8 è¡Œ)ï¼Œç„¶å¾Œ ccc é€™å€‹æœå‹™å» include æ ¹ç›®éŒ„çš„ terragrunt.hcl æª”æ¡ˆï¼Œ Terragrunt å°±æœƒè‡ªå‹•å¹«ä½ ç”¢ç”Ÿä»¥ä¸‹çš„ backend.tf æª”æ¡ˆï¼š\nbackend.tfterraform { backend \"gcs\" { bucket = \"terragrunt-tfstate\" prefix = \"/ccc\" } } é€™æ¨£å°±å¯ä»¥çœä¸‹æˆ‘å€‘è¦é‡è¤‡å¯« backend.tf çš„æ™‚é–“ï¼Œåœ¨ç¶­è­·ä¸Šä¹Ÿæœƒæ›´åŠ çš„æ–¹ä¾¿ã€‚\nå°‡å¾Œç«¯å­˜å„²æ¡¶ç´å…¥ç®¡ç† æ¥è‘—ï¼Œå¤§å®¶æœ‰æ²’æœ‰æƒ³éï¼Œæˆ‘å€‘éƒ½å·²ç¶“ä½¿ç”¨ Terraform ä¾†ç®¡ç† IaC ï¼Œä¸¦æŠŠç‹€æ…‹æª”æ¡ˆæ”¾åˆ° gcs ä¸Šé¢ä¾†ä¿å­˜ï¼Œä½†ä¸€é–‹å§‹é‚„æ²’æœ‰ç”¨ Terraform ç®¡ç† gcs çš„è³‡æºï¼Œæˆ‘å€‘é‚„éœ€è¦åœ¨è¨­å®š backend.tf å‰ï¼Œå…ˆæ‰‹å‹•å»æ–°å¢ä¸€å€‹ gcs ï¼Œæ‰èƒ½ä¾†å­˜æ”¾ tfstate ç‹€æ…‹æª”æ¡ˆå‘¢ï¼Ÿ\nå› æ­¤åœ¨ Terragrunt remote_state çš„ config æ™‚ï¼Œå¯ä»¥å¤šè¨­å®š gcs çš„ project id ä»¥åŠ locationï¼ŒTerragrunt åœ¨åˆå§‹åŒ–å¾Œç«¯æ™‚ï¼Œæœƒæª¢æŸ¥æ˜¯å¦æœ‰è©² gcs bucketï¼Œå¦‚æœæ²’æœ‰å°±æœƒè‡ªå‹•å»ºç«‹ï¼Œè¨­å®šæª”å¦‚ä¸‹ï¼š\nterragrunt.hclremote_state { backend = \"gcs\" generate = { path = \"backend.tf\" if_exists = \"overwrite\" } config = { project = \"gcp-xxxxxx\" location = \"asia\" bucket = \"terragrunt-tfstate\" prefix = \"${path_relative_to_include()}\" } } ä½¿ç”¨ generate è‡ªå‹•ç”Ÿæˆæª”æ¡ˆ åœ¨å‰›å‰›æˆ‘å€‘å¯ä»¥ä½¿ç”¨ generate ä¾†è‡ªå‹• backend.tf æª”æ¡ˆï¼Œé‚£ä»£è¡¨æˆ‘å€‘ä¹Ÿå¯ä»¥æŠŠæ¯å€‹ provider.tf çš„å…§å®¹ï¼Œä¹Ÿé€é generate ä¾†ç”Ÿæˆï¼Œå¦‚ä¸‹ï¼š\nterragrunt.hclgenerate \"provider\" { path = \"provider.tf\" if_exists = \"overwrite\" contents = \u003c\u003cEOF terraform { required_providers { google = { source = \"hashicorp/google\" version = \"~\u003e 4.48.0\" } } } EOF } é€™æ¨£å­æ¯å€‹ include é€™ä»½è¨­å®šæª”çš„æœå‹™é™¤äº† backend.tf æª”æ¡ˆä»¥å¤–ï¼Œé‚„æœƒè‡ªå‹•ç”¢ç”Ÿ provider.tf æª”æ¡ˆã€‚\nä½¿ç”¨ include æª”æ¡ˆä¾†é”åˆ° DRY åŸå‰‡ æˆ‘å€‘æå®šäº† backend.tf è·Ÿ provider.tf å¾Œï¼Œé‚„å‰©ä¸‹ main.tfï¼Œæ‰€ä»¥æˆ‘å€‘ä¹Ÿå°‡å®ƒæ”¹æˆ Terragrunt çš„æ ¼å¼å¦‚ä¸‹ï¼š\nterragrunt.hclterraform { source = \"${get_path_to_repo_root()}/modules/google_compute_instance\" } include \"root\" { path = find_in_parent_folders() } inputs = { instance_name = \"gcp-3456-ccc\" machine_type = \"e2-small\" instance_zone = \"asia-east1-b\" instance_tags = [] instance_labels = {} boot_disk_auto_delete = true boot_disk_image_name = \"debian-cloud/debian-10\" ... è¨­å®šéƒ¨åˆ†çœç•¥ ... } é€™é‚Šå¯ä»¥çœ‹åˆ° terraform source å®ƒå°±æ˜¯æˆ‘å€‘ä½¿ç”¨ module çš„è·¯å¾‘ï¼Œä¹Ÿå¯ä»¥ç”¨ ${get_path_to_repo_root()} é€™å€‹è®Šæ•¸ä»–æœƒè‡ªå‹•æŠ“è©²å°ˆæ¡ˆçš„æ ¹ç›®éŒ„ï¼Œæˆ‘å€‘å°±ä¸éœ€è¦å»ç‰¹åˆ¥è¨­å®šã€‚\næ­¤å¤–ä¹Ÿå¯ä»¥å°‡ module ç¨ç«‹æˆä¸€å€‹å°ˆæ¡ˆï¼Œæˆ–æ˜¯ä½¿ç”¨å…¶ä»–äººå¯«å¥½çš„ moduleï¼Œåœ¨ source çš„æ™‚å€™å¯ä»¥ä½¿ç”¨ git::https://[gitlab-ç¶²å€]/sre/terraform/module.git//google_compute_address çš„æ–¹å¼ä¾†å–å¾— moduleï¼Œå¯ä»¥è¨­å®šè¦ä½¿ç”¨å“ªå€‹åˆ†æ”¯æˆ–æ˜¯ tagï¼Œåªéœ€è¦åœ¨ç¶²å€å¾Œé¢åŠ ä¸Šï¼Œ?ref=[åˆ†ä¹‹ or tag åç¨±] å³å¯ï¼Œé€™æ¨£å¯ä»¥è®“é–‹ç™¼ä¸­çš„ module ä¸æœƒå½±éŸ¿åˆ°ç·šä¸Šå…¶ä»–æ­£åœ¨ä½¿ç”¨ä¸­çš„ module è¨­å®šã€‚\n(module.git å¾Œé¢çš„ // æ˜¯ Terraform module source çš„è¦å‰‡ï¼Œå¦‚æœä¸åŠ æœƒè·³è­¦å‘Šè¨Šæ¯)\næ¥è‘—æˆ‘å€‘å¯ä»¥çœ‹åˆ° include \"root\" {} é€™æ®µï¼Œè£¡é¢æœ‰ä½¿ç”¨ find_in_parent_folders é€™é‚Šè®Šæ•¸ï¼Œä»–å°±æ˜¯ä¸Šé¢çš„æåˆ°æœƒè‡ªå‹•å»æŠ“æ”¾åœ¨çˆ¶è³‡æ–™å¤¾çš„ remote_state è·Ÿ generate terragrunt.hcl æª”æ¡ˆã€‚\nå¾Œé¢çš„ input å°±è·Ÿä½¿ç”¨ module æ™‚ä¸€æ¨£ï¼Œå°‡ module çš„åƒæ•¸å¸¶å…¥å³å¯ã€‚\nè£œå……ï¼šæ‰€ä»¥æˆ‘å€‘ä¹Ÿå¯ä»¥æŠŠä¸€äº›é€šç”¨çš„è¨­å®šå¯«åœ¨æ ¹ç›®éŒ„çš„ terragrunt.hcl æª”æ¡ˆï¼Œä¾‹å¦‚å°ˆæ¡ˆçš„ idï¼Œå¯ä»¥å¯«ä»¥ä¸‹å…§å®¹ä¾†è®“ include å®ƒçš„æª”æ¡ˆåƒåˆ°åŒä¸€å€‹åƒæ•¸è¨­å®šï¼š\nterragrunt.hclinputs = { project_id = \"gcp-3456\" } ç®¡ç† Module ä¹‹é–“çš„ä¾è³´æ€§ ç”±æ–¼ Terragrunt æ˜¯æŠŠæ¯å€‹æœå‹™æ‹†åˆ†æˆæœ€å°åŒ–ï¼Œæ²’è¾¦æ³•æŠŠä½¿ç”¨ä¸åŒ module çš„è³‡æºæ”¾åœ¨ä¸€èµ·(å–®ç´”ä½¿ç”¨ module çš„è©±ï¼Œå¯ä»¥ä¸€æ¬¡ source å¤šäº† moduleï¼Œä¸¦æŠŠä»–æ”¾åœ¨åŒä¸€å€‹ tf æª”æ¡ˆä¸­)ï¼Œé‚£åƒæ˜¯æˆ‘å€‘å»ºç«‹ k8s æœƒä½¿ç”¨åˆ° google_container_clusterã€google_container_node_pool å…©ç¨®ä¸åŒçš„ module è©²æ€éº¼è¾¦å‘¢ï¼Ÿ\né¦–å…ˆæˆ‘å€‘å…ˆåœ¨ modules è³‡æ–™å¤¾æ”¾ä¸Š google_container_clusterã€google_container_node_pool å…©å€‹ module çš„è¨­å®šæª”æ¡ˆï¼Œè©³ç´°ç¨‹å¼å¯ä»¥é»æˆ‘å‰å¾€\nmodules google_container_cluster main.tf outputs.tf variables.tf google_container_node_pool main.tf variables.tf åœ¨ projects åº•ä¸‹æ–°å¢ gke è³‡æ–™å¤¾ï¼Œæ–°å¢ terragrunt.hcl ä¾†æ”¾ remote_state provider çš„è¨­å®šï¼Œä¸¦å€åˆ†å…©å€‹è³‡æ–™å¤¾ï¼Œåˆ†åˆ¥æ˜¯ cluster è³‡æ–™å¤¾ä¾†å­˜æ”¾ cluster è³‡è¨Šï¼Œä»¥åŠ test è³‡æ–™å¤¾ä¾†å­˜æ”¾ test node-pool è³‡è¨Šï¼š\nprojects gke cluster terragrunt.hcl terragrunt.hcl test terragrunt.hcl cluster çš„ terragrunt.hcl æª”æ¡ˆå¦‚ä¸‹ï¼š\nterragrunt.hclterraform { source = \"${get_path_to_repo_root()}/modules/google_container_cluster\" } include { path = find_in_parent_folders() } inputs = { cluster_name = \"tf-test\" cluster_location = \"asia-east1-b\" node_locations = [] cluster_version = \"1.24.12-gke.500\" network_name = \"projects/gcp-202011216-001/global/networks/bbin-testdev\" subnetwork_name = \"projects/gcp-202011216-001/regions/asia-east1/subnetworks/bbin-testdev-dev-platform\" node_max_pods = 64 remove_default_node_pool = true initial_node_count = 1 enable_shielded_nodes = false resource_labels = { \"dept\" : \"pid\", \"env\" : \"dev\", \"product\" : \"bbin\" } dns_enabled = false cluster_dns = \"PROVIDER_UNSPECIFIED\" cluster_dns_scope = \"DNS_SCOPE_UNSPECIFIED\" private_cluster_ipv4_cidr = \"172.16.0.176/28\" binary_authorization_enabled = true binary_authorization = \"DISABLED\" } test node-pool æª”æ¡ˆå¦‚ä¸‹ï¼š\nterragrunt.hclterraform { source = \"${get_path_to_repo_root()}/modules/google_container_node_pool\" } include { path = find_in_parent_folders() } dependency \"cluster\" { config_path = \"../cluster\" } inputs = { cluster_name = dependency.cluster.outputs.cluster_name cluster_location = dependency.cluster.outputs.cluster_location cluster_version = dependency.cluster.outputs.cluster_version node_pool_name = \"test\" node_count = 1 node_machine_type = \"e2-small\" node_disk_size = 100 node_disk_type = \"pd-standard\" node_image_type = \"COS_CONTAINERD\" node_oauth_scopes = [ \"https://www.googleapis.com/auth/devstorage.read_only\", \"https://www.googleapis.com/auth/logging.write\", \"https://www.googleapis.com/auth/monitoring\", \"https://www.googleapis.com/auth/service.management.readonly\", \"https://www.googleapis.com/auth/servicecontrol\", \"https://www.googleapis.com/auth/trace.append\" ] node_tags = [] node_taint_enabled = false node_taint_key = \"\" node_taint_value = \"\" node_taint_effect = \"\" auto_repair = true auto_upgrade = true upgrade_max_surge = 1 upgrade_max_unavailable = 0 upgrade_strategy = \"SURGE\" autoscaling_enabled = true autoscaling_max_node_count = 2 autoscaling_min_node_count = 1 autoscaling_total_max_node_count = 0 autoscaling_total_min_node_count = 0 } ä¸Šé¢å…©å€‹æª”æ¡ˆåˆ†åˆ¥æ˜¯ cluster çš„è¨­å®šï¼Œä»¥åŠ test node-pool çš„è¨­å®šï¼Œè£¡é¢çš„è¨­å®šï¼Œä¸Šé¢åŸºæœ¬éƒ½æœ‰æéï¼Œé€™é‚Šè¦æçš„æ˜¯ dependencyï¼Œdependency ä»–æ˜¯ Terragrunt æä¾›è®“æˆ‘å€‘å¯ä»¥æ–¹ä¾¿åœ°å»ç®¡ç† IaC ä¹‹é–“çš„ç›¸ä¾æ€§ï¼Œåƒæ˜¯æˆ‘å€‘é€™é‚Šï¼Œéœ€è¦å…ˆå»ºç«‹å¥½ cluster æ‰èƒ½å»ºç«‹ node_poolï¼Œæ­¤æ™‚å°±å¯ä»¥ä¾é  dependency block ä¾†å®Œæˆéœ€æ±‚ã€‚\n( é  dependency ä¾†å–å¾— cluster çš„è³‡è¨Šï¼Œä¸¦å¸¶å…¥ node_pool ä¸­ )\næ­¤æ™‚çš„åŸ·è¡ŒæŒ‡ä»¤æ˜¯åœ¨ gke ç›®éŒ„ä¸‹ï¼Œä½¿ç”¨ terragrunt run-all [åƒæ•¸] ä¾†è·‘æ•´å€‹ç›¸ä¾çš„ moduleï¼Œæˆ‘å€‘é€™é‚Šå°±å»ºç«‹ä¸€å€‹åç‚º tf-test çš„ clusterï¼Œä¸¦ä¸”æœ‰ä¸€å€‹åç‚º test çš„ node_pool ï¼Œå…¶ä»–è¨­å®šè«‹åƒè€ƒä¸Šé¢ç¨‹å¼ï¼š\næ¸¬è©¦ terragrunt run-all\n(é»ƒè‰²çš„ WARN æ˜¯å› ç‚º gcs ä¸Šé‚„æ²’æœ‰å­˜éè©²ç‹€æ…‹æª”æ¡ˆï¼Œæ‰€ä»¥æœƒè·³å‡ºæç¤º)\nç­‰åˆ° cluster å»ºç«‹å®Œæˆå¾Œï¼Œæœƒå°‡ cluster çš„è³‡è¨Šå¸¶å…¥ node_poolï¼Œæ‰é–‹å§‹å»ºç«‹ node_pool çš„è³‡æºï¼š\næ¸¬è©¦ terragrunt run-all\nç”¢ç”Ÿä¾è³´é—œè¯åœ– ç•¶æˆ‘å€‘æœå‹™ä½¿ç”¨åˆ°å¾ˆå¤šä¾è³´é—œä¿‚ï¼Œæƒ³è¦é‡æ¸…æ˜¯èª°ä¾è³´èª°ï¼Œå¦‚æœå–®ç´”çœ‹ç¨‹å¼æœƒæ¯”è¼ƒéº»ç…©ï¼Œåœ¨ Terragrunt é‚„æœ‰ä¸€å€‹å¥½ç”¨çš„æŒ‡ä»¤ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤ï¼Œç”¢ç”Ÿå°æ‡‰çš„ä¾è³´é—œä¿‚åœ–ï¼Œåœ¨æª¢è¦–æ™‚å¯ä»¥æ›´æ¸…æ¥šçŸ¥é“é—œä¿‚ï¼š\nterragrunt graph-dependencies | dot -Tpng \u003e graph.png ( é€™å€‹ dot æŒ‡ä»¤æ˜¯å¦å¤–çš„å¥—ä»¶ï¼Œæœƒå°‡é—œä¿‚åœ–ç¨‹å¼ç¢¼è½‰æˆåœ–æª”ï¼Œè«‹å…ˆå®‰è£ brew install graphviz )\né—œè¯åœ–","terragrunt-å®‰è£æ–¹å¼#Terragrunt å®‰è£æ–¹å¼":"é‚£è¦æ€éº¼ä½¿ç”¨ Terragrunt å‘¢ï¼ï¼Ÿ\nç¬¬ä¸€æ­¥ç•¶ç„¶æ˜¯å®‰è£å®ƒå›‰ï¼Œæˆ‘å€‘ç³»çµ±æ˜¯ macOSï¼Œæ‰€ä»¥æˆ‘å€‘å®‰è£æ–¹å¼æ˜¯ Homebrew ä¾†é€²è¡Œå®‰è£ï¼š\nbrew install terragrunt æ¥è‘—æˆ‘å€‘çš„æŒ‡ä»¤æœƒå¾ terraform XXX è®Šæˆä»¥ä¸‹ï¼š\nterragrunt plan terragrunt apply terragrunt output terragrunt destroy Terragrunt æœƒå°‡æ‰€æœ‰å‘½ä»¤ã€åƒæ•¸å’Œé¸é …ç›´æ¥è½‰ç™¼åˆ° Terraformã€‚(æ‰€ä»¥æˆ‘å€‘ä¹Ÿéœ€è¦ä¸‹è¼‰ Terraform)\nTerragrunt çš„é è¨­æª”æ¡ˆåç¨±æ˜¯ terragrunt.hcl ï¼ŒTerragrunt çš„è¨­å®šæª”æ¡ˆåŸºæœ¬ä¸Šèˆ‡ Module å·®ä¸å¤šï¼Œåªæ˜¯æœ‰æ›´å¤šæ›´æ–¹ä¾¿çš„è®Šæ•¸å¯ä»¥ä½¿ç”¨ã€‚","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"äº‹åŠåŠŸå€ â€” ä½¿ç”¨ Terragrunt æ­é… Terraform ç®¡ç†åŸºç¤è¨­ç½®ï¼šhttps://medium.com/act-as-a-software-engineer/%E4%BA%8B%E5%8D%8A%E5%8A%9F%E5%80%8D-%E4%BD%BF%E7%94%A8-terragrunt-%E6%90%AD%E9%85%8D-terraform-%E7%AE%A1%E7%90%86%E5%9F%BA%E7%A4%8E%E8%A8%AD%E6%96%BD-f70c30166639"},"title":"å¦‚ä½•å°å…¥ Terragruntï¼ŒTerragrunt å¥½è™•æ˜¯ä»€éº¼ï¼Ÿ"},"/projects/":{"data":{"":" æ´»å‹•ç”³è«‹ç³»çµ± (Web)å¹«å­¸æ ¡é–‹ç™¼çš„å¤§å‹æ ¡å‹™ç³»çµ±ï¼Œæ–¹ä¾¿ç³»çµ±ç¤¾åœ˜ä½¿ç”¨é›»å­å¡«å–®æ–¹å¼ç”³è«‹æ´»å‹•ï¼Œä¹Ÿè®“ä¹‹å¾Œçš„å­¸å¼Ÿå¦¹ï¼Œå¯ä»¥æ›´å¿«é€Ÿçš„æŸ¥çœ‹åˆ°æ­·å±†è¾¦ç†çš„æ´»å‹•ã€‚ å·”å³°æ¥µé€Ÿ å…Œæ›è™›å¯¶ç¶²ç«™ (Web)è©²éŠæˆ²æœ‰å¤§é‡è™›å¯¶å¯ä»¥å…Œæ›ï¼Œä½†å®˜æ–¹æä¾›çš„ç¶²é ï¼Œéœ€è¦é‡è¤‡è¼¸å…¥ ID ä»¥åŠé©—è­‰ç¢¼é‚„æœ‰åºè™Ÿï¼Œå› æ­¤å¯«äº†ä¸€å€‹å°ç¶²é ï¼Œå¯ä»¥åªè¼¸å…¥ä¸€æ¬¡ ID ä»¥åŠé©—è­‰ç¢¼ï¼Œå°±å…Œæ›å®Œæ‰€æœ‰åºè™Ÿã€‚ äº¬ç·¯å·¥ç¨‹æœ‰é™å…¬å¸å®˜ç¶² (Web)å”åŠ©äº¬ç·¯å·¥ç¨‹æœ‰é™å…¬å¸å»ºç«‹å…¬å¸å®˜æ–¹ç¶²é ã€‚ "},"title":"å°ˆæ¡ˆæˆå°±"}}