{"/about/":{"data":{"":"Hextra is designed to be a simple, fast, and flexible theme for building modern static websites. It is especially well-suited for documentation websites but can also be used for various types of sites, such as blogs, portfolios, and more.\nHugo, like Jekyll, is a static site generator. What sets Hugo apart is that it is a single binary, making it easy to install and run on various platforms. It is also extremely fast and reliable, capable of rendering a site with thousands of pages in milliseconds.\nHextra is built with a mindset focused on having a minimal footprint. To get started, no extra dependencies like Node.js packages are required; all you need is a single YAML configuration file, along with your Markdown content. Thus, we can focus on writing quality content instead of setting up tooling.","credits#Credits":"Hextra cannot be built without the following tools and inspirations:\nHugo Tailwind CSS Heroicons Nextra Next.js "},"title":"About"},"/docs/":{"data":{"":"ğŸ‘‹ å°¼å¥½ï¼Œæ­¡è¿ä¾†çœ‹æˆ‘çš„","features#Features":" Beautiful Design - Inspired by Nextra, Hextra utilizes Tailwind CSS to offer a modern design that makes your site look outstanding. Responsive Layout and Dark Mode - It looks great on all devices, from mobile, tablet to desktop. Dark mode is also supported to accommodate various lighting conditions. Fast and Lightweight - Powered by Hugo, a lightning-fast static-site generator housed in a single binary file, Hextra keeps its footprint minimal. No JavaScript or Node.js are needed to use it. Full-text Search - Built-in offline full-text search powered by FlexSearch, no additional configuration required. Battery-included - Markdown, syntax highlighting, LaTeX math formulae, diagrams and Shortcodes elements to enhance your content. Table of contents, breadcrumbs, pagination, sidebar navigation and more are all automatically generated. Multi-language and SEO Ready - Multi-language sites made easy with Hugoâ€™s multilingual mode. Out-of-the-box support is included for SEO tags, Open Graph, and Twitter Cards. ","what-is-hextra#What is Hextra?":"Hextra is a modern, fast and batteries-included [Hugo][hugo] theme built with [Tailwind CSS][tailwind-css].\nDesigned for building beautiful websites for documentation, blogs, and websites, it provides out-of-the-box features and flexibility to meet various requirements."},"title":"Blog"},"/docs/kubernetes/":{"data":{"":"Explore the following sections to learn how to use Hextra:\nåœ¨æ­£å¼ç’°å¢ƒä¸Šè¸©åˆ° StatefulSet çš„é›·ï¼Œæ‹¿åˆ° P1 çš„æ•™è¨“ "},"title":"Kubernetes"},"/docs/kubernetes/k8s-statefulset-podmanagementpolicy/":{"data":{"":"æ­¤æ–‡ç« è¦ä¾†è¨˜éŒ„ä¸€ä¸‹å‰é™£å­åœ¨å…¬å¸çš„æ­£å¼ç’°å¢ƒè¸©åˆ° StatefulSet çš„é›·ï¼Œäº‹æƒ…æ˜¯é€™æ¨£çš„ï¼Œæˆ‘å€‘æœ‰äº›æœå‹™ï¼Œæ˜¯ä½¿ç”¨ StatefulSet ä¾†å»ºç½®ï¼Œè‡³æ–¼ç‚ºä»€éº¼ä¸ç”¨ Deploymentï¼Œé€™å€‹èªªä¾†è©±é•· (ä¹Ÿä¸æ˜¯å› ç‚ºéœ€è¦ç‰¹å®šçš„ Pod åç¨±ã€æˆ–æ˜¯ç¶²è·¯æ¨™è¨˜ç­‰ç­‰)ï¼Œæˆ‘å€‘é€™é‚Šå…ˆä¸è¨è«–ï¼Œé€™å€‹ StatefulSet æœå‹™æ˜¯ Nginx + PHP-FPMï¼Œç‚ºäº†é¿å…æµé‡é€²å…¥åˆ° processes å·²ç¶“è¢«ç”¨å…‰çš„ Pod ä¸­ï¼Œæˆ‘å€‘åœ¨ StatefulSet çš„ PHP Container ä¸Šæœ‰è¨­å®š readinessï¼Œreadiness çš„è¨­å®šé•·å¾—åƒä»¥ä¸‹ï¼š\nreadinessProbe: exec: command: - \"/bin/bash\" - \"-c\" - | CHECK_INFO=$(curl -s -w 'http code:\\t%{http_code}\\n' 127.0.0.1/status) HTTP_CODE=$(echo -e \"${CHECK_INFO}\" | awk '/http code:/ {print $3}') IDLE_PROCESSES=$(echo -e \"${CHECK_INFO}\" | awk '/idle processes:/ {print $3}') [[ $HTTP_CODE -eq 200 \u0026\u0026 $IDLE_PROCESSES -ge 10 ]] || exit 1 æˆ‘å€‘æœƒç”¨ curl ä¾†æ‰“ /statusï¼Œæª¢æŸ¥å›å‚³çš„ http code æ˜¯å¦ç‚º 200ï¼Œä»¥åŠ idle processes æ˜¯å¦å¤§æ–¼ç­‰æ–¼ 10ï¼Œå¦‚æœä¸ç¬¦åˆï¼Œå°±æœƒå›å‚³ 1ï¼Œè®“ä»–è¢«æ¨™è¨˜ä¸å¥åº·ï¼Œè®“ Kubernetes åœæ­¢æµé‡åˆ°ä¸å¥åº·çš„å®¹å™¨ï¼Œä»¥ç¢ºä¿æµé‡è¢«è·¯ç”±åˆ°å…¶ä»–å¥åº·çš„å‰¯æœ¬ã€‚","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"Kubernetes â€” å¥åº·æª¢æŸ¥ï¼šhttps://medium.com/learn-or-die/kubernetes-%E5%81%A5%E5%BA%B7%E6%AA%A2%E6%9F%A5-59ee2a798115\nPod Management Policiesï¼šhttps://kubernetes.io/docs/concepts/workloads/controllers/statefulset/#pod-management-policies","å•é¡Œ#å•é¡Œ":"ç•¶å¤©é‡åˆ°çš„æƒ…æ³æ˜¯ï¼Œæˆ‘å€‘ä¸Šç¨‹å¼å¾Œï¼ŒPod éƒ½ä¸€åˆ‡æ­£å¸¸ï¼Œç•¶æµé‡é–‹å§‹é€²ä¾†å¾Œï¼Œç™¼ç¾ 10 å€‹ Pod æœƒé–‹å§‹å¶ç™¼çš„å™´ Readiness probe failedï¼ŒæŸ¥çœ‹ç›£æ§ç™¼ç¾ processes è¶Šä¾†è¶Šä½ï¼Œæœ€å¾Œè¢«åæ‡‰æœå‹™æœ‰å•é¡Œï¼Œæˆ‘å€‘æŸ¥çœ‹ Hpa çš„ç´€éŒ„çš„ç¢ºæœ‰è§¸ç™¼åˆ° 40 å€‹ Podï¼Œåªæ˜¯æŸ¥çœ‹ Pod æ•¸é‚„æ˜¯ä¾æ¨£å¡åœ¨ 10 å€‹ï¼Œç•¶ä¸‹æˆ‘å€‘æœ‰å˜—è©¦ä½¿ç”¨èª¿æ•´ yaml åœ¨ applyï¼Œç™¼ç¾ StatefulSet çš„ yaml ä¹Ÿå·²ç¶“æ›´æ–°äº†ï¼Œä½† Pod é‚„æ˜¯ä¸€æ¨£å¡åœ¨ 10 å€‹ï¼Œä¹Ÿæœ‰ä½¿ç”¨ kubectl ä¸‹ kubectl scale sts [æœå‹™åç¨±] --replicas=0ï¼Œæƒ³è¦åˆ‡æ› Pod æ•¸ä¹Ÿæ²’æœ‰è¾¦æ³•ã€‚\nç•¶ä¸‹æˆ‘å€‘æœ‰å…ˆ Call Google çš„ Support ä¸€èµ·æ‰¾åŸå› ï¼ŒGoogle æ˜¯å»ºè­°æˆ‘å€‘ readiness çš„æ¢ä»¶ä¸è¦è¨­çš„å¤ªåš´æ ¼ï¼Œå¯ä»¥åŠ ä¸Š timeoutSeconds: ç§’æ•¸ï¼Œä½†å°æ–¼ Pod å¡ä½ï¼Œé‚„æ˜¯æ²’æœ‰æ‰¾åˆ°åŸå› ï¼Œå¾Œä¾†æˆ‘å€‘æŸ¥äº†ä¸€ä¸‹ StatefulSet çš„æ–‡ä»¶ç™¼ç¾ï¼ŒStatefulSet æœ‰ä¸€å€‹è¨­å®š podManagementPolicyï¼Œé è¨­æ˜¯ OrderedReadyï¼Œä»–å¿…é ˆç­‰å¾…å‰é¢çš„ Pod æ˜¯ Ready ç‹€æ…‹ï¼Œæ‰æœƒå†ç¹¼çºŒå»ºç«‹æ–°çš„ï¼Œä¹Ÿå°±æ˜¯èªªæˆ‘å€‘çš„ StatefulSet å·²ç¶“å¡ä½ï¼Œå°è‡´å°±ç®— Hpa è§¸ç™¼è¦é•·åˆ° 40 å€‹ Pod ä¹Ÿæ²’æœ‰ç”¨ã€‚","æ¸¬è©¦çµæœ#æ¸¬è©¦çµæœ":"æœ€å¾Œæˆ‘å€‘å°±ä½¿ç”¨å…©ç¨®æ¨¡å¼ä¾†æ¸¬è©¦çœ‹çœ‹ï¼Œå·²ä¸‹æ˜¯æ¸¬è©¦çµæœ(é€é P1 æ‰çŸ¥é“çš„è¨­å®šï¼±ï¼±)ï¼š\næœ‰å°‡æ¸¬è©¦çš„ StatefulSet æ”¾åœ¨ Githubï¼Œå¯ä»¥é»æˆ‘æŸ¥çœ‹ (å¯ä»¥èª¿æ•´ readinessProbe çš„ httpGet.Path æ•…æ„æŠŠä»–ç”¨å£)\nä½¿ç”¨ OrderedReady æ¨¡å¼ StatefulSet åœ¨ podManagementPolicy é è¨­ OrderedReady çš„æ¨¡å¼ï¼Œæ•…æ„è®“ readiness å¡ä½æ™‚ (Pod å¡ä½æ™‚)ï¼š\nç•¶ä¸‹çš„ StatefulSet è¨­å®šï¼š StatefulSet è¨­å®š Pod ç‹€æ…‹ï¼š Pod ç‹€æ…‹ ä½¿ç”¨æŒ‡ä»¤èª¿æ•´ Pod æ•¸é‡ æˆ‘å€‘é€™æ™‚å€™ä¸‹æŒ‡ä»¤èª¿æ•´ Pod æ•¸é‡ï¼Œçœ‹çœ‹æœƒç™¼ç”Ÿä»€éº¼äº‹ï¼š\nkubectl scale sts my-statefulset --replicas=5 æˆ‘å€‘å…ˆçœ‹ StatefulSet çš„ yaml å¯ä»¥çœ‹åˆ° Pod replicas å·²ç¶“æ”¹è®Šï¼Œä¹Ÿå¯ä»¥çœ‹ generation æœ‰æ›´æ–°ï¼Œä»£è¡¨ StatefulSet æœ¬èº«æœ‰æ¥æ”¶åˆ°èª¿æ•´è¨­å®šçš„è«‹æ±‚ã€‚\nä¸‹æŒ‡ä»¤èª¿æ•´å¾Œçš„ StatefulSet è¨­å®š çœ‹äº†ä¸€ä¸‹ Pod æ•¸é‡ï¼Œä¹Ÿæ˜¯ä¸€æ¨£å¡ä½ï¼Œä¸” Pod æ•¸é‡ä¹Ÿæ²’æœ‰è®ŠåŒ–ã€‚\nä¸‹æŒ‡ä»¤èª¿æ•´å¾Œçš„ Pod ç‹€æ…‹ ä½¿ç”¨ yaml èª¿æ•´ Pod æ•¸é‡ æˆ‘å€‘ç›´æ¥èª¿æ•´ StatefulSet yaml çš„ Pod æ•¸é‡ï¼Œçœ‹çœ‹æœƒç™¼ç”Ÿä»€éº¼äº‹ï¼š\nä¸€æ¨£æˆ‘å€‘å…ˆçœ‹ StatefulSet çš„ yaml å¯ä»¥çœ‹åˆ° Pod replicas å·²ç¶“æ”¹è®Š(é€™è£¡æ‡‰è©²åˆ‡åˆ¥çš„ Pod æ•¸é‡ï¼Œåˆ‡å› 3 å€‹å¥½åƒæ²’æœ‰æ„ç¾© xD)ï¼Œä¹Ÿå¯ä»¥çœ‹ generation æœ‰æ›´æ–°ã€‚\nä½¿ç”¨ yaml èª¿æ•´å¾Œçš„ StatefulSet è¨­å®š çœ‹äº†ä¸€ä¸‹ Pod æ•¸é‡ï¼Œä¹Ÿæ˜¯ä¸€æ¨£å¡ä½ï¼Œä¸” Pod æ•¸é‡ä¹Ÿæ²’æœ‰è®ŠåŒ–ã€‚\nä½¿ç”¨ yaml èª¿æ•´å¾Œçš„ Pod ç‹€æ…‹ æ‰€ä»¥ä»£è¡¨åœ¨ OrderedReady çš„æ¨¡å¼ä¸‹ï¼ŒPod å¡ä½æ™‚ï¼Œç„¡æ³•å° Pod é€²è¡Œä»»ä½•æ“ä½œï¼Œå¿…é ˆè¦æ‰‹å‹•åˆªé™¤å¡ä½çš„ Pod æ‰åƒå¾—åˆ°æœ€æ–°çš„è¨­å®šã€‚\nä½¿ç”¨ Parallel æ¨¡å¼ StatefulSet åœ¨ podManagementPolicy Parallel çš„æ¨¡å¼ï¼Œæ•…æ„è®“ readiness å¡ä½æ™‚ (Pod å¡ä½æ™‚)ï¼š\nç•¶ä¸‹çš„ StatefulSet è¨­å®šï¼š StatefulSet è¨­å®š Pod ç‹€æ…‹ï¼š Pod ç‹€æ…‹ ä½¿ç”¨æŒ‡ä»¤èª¿æ•´ Pod æ•¸é‡ æˆ‘å€‘é€™æ™‚å€™ä¸‹æŒ‡ä»¤èª¿æ•´ Pod æ•¸é‡ï¼Œçœ‹çœ‹æœƒç™¼ç”Ÿä»€éº¼äº‹ï¼š\nkubectl scale sts my-statefulset --replicas=5 æˆ‘å€‘å…ˆçœ‹ StatefulSet çš„ yaml å¯ä»¥çœ‹åˆ° Pod replicas å·²ç¶“æ”¹è®Šï¼Œä¹Ÿå¯ä»¥çœ‹ generation æœ‰æ›´æ–°ï¼Œä»£è¡¨ StatefulSet æœ¬èº«æœ‰æ¥æ”¶åˆ°èª¿æ•´è¨­å®šçš„è«‹æ±‚ã€‚\nä¸‹æŒ‡ä»¤èª¿æ•´å¾Œçš„ StatefulSet è¨­å®š çœ‹äº†ä¸€ä¸‹ Pod æ•¸é‡ï¼Œå°±ç®— my-statefulset-2 å¡ä½ï¼Œé‚„æ˜¯å¯ä»¥æ“´åˆ° 5 å€‹ Podã€‚\nä¸‹æŒ‡ä»¤èª¿æ•´å¾Œçš„ Pod ç‹€æ…‹ ä½¿ç”¨ yaml èª¿æ•´ Pod æ•¸é‡ æˆ‘å€‘ç›´æ¥èª¿æ•´ StatefulSet yaml çš„ Pod æ•¸é‡ï¼Œçœ‹çœ‹æœƒç™¼ç”Ÿä»€éº¼äº‹ï¼š\nä¸€æ¨£æˆ‘å€‘å…ˆçœ‹ StatefulSet çš„ yaml å¯ä»¥çœ‹åˆ° Pod replicas å·²ç¶“æ”¹è®Šï¼Œä¹Ÿå¯ä»¥çœ‹ generation æœ‰æ›´æ–°ã€‚\nä½¿ç”¨ yaml èª¿æ•´å¾Œçš„ StatefulSet è¨­å®š çœ‹äº†ä¸€ä¸‹ Pod æ•¸é‡ï¼Œä¹Ÿä¸æœƒç®¡å…¶ä»– Pod æ˜¯å¦ Readyï¼Œä¸€æ¨£å¯ä»¥ç¸®å°æˆ 2 å€‹ Podã€‚\nä½¿ç”¨ yaml èª¿æ•´å¾Œçš„ Pod ç‹€æ…‹ ","çµè«–#çµè«–":"å¾Œä¾†æˆ‘å€‘é‡æ–°æª¢æŸ¥äº†ä¸€ä¸‹ç‚ºä»€éº¼ processes æœƒç”¨å®Œï¼Œçµæœç™¼ç¾æ˜¯ RD çš„ç¨‹å¼é‚è¼¯ï¼Œå°è‡´æ¯ç­† Request å¿…é ˆç­‰å¾…å‰ä¸€ç­† Request åšå®Œï¼Œæ‰æœƒé–‹å§‹å‹•ä½œï¼Œè®“ processes ä¸€ç›´è¢«å ç”¨ï¼Œæ²’è¾¦æ³•å³æ™‚æ¶ˆåŒ–ï¼Œå°è‡´ processes ç”¨å®Œï¼ŒåˆåŠ ä¸Šæœå‹™æ˜¯ä½¿ç”¨ StatefulSetï¼Œé è¨­æ¨¡å¼çš„ OrderedReadyï¼Œå¿…é ˆç­‰å¾…å‰ä¸€å€‹ Pod æ˜¯ Ready æ‰å¯ä»¥è‡ªå‹•æ“´ç¸®ï¼Œæ‰€ä»¥ç•¶æˆ‘å€‘ Hpa æƒ³è¦æ“´ç¸®ï¼Œä¾†å¢åŠ å¯ç”¨çš„ processes æ•¸é‡ï¼Œä¹Ÿå› ç‚ºæ²’è¾¦æ³•æ“´ç¸®ï¼Œæœ€å¾Œå°è‡´é€™ä¸€é€£ä¸²çš„å•é¡Œ ğŸ˜•ã€‚\nå¦å¤–ï¼Œå¦‚æœæƒ³è¦å¾ OrderedReady æ¨¡å¼åˆ‡æˆ Parallel æ¨¡å¼ (åæ­£éä¾†ä¹Ÿæ˜¯)ï¼Œå¿…é ˆå…ˆå°‡åŸæœ¬çš„ StatefulSet çµ¦åˆªé™¤ï¼Œæ‰å¯ä»¥èª¿æ•´ï¼š\nOrderedReady æ¨¡å¼åˆ‡æˆ Parallel æ¨¡å¼ ","è§£æ±ºè¾¦æ³•#è§£æ±ºè¾¦æ³•":"ç•¶ä¸‹æƒ³è¶•å¿«è§£æ±º readiness é€™å€‹å•é¡Œï¼Œèª¿æ•´ timeoutSeconds å¾Œï¼Œå–®ç´” apply æ˜¯æ²’æœ‰ç”¨çš„ï¼Œè¦è¨˜å¾—åˆªæ‰å¡ä½çš„ Podï¼Œè®“ä»–é‡æ–°å»ºç«‹ï¼Œæ‰æœƒå¥—ç”¨æ–°çš„è¨­å®š (ä½†æˆ‘å€‘ç•¶ä¸‹å¤ªåœ¨æ„ç‚ºç”šéº¼ Pod æœƒå¡ä½ï¼Œæ²’æœ‰æƒ³åˆ°è¦å…ˆæŠŠ readiness å•é¡Œä¿®æ‰ xDï¼Œæˆ‘å€‘ç•¶ä¸‹çš„è§£æ³•æ˜¯å…ˆå°‡æµé‡å°åˆ°åœ°ç«¯æ­£å¸¸çš„æœå‹™ä¸Š)ã€‚\nå¦å¤– Google ä¹Ÿèªªï¼Œå‡å¦‚æˆ‘å€‘é‚„æ˜¯å¿…é ˆä½¿ç”¨ StatefulSet ä¾†å»ºç«‹æœå‹™ï¼Œå»ºè­°æˆ‘å€‘æŠŠ podManagementPolicy æ”¹æˆ Parallelï¼Œå®ƒæœƒæœ‰é»åƒæ˜¯ Deployment çš„æ„Ÿè¦ºï¼Œä¸æœƒç­‰å¾…å…¶ä»– Pod è®Šæˆ Ready ç‹€æ…‹ï¼Œæ‰€ä»¥å¯ä»¥è®“æˆ‘å€‘å°±ç®—åœ¨ readiness å¡ä½çš„æƒ…æ³ä¸‹ï¼Œä¹Ÿå¯ä»¥è‡ªå‹•æ“´ç¸®æœå‹™ã€‚\nStatefulSet podManagementPolicy åƒæ•¸èªªæ˜\nOrderedReady (é è¨­) Pods æœƒæŒ‰ç…§é †åºä¸€å€‹æ¥ä¸€å€‹åœ°è¢«å‰µå»ºã€‚å³ï¼Œn+1 è™Ÿ Pod ä¸æœƒåœ¨ n è™Ÿ Pod æˆåŠŸå‰µå»ºä¸” Ready ä¹‹å‰é–‹å§‹å‰µå»ºã€‚ åœ¨ç¸®å° StatefulSet çš„å¤§å°æ™‚ï¼ŒPods æœƒæŒ‰ç…§åå‘é †åºä¸€å€‹æ¥ä¸€å€‹åœ°è¢«çµ‚æ­¢ã€‚å³ï¼Œn è™Ÿ Pod ä¸æœƒåœ¨ n+1 è™Ÿ Pod å®Œå…¨çµ‚æ­¢ä¹‹å‰é–‹å§‹çµ‚æ­¢ã€‚ é€™ç¢ºä¿äº† Pods çš„å•Ÿå‹•å’Œçµ‚æ­¢çš„é †åºæ€§ã€‚\nParallel æ‰€æœ‰ Pods æœƒåŒæ™‚åœ°è¢«å‰µå»ºæˆ–çµ‚æ­¢ã€‚ ç•¶ StatefulSet æ“´å±•æ™‚ï¼Œæ–°çš„ Pods æœƒç«‹å³é–‹å§‹å‰µå»ºï¼Œä¸ç”¨ç­‰å¾…å…¶ä»– Pods æˆç‚º Ready ç‹€æ…‹ã€‚ ç•¶ç¸®å° StatefulSet çš„å¤§å°æ™‚ï¼Œè¦çµ‚æ­¢çš„ Pods æœƒç«‹å³é–‹å§‹çµ‚æ­¢ï¼Œä¸ç”¨ç­‰å¾…å…¶ä»– Pods å…ˆçµ‚æ­¢ã€‚ é€™ç¨®ç­–ç•¥æä¾›äº†å¿«é€Ÿçš„æ“´å±•å’Œç¸®å°æ“ä½œï¼Œä½†ç¼ºä¹é †åºæ€§ä¿è­‰ã€‚"},"title":"æ­£å¼ç’°å¢ƒä¸Šè¸©åˆ° StatefulSet çš„é›·ï¼Œæ‹¿åˆ° P1 çš„æ•™è¨“"},"/docs/nginx/":{"data":{"":"Explore the following sections to learn how to use Hextra:\næƒ³ä½¿ç”¨ Nginx Upstream Proxy åˆ°å¤–éƒ¨æœå‹™ï¼Œä¸¦å¸¶å…¥å°æ‡‰çš„ header è©²æ€éº¼åšï¼Ÿ "},"title":"Nginx"},"/docs/nginx/nginx-upstream-set-host-header/":{"data":{"":"æ­¤æ–‡ç« è¦ä¾†è¨˜éŒ„ä¸€ä¸‹æœ€è¿‘åœ¨å…¬å¸æœå‹™å…¥å£é‡åˆ°çš„ä¸€äº›å°å•é¡Œï¼Œä»¥åŠè§£æ±ºçš„æ–¹æ³•ã€‚ç°¡å–®èªªæ˜ä¸€ä¸‹ï¼Œæˆ‘å€‘çš„æœå‹™å…¥å£æ˜¯ç”¨ Nginx ä¾†ç•¶ä½œ proxy serverï¼Œå°‡ä¸åŒè·¯å¾‘æˆ–æ˜¯ servername å°åˆ°å°æ‡‰çš„å¾Œç«¯ç¨‹å¼ï¼Œæˆ–æ˜¯å¤–éƒ¨çš„æœå‹™ä¸Š(ä¾‹å¦‚ AWS cloudfront.net)ï¼Œæœ¬ç¯‡è¦æ¸¬è©¦çš„æ˜¯å¦‚æœä½¿ç”¨è¦åŒæ™‚ä½¿ç”¨ upstream åˆ°å¤–éƒ¨æœå‹™ï¼Œä¸”éœ€è¦å¸¶ host header è©²æ€éº¼åšã€‚\nNginx çš„ upstream æ˜¯ä»€éº¼ï¼Ÿ\né€šå¸¸æˆ‘å€‘ proxy_pass çš„å¯«æ³•æœƒæ˜¯é€™æ¨£ï¼š\nlocation /aaa { proxy_pass http://aaa.example.com; } ç•¶ Nginx æ”¶åˆ°çš„ request æ˜¯ /aaa æ™‚ï¼Œå°±æœƒå°‡ request è½‰ç™¼åˆ° http://aaa.example.comã€‚\nä½†å‡å¦‚å¾Œç«¯æœ‰å¤šå°æ©Ÿå™¨æˆ–æ˜¯æœå‹™ï¼Œå¯ä»¥è™•ç†åŒä¸€ç¨® requestï¼Œé€™æ™‚å€™å°±å¯ä»¥ä½¿ç”¨ upstream ä¾†è™•ç†ï¼š\nupstream backend_hosts { server aaa.example.com; server bbb.example.com; server ccc.example.com; } location /aaa { proxy_pass http://backend_hosts; } é€™æ¨£å­çš„å¥½è™•æ˜¯å¯ä»¥æœ‰å¤šå€‹æ©Ÿå™¨æˆ–æ˜¯å¾Œç«¯æœå‹™å¯ä»¥åˆ†æ•£è«‹æ±‚ï¼Œåšåˆ°è² è¼‰å¹³è¡¡çš„æ•ˆæœã€‚","åƒè€ƒ#åƒè€ƒ":"Make nginx to pass hostname of the upstream when reverseproxying","å•é¡Œ#å•é¡Œ":"é‚£å¦‚æœæˆ‘å€‘ä½¿ç”¨ Nginx upstream æ™‚ï¼Œé‚„æƒ³è¦åŒæ™‚å¸¶ host çš„ header åˆ°å¾Œç«¯è©²æ€éº¼åšå‘¢ï¼Ÿæˆ‘å€‘å…ˆä¾†çœ‹ä¸€ä¸‹ç›®å‰çš„å¯«æ³•ï¼š\n( æ¸¬è©¦ç¯„ä¾‹æ˜¯ä½¿ç”¨ docker ä¾†æ¨¡æ“¬ï¼Œå¯ä»¥åƒè€ƒç¨‹å¼ç¢¼ \u003e é»æˆ‘å‰å¾€ githubï¼Œæœƒæœ‰ä¸‰å€‹ nginxï¼Œå…¶ä¸­ä¸€å€‹æ˜¯è² è²¬ proxy çš„ nginx åç‚º proxyï¼Œå¦å¤–å…©å°æ˜¯ upstream å¾Œçš„æœå‹™ï¼Œåç‚º upstream_server1ã€upstream_server2 )\nnginx-old.conf upstream upstream_server { server upstream_server1; server upstream_server2; } server { listen 80; server_name localhost; location /upstream_server/ { proxy_pass http://upstream_server; proxy_set_header Host \"upstream_server1\"; proxy_set_header Host \"upstream_server2\"; access_log /var/log/nginx/access.log upstream_log; } } } å¯ä»¥çœ‹åˆ°æˆ‘å€‘å¸Œæœ› Nginx æ”¶åˆ° request æ˜¯ /upstream_server æ™‚ï¼Œå°‡ request è½‰ç™¼åˆ° http://upstream_serverï¼Œè€Œ upstream_server å¾Œé¢æœ‰å…©å€‹ serverï¼Œä¸¦ä¸”åœ¨ proxy æ™‚ï¼Œå¸¶å…¥å…©å€‹ä¸åŒçš„ host headerã€‚ä½†å¦‚æœçœŸçš„é€™æ¨£å¯«ï¼Œå¯ä»¥é”åˆ°æˆ‘å€‘æƒ³è¦å¾—æ•ˆæœå—ï¼Ÿæˆ‘å€‘å¯¦éš›è·‘çœ‹çœ‹ç¨‹å¼ (ç¯„ä¾‹å¯ä»¥ä½¿ç”¨ nginx-old.conf)ï¼š\nnginx åŸæœ¬å¯«æ³• å¾ä¸Šé¢çš„ LOG å¯ä»¥ç™¼ç¾ï¼Œæˆ‘å€‘ call /upstream_server æ™‚ï¼Œå¾Œç«¯çš„ upstream_server1ã€upstream_server2 æ”¶åˆ°çš„ host åªæœƒæ”¶åˆ°ç¬¬ä¸€å€‹è¨­å®šçš„ Hostï¼Œä¸”æœå‹™æœƒå‡ºç¾ 400 Bad Requestï¼ŒæŸ¥äº†ä¸€ä¸‹ç¶²è·¯æ–‡ç« ï¼Œç™¼ç¾å‡ºç¾ 400 Bad Requestï¼Œå¯èƒ½è·Ÿ header é€å¤ªå¤šè³‡è¨Šéå»ï¼Œè©³ç´°å¯ä»¥åƒè€ƒ è§£æ±ºç¶²ç«™å‡ºç¾ 400 Bad Request ç‹€æ…‹çš„æ–¹æ³•ã€‚\né€™é‚Šæ¨æ¸¬æ‡‰è©²æ˜¯å¾Œç«¯å¦‚æœä¹Ÿæ˜¯ç”¨ nginx ç›´æ¥æ¥æ”¶æ‰æœƒé‡åˆ° 400 çš„å•é¡Œï¼Œé‚„å¥½ç›®å‰å…¬å¸æœå‹™é‚„æ˜¯æ­£å¸¸çš„ xDDï¼Œæª¢æŸ¥ä¸€ä¸‹å¾Œç™¼ç¾ï¼Œå…¶å¯¦å¾Œç«¯æ ¹æœ¬æ²’æœ‰è¦æ±‚å°æ‡‰ header æ‰èƒ½æ¥æ”¶(æ‡‰è©²æ˜¯å°æ–¹å¿˜è¨˜åŠ ä¸Šæ­¤é™åˆ¶)ã€‚","è§£æ±º#è§£æ±º":"å¥½ï¼Œä¸ç®¡æ˜¯å¦éœ€è¦å°æ‡‰ headerï¼Œæˆ‘å€‘é‚„æ˜¯æ‰¾çœ‹çœ‹æœ‰æ²’æœ‰è¾¦æ³•åŒæ™‚ä½¿ç”¨ upstreamï¼Œä¸¦å¸¶å…¥å°æ‡‰ host çš„æ–¹æ³•å‘¢ï¼Ÿ\næœ€å¾Œåƒè€ƒç¶²è·¯ä¸Šçš„æ–‡ç« ï¼Œä¼¼ä¹åªèƒ½ä½¿ç”¨å…©å±¤çš„ proxyï¼Œæ‰èƒ½å®Œæˆé€™å…©å€‹éœ€æ±‚ï¼Œæˆ‘å€‘ä¾†çœ‹çœ‹è¦æ€éº¼å¯«å§ (ç¯„ä¾‹å¯ä»¥ä½¿ç”¨ nginx.conf)ï¼š\nnginx.conf server { listen 777; server_name localhost; location / { proxy_pass http://upstream_server1; proxy_set_header Host \"upstream_server1\"; access_log /var/log/nginx/access.log upstream_log; } } server { listen 888; server_name localhost; location / { proxy_pass http://upstream_server2; proxy_set_header Host \"upstream_server2\"; access_log /var/log/nginx/access.log upstream_log; } } upstream upstream_server { server 127.0.0.1:777; server 127.0.0.1:888; } server { listen 80; server_name localhost; location /upstream_server/ { proxy_pass http://upstream_server; access_log /var/log/nginx/access.log upstream_log; } } å¯ä»¥çœ‹åˆ°ä¸Šé¢çš„ç¨‹å¼ç¢¼ï¼Œæˆ‘å€‘é€éå…©å±¤çš„ proxyï¼Œä¾†é”åˆ°æˆ‘å€‘æƒ³è¦çš„æ•ˆæœï¼Œé€™æ¨£å­å°±å¯ä»¥åŒæ™‚ä½¿ç”¨ upstreamï¼Œä¸¦ä¸”å¸¶å…¥å°æ‡‰çš„ host headerã€‚\né¦–å…ˆåœ¨ 28 ~ 36 è¡Œï¼Œæˆ‘å€‘ä¸€æ¨£å¦‚æœ Nginx æ”¶åˆ° request æ˜¯ /upstream_server æ™‚ï¼Œæœƒ proxy åˆ° upstream_server é€™å€‹ upstream ä¸­ï¼Œè€Œ upstream_server æœ‰å…©å€‹ serverï¼Œåˆ†åˆ¥æ˜¯ 127.0.0.1:777ã€127.0.0.1:888ï¼Œä½†å¯¦éš›ä¸Šæ²’æœ‰é€™å…©å€‹ portï¼Œæ‰€ä»¥æˆ‘å€‘éœ€è¦å†å¯«ä¸€å±¤ä¸€èˆ¬çš„ proxy è¨­å®šï¼Œåˆ†åˆ¥æ˜¯ 1 ~ 10 è¡Œã€12 ~ 21 è¡Œï¼Œé€™æ¨£å­å°±å¯ä»¥é”åˆ°æˆ‘å€‘æƒ³è¦çš„æ•ˆæœã€‚\nä½†é€™å€‹æ–¹æ³•æ¯”è¼ƒé©ç”¨æ–¼ upstream å¾Œç«¯æ²’æœ‰å¤ªå¤šå€‹æœå‹™æˆ–æ˜¯æ©Ÿå™¨çš„æƒ…æ³ï¼Œå¦‚æœæœ‰å¾ˆå¤šå€‹æœå‹™æˆ–æ˜¯æ©Ÿå™¨ï¼Œå°±éœ€è¦å¯«å¾ˆå¤šçš„ proxyï¼Œé€™æ¨£å­æœƒè®Šå¾—å¾ˆéº»ç…©ï¼Œæ‰€ä»¥å¦‚æœæœ‰æ›´å¥½çš„æ–¹æ³•ï¼Œä¹Ÿæ­¡è¿ç•™è¨€è·Ÿæˆ‘åˆ†äº« ğŸ¤£ã€‚\næœ€å¾Œæˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹å¯¦éš›åŸ·è¡Œçš„çµæœï¼š\nä½¿ç”¨å¤šå±¤çš„ nginx proxy è™•ç† "},"title":"æƒ³ä½¿ç”¨ Nginx Upstream Proxy åˆ°å¤–éƒ¨æœå‹™ï¼Œä¸¦å¸¶å…¥å°æ‡‰çš„ header è©²æ€éº¼åšï¼Ÿ"},"/projects/":{"data":{"":" ä½ å¥½ Porter LutheranConfessions Hextra Starter Template "},"title":"å°ˆæ¡ˆæˆå°±"}}