{"/about/":{"data":{"":"Hextra is designed to be a simple, fast, and flexible theme for building modern static websites. It is especially well-suited for documentation websites but can also be used for various types of sites, such as blogs, portfolios, and more.\nHugo, like Jekyll, is a static site generator. What sets Hugo apart is that it is a single binary, making it easy to install and run on various platforms. It is also extremely fast and reliable, capable of rendering a site with thousands of pages in milliseconds.\nHextra is built with a mindset focused on having a minimal footprint. To get started, no extra dependencies like Node.js packages are required; all you need is a single YAML configuration file, along with your Markdown content. Thus, we can focus on writing quality content instead of setting up tooling.","credits#Credits":"Hextra cannot be built without the following tools and inspirations:\nHugo Tailwind CSS Heroicons Nextra Next.js "},"title":"é—œæ–¼æˆ‘"},"/docs/":{"data":{"":"ğŸ‘‹ å°¼å¥½ï¼Œæ­¡è¿ä¾†çœ‹æˆ‘çš„","features#Features":" Beautiful Design - Inspired by Nextra, Hextra utilizes Tailwind CSS to offer a modern design that makes your site look outstanding. Responsive Layout and Dark Mode - It looks great on all devices, from mobile, tablet to desktop. Dark mode is also supported to accommodate various lighting conditions. Fast and Lightweight - Powered by Hugo, a lightning-fast static-site generator housed in a single binary file, Hextra keeps its footprint minimal. No JavaScript or Node.js are needed to use it. Full-text Search - Built-in offline full-text search powered by FlexSearch, no additional configuration required. Battery-included - Markdown, syntax highlighting, LaTeX math formulae, diagrams and Shortcodes elements to enhance your content. Table of contents, breadcrumbs, pagination, sidebar navigation and more are all automatically generated. Multi-language and SEO Ready - Multi-language sites made easy with Hugoâ€™s multilingual mode. Out-of-the-box support is included for SEO tags, Open Graph, and Twitter Cards. ","what-is-hextra#What is Hextra?":"Hextra is a modern, fast and batteries-included [Hugo][hugo] theme built with [Tailwind CSS][tailwind-css].\nDesigned for building beautiful websites for documentation, blogs, and websites, it provides out-of-the-box features and flexibility to meet various requirements."},"title":"Blog"},"/docs/kubernetes/":{"data":{"":"Explore the following sections to learn how to use Hextra:\nåœ¨æ­£å¼ç’°å¢ƒä¸Šè¸©åˆ° StatefulSet çš„é›·ï¼Œæ‹¿åˆ° P1 çš„æ•™è¨“ éƒ¨ç½² Pod é‡åˆ° container veth name provided (eth0) already exists éŒ¯èª¤ "},"title":"Kubernetes"},"/docs/kubernetes/k8s-statefulset-podmanagementpolicy/":{"data":{"":"æ­¤æ–‡ç« è¦ä¾†è¨˜éŒ„ä¸€ä¸‹å‰é™£å­åœ¨å…¬å¸çš„æ­£å¼ç’°å¢ƒè¸©åˆ° StatefulSet çš„é›·ï¼Œäº‹æƒ…æ˜¯é€™æ¨£çš„ï¼Œæˆ‘å€‘æœ‰äº›æœå‹™ï¼Œæ˜¯ä½¿ç”¨ StatefulSet ä¾†å»ºç½®ï¼Œè‡³æ–¼ç‚ºä»€éº¼ä¸ç”¨ Deploymentï¼Œé€™å€‹èªªä¾†è©±é•· (ä¹Ÿä¸æ˜¯å› ç‚ºéœ€è¦ç‰¹å®šçš„ Pod åç¨±ã€æˆ–æ˜¯ç¶²è·¯æ¨™è¨˜ç­‰ç­‰)ï¼Œæˆ‘å€‘é€™é‚Šå…ˆä¸è¨è«–ï¼Œé€™å€‹ StatefulSet æœå‹™æ˜¯ Nginx + PHP-FPMï¼Œç‚ºäº†é¿å…æµé‡é€²å…¥åˆ° processes å·²ç¶“è¢«ç”¨å…‰çš„ Pod ä¸­ï¼Œæˆ‘å€‘åœ¨ StatefulSet çš„ PHP Container ä¸Šæœ‰è¨­å®š readinessï¼Œreadiness çš„è¨­å®šé•·å¾—åƒä»¥ä¸‹ï¼š\nreadinessProbe: exec: command: - \"/bin/bash\" - \"-c\" - | CHECK_INFO=$(curl -s -w 'http code:\\t%{http_code}\\n' 127.0.0.1/status) HTTP_CODE=$(echo -e \"${CHECK_INFO}\" | awk '/http code:/ {print $3}') IDLE_PROCESSES=$(echo -e \"${CHECK_INFO}\" | awk '/idle processes:/ {print $3}') [[ $HTTP_CODE -eq 200 \u0026\u0026 $IDLE_PROCESSES -ge 10 ]] || exit 1 æˆ‘å€‘æœƒç”¨ curl ä¾†æ‰“ /statusï¼Œæª¢æŸ¥å›å‚³çš„ http code æ˜¯å¦ç‚º 200ï¼Œä»¥åŠ idle processes æ˜¯å¦å¤§æ–¼ç­‰æ–¼ 10ï¼Œå¦‚æœä¸ç¬¦åˆï¼Œå°±æœƒå›å‚³ 1ï¼Œè®“ä»–è¢«æ¨™è¨˜ä¸å¥åº·ï¼Œè®“ Kubernetes åœæ­¢æµé‡åˆ°ä¸å¥åº·çš„å®¹å™¨ï¼Œä»¥ç¢ºä¿æµé‡è¢«è·¯ç”±åˆ°å…¶ä»–å¥åº·çš„å‰¯æœ¬ã€‚","åƒè€ƒè³‡æ–™#åƒè€ƒè³‡æ–™":"Kubernetes â€” å¥åº·æª¢æŸ¥ï¼šhttps://medium.com/learn-or-die/kubernetes-%E5%81%A5%E5%BA%B7%E6%AA%A2%E6%9F%A5-59ee2a798115\nPod Management Policiesï¼šhttps://kubernetes.io/docs/concepts/workloads/controllers/statefulset/#pod-management-policies","å•é¡Œ#å•é¡Œ":"ç•¶å¤©é‡åˆ°çš„æƒ…æ³æ˜¯ï¼Œæˆ‘å€‘ä¸Šç¨‹å¼å¾Œï¼ŒPod éƒ½ä¸€åˆ‡æ­£å¸¸ï¼Œç•¶æµé‡é–‹å§‹é€²ä¾†å¾Œï¼Œç™¼ç¾ 10 å€‹ Pod æœƒé–‹å§‹å¶ç™¼çš„å™´ Readiness probe failedï¼ŒæŸ¥çœ‹ç›£æ§ç™¼ç¾ processes è¶Šä¾†è¶Šä½ï¼Œæœ€å¾Œè¢«åæ‡‰æœå‹™æœ‰å•é¡Œï¼Œæˆ‘å€‘æŸ¥çœ‹ Hpa çš„ç´€éŒ„çš„ç¢ºæœ‰è§¸ç™¼åˆ° 40 å€‹ Podï¼Œåªæ˜¯æŸ¥çœ‹ Pod æ•¸é‚„æ˜¯ä¾æ¨£å¡åœ¨ 10 å€‹ï¼Œç•¶ä¸‹æˆ‘å€‘æœ‰å˜—è©¦ä½¿ç”¨èª¿æ•´ yaml åœ¨ applyï¼Œç™¼ç¾ StatefulSet çš„ yaml ä¹Ÿå·²ç¶“æ›´æ–°äº†ï¼Œä½† Pod é‚„æ˜¯ä¸€æ¨£å¡åœ¨ 10 å€‹ï¼Œä¹Ÿæœ‰ä½¿ç”¨ kubectl ä¸‹ kubectl scale sts [æœå‹™åç¨±] --replicas=0ï¼Œæƒ³è¦åˆ‡æ› Pod æ•¸ä¹Ÿæ²’æœ‰è¾¦æ³•ã€‚\nç•¶ä¸‹æˆ‘å€‘æœ‰å…ˆ Call Google çš„ Support ä¸€èµ·æ‰¾åŸå› ï¼ŒGoogle æ˜¯å»ºè­°æˆ‘å€‘ readiness çš„æ¢ä»¶ä¸è¦è¨­çš„å¤ªåš´æ ¼ï¼Œå¯ä»¥åŠ ä¸Š timeoutSeconds: ç§’æ•¸ï¼Œä½†å°æ–¼ Pod å¡ä½ï¼Œé‚„æ˜¯æ²’æœ‰æ‰¾åˆ°åŸå› ï¼Œå¾Œä¾†æˆ‘å€‘æŸ¥äº†ä¸€ä¸‹ StatefulSet çš„æ–‡ä»¶ç™¼ç¾ï¼ŒStatefulSet æœ‰ä¸€å€‹è¨­å®š podManagementPolicyï¼Œé è¨­æ˜¯ OrderedReadyï¼Œä»–å¿…é ˆç­‰å¾…å‰é¢çš„ Pod æ˜¯ Ready ç‹€æ…‹ï¼Œæ‰æœƒå†ç¹¼çºŒå»ºç«‹æ–°çš„ï¼Œä¹Ÿå°±æ˜¯èªªæˆ‘å€‘çš„ StatefulSet å·²ç¶“å¡ä½ï¼Œå°è‡´å°±ç®— Hpa è§¸ç™¼è¦é•·åˆ° 40 å€‹ Pod ä¹Ÿæ²’æœ‰ç”¨ã€‚","æ¸¬è©¦çµæœ#æ¸¬è©¦çµæœ":"æœ€å¾Œæˆ‘å€‘å°±ä½¿ç”¨å…©ç¨®æ¨¡å¼ä¾†æ¸¬è©¦çœ‹çœ‹ï¼Œå·²ä¸‹æ˜¯æ¸¬è©¦çµæœ(é€é P1 æ‰çŸ¥é“çš„è¨­å®šï¼±ï¼±)ï¼š\næœ‰å°‡æ¸¬è©¦çš„ StatefulSet æ”¾åœ¨ Githubï¼Œå¯ä»¥é»æˆ‘æŸ¥çœ‹ (å¯ä»¥èª¿æ•´ readinessProbe çš„ httpGet.Path æ•…æ„æŠŠä»–ç”¨å£)\nä½¿ç”¨ OrderedReady æ¨¡å¼ StatefulSet åœ¨ podManagementPolicy é è¨­ OrderedReady çš„æ¨¡å¼ï¼Œæ•…æ„è®“ readiness å¡ä½æ™‚ (Pod å¡ä½æ™‚)ï¼š\nç•¶ä¸‹çš„ StatefulSet è¨­å®šï¼š StatefulSet è¨­å®š Pod ç‹€æ…‹ï¼š Pod ç‹€æ…‹ ä½¿ç”¨æŒ‡ä»¤èª¿æ•´ Pod æ•¸é‡ æˆ‘å€‘é€™æ™‚å€™ä¸‹æŒ‡ä»¤èª¿æ•´ Pod æ•¸é‡ï¼Œçœ‹çœ‹æœƒç™¼ç”Ÿä»€éº¼äº‹ï¼š\nkubectl scale sts my-statefulset --replicas=5 æˆ‘å€‘å…ˆçœ‹ StatefulSet çš„ yaml å¯ä»¥çœ‹åˆ° Pod replicas å·²ç¶“æ”¹è®Šï¼Œä¹Ÿå¯ä»¥çœ‹ generation æœ‰æ›´æ–°ï¼Œä»£è¡¨ StatefulSet æœ¬èº«æœ‰æ¥æ”¶åˆ°èª¿æ•´è¨­å®šçš„è«‹æ±‚ã€‚\nä¸‹æŒ‡ä»¤èª¿æ•´å¾Œçš„ StatefulSet è¨­å®š çœ‹äº†ä¸€ä¸‹ Pod æ•¸é‡ï¼Œä¹Ÿæ˜¯ä¸€æ¨£å¡ä½ï¼Œä¸” Pod æ•¸é‡ä¹Ÿæ²’æœ‰è®ŠåŒ–ã€‚\nä¸‹æŒ‡ä»¤èª¿æ•´å¾Œçš„ Pod ç‹€æ…‹ ä½¿ç”¨ yaml èª¿æ•´ Pod æ•¸é‡ æˆ‘å€‘ç›´æ¥èª¿æ•´ StatefulSet yaml çš„ Pod æ•¸é‡ï¼Œçœ‹çœ‹æœƒç™¼ç”Ÿä»€éº¼äº‹ï¼š\nä¸€æ¨£æˆ‘å€‘å…ˆçœ‹ StatefulSet çš„ yaml å¯ä»¥çœ‹åˆ° Pod replicas å·²ç¶“æ”¹è®Š(é€™è£¡æ‡‰è©²åˆ‡åˆ¥çš„ Pod æ•¸é‡ï¼Œåˆ‡å› 3 å€‹å¥½åƒæ²’æœ‰æ„ç¾© xD)ï¼Œä¹Ÿå¯ä»¥çœ‹ generation æœ‰æ›´æ–°ã€‚\nä½¿ç”¨ yaml èª¿æ•´å¾Œçš„ StatefulSet è¨­å®š çœ‹äº†ä¸€ä¸‹ Pod æ•¸é‡ï¼Œä¹Ÿæ˜¯ä¸€æ¨£å¡ä½ï¼Œä¸” Pod æ•¸é‡ä¹Ÿæ²’æœ‰è®ŠåŒ–ã€‚\nä½¿ç”¨ yaml èª¿æ•´å¾Œçš„ Pod ç‹€æ…‹ æ‰€ä»¥ä»£è¡¨åœ¨ OrderedReady çš„æ¨¡å¼ä¸‹ï¼ŒPod å¡ä½æ™‚ï¼Œç„¡æ³•å° Pod é€²è¡Œä»»ä½•æ“ä½œï¼Œå¿…é ˆè¦æ‰‹å‹•åˆªé™¤å¡ä½çš„ Pod æ‰åƒå¾—åˆ°æœ€æ–°çš„è¨­å®šã€‚\nä½¿ç”¨ Parallel æ¨¡å¼ StatefulSet åœ¨ podManagementPolicy Parallel çš„æ¨¡å¼ï¼Œæ•…æ„è®“ readiness å¡ä½æ™‚ (Pod å¡ä½æ™‚)ï¼š\nç•¶ä¸‹çš„ StatefulSet è¨­å®šï¼š StatefulSet è¨­å®š Pod ç‹€æ…‹ï¼š Pod ç‹€æ…‹ ä½¿ç”¨æŒ‡ä»¤èª¿æ•´ Pod æ•¸é‡ æˆ‘å€‘é€™æ™‚å€™ä¸‹æŒ‡ä»¤èª¿æ•´ Pod æ•¸é‡ï¼Œçœ‹çœ‹æœƒç™¼ç”Ÿä»€éº¼äº‹ï¼š\nkubectl scale sts my-statefulset --replicas=5 æˆ‘å€‘å…ˆçœ‹ StatefulSet çš„ yaml å¯ä»¥çœ‹åˆ° Pod replicas å·²ç¶“æ”¹è®Šï¼Œä¹Ÿå¯ä»¥çœ‹ generation æœ‰æ›´æ–°ï¼Œä»£è¡¨ StatefulSet æœ¬èº«æœ‰æ¥æ”¶åˆ°èª¿æ•´è¨­å®šçš„è«‹æ±‚ã€‚\nä¸‹æŒ‡ä»¤èª¿æ•´å¾Œçš„ StatefulSet è¨­å®š çœ‹äº†ä¸€ä¸‹ Pod æ•¸é‡ï¼Œå°±ç®— my-statefulset-2 å¡ä½ï¼Œé‚„æ˜¯å¯ä»¥æ“´åˆ° 5 å€‹ Podã€‚\nä¸‹æŒ‡ä»¤èª¿æ•´å¾Œçš„ Pod ç‹€æ…‹ ä½¿ç”¨ yaml èª¿æ•´ Pod æ•¸é‡ æˆ‘å€‘ç›´æ¥èª¿æ•´ StatefulSet yaml çš„ Pod æ•¸é‡ï¼Œçœ‹çœ‹æœƒç™¼ç”Ÿä»€éº¼äº‹ï¼š\nä¸€æ¨£æˆ‘å€‘å…ˆçœ‹ StatefulSet çš„ yaml å¯ä»¥çœ‹åˆ° Pod replicas å·²ç¶“æ”¹è®Šï¼Œä¹Ÿå¯ä»¥çœ‹ generation æœ‰æ›´æ–°ã€‚\nä½¿ç”¨ yaml èª¿æ•´å¾Œçš„ StatefulSet è¨­å®š çœ‹äº†ä¸€ä¸‹ Pod æ•¸é‡ï¼Œä¹Ÿä¸æœƒç®¡å…¶ä»– Pod æ˜¯å¦ Readyï¼Œä¸€æ¨£å¯ä»¥ç¸®å°æˆ 2 å€‹ Podã€‚\nä½¿ç”¨ yaml èª¿æ•´å¾Œçš„ Pod ç‹€æ…‹ ","çµè«–#çµè«–":"å¾Œä¾†æˆ‘å€‘é‡æ–°æª¢æŸ¥äº†ä¸€ä¸‹ç‚ºä»€éº¼ processes æœƒç”¨å®Œï¼Œçµæœç™¼ç¾æ˜¯ RD çš„ç¨‹å¼é‚è¼¯ï¼Œå°è‡´æ¯ç­† Request å¿…é ˆç­‰å¾…å‰ä¸€ç­† Request åšå®Œï¼Œæ‰æœƒé–‹å§‹å‹•ä½œï¼Œè®“ processes ä¸€ç›´è¢«å ç”¨ï¼Œæ²’è¾¦æ³•å³æ™‚æ¶ˆåŒ–ï¼Œå°è‡´ processes ç”¨å®Œï¼ŒåˆåŠ ä¸Šæœå‹™æ˜¯ä½¿ç”¨ StatefulSetï¼Œé è¨­æ¨¡å¼çš„ OrderedReadyï¼Œå¿…é ˆç­‰å¾…å‰ä¸€å€‹ Pod æ˜¯ Ready æ‰å¯ä»¥è‡ªå‹•æ“´ç¸®ï¼Œæ‰€ä»¥ç•¶æˆ‘å€‘ Hpa æƒ³è¦æ“´ç¸®ï¼Œä¾†å¢åŠ å¯ç”¨çš„ processes æ•¸é‡ï¼Œä¹Ÿå› ç‚ºæ²’è¾¦æ³•æ“´ç¸®ï¼Œæœ€å¾Œå°è‡´é€™ä¸€é€£ä¸²çš„å•é¡Œ ğŸ˜•ã€‚\nå¦å¤–ï¼Œå¦‚æœæƒ³è¦å¾ OrderedReady æ¨¡å¼åˆ‡æˆ Parallel æ¨¡å¼ (åæ­£éä¾†ä¹Ÿæ˜¯)ï¼Œå¿…é ˆå…ˆå°‡åŸæœ¬çš„ StatefulSet çµ¦åˆªé™¤ï¼Œæ‰å¯ä»¥èª¿æ•´ï¼š\nOrderedReady æ¨¡å¼åˆ‡æˆ Parallel æ¨¡å¼ ","è§£æ±ºè¾¦æ³•#è§£æ±ºè¾¦æ³•":"ç•¶ä¸‹æƒ³è¶•å¿«è§£æ±º readiness é€™å€‹å•é¡Œï¼Œèª¿æ•´ timeoutSeconds å¾Œï¼Œå–®ç´” apply æ˜¯æ²’æœ‰ç”¨çš„ï¼Œè¦è¨˜å¾—åˆªæ‰å¡ä½çš„ Podï¼Œè®“ä»–é‡æ–°å»ºç«‹ï¼Œæ‰æœƒå¥—ç”¨æ–°çš„è¨­å®š (ä½†æˆ‘å€‘ç•¶ä¸‹å¤ªåœ¨æ„ç‚ºç”šéº¼ Pod æœƒå¡ä½ï¼Œæ²’æœ‰æƒ³åˆ°è¦å…ˆæŠŠ readiness å•é¡Œä¿®æ‰ xDï¼Œæˆ‘å€‘ç•¶ä¸‹çš„è§£æ³•æ˜¯å…ˆå°‡æµé‡å°åˆ°åœ°ç«¯æ­£å¸¸çš„æœå‹™ä¸Š)ã€‚\nå¦å¤– Google ä¹Ÿèªªï¼Œå‡å¦‚æˆ‘å€‘é‚„æ˜¯å¿…é ˆä½¿ç”¨ StatefulSet ä¾†å»ºç«‹æœå‹™ï¼Œå»ºè­°æˆ‘å€‘æŠŠ podManagementPolicy æ”¹æˆ Parallelï¼Œå®ƒæœƒæœ‰é»åƒæ˜¯ Deployment çš„æ„Ÿè¦ºï¼Œä¸æœƒç­‰å¾…å…¶ä»– Pod è®Šæˆ Ready ç‹€æ…‹ï¼Œæ‰€ä»¥å¯ä»¥è®“æˆ‘å€‘å°±ç®—åœ¨ readiness å¡ä½çš„æƒ…æ³ä¸‹ï¼Œä¹Ÿå¯ä»¥è‡ªå‹•æ“´ç¸®æœå‹™ã€‚\nStatefulSet podManagementPolicy åƒæ•¸èªªæ˜\nOrderedReady (é è¨­) Pods æœƒæŒ‰ç…§é †åºä¸€å€‹æ¥ä¸€å€‹åœ°è¢«å‰µå»ºã€‚å³ï¼Œn+1 è™Ÿ Pod ä¸æœƒåœ¨ n è™Ÿ Pod æˆåŠŸå‰µå»ºä¸” Ready ä¹‹å‰é–‹å§‹å‰µå»ºã€‚ åœ¨ç¸®å° StatefulSet çš„å¤§å°æ™‚ï¼ŒPods æœƒæŒ‰ç…§åå‘é †åºä¸€å€‹æ¥ä¸€å€‹åœ°è¢«çµ‚æ­¢ã€‚å³ï¼Œn è™Ÿ Pod ä¸æœƒåœ¨ n+1 è™Ÿ Pod å®Œå…¨çµ‚æ­¢ä¹‹å‰é–‹å§‹çµ‚æ­¢ã€‚ é€™ç¢ºä¿äº† Pods çš„å•Ÿå‹•å’Œçµ‚æ­¢çš„é †åºæ€§ã€‚\nParallel æ‰€æœ‰ Pods æœƒåŒæ™‚åœ°è¢«å‰µå»ºæˆ–çµ‚æ­¢ã€‚ ç•¶ StatefulSet æ“´å±•æ™‚ï¼Œæ–°çš„ Pods æœƒç«‹å³é–‹å§‹å‰µå»ºï¼Œä¸ç”¨ç­‰å¾…å…¶ä»– Pods æˆç‚º Ready ç‹€æ…‹ã€‚ ç•¶ç¸®å° StatefulSet çš„å¤§å°æ™‚ï¼Œè¦çµ‚æ­¢çš„ Pods æœƒç«‹å³é–‹å§‹çµ‚æ­¢ï¼Œä¸ç”¨ç­‰å¾…å…¶ä»– Pods å…ˆçµ‚æ­¢ã€‚ é€™ç¨®ç­–ç•¥æä¾›äº†å¿«é€Ÿçš„æ“´å±•å’Œç¸®å°æ“ä½œï¼Œä½†ç¼ºä¹é †åºæ€§ä¿è­‰ã€‚"},"title":"æ­£å¼ç’°å¢ƒä¸Šè¸©åˆ° StatefulSet çš„é›·ï¼Œæ‹¿åˆ° P1 çš„æ•™è¨“"},"/docs/kubernetes/pod-veth-name-provided-eth0-already-exists/":{"data":{"":"æ­¤æ–‡ç« è¦ä¾†è¨˜éŒ„ä¸€ä¸‹å…¬å¸åŒäº‹åœ¨æ­£å¼æœå‹™ä¸Šé‡åˆ°çš„å•é¡Œï¼Œæœƒè©³ç´°èªªæ˜é‡åˆ°äº‹æƒ…çš„ç¶“éï¼Œä»¥åŠé–‹å–®è©¢å• google support æœ€å¾Œè¨è«–å‡ºçš„æš«æ™‚è§£æ±ºçš„è¾¦æ³•ï¼š\nç°¡å–®åˆ—å‡ºæ­£å¼ç«™ç•¶ä¸‹æœå‹™ç’°å¢ƒï¼š\ngke master versionï¼š1.25.10-gke.2700 gke node versionï¼š1.25.8-gke.1000 è©²å•é¡Œç™¼ç”Ÿçš„ node pool æœ‰è¨­å®š taint ç™¼ç”Ÿå•é¡Œçš„ Pod æ˜¯ç”¨ Statefulset å»ºç«‹çš„æœå‹™ ","äº‹æƒ…ç™¼ç”Ÿçš„ç¶“é#äº‹æƒ…ç™¼ç”Ÿçš„ç¶“é":" RD åŒä»åæ‡‰ï¼Œç™¼ç¾ä½¿ç”¨ Statefulset å»ºç«‹çš„æ’ç¨‹æœå‹™æœ‰å•é¡Œï¼Œä¸‹ kubectl delete æŒ‡ä»¤æƒ³è¦åˆªé™¤ Podï¼Œè®“ Pod é‡æ–°é•·ï¼Œå»å¡åœ¨ Terminatingï¼Œç­‰å¾…ä¸€æ®µæ™‚é–“å¾Œï¼Œæ±ºå®šä¸‹ kubectl delete --force --grace-period=0 ä¾†å¼·åˆ¶åˆªé™¤ Podï¼Œé€™æ™‚å€™ç‹€æ…‹æœƒå¡åœ¨ ContainerCreatingï¼Œä½¿ç”¨ Describe æŸ¥çœ‹ï¼Œæœƒå‡ºç¾ä»¥ä¸‹éŒ¯èª¤ï¼š Warning (combined from similar events): Failed to create pod sandbox: rpo error: code = Unknown desc = failed to setup network for sandbox \"14fe0cd3d688aed4ffed4c36ffab1a145230449881bcbe4cac6478a63412b0c*: plugin type=*gke\" failed (add): container veth name provided (etho) already exists æˆ‘å€‘ SRE å”åŠ©æŸ¥çœ‹å¾Œï¼Œä¹Ÿæœ‰å˜—è©¦å»ä¸‹ kubectl delete --force --grace-period=0 ä¾†åˆªé™¤ Podï¼Œä½†é‚„æ˜¯ä¸€æ¨£å¡åœ¨ ContainerCreatingï¼Œæœ€å¾Œæ˜¯å…ˆé–‹ä¸€å€‹æ–°çš„ Node ä¸¦è®“è©² Pod å»ºç«‹åˆ°æ–°çš„ Node ä¸Šï¼Œæ‰è§£æ±ºå•é¡Œã€‚ç‚ºäº†æ–¹ä¾¿ google support å”åŠ©æª¢æŸ¥å‡ºå•é¡Œçš„ Nodeï¼Œå…ˆå°‡ Node è¨­å®šæˆ cordonï¼Œé¿å…å…¶ä»– Pod è¢«èª¿åº¦åˆ°è©²å•é¡Œ node ä¸Šã€‚ Node è¨­å®šæˆ cordon\nNode å¯ä»¥è¨­å®š cordonã€drain å’Œ delete ä¸‰å€‹æŒ‡å®šéƒ½æœƒä½¿ Node åœæ­¢è¢«èª¿åº¦ï¼Œåªæ˜¯æ¯å€‹çš„æ“ä½œæš´åŠ›ç¨‹åº¦ä¸åŒï¼š\ncordonï¼šå½±éŸ¿æœ€å°ï¼Œåªæœƒå°‡ Node æ¨™ç¤ºç‚º SchedulingDisabled ä¸å¯èª¿åº¦ç‹€æ…‹ï¼Œä½†ä¸æœƒå½±éŸ¿åˆ°å·²ç¶“åœ¨è©² Node ä¸Šçš„ Podï¼Œä½¿ç”¨ kubectl cordon [node name] ä¾†åœæ­¢èª¿åº¦ï¼Œä½¿ç”¨ kubectl uncordon [node name] ä¾†æ¢å¾©èª¿åº¦ã€‚\ndrainï¼šæœƒå…ˆé©…é€åœ¨ Node ä¸Šçš„ Podï¼Œå†å°‡ Node æ¨™ç¤ºç‚º SchedulingDisabled ä¸å¯èª¿åº¦ç‹€æ…‹ï¼Œä½¿ç”¨ kubectl drain [node name] --ignore-daemonsets --delete-local-data ä¾†åœæ­¢èª¿åº¦ï¼Œä½¿ç”¨ kubectl uncordon [node name] ä¾†æ¢å¾©èª¿åº¦ã€‚\ndeleteï¼šæœƒå…ˆé©…é€ Node ä¸Šçš„ Podï¼Œå†åˆªé™¤ Node ç¯€é»ï¼Œå®ƒæ˜¯ä¸€ç¨®æš´åŠ›åˆªé™¤ Node çš„ä½œæ³•ï¼Œåœ¨é©…é€ Pod æ™‚ï¼Œæœƒå¼·åˆ¶ Kill å®¹å™¨é€²ç¨‹ï¼Œæ²’è¾¦æ³•å„ªé›…çš„çµ‚æ­¢ Podã€‚\næˆ‘å€‘éš¨å¾Œé–‹å–®è©¢å• goolge supportã€‚ ","åƒè€ƒ#åƒè€ƒ":"Node ç¯€é»ç¦æ­¢èª¿åº¦ï¼ˆå¹³æ»‘ç¶­è­·ï¼‰æ–¹å¼- cordonï¼Œdrainï¼Œdeleteï¼šhttps://www.cnblogs.com/kevingrace/p/14412254.html","èˆ‡-google-support-è¨è«–å…§å®¹#èˆ‡ Google Support è¨è«–å…§å®¹":"Google Support ç¶“éæŸ¥è©¢å¾Œï¼Œå›è¦†èªªï¼šé€™å€‹å•é¡Œæ˜¯å› ç‚º Pod è¢«å¼·åˆ¶åˆªé™¤å°è‡´ï¼Œå¼·åˆ¶åˆªé™¤æ˜¯ä¸€ç¨®å±éšªçš„æ“ä½œï¼Œä¸å»ºè­°é€™æ¨£è™•ç†ï¼Œä¸‹é¢æœ‰è©³ç´°è¨è«–ã€‚\nä¸€é–‹å§‹å¡åœ¨ Terminating ç‹€æ…‹ï¼Œæˆ‘å€‘ä¹Ÿæœ‰è«‹ RD èªªæ˜ä¸€ä¸‹ç•¶ä¸‹é‡åˆ°çš„å•é¡Œä»¥åŠè™•ç†å‹•ä½œï¼šRD ç•¶æ™‚æƒ³è¦åˆªé™¤ Pod æ˜¯å› ç‚ºè©²ç¨‹å¼ç•¶ä¸‹æœ‰ Bugï¼Œå°‡ redis èˆ‡ db é€£ç·šçµ¦é—œé–‰ï¼Œç¨‹å¼æ‰¾ä¸åˆ°å°±æœƒä¸€ç›´ retryï¼Œå°è‡´ç›¸é—œé€²ç¨‹ç„¡æ³•çµæŸï¼Œå†åŠ ä¸Š terminationGracePeriodSeconds æˆ‘å€‘è¨­å®š 14400ï¼Œä¹Ÿå°±æ˜¯ 4 å°æ™‚ï¼Œæ‰æœƒå¡åœ¨ Terminating ç‹€æ…‹ã€‚ (terminationGracePeriodSeconds è¨­å®šé€™éº¼ä¹…æ˜¯å¸Œæœ›å¦‚æœæœ‰è¢« on callï¼Œå·¥ç¨‹å¸«ä¸Šä¾†æ™‚ï¼Œå¯ä»¥æŸ¥çœ‹è©² Pod çš„éŒ¯èª¤åŸå› )\nå› ç‚ºå¡åœ¨ Terminating å¤ªä¹…ï¼ŒRD æœ‰åŸ·è¡Œ kubectl delete --forceï¼Œå°±æ˜¯å› ç‚ºä¸‹äº† --force æ‰é€ æˆç›¸é—œè³‡æºå•é¡Œ (ä¾‹å¦‚ container proccess, sandbox, ä»¥åŠç¶²è·¯è³‡æº)æ²’æœ‰åˆªä¹¾æ·¨ã€‚æ‰€ä»¥å¼•èµ·äº†æ­¤æ¬¡çš„å ±éŒ¯ â€œcontainer veth name provided (eth0) already existsâ€ã€‚ (å› ç‚ºæˆ‘å€‘æœå‹™ä½¿ç”¨ Statefulsetï¼ŒPod åç¨±ç›¸åŒï¼Œå°è‡´ eth0 é€™å€‹ç¶²è·¯è³‡æºåç¨±é‡è¤‡ï¼Œæ‰€ä»¥é€ æˆéŒ¯èª¤ï¼Œå¯ä»¥ç”¨ deployment ä¾†æ”¹å–„é€™å€‹å•é¡Œï¼Œåªæ˜¯è³‡æºå¦‚æœæ²’æœ‰æ¸…ç†ä¹¾æ·¨æœƒä½”ç”¨ IPï¼Œæ‰€ä»¥å–®ç´”èª¿æ•´æˆ deployment ä¹Ÿä¸æ˜¯æœ€ä½³è§£)\nGoogle ç”¢å“åœ˜éšŠå»ºè­°ï¼Œå¦‚æœ Pod è™•æ–¼ Running ç‹€æ…‹æ™‚ï¼Œæƒ³è¦å¿«é€Ÿåˆªé™¤ Pod æ™‚ï¼Œä¸€é–‹å§‹å°±å…ˆä½¿ç”¨ kubectl delete pod --grace-period=number[ç§’æ•¸] ä¾†åˆªé™¤ï¼Œå¦‚æœå·²ç¶“æ˜¯ Terminating ç‹€æ…‹å‰‡ç„¡æ•ˆã€‚(SRE åŒä»å·²æ¸¬è©¦éï¼Œèˆ‡ Google Support èªªæ˜ç›¸åŒ)\né‚£å¦‚æœå·²ç¶“è™•æ–¼ Terminating ç‹€æ…‹ï¼Œè¦æ€éº½è®“ Pod è¢«é †åˆ©åˆªé™¤ï¼Œé€™éƒ¨åˆ† Google Support å¾ŒçºŒæœƒåœ¨æ¸¬è©¦ä¸¦çµ¦å‡ºå»ºè­°ï¼Œç›®å‰æ¸¬è©¦æ˜¯ï¼šé€²å»å¡ä½çš„ Pod Containerï¼Œæ‰‹å‹•åˆªé™¤ä¸»é€²ç¨‹ (pkill) å°±å¯ä»¥äº†ã€‚\nGoogle Support å›è¦† "},"title":"éƒ¨ç½² Pod é‡åˆ° container veth name provided (eth0) already exists éŒ¯èª¤"},"/docs/nginx/":{"data":{"":"Explore the following sections to learn how to use Hextra:\næƒ³ä½¿ç”¨ Nginx Upstream Proxy åˆ°å¤–éƒ¨æœå‹™ï¼Œä¸¦å¸¶å…¥å°æ‡‰çš„ header è©²æ€éº¼åšï¼Ÿ Soketi WebSocket Server LOG ä¸å®šæ™‚å‡ºç¾ 502 error ä»¥åŠ connect() failed (111: Connection refused) "},"title":"Nginx"},"/docs/nginx/nginx-upstream-set-host-header/":{"data":{"":"æ­¤æ–‡ç« è¦ä¾†è¨˜éŒ„ä¸€ä¸‹æœ€è¿‘åœ¨å…¬å¸æœå‹™å…¥å£é‡åˆ°çš„ä¸€äº›å°å•é¡Œï¼Œä»¥åŠè§£æ±ºçš„æ–¹æ³•ã€‚ç°¡å–®èªªæ˜ä¸€ä¸‹ï¼Œæˆ‘å€‘çš„æœå‹™å…¥å£æ˜¯ç”¨ Nginx ä¾†ç•¶ä½œ proxy serverï¼Œå°‡ä¸åŒè·¯å¾‘æˆ–æ˜¯ servername å°åˆ°å°æ‡‰çš„å¾Œç«¯ç¨‹å¼ï¼Œæˆ–æ˜¯å¤–éƒ¨çš„æœå‹™ä¸Š(ä¾‹å¦‚ AWS cloudfront.net)ï¼Œæœ¬ç¯‡è¦æ¸¬è©¦çš„æ˜¯å¦‚æœä½¿ç”¨è¦åŒæ™‚ä½¿ç”¨ upstream åˆ°å¤–éƒ¨æœå‹™ï¼Œä¸”éœ€è¦å¸¶ host header è©²æ€éº¼åšã€‚\nNginx çš„ upstream æ˜¯ä»€éº¼ï¼Ÿ\né€šå¸¸æˆ‘å€‘ proxy_pass çš„å¯«æ³•æœƒæ˜¯é€™æ¨£ï¼š\nlocation /aaa { proxy_pass http://aaa.example.com; } ç•¶ Nginx æ”¶åˆ°çš„ request æ˜¯ /aaa æ™‚ï¼Œå°±æœƒå°‡ request è½‰ç™¼åˆ° http://aaa.example.comã€‚\nä½†å‡å¦‚å¾Œç«¯æœ‰å¤šå°æ©Ÿå™¨æˆ–æ˜¯æœå‹™ï¼Œå¯ä»¥è™•ç†åŒä¸€ç¨® requestï¼Œé€™æ™‚å€™å°±å¯ä»¥ä½¿ç”¨ upstream ä¾†è™•ç†ï¼š\nupstream backend_hosts { server aaa.example.com; server bbb.example.com; server ccc.example.com; } location /aaa { proxy_pass http://backend_hosts; } é€™æ¨£å­çš„å¥½è™•æ˜¯å¯ä»¥æœ‰å¤šå€‹æ©Ÿå™¨æˆ–æ˜¯å¾Œç«¯æœå‹™å¯ä»¥åˆ†æ•£è«‹æ±‚ï¼Œåšåˆ°è² è¼‰å¹³è¡¡çš„æ•ˆæœã€‚","åƒè€ƒ#åƒè€ƒ":"Make nginx to pass hostname of the upstream when reverseproxyingï¼šhttps://serverfault.com/questions/598202/make-nginx-to-pass-hostname-of-the-upstream-when-reverseproxying","å•é¡Œ#å•é¡Œ":"é‚£å¦‚æœæˆ‘å€‘ä½¿ç”¨ Nginx upstream æ™‚ï¼Œé‚„æƒ³è¦åŒæ™‚å¸¶ host çš„ header åˆ°å¾Œç«¯è©²æ€éº¼åšå‘¢ï¼Ÿæˆ‘å€‘å…ˆä¾†çœ‹ä¸€ä¸‹ç›®å‰çš„å¯«æ³•ï¼š\n( æ¸¬è©¦ç¯„ä¾‹æ˜¯ä½¿ç”¨ docker ä¾†æ¨¡æ“¬ï¼Œå¯ä»¥åƒè€ƒç¨‹å¼ç¢¼ \u003e é»æˆ‘å‰å¾€ githubï¼Œæœƒæœ‰ä¸‰å€‹ nginxï¼Œå…¶ä¸­ä¸€å€‹æ˜¯è² è²¬ proxy çš„ nginx åç‚º proxyï¼Œå¦å¤–å…©å°æ˜¯ upstream å¾Œçš„æœå‹™ï¼Œåç‚º upstream_server1ã€upstream_server2 )\nnginx-old.conf upstream upstream_server { server upstream_server1; server upstream_server2; } server { listen 80; server_name localhost; location /upstream_server/ { proxy_pass http://upstream_server; proxy_set_header Host \"upstream_server1\"; proxy_set_header Host \"upstream_server2\"; access_log /var/log/nginx/access.log upstream_log; } } } å¯ä»¥çœ‹åˆ°æˆ‘å€‘å¸Œæœ› Nginx æ”¶åˆ° request æ˜¯ /upstream_server æ™‚ï¼Œå°‡ request è½‰ç™¼åˆ° http://upstream_serverï¼Œè€Œ upstream_server å¾Œé¢æœ‰å…©å€‹ serverï¼Œä¸¦ä¸”åœ¨ proxy æ™‚ï¼Œå¸¶å…¥å…©å€‹ä¸åŒçš„ host headerã€‚ä½†å¦‚æœçœŸçš„é€™æ¨£å¯«ï¼Œå¯ä»¥é”åˆ°æˆ‘å€‘æƒ³è¦å¾—æ•ˆæœå—ï¼Ÿæˆ‘å€‘å¯¦éš›è·‘çœ‹çœ‹ç¨‹å¼ (ç¯„ä¾‹å¯ä»¥ä½¿ç”¨ nginx-old.conf)ï¼š\nnginx åŸæœ¬å¯«æ³• å¾ä¸Šé¢çš„ LOG å¯ä»¥ç™¼ç¾ï¼Œæˆ‘å€‘ call /upstream_server æ™‚ï¼Œå¾Œç«¯çš„ upstream_server1ã€upstream_server2 æ”¶åˆ°çš„ host åªæœƒæ”¶åˆ°ç¬¬ä¸€å€‹è¨­å®šçš„ Hostï¼Œä¸”æœå‹™æœƒå‡ºç¾ 400 Bad Requestï¼ŒæŸ¥äº†ä¸€ä¸‹ç¶²è·¯æ–‡ç« ï¼Œç™¼ç¾å‡ºç¾ 400 Bad Requestï¼Œå¯èƒ½è·Ÿ header é€å¤ªå¤šè³‡è¨Šéå»ï¼Œè©³ç´°å¯ä»¥åƒè€ƒ è§£æ±ºç¶²ç«™å‡ºç¾ 400 Bad Request ç‹€æ…‹çš„æ–¹æ³•ã€‚\né€™é‚Šæ¨æ¸¬æ‡‰è©²æ˜¯å¾Œç«¯å¦‚æœä¹Ÿæ˜¯ç”¨ nginx ç›´æ¥æ¥æ”¶æ‰æœƒé‡åˆ° 400 çš„å•é¡Œï¼Œé‚„å¥½ç›®å‰å…¬å¸æœå‹™é‚„æ˜¯æ­£å¸¸çš„ xDDï¼Œæª¢æŸ¥ä¸€ä¸‹å¾Œç™¼ç¾ï¼Œå…¶å¯¦å¾Œç«¯æ ¹æœ¬æ²’æœ‰è¦æ±‚å°æ‡‰ header æ‰èƒ½æ¥æ”¶(æ‡‰è©²æ˜¯å°æ–¹å¿˜è¨˜åŠ ä¸Šæ­¤é™åˆ¶)ã€‚","è§£æ±º#è§£æ±º":"å¥½ï¼Œä¸ç®¡æ˜¯å¦éœ€è¦å°æ‡‰ headerï¼Œæˆ‘å€‘é‚„æ˜¯æ‰¾çœ‹çœ‹æœ‰æ²’æœ‰è¾¦æ³•åŒæ™‚ä½¿ç”¨ upstreamï¼Œä¸¦å¸¶å…¥å°æ‡‰ host çš„æ–¹æ³•å‘¢ï¼Ÿ\næœ€å¾Œåƒè€ƒç¶²è·¯ä¸Šçš„æ–‡ç« ï¼Œä¼¼ä¹åªèƒ½ä½¿ç”¨å…©å±¤çš„ proxyï¼Œæ‰èƒ½å®Œæˆé€™å…©å€‹éœ€æ±‚ï¼Œæˆ‘å€‘ä¾†çœ‹çœ‹è¦æ€éº¼å¯«å§ (ç¯„ä¾‹å¯ä»¥ä½¿ç”¨ nginx.conf)ï¼š\nnginx.conf server { listen 777; server_name localhost; location / { proxy_pass http://upstream_server1; proxy_set_header Host \"upstream_server1\"; access_log /var/log/nginx/access.log upstream_log; } } server { listen 888; server_name localhost; location / { proxy_pass http://upstream_server2; proxy_set_header Host \"upstream_server2\"; access_log /var/log/nginx/access.log upstream_log; } } upstream upstream_server { server 127.0.0.1:777; server 127.0.0.1:888; } server { listen 80; server_name localhost; location /upstream_server/ { proxy_pass http://upstream_server; access_log /var/log/nginx/access.log upstream_log; } } å¯ä»¥çœ‹åˆ°ä¸Šé¢çš„ç¨‹å¼ç¢¼ï¼Œæˆ‘å€‘é€éå…©å±¤çš„ proxyï¼Œä¾†é”åˆ°æˆ‘å€‘æƒ³è¦çš„æ•ˆæœï¼Œé€™æ¨£å­å°±å¯ä»¥åŒæ™‚ä½¿ç”¨ upstreamï¼Œä¸¦ä¸”å¸¶å…¥å°æ‡‰çš„ host headerã€‚\né¦–å…ˆåœ¨ 28 ~ 36 è¡Œï¼Œæˆ‘å€‘ä¸€æ¨£å¦‚æœ Nginx æ”¶åˆ° request æ˜¯ /upstream_server æ™‚ï¼Œæœƒ proxy åˆ° upstream_server é€™å€‹ upstream ä¸­ï¼Œè€Œ upstream_server æœ‰å…©å€‹ serverï¼Œåˆ†åˆ¥æ˜¯ 127.0.0.1:777ã€127.0.0.1:888ï¼Œä½†å¯¦éš›ä¸Šæ²’æœ‰é€™å…©å€‹ portï¼Œæ‰€ä»¥æˆ‘å€‘éœ€è¦å†å¯«ä¸€å±¤ä¸€èˆ¬çš„ proxy è¨­å®šï¼Œåˆ†åˆ¥æ˜¯ 1 ~ 10 è¡Œã€12 ~ 21 è¡Œï¼Œé€™æ¨£å­å°±å¯ä»¥é”åˆ°æˆ‘å€‘æƒ³è¦çš„æ•ˆæœã€‚\nä½†é€™å€‹æ–¹æ³•æ¯”è¼ƒé©ç”¨æ–¼ upstream å¾Œç«¯æ²’æœ‰å¤ªå¤šå€‹æœå‹™æˆ–æ˜¯æ©Ÿå™¨çš„æƒ…æ³ï¼Œå¦‚æœæœ‰å¾ˆå¤šå€‹æœå‹™æˆ–æ˜¯æ©Ÿå™¨ï¼Œå°±éœ€è¦å¯«å¾ˆå¤šçš„ proxyï¼Œé€™æ¨£å­æœƒè®Šå¾—å¾ˆéº»ç…©ï¼Œæ‰€ä»¥å¦‚æœæœ‰æ›´å¥½çš„æ–¹æ³•ï¼Œä¹Ÿæ­¡è¿ç•™è¨€è·Ÿæˆ‘åˆ†äº« ğŸ¤£ã€‚\næœ€å¾Œæˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹å¯¦éš›åŸ·è¡Œçš„çµæœï¼š\nä½¿ç”¨å¤šå±¤çš„ nginx proxy è™•ç† "},"title":"æƒ³ä½¿ç”¨ Nginx Upstream Proxy åˆ°å¤–éƒ¨æœå‹™ï¼Œä¸¦å¸¶å…¥å°æ‡‰çš„ header è©²æ€éº¼åšï¼Ÿ"},"/docs/nginx/soketi-log-502-error/":{"data":{"":"æ­¤æ–‡ç« è¦ä¾†è¨˜éŒ„ä¸€ä¸‹ RD åŒä»å‰é™£å­æœ‰åæ‡‰ä½¿ç”¨ Soketi é€™å€‹ WebSocket Server æœƒä¸å®šæ™‚åœ¨ LOG å‡ºç¾ 502 error éŒ¯èª¤è¨Šæ¯ä»¥åŠ connect() failed (111: Connection refused) while connecting to upstreamï¼Œé›–ç„¶èªªæœå‹™ä½¿ç”¨ä¸Šä¸æœƒå½±éŸ¿å¾ˆå¤§ï¼Œä½†é‚„æ˜¯å¸Œæœ›æˆ‘å€‘å¯ä»¥å”åŠ©æ‰¾å‡º 502 çš„åŸå› ã€‚\nå‡ºéŒ¯çš„ LOG åœ¨é–‹å§‹æ‰¾å•é¡Œå‰ï¼Œå…ˆç°¡å–®ä»‹ç´¹ä¸€ä¸‹ Soketi æ˜¯ä»€éº¼æ±è¥¿å¥½äº†ï¼Œæ ¹æ“šå®˜ç¶²çš„èªªæ˜ï¼Œä»–æ˜¯ç°¡å–®ã€å¿«é€Ÿä¸”æœ‰å½ˆæ€§çš„é–‹æº WebSockets serverï¼Œæƒ³è¦äº†è§£æ›´å¤šçš„å¯ä»¥åˆ°å®ƒå®˜ç¶²å»æŸ¥çœ‹ã€‚\nå¦å¤–æœƒæŠŠç¨‹å¼ç¢¼ç›¸é—œæ”¾åˆ° GitHub Â» é»æˆ‘å‰å¾€","åƒè€ƒ#åƒè€ƒ":"[Nginx] è§£æ±º connect() failed (111: Connection refused) while connecting to upstreamï¼šhttps://wshs0713.github.io/posts/8c1276a7/\nWebSocket proxyingï¼šhttp://nginx.org/en/docs/http/websocket.html\nday 10 Pod(3)-ç”Ÿå‘½é€±æœŸ, å®¹å™¨æ¢æ¸¬ï¼šhttps://ithelp.ithome.com.tw/articles/10236314","å£“æ¸¬#å£“æ¸¬":"æœ€å¾Œèª¿æ•´å®Œï¼Œæˆ‘å€‘ä¾†æ¸¬è©¦çœ‹çœ‹æ˜¯å¦åœ¨ Pod è‡ªå‹•é‡å•Ÿ or æ›´æ–° Deployment çš„æ™‚å€™(ä¸¦ä¸”æœ‰å¤§é‡é€£ç·šæ™‚)é‚„æœƒå™´ 502 error æˆ–æ˜¯ connect() failed (111: Connection refused)ï¼Œæˆ‘å€‘é€™é‚Šä½¿ç”¨ k6 ä¾†åš websocket æœå‹™çš„å£“æ¸¬ï¼Œæœ‰ç°¡å–®å¯«ä¸€å€‹å£“æ¸¬ç¨‹å¼å¦‚ä¸‹ï¼š\nk6 å£“æ¸¬\nk6 æ˜¯ä¸€å€‹é–‹æºçš„å£“æ¸¬å·¥å…·ï¼Œå¯ä»¥ç”¨ä¾†æ¸¬è©¦ APIã€WebSocketã€gRPC ç­‰æœå‹™ï¼Œå¯ä»¥åˆ°å®ƒçš„å®˜ç¶²æŸ¥çœ‹æ›´å¤šè³‡è¨Šã€‚\nMacOS å®‰è£æ–¹å¼ï¼šbrew install k6\nwebsocket.jsimport ws from \"k6/ws\"; import { check } from \"k6\"; export const options = { vus: 1000, duration: \"30s\", }; export default function () { const url = \"wss://socket.XXX.com/app/hex-ws?protocol=7\u0026client=js\u0026version=7.4.1\u0026flash=false\"; const res = ws.connect(url, function (socket) { socket.on(\"open\", () =\u003e console.log(\"connected\")); socket.on(\"message\", (data) =\u003e console.log(\"Message received: \", data)); socket.on(\"close\", () =\u003e console.log(\"disconnected\")); }); check(res, { \"status is 101\": (r) =\u003e r \u0026\u0026 r.status === 101 }); } ç°¡å–®èªªæ˜ä¸€ä¸‹ä¸Šé¢ç¨‹å¼åœ¨å¯«ä»€éº¼ï¼Œæˆ‘å€‘åœ¨ const è¨­å®š vus ä»£è¡¨æœ‰ 1000 å€‹è™›æ“¬ä½¿ç”¨è€…ï¼Œæœƒåœ¨ duration 30s å…§å®Œæˆæ¸¬è©¦ï¼Œä¸‹é¢çš„ default å°±æ˜¯æ¸¬è©¦é€£ç·š ws ä»¥åŠ message è·Ÿ close ç­‰å‹•ä½œï¼Œæœ€å¾Œéœ€è¦å›å‚³ 101 (ws äº¤æ¡)\nåŸ·è¡Œ k6 run websocket.js å¾Œï¼Œå°±æœƒé–‹å§‹å£“æ¸¬ï¼Œå¯ä»¥çœ‹åˆ°æœƒé–‹å§‹åŸ·è¡Œå‰›å‰›åœ¨ä¸Šé¢æåˆ° default çš„å‹•ä½œï¼š\nk6 å£“æ¸¬éç¨‹ ç­‰åˆ°è·‘å®Œï¼Œå°±æœƒå‘Šè¨´ä½  1000 ç­†è£¡é¢æœ‰å¤šå°‘çš„ http 101ï¼Œé€™é‚Šé¡¯ç¤º status is 101ï¼Œå°±ä»£è¡¨éƒ½æ˜¯ 101ï¼Œä»£è¡¨éƒ½æœ‰é€£ç·šæˆåŠŸï¼Œæ²’æœ‰å‡ºç¾ 502 error æˆ–æ˜¯ connect() failed (111: Connection refused) çš„éŒ¯èª¤ï¼Œé€™æ¨£å°±ä»£è¡¨æˆ‘å€‘çš„å•é¡Œè§£æ±ºäº†ã€‚\nk6 å£“æ¸¬çµæœ ","è§£æ±ºéç¨‹#è§£æ±ºéç¨‹":"æˆ‘å€‘å¯ä»¥çœ‹åˆ°ä¸Šæ–¹éŒ¯èª¤ LOG ä¸­ï¼Œç™¼ç¾æœ‰å‡ºç¾ 502 error ä»¥åŠ connect() failed (111: Connection refused) while connecting to upstreamï¼Œé€™å…©å€‹éŒ¯èª¤éƒ½æ˜¯ç”± Nginx æ‰€ç”¢ç”Ÿçš„ï¼Œé‚£æˆ‘å€‘å…ˆä¾†ç†è§£ä¸€ä¸‹ï¼ŒNginx èˆ‡ Soketi ä¹‹é–“çš„é—œä¿‚ã€‚\nåœ¨ä½¿ç”¨ä¸Šï¼ŒRD çš„ç¨‹å¼æœƒæ‰“ Soketi å°ˆç”¨çš„ Subdomain ä¾†ä½¿ç”¨é€™å€‹ WebSocket æœå‹™ï¼Œè€Œåœ¨æˆ‘å€‘çš„æ¶æ§‹ä¸Šï¼Œé€™å€‹ Subdomain æœƒç¶“éç”¨ nginx proxy serverï¼Œä¾†è½‰ç™¼åˆ° Soketi WebSocket Server (èµ° k8s svc)ï¼Œè¨­å®šæª”å¦‚ä¸‹åœ–ï¼š\nå…¥å£ nginx è¨­å®š ç„¶å¾Œæœƒå‡ºç¾ connect() failed (111: Connection refused) while connecting to upstream çš„éŒ¯èª¤è¨Šæ¯ï¼Œä»£è¡¨æˆ‘å€‘çš„ Nginx è¨­å®šå°‘äº†ä¸€å€‹é‡è¦çš„ä¸€è¡Œè¨­å®šï¼Œå°±æ˜¯ proxy_http_version 1.1;ï¼Œé€™å€‹è¨­å®šè¦è®“ Nginx ä½œç‚º proxy å¯ä»¥å’Œ upstream çš„å¾Œç«¯æœå‹™ä¹Ÿæ˜¯ç”¨ keepaliveï¼Œå¿…é ˆä½¿ç”¨ http 1.1ï¼Œä½†å¦‚æœæ²’æœ‰è¨­å®šé è¨­æ˜¯ 1.0ï¼Œä¹Ÿè¦è¨˜å¾—è¨­å®š proxy_set_header Upgradeã€proxy_set_header Connectionã€‚èª¿æ•´éå¾Œå°±è®Šæˆï¼š\nws.confserver { server_name socket.XXX.com; listen 80 ; listen [::]:80 ; listen 443 ssl; listen [::]:443 ssl; ssl_certificate /etc/nginx/ingress.gcp.cert; ssl_certificate_key /etc/nginx/ingress.gcp.key; access_log /var/log/nginx/access.log main; location / { proxy_pass http://soketi-ws-ci:6001; proxy_connect_timeout 10s; proxy_read_timeout 1800s; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \"Upgrade\"; proxy_set_header X-Real-IP $remote_addr; } } è§£æ±ºå®Œ connect() failed (111: Connection refused) é€™å€‹å•é¡Œå¾Œï¼Œæ¥ä¸‹ä¾†å°±æ˜¯è¦è§£æ±º 502 error é€™å€‹å•é¡Œï¼Œæœƒå°è‡´ 502 ä»£è¡¨ Nginx é€™å€‹ proxy server é€£ä¸ä¸Šå¾Œç«¯çš„ Soketi WebSocket Serverï¼Œå†è§€å¯Ÿ LOG ä»¥åŠæ¸¬è©¦å¾Œç™¼ç¾ï¼Œç•¶ Pod è‡ªå‹•é‡å•Ÿï¼Œæˆ–æ˜¯æ‰‹å‹•é‡å•Ÿ Deployment çš„æ™‚å€™ï¼Œå°±æœƒæœ‰ 502 çš„éŒ¯èª¤ï¼Œä»£è¡¨ Nginx åœ¨ proxy åˆ°å¾Œé¢çš„ Soketi svc å†åˆ° Pod çš„æ™‚å€™ï¼Œæœ‰ä¸€æ®µæ™‚é–“æ˜¯é€£ä¸ä¸Šçš„ï¼Œæ‰€ä»¥å°±æœƒå‡ºç¾ 502 çš„éŒ¯èª¤ï¼Œå¯ä»¥æ¨æ¸¬æ˜¯æµé‡é€²åˆ°æ­£åœ¨é—œé–‰çš„ Pod æˆ–æ˜¯é€²åˆ°é‚„æ²’æœ‰å•Ÿå‹•å¥½çš„ Pod æ‰å°è‡´çš„ã€‚\né‚£æˆ‘å€‘å…ˆä¾†çœ‹ä¸€ä¸‹ Soketi WebSocket Server çš„æœå‹™ yaml æª”æ¡ˆï¼š\ndeployment.yaml deployment.yaml spec: terminationGracePeriodSeconds: 30 securityContext: {} containers: - name: soketi securityContext: {} image: \"quay.io/soketi/soketi::1.6.0-16-alpine\" ... çœç•¥ (å¯ä»¥åˆ° github çœ‹ code)... livenessProbe: failureThreshold: 3 httpGet: httpHeaders: - name: X-Kube-Healthcheck value: \"Yes\" path: / port: 6001 initialDelaySeconds: 5 periodSeconds: 2 successThreshold: 1 å¯ä»¥çœ‹åˆ°åŸä¾†çš„è¨­å®šåªæœ‰ livenessProbe è€Œå·²ï¼Œå› æ­¤æˆ‘å€‘ç‚ºäº†è¦é¿å…æµé‡é€²åˆ°æ­£åœ¨é—œé–‰çš„ Pod æˆ–æ˜¯é€²åˆ°é‚„æ²’æœ‰å•Ÿå‹•å¥½çš„ Podï¼Œæ‰€ä»¥æˆ‘å€‘éœ€è¦åŠ ä¸Š readinessProbe ä»¥åŠ preStopï¼Œè®“ Pod ç¢ºå®šå•Ÿå‹•å®Œç•¢ï¼Œæˆ–æ˜¯ç­‰å¾… Service çš„ endpoint list ä¸­ç§»é™¤ Podï¼Œæ‰é–‹å§‹æ¥æ”¶æµé‡ï¼Œé€™æ¨£å°±å¯ä»¥é¿å…å‡ºç¾ 502 çš„éŒ¯èª¤ã€‚\ndeployment.yaml spec: terminationGracePeriodSeconds: 30 securityContext: {} containers: - name: soketi securityContext: {} image: \"quay.io/soketi/soketi::1.6.0-16-alpine\" ... çœç•¥ (å¯ä»¥åˆ° github çœ‹ code)... livenessProbe: failureThreshold: 3 httpGet: httpHeaders: - name: X-Kube-Healthcheck value: \"Yes\" path: / port: 6001 initialDelaySeconds: 5 periodSeconds: 2 successThreshold: 1 readinessProbe: failureThreshold: 3 httpGet: httpHeaders: - name: X-Kube-Healthcheck value: \"Yes\" path: /ready port: 6001 initialDelaySeconds: 5 periodSeconds: 2 successThreshold: 1 lifecycle: preStop: exec: command: [\"/bin/sh\", \"-c\", \"sleep 20\"] Pod çµ‚æ­¢çš„éç¨‹ "},"title":"Soketi WebSocket Server LOG ä¸å®šæ™‚å‡ºç¾ 502 error ä»¥åŠ connect() failed (111: Connection refused)"},"/docs/opentelemetry/":{"data":{"":"Explore the following sections to learn how to use Hextra:\nå¦‚ä½•é€é OpenTelemetry ä¾†æ”¶é›† Ingress Nginx Controller çš„ Metrics èˆ‡ Traces ä¸¦é€åˆ° Datadog ä¸Š "},"title":"Opentelemetry"},"/docs/opentelemetry/opentelemetry-ingress-nginx-controller/":{"data":{"":"ç”±æ–¼æœ€è¿‘å…¬å¸æƒ³è¦å°å…¥ Datadogï¼Œåœ¨æ¸¬è©¦éç¨‹ä¸­é †ä¾¿å°å…¥ OpenTelemetry ä¾†æ”¶é›† Metrics èˆ‡ Traces ä¸¦é€åˆ° Datadog ä¸Š ï½\nğŸ”¥ é€™å€‹ç¯„ä¾‹æ¯”è¼ƒç‰¹åˆ¥ï¼Œå› ç‚º Datadog æœ‰æä¾› Ingress Nginx Controller çš„ integrationsï¼Œå¯ä»¥é€é Datadog Agent ä¾†æ”¶é›† Metricsï¼Œä¸éœ€è¦é€é OpenTelemetry Collector ä¾†æ”¶é›†ã€‚ ( Datadog Agent è«‹åƒè€ƒï¼šhttps://docs.datadoghq.com/containers/kubernetes/ )\nç¨‹å¼éƒ¨åˆ†ä¹ŸåŒæ­¥ä¸Šå‚³åˆ° github ä¸Šï¼Œå¯ä»¥é»æˆ‘å‰å¾€","åƒè€ƒ#åƒè€ƒ":"Configure Nginx Ingress Controller to use JSON log formatï¼šhttps://dev.to/bzon/send-gke-nginx-ingress-controller-logs-to-stackdriver-2ih4\næ·ºè«‡ OpenTelemetry - Collector Compoentsï¼šhttps://ithelp.ithome.com.tw/articles/10290703","åŸ·è¡Œæ­¥é©Ÿ#åŸ·è¡Œæ­¥é©Ÿ":" å…ˆ clone é€™å€‹ repo (å»¢è©± xD)\nå…ˆå»ºç«‹ OpenTelemetry Collectorï¼ŒåŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š\nhelm upgrade collector \\ opentelemetry-collector \\ --repo https://open-telemetry.github.io/opentelemetry-helm-charts \\ --install \\ --create-namespace \\ --namespace opentelemetry \\ -f \"otel-collector.yaml\" å†å»ºç«‹ Ingress Nginx Controllerï¼ŒåŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š\nhelm upgrade ingress-nginx \\ ingress-nginx \\ --repo https://kubernetes.github.io/ingress-nginx \\ --install \\ --create-namespace \\ --namespace ingress-nginx \\ -f \"ingress-nginx-values.yaml\" æ¥è‘—å»ºç«‹æ¸¬è©¦ç”¨ Nginx æœå‹™ï¼ŒåŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š\nkubectl apply -f nginx.yaml ","æª”æ¡ˆèªªæ˜#æª”æ¡ˆèªªæ˜":" otel-collector.yamlï¼š OpenTelemetry Collector çš„è¨­å®šæª”ï¼Œä¸»è¦æ˜¯è¨­å®šè¦æ”¶é›†å“ªäº› metricsã€tracesï¼Œä¸¦ä¸”è¦é€åˆ°å“ªå€‹ exporterï¼Œè¦æ³¨æ„çš„æ˜¯ exporters çš„ datadog éœ€è¦è¨­å®š siteã€api_keyï¼Œä»¥åŠ image è¦è¨˜å¾—ç”¨ otel/opentelemetry-collector-contribï¼Œæ‰æœƒæœ‰ datadog çš„ exporterã€‚\ningress-nginx-values.yamlï¼š Ingress Nginx Controller çš„è¨­å®šæª”ï¼Œé€™é‚Šçš„ podAnnotations æ˜¯ç‚ºäº†è®“ Ingress Nginx Controller çš„ Pod èƒ½å¤ é€é Datadog agent æ”¶é›† metrics åˆ° Datadog æ‰åŠ ä¸Šçš„ã€‚\nconfig è£¡é¢çš„è¨­å®šæœ‰å¾ˆå¤šï¼Œä¸»è¦éƒ½æ˜¯ openTelemetry çš„è¨­å®šï¼Œè¦æ³¨æ„çš„æ˜¯ enable-opentelemetry è¦è¨­ç‚º trueï¼Œå¦å¤– otlp-collector-host ä»¥åŠ otlp-collector-port è¦é€åˆ°å“ªå€‹ collector ç­‰ç­‰ä¹Ÿè¦è¨˜å¾—è¨­å®šã€‚ å¦å¤–å¦‚æœæƒ³è¦å°‡ LOG èˆ‡ Trace ä¸²å†ä¸€èµ·ï¼Œè¨˜å¾—è¦æŠŠ log-format è¨­ç‚º jsonï¼Œä¸¦ä¸”å¸¶å…¥ï¼Œtrace_id èˆ‡ span_id ( é€™é‚Šæœ‰å¤šå¸¶ dd.trace_id æ˜¯ç‚ºäº†è®“ datadog å¯ä»¥è‡ªå‹•ä¸²æ¥ LOG \u0026 Trace )ã€‚\nnginx.yamlï¼š ä¸€å€‹ç°¡å–®çš„ Nginx æ•´å¥—æœå‹™ (Deploymentã€Serviceã€Ingress)ï¼Œè¦æ³¨æ„çš„æ˜¯ Ingress éœ€è¦è¨­å®š annotations kubernetes.io/ingress.class: nginx (é€™å€‹æ˜¯ Ingress Nginx Controller çš„é è¨­ class name)ï¼Œæ‰æœƒè¢« Ingress Nginx Controller æ¥ç®¡ (æ‰æœƒæœ‰ Load Balancer çš„ IP)","æ¸¬è©¦#æ¸¬è©¦":"ç•¶ä½ åŸ·è¡Œå®Œä¸Šé¢çš„æ­¥é©Ÿå¾Œï¼Œä½ æœƒç™¼ç¾æœ‰ç”¢ç”Ÿå…©å€‹ namespaceï¼Œä¸€å€‹æ˜¯ ingress-nginxï¼Œå¦ä¸€å€‹æ˜¯ opentelemetryï¼Œä¸¦ä¸”æœƒæœ‰ OpenTelemetry Collectorã€Ingress Nginx Controllerã€Nginx ç­‰æœå‹™ï¼Œå¦‚ä¸‹ï¼š\nå•Ÿå‹•æœå‹™ æˆ‘å€‘è©¦è‘—æ‰“ http://nginx.example.com/ (æ¸¬è©¦ç¶²å€ï¼Œéœ€è¦å…ˆåœ¨ /etc/hosts ç¶å®š Ingress Nginx Controller å’¬ä½çš„ Load Balancer IP)ï¼ŒæŸ¥çœ‹ä¸€ä¸‹ Datadog çš„ LOGï¼Œçœ‹çœ‹æ˜¯å¦æœ‰æ”¶åˆ° Nginx çš„ LOG (æ­¤æ”¶é›† LOG çš„æ–¹å¼æ˜¯é€éåœ¨ cluster ä¸Šå®‰è£ Datadog çš„ agent)ï¼Œå¦‚ä¸‹ï¼š\nDatadog LOG æ¥è‘—æŸ¥çœ‹ Datadog APM çš„ traceï¼Œå¦‚ä¸‹ï¼š\nDatadog APM ç”±æ–¼æˆ‘å€‘åœ¨å¾Œé¢ç›®å‰æ²’æœ‰ä¸²å…¶ä»–æœå‹™ï¼Œæ‰€ä»¥åªæœ‰ä¸€å€‹ spanï¼Œä¹‹å¾Œé‚„æœ‰å¦å¤–å…©ç¯‡æ–‡ç« æ˜¯ä»‹ç´¹å¦‚ä½•ä¸²å…¶ä»–æœå‹™ (æœƒå¢åŠ æœå‹™ä»¥åŠéƒ¨åˆ†è¨­å®š)ï¼Œå¯ä»¥åƒè€ƒçœ‹çœ‹ï¼šopentelemetry-roadrunnerã€opentelemetry-nodejs\né †ä¾¿çœ‹ä¸€ä¸‹é€é Datadog Agent æ”¶é›†çš„ Ingress Nginx Controller çš„ Metricsï¼Œå¦‚ä¸‹ï¼š\nDatadog Ingress Nginx Controller çš„ Metrics å¯ä»¥ç”¨é€™äº› Metrics ä¾†åš Dashboardï¼Œå¦‚ä¸‹ï¼š\nDatadog Dashboard ","çµè«–#çµè«–":"é€é OpenTelemetry Collector ä¾†æ”¶é›† Ingress Nginx Controller çš„ Metrics èˆ‡ Traces ä¸¦é€åˆ° Datadog ä¸Šï¼Œé€™æ¨£å°±å¯ä»¥é€é Ingress Nginx Controller çš„ Metrics ä¾†åšç›£æ§äº†ï¼Œå°æ–¼ RD å†é–‹ç™¼ä¸Šï¼Œæœ‰ Traces ä¹Ÿæ›´æ–¹ä¾¿ RD ä»–å€‘æ‰¾åˆ°ç¨‹å¼çš„ç“¶é ¸ (æœ‰å¯èƒ½æ˜¯æœå‹™å°è‡´çš„)ã€‚"},"title":"å¦‚ä½•é€é OpenTelemetry ä¾†æ”¶é›† Ingress Nginx Controller çš„ Metrics èˆ‡ Traces ä¸¦é€åˆ° Datadog ä¸Š"},"/projects/":{"data":{"":" æ´»å‹•ç”³è«‹ç³»çµ± (Web) "},"title":"å°ˆæ¡ˆæˆå°±"}}